"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("react");var t,i={},r={};var n,o,a={};
/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function s(){return n||(n=1,"production"!==process.env.NODE_ENV&&function(){var t=e,i=Symbol.for("react.element"),r=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),v=Symbol.for("react.offscreen"),g=Symbol.iterator;var m=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function y(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];b("error",e,i)}function b(e,t,i){var r=m.ReactDebugCurrentFrame.getStackAddendum();""!==r&&(t+="%s",i=i.concat([r]));var n=i.map((function(e){return String(e)}));n.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,n)}var x;function w(e){return e.displayName||"Context"}function S(e){if(null==e)return null;if("number"==typeof e.tag&&y("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case n:return"Fragment";case r:return"Portal";case s:return"Profiler";case o:return"StrictMode";case f:return"Suspense";case h:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case l:return w(e)+".Consumer";case c:return w(e._context)+".Provider";case u:return function(e,t,i){var r=e.displayName;if(r)return r;var n=t.displayName||t.name||"";return""!==n?i+"("+n+")":i}(e,e.render,"ForwardRef");case p:var t=e.displayName||null;return null!==t?t:S(e.type)||"Memo";case d:var i=e,a=i._payload,v=i._init;try{return S(v(a))}catch(g){return null}}return null}x=Symbol.for("react.module.reference");var j,A,O,C,k,R,I,T=Object.assign,$=0;function F(){}F.__reactDisabledLog=!0;var P,L=m.ReactCurrentDispatcher;function _(e,t,i){if(void 0===P)try{throw Error()}catch(n){var r=n.stack.trim().match(/\n( *(at )?)/);P=r&&r[1]||""}return"\n"+P+e}var W,E=!1,M="function"==typeof WeakMap?WeakMap:Map;function z(e,t){if(!e||E)return"";var i,r=W.get(e);if(void 0!==r)return r;E=!0;var n,o=Error.prepareStackTrace;Error.prepareStackTrace=void 0,n=L.current,L.current=null,function(){if(0===$){j=console.log,A=console.info,O=console.warn,C=console.error,k=console.group,R=console.groupCollapsed,I=console.groupEnd;var e={configurable:!0,enumerable:!0,value:F,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}$++}();try{if(t){var a=function(){throw Error()};if(Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(a,[])}catch(d){i=d}Reflect.construct(e,[],a)}else{try{a.call()}catch(d){i=d}e.call(a.prototype)}}else{try{throw Error()}catch(d){i=d}e()}}catch(v){if(v&&i&&"string"==typeof v.stack){for(var s=v.stack.split("\n"),c=i.stack.split("\n"),l=s.length-1,u=c.length-1;l>=1&&u>=0&&s[l]!==c[u];)u--;for(;l>=1&&u>=0;l--,u--)if(s[l]!==c[u]){if(1!==l||1!==u)do{if(l--,--u<0||s[l]!==c[u]){var f="\n"+s[l].replace(" at new "," at ");return e.displayName&&f.includes("<anonymous>")&&(f=f.replace("<anonymous>",e.displayName)),"function"==typeof e&&W.set(e,f),f}}while(l>=1&&u>=0);break}}}finally{E=!1,L.current=n,function(){if(0==--$){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:T({},e,{value:j}),info:T({},e,{value:A}),warn:T({},e,{value:O}),error:T({},e,{value:C}),group:T({},e,{value:k}),groupCollapsed:T({},e,{value:R}),groupEnd:T({},e,{value:I})})}$<0&&y("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=o}var h=e?e.displayName||e.name:"",p=h?_(h):"";return"function"==typeof e&&W.set(e,p),p}function q(e,t,i){if(null==e)return"";if("function"==typeof e)return z(e,!(!(r=e.prototype)||!r.isReactComponent));var r;if("string"==typeof e)return _(e);switch(e){case f:return _("Suspense");case h:return _("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case u:return z(e.render,!1);case p:return q(e.type,t,i);case d:var n=e,o=n._payload,a=n._init;try{return q(a(o),t,i)}catch(s){}}return""}W=new M;var D=Object.prototype.hasOwnProperty,N={},B=m.ReactDebugCurrentFrame;function U(e){if(e){var t=e._owner,i=q(e.type,e._source,t?t.type:null);B.setExtraStackFrame(i)}else B.setExtraStackFrame(null)}var H=Array.isArray;function Q(e){return H(e)}function V(e){return""+e}function Y(e){if(function(e){try{return V(e),!1}catch(t){return!0}}(e))return y("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",function(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}(e)),V(e)}var J,K,X,Z=m.ReactCurrentOwner,G={key:!0,ref:!0,__self:!0,__source:!0};X={};function ee(e,t,r,n,o){var a,s={},c=null,l=null;for(a in void 0!==r&&(Y(r),c=""+r),function(e){if(D.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(t)&&(Y(t.key),c=""+t.key),function(e){if(D.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return void 0!==e.ref}(t)&&(l=t.ref,function(e,t){if("string"==typeof e.ref&&Z.current&&t&&Z.current.stateNode!==t){var i=S(Z.current.type);X[i]||(y('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',S(Z.current.type),e.ref),X[i]=!0)}}(t,o)),t)D.call(t,a)&&!G.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps){var u=e.defaultProps;for(a in u)void 0===s[a]&&(s[a]=u[a])}if(c||l){var f="function"==typeof e?e.displayName||e.name||"Unknown":e;c&&function(e,t){var i=function(){J||(J=!0,y("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};i.isReactWarning=!0,Object.defineProperty(e,"key",{get:i,configurable:!0})}(s,f),l&&function(e,t){var i=function(){K||(K=!0,y("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};i.isReactWarning=!0,Object.defineProperty(e,"ref",{get:i,configurable:!0})}(s,f)}return function(e,t,r,n,o,a,s){var c={$$typeof:i,type:e,key:t,ref:r,props:s,_owner:a,_store:{}};return Object.defineProperty(c._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(c,"_self",{configurable:!1,enumerable:!1,writable:!1,value:n}),Object.defineProperty(c,"_source",{configurable:!1,enumerable:!1,writable:!1,value:o}),Object.freeze&&(Object.freeze(c.props),Object.freeze(c)),c}(e,c,l,o,n,Z.current,s)}var te,ie=m.ReactCurrentOwner,re=m.ReactDebugCurrentFrame;function ne(e){if(e){var t=e._owner,i=q(e.type,e._source,t?t.type:null);re.setExtraStackFrame(i)}else re.setExtraStackFrame(null)}function oe(e){return"object"==typeof e&&null!==e&&e.$$typeof===i}function ae(){if(ie.current){var e=S(ie.current.type);if(e)return"\n\nCheck the render method of `"+e+"`."}return""}te=!1;var se={};function ce(e,t){if(e._store&&!e._store.validated&&null==e.key){e._store.validated=!0;var i=function(e){var t=ae();if(!t){var i="string"==typeof e?e:e.displayName||e.name;i&&(t="\n\nCheck the top-level render call using <"+i+">.")}return t}(t);if(!se[i]){se[i]=!0;var r="";e&&e._owner&&e._owner!==ie.current&&(r=" It was passed a child from "+S(e._owner.type)+"."),ne(e),y('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',i,r),ne(null)}}}function le(e,t){if("object"==typeof e)if(Q(e))for(var i=0;i<e.length;i++){var r=e[i];oe(r)&&ce(r,t)}else if(oe(e))e._store&&(e._store.validated=!0);else if(e){var n=function(e){if(null===e||"object"!=typeof e)return null;var t=g&&e[g]||e["@@iterator"];return"function"==typeof t?t:null}(e);if("function"==typeof n&&n!==e.entries)for(var o,a=n.call(e);!(o=a.next()).done;)oe(o.value)&&ce(o.value,t)}}function ue(e){var t,i=e.type;if(null!=i&&"string"!=typeof i){if("function"==typeof i)t=i.propTypes;else{if("object"!=typeof i||i.$$typeof!==u&&i.$$typeof!==p)return;t=i.propTypes}if(t){var r=S(i);!function(e,t,i,r,n){var o=Function.call.bind(D);for(var a in e)if(o(e,a)){var s=void 0;try{if("function"!=typeof e[a]){var c=Error((r||"React class")+": "+i+" type `"+a+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[a]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw c.name="Invariant Violation",c}s=e[a](t,a,r,i,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(l){s=l}!s||s instanceof Error||(U(n),y("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",r||"React class",i,a,typeof s),U(null)),s instanceof Error&&!(s.message in N)&&(N[s.message]=!0,U(n),y("Failed %s type: %s",i,s.message),U(null))}}(t,e.props,"prop",r,e)}else if(void 0!==i.PropTypes&&!te){te=!0,y("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",S(i)||"Unknown")}"function"!=typeof i.getDefaultProps||i.getDefaultProps.isReactClassApproved||y("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function fe(e,t,r,a,g,m){var b=function(e){return"string"==typeof e||"function"==typeof e||e===n||e===s||e===o||e===f||e===h||e===v||"object"==typeof e&&null!==e&&(e.$$typeof===d||e.$$typeof===p||e.$$typeof===c||e.$$typeof===l||e.$$typeof===u||e.$$typeof===x||void 0!==e.getModuleId)}(e);if(!b){var w="";(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(w+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var j,A=function(e){return void 0!==e?"\n\nCheck your code at "+e.fileName.replace(/^.*[\\\/]/,"")+":"+e.lineNumber+".":""}(g);w+=A||ae(),null===e?j="null":Q(e)?j="array":void 0!==e&&e.$$typeof===i?(j="<"+(S(e.type)||"Unknown")+" />",w=" Did you accidentally export a JSX literal instead of a component?"):j=typeof e,y("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",j,w)}var O=ee(e,t,r,g,m);if(null==O)return O;if(b){var C=t.children;if(void 0!==C)if(a)if(Q(C)){for(var k=0;k<C.length;k++)le(C[k],e);Object.freeze&&Object.freeze(C)}else y("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else le(C,e)}return e===n?function(e){for(var t=Object.keys(e.props),i=0;i<t.length;i++){var r=t[i];if("children"!==r&&"key"!==r){ne(e),y("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",r),ne(null);break}}null!==e.ref&&(ne(e),y("Invalid attribute `ref` supplied to `React.Fragment`."),ne(null))}(O):ue(O),O}var he=function(e,t,i){return fe(e,t,i,!1)},pe=function(e,t,i){return fe(e,t,i,!0)};a.Fragment=n,a.jsx=he,a.jsxs=pe}()),a}o={get exports(){return i},set exports(e){i=e}},"production"===process.env.NODE_ENV?o.exports=function(){if(t)return r;t=1;var i=e,n=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,i){var r,o={},l=null,u=null;for(r in void 0!==i&&(l=""+i),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!c.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:n,type:e,key:l,ref:u,props:o,_owner:s.current}}return r.Fragment=o,r.jsx=l,r.jsxs=l,r}():o.exports=s();const c=i.Fragment,l=i.jsx,u=i.jsxs,f={},h={get:e=>e,setMetaValue([e,t,i],r){const n=h.getResourceMeta(e,t),o=n?n[i]:void 0,a="function"==typeof r?r(o):r;f[e]={...f[e]||{},[t]:{...(f[e]||{})[t]||{},[i]:a}}},getResourceMeta:(e,t)=>{const i=f[e];if(i)return t?i[t]:i}};function p(e){return e.endsWith("info.json")?e:e.endsWith("/")?`${e}info.json`:`${e}/info.json`}const d="http://library.stanford.edu/iiif/image-api/compliance.html#level1",v="http://library.stanford.edu/iiif/image-api/compliance.html#level2",g="http://library.stanford.edu/iiif/image-api/conformance.html#level1",m="http://library.stanford.edu/iiif/image-api/conformance.html#level2",y="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",b="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",x="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",w="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",S="http://iiif.io/api/image/1/level1.json",j="http://iiif.io/api/image/1/profiles/level1.json",A="http://iiif.io/api/image/1/level2.json",O="http://iiif.io/api/image/1/profiles/level2.json",C="http://iiif.io/api/image/2/level1.json",k="http://iiif.io/api/image/2/profiles/level1.json",R="http://iiif.io/api/image/2/level2.json",I="http://iiif.io/api/image/2/profiles/level2.json",T="level1",$="level2",F="http://iiif.io/api/image/2/level1",P="http://iiif.io/api/image/2/level2",L=[P,v,m,b,w,A,O,R,I,$],_=[...L,F,d,g,y,x,S,j,C,k,T],W=["http://iiif.io/api/image/2/level0",F,P,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",d,v,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",g,m,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",y,b,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",x,w,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",S,j,A,O,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",C,k,R,I,"level0",T,$],E={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},M={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},z={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]};function q(e){return-1!==L.indexOf(e)?z:-1!==_.indexOf(e)?M:E}function D(e){try{if("full"===e)return{full:!0};if("square"===e)return{square:!0};const t=e.startsWith("pct:"),i=e.substr(t?4:0).split(",").map((e=>parseFloat(e)));return{x:i[0],y:i[1],w:i[2],h:i[3],percent:t}}catch{throw new Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+e)}}function N(e){const t={upscaled:!1,max:!1,confined:!1};if("^"===e[0]&&(t.upscaled=!0,e=e.slice(1)),"max"===e||"full"===e)return t.max=!0,t.serialiseAsFull="full"===e,t;if("!"===e[0]&&(t.confined=!0,e=e.slice(1)),"p"===e[0])return t.percentScale=parseFloat(e.slice(4)),t;const i=e.split(",").map((e=>e.trim()));return i.length&&(""!==i[0]&&(t.width=parseInt(i[0],10)),""!==i[1]?(t.height=parseInt(i[1],10),t.version=2):t.version=3),t}function B(e){const t={angle:0};if("!"===e[0]&&(t.mirror=!0,e=e.substr(1)),t.angle=parseFloat(e)%360,Number.isNaN(t.angle))throw new Error(`Invalid rotation ${e}`);return t}function U(e,t=""){const{path:i,scheme:r,server:n,prefix:o}=function(e,t=""){const i=e.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!i)throw new Error(`Invalid or unknown input ${e}`);const r=i[2],n=i[3];let o=i[4];if("/"===o[0]&&(o=o.substr(1)),t.length>0){if("/"===t[0]&&(t=t.substr(1)),t!==o.substr(0,t.length))throw new Error(`Path does not start with prefix (path: ${o}, prefix: ${t})`);o=o.substr(t.length)}return{scheme:r,server:n,path:o,prefix:t}}(e,t),a=i.split("/").reverse(),[s,c,l,u,...f]=a,h=f.reverse().filter(Boolean).join("/");if(1===a.length||""===s)return{type:"base",scheme:r,server:n,prefix:o,identifier:h};if("info.json"===s){const[,...e]=a;return{type:"info",scheme:r,server:n,prefix:o,identifier:e.reverse().filter(Boolean).join("/")}}const p=s.split(".");return{type:"image",scheme:r,server:n,prefix:o,identifier:h,originalPath:i,region:D(u),size:N(l),rotation:B(c),quality:p[0],format:p[1]}}function H(e){const t=U(p(e.id));if("info"!==t.type)throw new Error("Invalid service URL");const i=function(e){const t=e?Array.isArray(e.profile)?e.profile:[e.profile]:[],i={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let r of t)if("string"==typeof r&&(r=q(r)),r){if(r.formats)for(const e of r.formats)-1===i.extraFormats.indexOf(e)&&i.extraFormats.push(e);if(r.qualities)for(const e of r.qualities)-1===i.extraQualities.indexOf(e)&&i.extraQualities.push(e);if(r.supports)for(const e of r.supports)-1===i.extraFeatures.indexOf(e)&&i.extraFeatures.push(e);if(r.maxHeight&&(i.maxHeight=r.maxHeight),r.maxWidth&&(i.maxWidth=r.maxWidth),r.maxArea&&(i.maxArea=r.maxArea),r.extraFormats)for(const e of r.extraFormats)-1===i.extraFormats.indexOf(e)&&i.extraFormats.push(e);if(r.extraQualities)for(const e of r.extraQualities)-1===i.extraQualities.indexOf(e)&&i.extraQualities.push(e);if(r.extraFeatures)for(const e of r.extraFeatures)-1===i.extraFeatures.indexOf(e)&&i.extraFeatures.push(e);r.maxHeight&&(i.maxHeight=r.maxHeight),r.maxWidth&&(i.maxWidth=r.maxWidth),r.maxArea&&(i.maxArea=r.maxArea)}if(e.extraFormats)for(const r of e.extraFormats)-1===i.extraFormats.indexOf(r)&&i.extraFormats.push(r);if(e.extraFeatures)for(const r of e.extraFeatures)-1===i.extraFeatures.indexOf(r)&&i.extraFeatures.push(r);if(e.extraQualities)for(const r of e.extraQualities)-1===i.extraQualities.indexOf(r)&&i.extraQualities.push(r);return i}(e);return{identifier:t.identifier,originalPath:"",server:t.server,prefix:t.prefix,scheme:t.scheme,type:"image",quality:-1===i.extraQualities.indexOf("default")?i.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}function Q(e,t,i){const r=i.length,n=[];for(let o=0;o<r;o++){const t=i[o].width;n.push(e/t)}return n}function V(e,t,i){const r=i.length,n=[];for(let o=0;o<r;o++){const r=i[o];n.push({width:Math.floor(e/r),height:Math.floor(t/r)})}return n}function Y(e){return e["@id"]?e["@id"]:e.id?e.id:void 0}function J(e){if(!e||!e.profile||!Y(e))return!1;const t=Array.isArray(e.profile)?e.profile:[e.profile];for(const i of t)if("string"==typeof i&&-1!==W.indexOf(i))return!0;return!1}function K(e,t){if(t&&t.profile){const i=t.profile;if(i){const t=Array.isArray(i)?i:[i];return t.includes(`level${e}`)||t.includes(`http://iiif.io/api/image/2/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/profiles/level${e}.json`)}}return!1}function X(e){return J(e)?K(0,e)?0:K(1,e)?1:K(2,e)?2:null:null}function Z(e){return-1!==(e["@context"]?Array.isArray(e["@context"])?e["@context"]:[e["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")}function G(e){if(!function(e){if(!J(e))return!1;const t=Array.isArray(e.profile)?e.profile:[e.profile];for(const i of t)if("string"==typeof i){if(-1!==_.indexOf(i))return!0}else{const e=[...i.supports||[],...i.extraFeatures||[]];if(-1!==e.indexOf("regionByPx")&&(-1!==e.indexOf("sizeByW")||-1!==e.indexOf("sizeByWh")))return!0}return!1}(e))return[];const t=[],i=Array.isArray(e.profile)?e.profile:[e.profile],r=i.length;for(let n=0;n<r;n++){const t=i[n];if("string"!=typeof t&&(t.maxHeight||t.maxWidth))return[{id:Y(e),type:"variable",minWidth:0,minHeight:0,maxHeight:t.maxHeight||t.maxWidth,maxWidth:t.maxWidth||t.maxHeight,level:X(e),version:"http://iiif.io/api/image/3/context.json"===e["@context"]?3:2}]}if(e.tiles){const i=e.tiles.length;for(let r=0;r<i;r++){const i=e.tiles[r];(i.height||i.width)&&t.push({id:Y(e),type:"variable",minHeight:0,minWidth:0,maxHeight:i.height||i.width,maxWidth:i.width,level:X(e),version:Z(e)?3:2})}}return t}function ee(e){const t=e.match(/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/);if(t){const i=t[1],r=parseInt(t[4],10),n=parseInt(t[5],10),o=t[7];if(("max"===i||"full"===i)&&r&&n&&o)return{type:"fixed",id:e,height:n,width:r}}return{type:"unknown",id:e}}function te(e){if("string"==typeof e)return ee(e);const t=function(e){return e["@type"]?e["@type"]:e.type?e.type:void 0}(e);if("Image"!==t&&"sc:Image"!==t)return null;const i=e,r=Y(i);return r?r&&i.width&&i.height?{id:r,type:"fixed",width:i.width,height:i.height,unsafe:!0}:ee(r):null}function ie(e){return J(e)?(e&&e.sizes?e.sizes:[]).map((t=>({id:Y(e),type:"fixed-service",height:t.height,width:t.width,level:X(e),version:Z(e)?3:2}))):[]}function re(e){const t=[],i=e.length;for(let r=0;r<i;r++){const i=ie(e[r]);i.length&&t.push(...i);const n=G(e[r]);n.length&&t.push(...n)}return t}function ne(e){const t=e.service?Array.isArray(e.service)?e.service:[e.service]:[],i=t.length,r=[];for(let n=0;n<i;n++)J(t[n])&&r.push(t[n]);return r}function oe({x:e=0,y:t=0,w:i,h:r,full:n,square:o,percent:a}){if(n)return"full";if(o)return"square";if(typeof i>"u"||typeof r>"u")throw new Error("RegionParameter: invalid region");const s=`${e},${t},${i},${r}`;return a?`pct:${s}`:s}function ae({max:e,percentScale:t,upscaled:i,confined:r,width:n,height:o,serialiseAsFull:a,version:s}){const c=[];return i&&c.push("^"),e?(c.push(a?"full":"max"),c.join("")):(r&&c.push("!"),t&&c.push(`pct:${t}`),n&&c.push(`${n}`),c.push(","),o&&3===s&&c.push(`${o}`),c.join(""))}function se(e){return`${e.mirror?"!":""}${(e.angle||0)%360}`}var ce=Object.defineProperty,le=Object.defineProperties,ue=Object.getOwnPropertyDescriptors,fe=Object.getOwnPropertySymbols,he=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable,de=(e,t,i)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ve=(e,t)=>{for(var i in t||(t={}))he.call(t,i)&&de(e,i,t[i]);if(fe)for(var i of fe(t))pe.call(t,i)&&de(e,i,t[i]);return e},ge=(e,t)=>le(e,ue(t));function me(e,t){const i=e.prefix.startsWith("/")?e.prefix.substr(1):e.prefix,r=`${e.scheme}://${e.server}/${i?`${i}/`:""}${e.identifier}`;if("base"===e.type)return r;if("info"===e.type)return`${r}/info.json`;let{size:n}=e;const{region:o,rotation:a,format:s,quality:c}=e;if(t){const e=t["@context"]?Array.isArray(t["@context"])?t["@context"]:[t["@context"]]:[],i=-1!==e.indexOf("http://iiif.io/api/image/2/context.json"),r=-1!==e.indexOf("http://iiif.io/api/image/3/context.json");if((n.width===t.width&&!n.height||n.height===t.height&&!n.width||n.width===t.width&&n.height===t.height)&&(n=ge(ve({},n),{max:!0})),i&&(n.max&&!n.serialiseAsFull&&(n=ge(ve({},n),{serialiseAsFull:!0})),!n.max&&n.width&&n.height&&(n=ge(ve({},n),{height:void 0})),n=ge(ve({},n),{version:2})),r){if(n.max&&n.serialiseAsFull&&(n=ge(ve({},n),{serialiseAsFull:!1})),n.width&&!n.height&&t.width&&t.height){const e=t.height/t.width;n=ge(ve({},n),{height:Math.ceil(n.width*e)})}n=ge(ve({},n),{version:3})}}return[r,oe(o),ae(n),se(a),`${c}.${s}`].filter(Boolean).join("/")}function ye(e,t,i){const r=H({"@context":3===e.version?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:p(Y(e)),profile:null===e.level||typeof e.level>"u"?"level0":`level${e.level}}`,type:3===e.version?"ImageService3":"ImageService2"});if("image"!==r.type)throw new Error("Invalid service");return r.size.max=!1,r.size.width=t,r.size.height=i,{id:me(r),type:"fixed",width:t,height:i||e.height/(e.width||1)*t,unsafe:e.width>t}}function be(e){const t=e.replace(/(https?:\/\/)?(www.)?/i,"");return-1!==t.indexOf("/")?t.split("/")[0]:t}function xe(e,t){const i=[],r=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},e),n=(e,t=0)=>r.explain?i.push(new Array(t).fill(0).map((e=>"    ")).join("")+e().trim()):void 0,o=[],a=[];let s=null;n((()=>`Using configuration: ${JSON.stringify(r,null,2)}`));const c=(e,t)=>{if(n((()=>"Swapping choice"),3),function(e,t,i){const r=e.width?e.width:e.maxWidth;return i.height<=e.maxHeight&&i.width<=e.maxWidth&&i.height>=e.minHeight&&i.width>=e.minWidth&&(!t||Math.abs(i.width-r)<Math.abs(t.width-r))}(r,t,e)){if(r.preferFixedSize&&e.unsafe)return n((()=>`We found an image that was marked as unsafe, but it was the best size. (${e.id})`),4),void a.push(e);r.returnAllOptions&&t&&a.push(t),n((()=>`We found a new image that was the best size. (${e.id})`),4),s=e}else r.returnAllOptions&&a.push(e)};n((()=>`The input shows we have ${t.length} list(s) of candidates to choose from.`));const l=t.length;for(let u=0;u<l;u++){const e=t[u]();n((()=>`Candidate group ${u}: ${JSON.stringify(e,null,2)}`),1);const i=e.length;n((()=>`Checking candidate list number ${u} and found ${i} potential ways of creating image(s)`),1);for(let t=0;t<i;t++){const i=e[t];if(n((()=>`-> Checking candidate ${t}`),1),"unknown"===i.type&&r.atAnyCost&&(n((()=>'We\'ve found an unknown image type, adding this to the "last resort" list'),2),o.push(i)),"fixed"===i.type&&(i.unsafe?(n((()=>'We\'ve found an unsafe fixed image type, adding this to the "last resort" list'),2),o.push(i)):(n((()=>"We've found a fixed size image, checking if it matches the request"),2),c(i,s))),"fixed-service"===i.type)if(r.unsafeImageService){n((()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)"),2);c(ye(i,r.width,r.height),s)}else{n((()=>"Checking for an image from the tile source 3"),2);c(ye(i,i.width,i.height),s)}if("variable"===i.type&&i.maxWidth){c(ye({id:i.id,type:"fixed-service",width:i.maxWidth,height:i.maxWidth,level:i.level,version:i.version},i.maxWidth),s)}}if(s&&!r.returnAllOptions){if(s.unsafe||r.allowUnsafe)continue;n((()=>`We found a match in choice list number ${u}, no searching any more`));break}}return r.atAnyCost&&0===a.length?(n((()=>s?`We found an image! ${s.id} of type ${s.type}`:'We found no images, but "atAnyCost" is set, so returning that')),{best:s||o[0],fallback:o.slice(1),log:i}):r.returnAllOptions?(n((()=>"Returning all options that we have found")),{best:r.atAnyCost?s||a[0]||o[0]:s||a[0],fallback:[...a,...o],log:i}):(n((()=>"Returning the best image that we found, and a fallback")),{best:s||a[0]||null,fallback:s?a:a.slice(1),log:i})}var we=Object.defineProperty,Se=Object.defineProperties,je=Object.getOwnPropertyDescriptors,Ae=Object.getOwnPropertySymbols,Oe=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable,ke=(e,t,i)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Re=(e,t)=>{for(var i in t||(t={}))Oe.call(t,i)&&ke(e,i,t[i]);if(Ae)for(var i of Ae(t))Ce.call(t,i)&&ke(e,i,t[i]);return e},Ie=(e,t)=>Se(e,je(t));function Te(e,t,i){const r=e>t?e:t,n=i.length,o=[];for(let a=0;a<n;a++){const e=i[a];let t=e.scaleFactors[0],n=r/t;const s=[t];for(;n>=e.width;)t*=2,s.push(t),n/=2;o.push(Ie(Re({},e),{scaleFactors:s}))}return o}function $e(e){return K(0,e)}var Fe=(e,t,i)=>new Promise(((r,n)=>{var o=e=>{try{s(i.next(e))}catch(t){n(t)}},a=e=>{try{s(i.throw(e))}catch(t){n(t)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,a);s((i=i.apply(e,t)).next())}));class Pe{constructor(){this.config={verificationsRequired:1,approximateServices:!0,enableFetching:!0,disableThrottling:!1},this.fetchingCount=0,this.imageServices={},this.knownImageServers={}}setConfig(e){Object.assign(this.config,e)}sample(e,t,i=!0){const r=be(Y(e)),n=p(Y(e)),o=this.knownImageServers[r];return this.imageServices[n]=Object.assign(e,{real:!0}),o||!e.tiles||$e(e)?this.verify(e):(this.knownImageServers[r]={verifications:0,malformed:!1,root:r,preLoaded:i,sampledId:Y(e),verified:!1,server:null,result:{context:e["@context"]||[],sampledProfile:e.profile,resourceServiceRatio:t&&e.height?t.height/e.height:1,sampledSizes:e.sizes||[],sizeRatios:Q(e.width,e.height,e.sizes||[]),sampledTiles:e.tiles||[]}},!0)}preLoad(e,t=!0){this.knownImageServers[e.root]=e,t&&(this.knownImageServers[e.root].malformed=!1,this.knownImageServers[e.root].verifications=this.config.verificationsRequired)}predict(e,t=!1,i=!1){const r=null==e?void 0:e.source,n=be(Y(e)),o=this.knownImageServers[n];if(!o||!o.result||!(null==r?void 0:r.height)&&!e.height||!(null==r?void 0:r.width)&&!e.width||!i&&(o.malformed||o.verifications<this.config.verificationsRequired)||$e(e.source))return null;const a=p(Y(e));return this.imageServices[a]||(this.imageServices[a]={"@context":o.result.context,"@id":Y(e),id:Y(e),protocol:"http://iiif.io/api/image",tiles:(null==r?void 0:r.tiles)||Te(e.width,e.height,o.result.sampledTiles),sizes:(null==r?void 0:r.sizes)||V(Math.round(e.width/o.result.resourceServiceRatio),Math.round(e.height/o.result.resourceServiceRatio),o.result.sizeRatios),profile:(null==r?void 0:r.profile)||o.result.sampledProfile,height:(null==r?void 0:r.height)||e.height,width:(null==r?void 0:r.width)||e.width,real:!1}),this.imageServices[a]}getThumbnailFromResource(e,t){return Fe(this,arguments,(function*(e,t,i=!0,r=[]){const n=e?yield this.getImageCandidates(e,i):[];return xe(t,[()=>r,()=>n])}))}getImageCandidates(e,t=!0){return Fe(this,null,(function*(){const i=e;if(t&&i.height&&i.width){const e=ne(i);for(const t of e){const e={id:Y(t),width:t.width?t.width:i.width,height:t.height?t.height:i.height,source:t};yield this.loadService(e)}}return function(e,t=!0,i){const r=[],n=te(e);if(null===n)return r;const o=e;if(r.push(n),t&&o.width&&o.height){const e=[],t=ne(o);for(const r of t){const t={id:Y(r),width:o.width,height:o.height};if(i.canLoadSync(t)){const r=i.loadServiceSync(t);r&&(r.height||(r.height=o.height),r.width||(r.width=o.width),e.push(...re([r])))}}if(e.length)return r.push(...e),r}return o.service&&r.push(...re(o.service)),r}(e,t,this)}))}verify(e){return Fe(this,null,(function*(){const t=this.predict(e,!1,!0),i=yield this.fetchService(Y(e));if(!t)return!1;const r=t.height===i.height&&t.width===i.width&&t["@context"]===i["@context"]&&function(e,t){if(e.length!==t.length)return!1;if(0===e.length&&0===t.length)return!0;const i=e.length;let r=!0;for(let o=0;o<i;o++){const i=e[o],n=t[o];if(i.width!==n.width||i.height!==n.height){r=!1;break}}if(r)return!0;let n=0;for(let o=0;o<i;o++)for(let r=0;r<i;r++)if(e[o].width===t[r].width&&e[o].height===t[r].height){n++;break}return n===i}(t.sizes||[],i.sizes||[]);if(r){const t=be(Y(e));this.knownImageServers[t].verifications+=1,this.knownImageServers[t].verifications>=this.config.verificationsRequired&&(this.knownImageServers[t].verified=!0)}return r}))}canLoadSync(e){const t="string"==typeof e?e:Y(e),i=p(t);if(this.imageServices[i])return!0;const r=this.knownImageServers[be(t)];return r&&!r.malformed&&r.verifications>=this.config.verificationsRequired}markAsMalformed(e){return Fe(this,null,(function*(){return this.knownImageServers[be(Y(e))].malformed=!0,this.loadService(e,!0)}))}fetchService(e,t=!1){return Fe(this,null,(function*(){const i=p(e);if(this.imageServices[i]&&(!t||this.imageServices[i].real))return this.imageServices[i];if(!this.config.enableFetching)throw new Error("Fetching is not enabled");const r=yield this.fetch(i).then((e=>e.json()));return!r.id&&r["@id"]&&(r.id=r["@id"]),r.id!==e&&(r.id=e,r["@id"]&&(r["@id"]=e)),this.imageServices[i]=Object.assign(r,{real:!0}),this.imageServices[i]}))}fetch(e,t){return Fe(this,null,(function*(){return fetch(e,t)}))}loadService(e,t=!1){return Fe(this,null,(function*(){if(!this.config.disableThrottling){let e=!0;for(;e;){if(!(this.fetchingCount>=this.config.verificationsRequired)){e=!1;break}yield new Promise((e=>setTimeout(e,500)))}}const i=this.knownImageServers[be(Y(e))];if(i&&!i.malformed&&!t){yield i.result;const t=this.loadServiceSync(e);if(t)return t}this.fetchingCount++;const r=yield this.fetchService(Y(e),t);return this.fetchingCount--,r.real&&this.sample(r,e),r}))}loadServiceSync(e){const t=p(Y(e));return this.imageServices[t]?this.imageServices[t]:this.predict(e)}}function Le(e,t={}){return function(e,t,i={}){const{strictFallback:r=!1,defaultText:n="",separator:o="\n",fallbackLanguages:a=[],closest:s}=i,c=Object.keys(e||{}),l=s?t:function(e,t,i=[],r=!1){if(!e||!t||0===t.length)return;if(1===t.length)return t[0];if(-1!==t.indexOf(e))return e;const n=-1!==e.indexOf("-")?e.slice(0,e.indexOf("-")):null;if(n&&-1!==t.indexOf(n))return n;for(const o of i)if(-1!==t.indexOf(o))return o;if(!r){const r=t.map((e=>-1!==e.indexOf("-")?e.slice(0,e.indexOf("-")):null)).indexOf(e);if(-1!==r)return t[r];for(const e of i){const i=-1!==e.indexOf("-")?e.slice(0,e.indexOf("-")):null,r=i?t.indexOf(i):-1;if(-1!==r)return t[r]}}return-1!==t.indexOf("none")?"none":-1!==t.indexOf("@none")?"@none":t[0]}(t,c,a,r);if(!e)return n;if("string"==typeof e)return e;const u=l?e[l]:void 0;return u?"string"==typeof u?u:u.join(o):""}(e,"undefined"!=typeof navigator?navigator.language:void 0,t)}new Pe;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var _e,We,Ee,Me={exports:{}};_e=Me.exports,We=Object.defineProperty,Ee=(e,t,i)=>(((e,t,i)=>{t in e?We(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),function(e){const t="http://library.stanford.edu/iiif/image-api/compliance.html#level1",i="http://library.stanford.edu/iiif/image-api/compliance.html#level2",r="http://library.stanford.edu/iiif/image-api/conformance.html#level1",n="http://library.stanford.edu/iiif/image-api/conformance.html#level2",o="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",a="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",s="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",c="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",l="http://iiif.io/api/image/1/level1.json",u="http://iiif.io/api/image/1/profiles/level1.json",f="http://iiif.io/api/image/1/level2.json",h="http://iiif.io/api/image/1/profiles/level2.json",p="http://iiif.io/api/image/2/level1.json",d="http://iiif.io/api/image/2/profiles/level1.json",v="http://iiif.io/api/image/2/level2.json",g="http://iiif.io/api/image/2/profiles/level2.json",m="level1",y="level2",b="http://iiif.io/api/image/2/level1",x="http://iiif.io/api/image/2/level2",w=[b,x,t,i,r,n,o,a,s,c,l,u,f,h,p,d,v,g,m,y],S=["http://iiif.io/api/image/2/level0",b,x,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",t,i,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",r,n,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",o,a,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",s,c,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",l,u,f,h,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",p,d,v,g,"level0",m,y],j=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];class A{constructor(e,t={}){Ee(this,"traversals"),Ee(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(e){return new A({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){const t=[...(e.manifests||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e)),...(e.collections||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e)),...e.members||[]];delete e.collections,delete e.manifests,e.members=t}return e.manifests&&(e.manifests=e.manifests.map((e=>this.traverseManifest("string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e)))),e.collections&&(e.collections=e.collections.map((e=>this.traverseCollection("string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e)))),e.members&&(e.members=e.members.map((e=>"string"==typeof e?e:this.traverseUnknown(e)))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map((e=>this.traverseSequence(e)))),e.structures&&(e.structures=e.structures.map((e=>this.traverseRange(e)))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map((e=>this.traverseCanvas(e)))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map((e=>this.traverseAnnotation(e)))),e.otherContent&&(e.otherContent=e.otherContent.map((e=>this.traverseAnnotationList(e)))),e}traverseRange(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){const t=[...(e.ranges||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Range"}:e)),...(e.canvases||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Canvas"}:e)),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map((e=>this.traverseUnknown(e))):void 0}return e}traverseAnnotationList(e){const t="string"==typeof e?{"@id":e,"@type":"sc:AnnotationList"}:e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map((e=>this.traverseAnnotation(e)))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map((e=>this.traverseContentResource(e))):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map((e=>this.traverseAnnotationList(e)))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&"rdf:nil"!==e.default&&(e.default=this.traverseContentResource(e.default)),e.item&&"rdf:nil"!==e.item&&(e.item=e.item.map((e=>this.traverseContentResource(e)))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return"oa:Choice"===e["@type"]?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||"string"==typeof e)return e;switch(function(e){if(null==e)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw new Error("Array is not a valid entity");if("object"!=typeof e)throw new Error(typeof e+" is not a valid entity");if("string"==typeof e["@type"]){const t=j.indexOf(e["@type"]);if(-1!==t)return j[t]}if(e.profile)return"Service";if(e.format)return"ContentResource";if(e["@type"])return"ContentResource";throw new Error("Resource type is not known")}(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){const t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(const n of i)"string"==typeof n?r.push(this.traverseContentResource({"@id":n,"@type":"dctypes:Image"})):r.push(this.traverseContentResource(n));return t||this.options.convertPropsToArray?r:r[0]}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){const t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(const n of i)r.push(this.traverseService(n));return t||this.options.convertPropsToArray?r:r[0]}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&("string"==typeof e.within||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&("string"==typeof e.startCanvas?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&("string"==typeof e.contentLayer?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e)){if(!this.options.convertPropsToArray)return this.traverseType(e,t);e=[e]}return e.map((e=>this.traverseType(e,t)))}traverseType(e,t){return t.reduce(((e,t)=>{const i=t(e);return void 0!==i||this.options.allowUndefinedReturn?i:e}),e)}}const O="Attribution",C="http://example.org/provider",k="Unknown";function R(e,t="none"){if(!e)return{};const i=Array.isArray(e)?e:[e],r={};for(const n of i){if("string"==typeof n){r[t]=r[t]?r[t]:[],r[t].push(n||"");continue}if(!n["@language"]){r[t]=r[t]?r[t]:[],r[t].push(n["@value"]||"");continue}const e=n["@language"];r[e]=r[e]?r[e]:[],r[e].push(n["@value"]||"")}return r}function I(e){return Array.isArray(e)?I(e.find((e=>"string"==typeof e))):-1!==S.indexOf(e)?"level2":-1!==w.indexOf(e)?"level1":"string"==typeof e?e:void 0}function T(e){for(const t of["sc","oa","dcterms","dctypes","iiif"])if(e.startsWith(`${t}:`))return e.slice(t.length+1);return e}const $=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function F(e){const t=e["@id"]||e.id;let i=e["@type"]||e.type;const r=e.profile||void 0,n=e["@context"]||void 0;if(r){const e=function(e){switch(e){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}(r);if(e)return e}if(n){const e=function(e){const t=Array.isArray(e)?e:[e];for(const i of t)switch(i){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}(n);if(e)return e}if(i){if(Array.isArray(i)){if(-1!==i.indexOf("oa:CssStylesheet"))return"CssStylesheet";if(-1!==i.indexOf("cnt:ContentAsText"))return"TextualBody";i=i[0]}for(const e of["sc","oa","dcterms","dctypes","iiif"])if(i.startsWith(`${e}:`)){i=i.slice(e.length+1);break}switch(i){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(i&&-1!==$.indexOf(i))return i;if(e.format){if(e.format.startsWith("image/"))return"Image";if(e.format.startsWith("text/"))return"Text";if("application/pdf"===e.format)return"Text";if(e.format.startsWith("application/"))return"Dataset"}return t&&(t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".jpeg"))?"Image":i||"unknown"}const P=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function L(e){const t=e.match(P);return t?t[0]:e}const _=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function W(e){if(e){const t=Array.isArray(e)?e:[e],i=[];for(const e of t)"http://iiif.io/api/presentation/2/context.json"===e&&i.push("http://iiif.io/api/presentation/3/context.json"),-1===_.indexOf(e)&&i.push(e);if(t.length)return 1===i.length?i[0]:i}}function E(e){for(const t in e)void 0!==e[t]&&null!==e[t]||delete e[t];return e}let M=0;function z(e,t){const i=encodeURI(e.id||e["@id"]||"").trim();return i&&t?`${i}/${t}`:i||(M++,`http://example.org/${e["@type"]}${t?`/${t}`:""}/${M}`)}function q(e){const t=[...e.behavior||[]];let i;return e.viewingHint&&t.push(e.viewingHint),Array.isArray(e.motivation)?i=e.motivation.map(T):e.motivation&&(i=T(e.motivation)),{"@context":e["@context"]?W(e["@context"]):void 0,id:(e["@id"]||z(e)).trim(),type:F(e),behavior:t.length?t:void 0,height:e.height?e.height:void 0,width:e.width?e.width:void 0,motivation:i,viewingDirection:e.viewingDirection,profile:e.profile,format:e.format?e.format:void 0,duration:void 0,timeMode:void 0}}function D(e){const[t,i]=function(e,t="Rights/License",i="none"){let r=null;const n=[],o=Array.isArray(e)?e:[e];for(const a of o){const e=a?L(a):void 0;!e||-1===e.indexOf("creativecommons.org")&&-1===e.indexOf("rightsstatements.org")?e&&n.push({label:{[i]:[t]},value:{[i]:[e]}}):r=e.startsWith("https://")?`http://${e.slice(8)}`:e}return[r,n]}(e.license),r=[...e.metadata?(n=e.metadata,n?n.map((e=>({label:R(e.label),value:R(e.value)}))):[]):[],...i];var n;return{rights:t,metadata:r.length?r:void 0,label:e.label?R(e.label):void 0,requiredStatement:e.attribution?{label:R(O),value:R(e.attribution)}:void 0,navDate:e.navDate,summary:e.description?R(e.description):void 0,thumbnail:e.thumbnail}}function N(e){if(!e.within)return;const t=Array.isArray(e.within)?e.within:[e.within],i=[];for(const r of t)"string"==typeof r?r&&"sc:Manifest"===e["@type"]&&i.push({id:r,type:"Collection"}):r["@id"]&&i.push({id:r["@id"],type:F(r)});return i.length?i:void 0}function B(e){const t=e.related?Array.isArray(e.related)?e.related:[e.related]:[],i=e.contentLayer;return{provider:e.logo||t.length?[{id:C,type:"Agent",homepage:t.length?[t[0]]:void 0,logo:e.logo?Array.isArray(e.logo)?e.logo:[e.logo]:void 0,label:R(k)}]:void 0,partOf:N(e),rendering:e.rendering,seeAlso:e.seeAlso,start:e.startCanvas,service:e.service?(r=e.service,Array.isArray(r)?r:[r]):void 0,supplementary:i?[i]:void 0};var r}function U(e){const t=e;return E({...q(t),...D(t),...B(t),...(i=t,{chars:i.chars,format:i.format?i.format:void 0,language:i.language})});var i}const H=new A({collection:[function(e){return E({...q(e),...D(e),...B(e),items:e.members})}],manifest:[function(e){const t=[],i=[];for(const n of e.sequences||[])n.canvases.length&&t.push(...n.canvases),n.behavior&&i.push(...n.behavior);const r=q(e);return i.length&&(r.behavior?r.behavior.push(...i):r.behavior=i),E({...r,...D(e),...B(e),items:t,structures:e.structures})}],canvas:[function(e){return E({...q(e),...D(e),...B(e),annotations:e.otherContent&&e.otherContent.length?e.otherContent:void 0,items:e.images&&e.images.length?[{id:z(e,"annotation-page"),type:"AnnotationPage",items:e.images}]:void 0})}],annotationList:[function(e){return E({...q(e),...D(e),...B(e),items:e.resources&&e.resources.length?e.resources:void 0})}],sequence:[function(e){return e.canvases&&0!==e.canvases.length?{canvases:e.canvases,behavior:e.viewingHint?[e.viewingHint]:[]}:{canvases:[],behavior:[]}}],annotation:[function(e){return E({...q(e),...D(e),...B(e),target:function e(t){if(Array.isArray(t)){if(t.length>1)return{type:"List",items:t.map(e)};t=t[0]}if("string"==typeof t)return encodeURI(t).trim();if("@type"in t){let e;if("string"==typeof t.full)e=t.full;else if("dctypes:Image"===t.full["@type"])e={id:t.full["@id"],type:"Image"};else{if("sc:Canvas"!==t.full["@type"])throw new Error(`Unsupported source type on annotation: ${t.full["@type"]}`);e={id:t.full["@id"],type:"Canvas"}}return{type:"SpecificResource",source:e,selector:Q(t.selector)}}return encodeURI(t["@id"]).trim()}(e.on),body:Array.isArray(e.resource)?e.resource.map(U):U(e.resource)})}],contentResource:[U],choice:[function(e){const t=[];return e.default&&"rdf:nil"!==e.default&&t.push(e.default),e.item&&"rdf:nil"!==e.item&&t.push(...e.item),{...q(e),...D(e),items:t}}],range:[function(e){return E({...q(e),...D(e),...B(e),items:e.members})}],service:[function(e){const{"@id":t,"@type":i,"@context":r,profile:n,...o}=e,a={};return t&&(a["@id"]=t),a["@type"]=F(e),"unknown"===a["@type"]&&(r&&r.length&&(a["@context"]=r),a["@type"]="Service"),n&&(a.profile=I(n)),E({...a,...o})}],layer:[function(e){return E({...q(e),...D(e),...B(e)})}]});function Q(e){if((Array.isArray(e["@type"])&&e["@type"].includes("oa:SvgSelector")||"oa:SvgSelector"==e["@type"])&&("chars"in e||"value"in e))return{type:"SvgSelector",value:"chars"in e?e.chars:e.value};if("oa:FragmentSelector"===e["@type"])return{type:"FragmentSelector",value:e.value};if("oa:Choice"===e["@type"])return[Q(e.default),...(Array.isArray(e.item)?e.item:[e.item]).map(Q)];if("iiif:ImageApiSelector"==e["@type"])return{type:"ImageApiSelector",region:"region"in e?e.region:void 0,rotation:"rotation"in e?e.rotation:void 0};throw new Error(`Unsupported selector type: ${e["@type"]}`)}const V=function(e){return e&&e["@context"]&&("http://iiif.io/api/presentation/2/context.json"===e["@context"]||-1!==e["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")||"http://www.shared-canvas.org/ns/context.json"===e["@context"])||"http://iiif.io/api/image/2/context.json"===e["@context"]?H.traverseUnknown(e):e};e.upgrade=V,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}(_e);const ze=e.createContext({currentResourceId:void 0,error:null,isLoaded:!1,orientation:"vertical",resource:void 0});function qe(){return e.useContext(ze)}function De(t){const{currentResourceId:i,orientation:r,onLoad:n,overrides:o}=t,[a,s]=e.useState(),c=e.useMemo((()=>{if(!o||!a)return a;const e=Object.fromEntries(Object.entries(o).filter((([,e])=>void 0!==e)));return Object.assign({},a,e||{})}),[a,...Object.values(o||{})]),[u,f]=e.useState(!1);e.useEffect((()=>{if(t.resource){if("string"==typeof t.resource){const r=new AbortController;return(e=t.resource,i={signal:r.signal},fetch(e,i).then((e=>e.json())).then(Me.exports.upgrade)).then((e=>{s(e),n&&n(e)})).catch((e=>f(e))),()=>{r.abort()}}var e,i;s(t.resource),n&&n(t.resource)}}),[t.resource]);const h=e.useMemo((()=>({resource:c,error:u,isLoaded:!!a,orientation:r,currentResourceId:i})),[c,u,r,i]);return l(ze.Provider,{value:h,children:t.children})}const Ne=({item:t,onClick:i})=>{const r=function(e=h,t={}){const i=t.imageServiceLoader||new Pe;return{getBestThumbnailAtSize:async function t(r,n,o,a=[],s){const c=()=>i.getThumbnailFromResource(void 0,n,o,a);if(!r)return await i.getThumbnailFromResource(void 0,n,o,a);if("string"==typeof r){const e=te(r);return e&&a.push(e),await i.getThumbnailFromResource(void 0,n,o,a)}const l=e.get(r,{skipSelfReturn:!1});if("string"==typeof l)return{best:te(l),fallback:[],log:[]};if(!l)return await c();switch(await(async t=>{if(t&&t.thumbnail&&t.thumbnail.length){const r=e.get(t.thumbnail[0]),n=await i.getImageCandidates(r,o);n&&n.length&&a.push(...n)}})(l),l.type){case"Annotation":{const t=Array.isArray(l.body)?l.body:[l.body],r=e.get(t[0]);return s&&!r.width&&(r.width=s.width,r.height=s.height),await i.getThumbnailFromResource(r,n,o,a)}case"Canvas":{const e=l;return t(e.items[0],n,o,a,{width:e.width,height:e.height})}case"AnnotationPage":return t(l.items[0],n,o,a,s);case"Choice":{const e=l;return!e.items||e.items[0]?await c():t(e.items[0],n,o,a,s)}case"Collection":{const e=l.items[0];return e?t(e,n,o,a,s):await c()}case"Manifest":{const e=l.items[0];return e?t(e,n,o,a,s):await c()}case"SpecificResource":case"Image":case"Dataset":case"Sound":case"Text":case"TextualBody":case"Video":return s&&!l.width&&(l.width=s.width,l.height=s.height),i.getThumbnailFromResource(l,n,o,a);case"Service":case"Range":case"AnnotationCollection":case"CanvasReference":case"ContentResource":return await c()}return await c()}}}(),[n,o]=e.useState(),{resource:a}=qe(),s=(null==a?void 0:a.thumbnailSize)||200;return e.useEffect((()=>{t&&async function(){const e=await r.getBestThumbnailAtSize(t,{width:s,height:s});o(e.best)}()}),[t]),l("button",{"data-testid":"thumbnail-wrapper",onClick:()=>{i&&i(null==a?void 0:a.id)},children:u("figure",{children:[l("div",{style:{backgroundColor:"#f0f0f0",width:`${s}px`,height:`${s}px`,objectFit:"contain"},children:n?l("img",{src:n.id,alt:"",style:{maxWidth:"100%",maxHeight:"100%"},"data-testid":"thumb-image"}):l(c,{})}),l("figcaption",{children:t.id})]})})},Be={},Ue={get:e=>e,setMetaValue([e,t,i],r){const n=Ue.getResourceMeta(e,t),o=n?n[i]:void 0,a="function"==typeof r?r(o):r;Be[e]={...Be[e]||{},[t]:{...(Be[e]||{})[t]||{},[i]:a}}},getResourceMeta:(e,t)=>{const i=Be[e];if(i)return t?i[t]:i}};function He(e,t){const i=[];for(const r of t.items)if("Canvas"===r.type&&(-1!==r.id.indexOf("#")?i.push({id:r.id.split("#")[0],type:"Canvas"}):i.push(r)),"Range"===r.type&&i.push(...He(e,e.get(r))),"SpecificResource"===r.type){const e="string"==typeof r.source?r.source:r.source.id;i.push({id:e,type:"Canvas"})}return i}function Qe(e=Ue){return{getVisibleCanvasesFromCanvasId:(t,i,r=!1)=>function(e=Ue,t,i,r=!1){const n=t.behavior||[],o=i?e.get(i):null;if(!o)return[];const a=o.behavior||[],s=!r&&n.includes("paged"),c=!s&&n.includes("continuous"),l=!s&&!c&&n.includes("individuals"),u=a.includes("facing-pages"),f=a.includes("non-paged");if(u||f||l||r)return[{id:o.id,type:"Canvas"}];const[h,p]=Ve(e,t);if(c)return h;const d=h.findIndex((e=>e.id===i));if(-1===d)return[];for(const v of p)if(v.includes(d))return v.map((e=>h[e]));return[{id:o.id,type:"Canvas"}]}(e,t,i,r),getManifestSequence:(t,i={})=>Ve(e,t,i)}}function Ve(e=Ue,t,{disablePaging:i,skipNonPaged:r}={}){const n=t.behavior||[],o=n.includes("paged"),a=!o&&n.includes("continuous"),s=!o&&!a&&n.includes("individuals"),c="Manifest"===t.type?t.items:He(e,t);if(a)return[c,[c.map(((e,t)=>t))]];if(s||!o||i)return[c,c.map(((e,t)=>[t]))];const l=[];let u=[];const f=()=>{u.length&&(l.push([...u]),u=[])};let h=0,p=!1;for(let d=0;d<c.length;d++){const t=e.get(c[d]).behavior||[];t.includes("non-paged")?(d===h&&h++,r||(f(),l.push([d]),f())):d===h||t.includes("facing-pages")?(u.length&&(p=!0),f(),l.push([d]),f()):(u.push(d),p?(f(),p=!1):u.length>1&&f())}return u.length&&f(),[c,l]}const Ye=({onResourceChanged:t})=>{const{resource:i,isLoaded:r,currentResourceId:n,orientation:o}=qe(),a=Qe(),[s,f]=e.useMemo((()=>{if(!i)return[];const[e,t]=a.getManifestSequence(i,{disablePaging:!1});return[e,t]}),[i]);if(!(r&&i&&f&&s))return l(c,{});const h="left-to-right"===i.viewingDirection?"ltr":"rtl",p=e=>{var t,i;if(40===e.keyCode){const r=1+Number(e.currentTarget.getAttribute("data-index"));(null==(i=null==(t=e.currentTarget.parentElement)?void 0:t.parentElement)?void 0:i.querySelector(`div[data-index="${r}"]`)).focus()}},d=e=>f.findIndex((e=>{const t=s.findIndex((e=>e.id===n));return e.includes(t)}))===e;return u("div",{dir:h,"thumbnail-panel":"","data-orientation":o,children:[l("h3",{children:Le(i.label)}),l("span",{children:o}),f.map(((e,i)=>l("div",{"thumbnail-group":"","data-selected":d(i),children:e.map(((e,i)=>{var r;return l("div",{"thumbnail-item":"",tabIndex:0===e?0:-1,"data-index":e,onKeyDown:p,"data-selected":n===(null==(r=s[e])?void 0:r.id),children:l(Ne,{item:s[e],onClick:()=>{var i;t&&t(null==(i=s[e])?void 0:i.id)}},e)},i)}))},i)))]})};exports.Thumbnail=Ne,exports.ThumbnailPanel=({iiifContent:e,orientation:t,currentResourceId:i,overrides:r,onLoad:n,onResourceChanged:o})=>l(De,{resource:e,overrides:r,orientation:t,currentResourceId:i,onLoad:n,children:l(Ye,{onResourceChanged:o})});
//# sourceMappingURL=index.js.map
