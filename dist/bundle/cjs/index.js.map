{"version":3,"file":"index.js","sources":["../../../node_modules/react/cjs/react-jsx-runtime.development.js","../../../node_modules/react/jsx-runtime.js","../../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../../node_modules/@iiif/vault-helpers/dist/esm/index.mjs","../../../node_modules/@iiif/vault-helpers/dist/fetch/esm/fetch.mjs","../../../src/context/IIIFResourceContext.tsx","../../../src/components/Thumbnail.tsx","../../../node_modules/@iiif/vault-helpers/dist/sequences/esm/sequences.mjs","../../../src/components/ThumbnailPanel.tsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.development.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nif (process.env.NODE_ENV !== \"production\") {\n  (function() {\n'use strict';\n\nvar React = require('react');\n\n// ATTENTION\n// When adding new symbols to this file,\n// Please consider also adding to 'react-devtools-shared/src/backend/ReactSymbols'\n// The Symbol used to tag the ReactElement-like types.\nvar REACT_ELEMENT_TYPE = Symbol.for('react.element');\nvar REACT_PORTAL_TYPE = Symbol.for('react.portal');\nvar REACT_FRAGMENT_TYPE = Symbol.for('react.fragment');\nvar REACT_STRICT_MODE_TYPE = Symbol.for('react.strict_mode');\nvar REACT_PROFILER_TYPE = Symbol.for('react.profiler');\nvar REACT_PROVIDER_TYPE = Symbol.for('react.provider');\nvar REACT_CONTEXT_TYPE = Symbol.for('react.context');\nvar REACT_FORWARD_REF_TYPE = Symbol.for('react.forward_ref');\nvar REACT_SUSPENSE_TYPE = Symbol.for('react.suspense');\nvar REACT_SUSPENSE_LIST_TYPE = Symbol.for('react.suspense_list');\nvar REACT_MEMO_TYPE = Symbol.for('react.memo');\nvar REACT_LAZY_TYPE = Symbol.for('react.lazy');\nvar REACT_OFFSCREEN_TYPE = Symbol.for('react.offscreen');\nvar MAYBE_ITERATOR_SYMBOL = Symbol.iterator;\nvar FAUX_ITERATOR_SYMBOL = '@@iterator';\nfunction getIteratorFn(maybeIterable) {\n  if (maybeIterable === null || typeof maybeIterable !== 'object') {\n    return null;\n  }\n\n  var maybeIterator = MAYBE_ITERATOR_SYMBOL && maybeIterable[MAYBE_ITERATOR_SYMBOL] || maybeIterable[FAUX_ITERATOR_SYMBOL];\n\n  if (typeof maybeIterator === 'function') {\n    return maybeIterator;\n  }\n\n  return null;\n}\n\nvar ReactSharedInternals = React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n\nfunction error(format) {\n  {\n    {\n      for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        args[_key2 - 1] = arguments[_key2];\n      }\n\n      printWarning('error', format, args);\n    }\n  }\n}\n\nfunction printWarning(level, format, args) {\n  // When changing this logic, you might want to also\n  // update consoleWithStackDev.www.js as well.\n  {\n    var ReactDebugCurrentFrame = ReactSharedInternals.ReactDebugCurrentFrame;\n    var stack = ReactDebugCurrentFrame.getStackAddendum();\n\n    if (stack !== '') {\n      format += '%s';\n      args = args.concat([stack]);\n    } // eslint-disable-next-line react-internal/safe-string-coercion\n\n\n    var argsWithFormat = args.map(function (item) {\n      return String(item);\n    }); // Careful: RN currently depends on this prefix\n\n    argsWithFormat.unshift('Warning: ' + format); // We intentionally don't use spread (or .apply) directly because it\n    // breaks IE9: https://github.com/facebook/react/issues/13610\n    // eslint-disable-next-line react-internal/no-production-logging\n\n    Function.prototype.apply.call(console[level], console, argsWithFormat);\n  }\n}\n\n// -----------------------------------------------------------------------------\n\nvar enableScopeAPI = false; // Experimental Create Event Handle API.\nvar enableCacheElement = false;\nvar enableTransitionTracing = false; // No known bugs, but needs performance testing\n\nvar enableLegacyHidden = false; // Enables unstable_avoidThisFallback feature in Fiber\n// stuff. Intended to enable React core members to more easily debug scheduling\n// issues in DEV builds.\n\nvar enableDebugTracing = false; // Track which Fiber(s) schedule render work.\n\nvar REACT_MODULE_REFERENCE;\n\n{\n  REACT_MODULE_REFERENCE = Symbol.for('react.module.reference');\n}\n\nfunction isValidElementType(type) {\n  if (typeof type === 'string' || typeof type === 'function') {\n    return true;\n  } // Note: typeof might be other than 'symbol' or 'number' (e.g. if it's a polyfill).\n\n\n  if (type === REACT_FRAGMENT_TYPE || type === REACT_PROFILER_TYPE || enableDebugTracing  || type === REACT_STRICT_MODE_TYPE || type === REACT_SUSPENSE_TYPE || type === REACT_SUSPENSE_LIST_TYPE || enableLegacyHidden  || type === REACT_OFFSCREEN_TYPE || enableScopeAPI  || enableCacheElement  || enableTransitionTracing ) {\n    return true;\n  }\n\n  if (typeof type === 'object' && type !== null) {\n    if (type.$$typeof === REACT_LAZY_TYPE || type.$$typeof === REACT_MEMO_TYPE || type.$$typeof === REACT_PROVIDER_TYPE || type.$$typeof === REACT_CONTEXT_TYPE || type.$$typeof === REACT_FORWARD_REF_TYPE || // This needs to include all possible module reference object\n    // types supported by any Flight configuration anywhere since\n    // we don't know which Flight build this will end up being used\n    // with.\n    type.$$typeof === REACT_MODULE_REFERENCE || type.getModuleId !== undefined) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction getWrappedName(outerType, innerType, wrapperName) {\n  var displayName = outerType.displayName;\n\n  if (displayName) {\n    return displayName;\n  }\n\n  var functionName = innerType.displayName || innerType.name || '';\n  return functionName !== '' ? wrapperName + \"(\" + functionName + \")\" : wrapperName;\n} // Keep in sync with react-reconciler/getComponentNameFromFiber\n\n\nfunction getContextName(type) {\n  return type.displayName || 'Context';\n} // Note that the reconciler package should generally prefer to use getComponentNameFromFiber() instead.\n\n\nfunction getComponentNameFromType(type) {\n  if (type == null) {\n    // Host root, text node or just invalid type.\n    return null;\n  }\n\n  {\n    if (typeof type.tag === 'number') {\n      error('Received an unexpected object in getComponentNameFromType(). ' + 'This is likely a bug in React. Please file an issue.');\n    }\n  }\n\n  if (typeof type === 'function') {\n    return type.displayName || type.name || null;\n  }\n\n  if (typeof type === 'string') {\n    return type;\n  }\n\n  switch (type) {\n    case REACT_FRAGMENT_TYPE:\n      return 'Fragment';\n\n    case REACT_PORTAL_TYPE:\n      return 'Portal';\n\n    case REACT_PROFILER_TYPE:\n      return 'Profiler';\n\n    case REACT_STRICT_MODE_TYPE:\n      return 'StrictMode';\n\n    case REACT_SUSPENSE_TYPE:\n      return 'Suspense';\n\n    case REACT_SUSPENSE_LIST_TYPE:\n      return 'SuspenseList';\n\n  }\n\n  if (typeof type === 'object') {\n    switch (type.$$typeof) {\n      case REACT_CONTEXT_TYPE:\n        var context = type;\n        return getContextName(context) + '.Consumer';\n\n      case REACT_PROVIDER_TYPE:\n        var provider = type;\n        return getContextName(provider._context) + '.Provider';\n\n      case REACT_FORWARD_REF_TYPE:\n        return getWrappedName(type, type.render, 'ForwardRef');\n\n      case REACT_MEMO_TYPE:\n        var outerName = type.displayName || null;\n\n        if (outerName !== null) {\n          return outerName;\n        }\n\n        return getComponentNameFromType(type.type) || 'Memo';\n\n      case REACT_LAZY_TYPE:\n        {\n          var lazyComponent = type;\n          var payload = lazyComponent._payload;\n          var init = lazyComponent._init;\n\n          try {\n            return getComponentNameFromType(init(payload));\n          } catch (x) {\n            return null;\n          }\n        }\n\n      // eslint-disable-next-line no-fallthrough\n    }\n  }\n\n  return null;\n}\n\nvar assign = Object.assign;\n\n// Helpers to patch console.logs to avoid logging during side-effect free\n// replaying on render function. This currently only patches the object\n// lazily which won't cover if the log function was extracted eagerly.\n// We could also eagerly patch the method.\nvar disabledDepth = 0;\nvar prevLog;\nvar prevInfo;\nvar prevWarn;\nvar prevError;\nvar prevGroup;\nvar prevGroupCollapsed;\nvar prevGroupEnd;\n\nfunction disabledLog() {}\n\ndisabledLog.__reactDisabledLog = true;\nfunction disableLogs() {\n  {\n    if (disabledDepth === 0) {\n      /* eslint-disable react-internal/no-production-logging */\n      prevLog = console.log;\n      prevInfo = console.info;\n      prevWarn = console.warn;\n      prevError = console.error;\n      prevGroup = console.group;\n      prevGroupCollapsed = console.groupCollapsed;\n      prevGroupEnd = console.groupEnd; // https://github.com/facebook/react/issues/19099\n\n      var props = {\n        configurable: true,\n        enumerable: true,\n        value: disabledLog,\n        writable: true\n      }; // $FlowFixMe Flow thinks console is immutable.\n\n      Object.defineProperties(console, {\n        info: props,\n        log: props,\n        warn: props,\n        error: props,\n        group: props,\n        groupCollapsed: props,\n        groupEnd: props\n      });\n      /* eslint-enable react-internal/no-production-logging */\n    }\n\n    disabledDepth++;\n  }\n}\nfunction reenableLogs() {\n  {\n    disabledDepth--;\n\n    if (disabledDepth === 0) {\n      /* eslint-disable react-internal/no-production-logging */\n      var props = {\n        configurable: true,\n        enumerable: true,\n        writable: true\n      }; // $FlowFixMe Flow thinks console is immutable.\n\n      Object.defineProperties(console, {\n        log: assign({}, props, {\n          value: prevLog\n        }),\n        info: assign({}, props, {\n          value: prevInfo\n        }),\n        warn: assign({}, props, {\n          value: prevWarn\n        }),\n        error: assign({}, props, {\n          value: prevError\n        }),\n        group: assign({}, props, {\n          value: prevGroup\n        }),\n        groupCollapsed: assign({}, props, {\n          value: prevGroupCollapsed\n        }),\n        groupEnd: assign({}, props, {\n          value: prevGroupEnd\n        })\n      });\n      /* eslint-enable react-internal/no-production-logging */\n    }\n\n    if (disabledDepth < 0) {\n      error('disabledDepth fell below zero. ' + 'This is a bug in React. Please file an issue.');\n    }\n  }\n}\n\nvar ReactCurrentDispatcher = ReactSharedInternals.ReactCurrentDispatcher;\nvar prefix;\nfunction describeBuiltInComponentFrame(name, source, ownerFn) {\n  {\n    if (prefix === undefined) {\n      // Extract the VM specific prefix used by each line.\n      try {\n        throw Error();\n      } catch (x) {\n        var match = x.stack.trim().match(/\\n( *(at )?)/);\n        prefix = match && match[1] || '';\n      }\n    } // We use the prefix to ensure our stacks line up with native stack frames.\n\n\n    return '\\n' + prefix + name;\n  }\n}\nvar reentry = false;\nvar componentFrameCache;\n\n{\n  var PossiblyWeakMap = typeof WeakMap === 'function' ? WeakMap : Map;\n  componentFrameCache = new PossiblyWeakMap();\n}\n\nfunction describeNativeComponentFrame(fn, construct) {\n  // If something asked for a stack inside a fake render, it should get ignored.\n  if ( !fn || reentry) {\n    return '';\n  }\n\n  {\n    var frame = componentFrameCache.get(fn);\n\n    if (frame !== undefined) {\n      return frame;\n    }\n  }\n\n  var control;\n  reentry = true;\n  var previousPrepareStackTrace = Error.prepareStackTrace; // $FlowFixMe It does accept undefined.\n\n  Error.prepareStackTrace = undefined;\n  var previousDispatcher;\n\n  {\n    previousDispatcher = ReactCurrentDispatcher.current; // Set the dispatcher in DEV because this might be call in the render function\n    // for warnings.\n\n    ReactCurrentDispatcher.current = null;\n    disableLogs();\n  }\n\n  try {\n    // This should throw.\n    if (construct) {\n      // Something should be setting the props in the constructor.\n      var Fake = function () {\n        throw Error();\n      }; // $FlowFixMe\n\n\n      Object.defineProperty(Fake.prototype, 'props', {\n        set: function () {\n          // We use a throwing setter instead of frozen or non-writable props\n          // because that won't throw in a non-strict mode function.\n          throw Error();\n        }\n      });\n\n      if (typeof Reflect === 'object' && Reflect.construct) {\n        // We construct a different control for this case to include any extra\n        // frames added by the construct call.\n        try {\n          Reflect.construct(Fake, []);\n        } catch (x) {\n          control = x;\n        }\n\n        Reflect.construct(fn, [], Fake);\n      } else {\n        try {\n          Fake.call();\n        } catch (x) {\n          control = x;\n        }\n\n        fn.call(Fake.prototype);\n      }\n    } else {\n      try {\n        throw Error();\n      } catch (x) {\n        control = x;\n      }\n\n      fn();\n    }\n  } catch (sample) {\n    // This is inlined manually because closure doesn't do it for us.\n    if (sample && control && typeof sample.stack === 'string') {\n      // This extracts the first frame from the sample that isn't also in the control.\n      // Skipping one frame that we assume is the frame that calls the two.\n      var sampleLines = sample.stack.split('\\n');\n      var controlLines = control.stack.split('\\n');\n      var s = sampleLines.length - 1;\n      var c = controlLines.length - 1;\n\n      while (s >= 1 && c >= 0 && sampleLines[s] !== controlLines[c]) {\n        // We expect at least one stack frame to be shared.\n        // Typically this will be the root most one. However, stack frames may be\n        // cut off due to maximum stack limits. In this case, one maybe cut off\n        // earlier than the other. We assume that the sample is longer or the same\n        // and there for cut off earlier. So we should find the root most frame in\n        // the sample somewhere in the control.\n        c--;\n      }\n\n      for (; s >= 1 && c >= 0; s--, c--) {\n        // Next we find the first one that isn't the same which should be the\n        // frame that called our sample function and the control.\n        if (sampleLines[s] !== controlLines[c]) {\n          // In V8, the first line is describing the message but other VMs don't.\n          // If we're about to return the first line, and the control is also on the same\n          // line, that's a pretty good indicator that our sample threw at same line as\n          // the control. I.e. before we entered the sample frame. So we ignore this result.\n          // This can happen if you passed a class to function component, or non-function.\n          if (s !== 1 || c !== 1) {\n            do {\n              s--;\n              c--; // We may still have similar intermediate frames from the construct call.\n              // The next one that isn't the same should be our match though.\n\n              if (c < 0 || sampleLines[s] !== controlLines[c]) {\n                // V8 adds a \"new\" prefix for native classes. Let's remove it to make it prettier.\n                var _frame = '\\n' + sampleLines[s].replace(' at new ', ' at '); // If our component frame is labeled \"<anonymous>\"\n                // but we have a user-provided \"displayName\"\n                // splice it in to make the stack more readable.\n\n\n                if (fn.displayName && _frame.includes('<anonymous>')) {\n                  _frame = _frame.replace('<anonymous>', fn.displayName);\n                }\n\n                {\n                  if (typeof fn === 'function') {\n                    componentFrameCache.set(fn, _frame);\n                  }\n                } // Return the line we found.\n\n\n                return _frame;\n              }\n            } while (s >= 1 && c >= 0);\n          }\n\n          break;\n        }\n      }\n    }\n  } finally {\n    reentry = false;\n\n    {\n      ReactCurrentDispatcher.current = previousDispatcher;\n      reenableLogs();\n    }\n\n    Error.prepareStackTrace = previousPrepareStackTrace;\n  } // Fallback to just using the name if we couldn't make it throw.\n\n\n  var name = fn ? fn.displayName || fn.name : '';\n  var syntheticFrame = name ? describeBuiltInComponentFrame(name) : '';\n\n  {\n    if (typeof fn === 'function') {\n      componentFrameCache.set(fn, syntheticFrame);\n    }\n  }\n\n  return syntheticFrame;\n}\nfunction describeFunctionComponentFrame(fn, source, ownerFn) {\n  {\n    return describeNativeComponentFrame(fn, false);\n  }\n}\n\nfunction shouldConstruct(Component) {\n  var prototype = Component.prototype;\n  return !!(prototype && prototype.isReactComponent);\n}\n\nfunction describeUnknownElementTypeFrameInDEV(type, source, ownerFn) {\n\n  if (type == null) {\n    return '';\n  }\n\n  if (typeof type === 'function') {\n    {\n      return describeNativeComponentFrame(type, shouldConstruct(type));\n    }\n  }\n\n  if (typeof type === 'string') {\n    return describeBuiltInComponentFrame(type);\n  }\n\n  switch (type) {\n    case REACT_SUSPENSE_TYPE:\n      return describeBuiltInComponentFrame('Suspense');\n\n    case REACT_SUSPENSE_LIST_TYPE:\n      return describeBuiltInComponentFrame('SuspenseList');\n  }\n\n  if (typeof type === 'object') {\n    switch (type.$$typeof) {\n      case REACT_FORWARD_REF_TYPE:\n        return describeFunctionComponentFrame(type.render);\n\n      case REACT_MEMO_TYPE:\n        // Memo may contain any component type so we recursively resolve it.\n        return describeUnknownElementTypeFrameInDEV(type.type, source, ownerFn);\n\n      case REACT_LAZY_TYPE:\n        {\n          var lazyComponent = type;\n          var payload = lazyComponent._payload;\n          var init = lazyComponent._init;\n\n          try {\n            // Lazy may contain any component type so we recursively resolve it.\n            return describeUnknownElementTypeFrameInDEV(init(payload), source, ownerFn);\n          } catch (x) {}\n        }\n    }\n  }\n\n  return '';\n}\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar loggedTypeFailures = {};\nvar ReactDebugCurrentFrame = ReactSharedInternals.ReactDebugCurrentFrame;\n\nfunction setCurrentlyValidatingElement(element) {\n  {\n    if (element) {\n      var owner = element._owner;\n      var stack = describeUnknownElementTypeFrameInDEV(element.type, element._source, owner ? owner.type : null);\n      ReactDebugCurrentFrame.setExtraStackFrame(stack);\n    } else {\n      ReactDebugCurrentFrame.setExtraStackFrame(null);\n    }\n  }\n}\n\nfunction checkPropTypes(typeSpecs, values, location, componentName, element) {\n  {\n    // $FlowFixMe This is okay but Flow doesn't know it.\n    var has = Function.call.bind(hasOwnProperty);\n\n    for (var typeSpecName in typeSpecs) {\n      if (has(typeSpecs, typeSpecName)) {\n        var error$1 = void 0; // Prop type validation may throw. In case they do, we don't want to\n        // fail the render phase where it didn't fail before. So we log it.\n        // After these have been cleaned up, we'll let them throw.\n\n        try {\n          // This is intentionally an invariant that gets caught. It's the same\n          // behavior as without this statement except with a better message.\n          if (typeof typeSpecs[typeSpecName] !== 'function') {\n            // eslint-disable-next-line react-internal/prod-error-codes\n            var err = Error((componentName || 'React class') + ': ' + location + ' type `' + typeSpecName + '` is invalid; ' + 'it must be a function, usually from the `prop-types` package, but received `' + typeof typeSpecs[typeSpecName] + '`.' + 'This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.');\n            err.name = 'Invariant Violation';\n            throw err;\n          }\n\n          error$1 = typeSpecs[typeSpecName](values, typeSpecName, componentName, location, null, 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED');\n        } catch (ex) {\n          error$1 = ex;\n        }\n\n        if (error$1 && !(error$1 instanceof Error)) {\n          setCurrentlyValidatingElement(element);\n\n          error('%s: type specification of %s' + ' `%s` is invalid; the type checker ' + 'function must return `null` or an `Error` but returned a %s. ' + 'You may have forgotten to pass an argument to the type checker ' + 'creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and ' + 'shape all require an argument).', componentName || 'React class', location, typeSpecName, typeof error$1);\n\n          setCurrentlyValidatingElement(null);\n        }\n\n        if (error$1 instanceof Error && !(error$1.message in loggedTypeFailures)) {\n          // Only monitor this failure once because there tends to be a lot of the\n          // same error.\n          loggedTypeFailures[error$1.message] = true;\n          setCurrentlyValidatingElement(element);\n\n          error('Failed %s type: %s', location, error$1.message);\n\n          setCurrentlyValidatingElement(null);\n        }\n      }\n    }\n  }\n}\n\nvar isArrayImpl = Array.isArray; // eslint-disable-next-line no-redeclare\n\nfunction isArray(a) {\n  return isArrayImpl(a);\n}\n\n/*\n * The `'' + value` pattern (used in in perf-sensitive code) throws for Symbol\n * and Temporal.* types. See https://github.com/facebook/react/pull/22064.\n *\n * The functions in this module will throw an easier-to-understand,\n * easier-to-debug exception with a clear errors message message explaining the\n * problem. (Instead of a confusing exception thrown inside the implementation\n * of the `value` object).\n */\n// $FlowFixMe only called in DEV, so void return is not possible.\nfunction typeName(value) {\n  {\n    // toStringTag is needed for namespaced types like Temporal.Instant\n    var hasToStringTag = typeof Symbol === 'function' && Symbol.toStringTag;\n    var type = hasToStringTag && value[Symbol.toStringTag] || value.constructor.name || 'Object';\n    return type;\n  }\n} // $FlowFixMe only called in DEV, so void return is not possible.\n\n\nfunction willCoercionThrow(value) {\n  {\n    try {\n      testStringCoercion(value);\n      return false;\n    } catch (e) {\n      return true;\n    }\n  }\n}\n\nfunction testStringCoercion(value) {\n  // If you ended up here by following an exception call stack, here's what's\n  // happened: you supplied an object or symbol value to React (as a prop, key,\n  // DOM attribute, CSS property, string ref, etc.) and when React tried to\n  // coerce it to a string using `'' + value`, an exception was thrown.\n  //\n  // The most common types that will cause this exception are `Symbol` instances\n  // and Temporal objects like `Temporal.Instant`. But any object that has a\n  // `valueOf` or `[Symbol.toPrimitive]` method that throws will also cause this\n  // exception. (Library authors do this to prevent users from using built-in\n  // numeric operators like `+` or comparison operators like `>=` because custom\n  // methods are needed to perform accurate arithmetic or comparison.)\n  //\n  // To fix the problem, coerce this object or symbol value to a string before\n  // passing it to React. The most reliable way is usually `String(value)`.\n  //\n  // To find which value is throwing, check the browser or debugger console.\n  // Before this exception was thrown, there should be `console.error` output\n  // that shows the type (Symbol, Temporal.PlainDate, etc.) that caused the\n  // problem and how that type was used: key, atrribute, input value prop, etc.\n  // In most cases, this console output also shows the component and its\n  // ancestor components where the exception happened.\n  //\n  // eslint-disable-next-line react-internal/safe-string-coercion\n  return '' + value;\n}\nfunction checkKeyStringCoercion(value) {\n  {\n    if (willCoercionThrow(value)) {\n      error('The provided key is an unsupported type %s.' + ' This value must be coerced to a string before before using it here.', typeName(value));\n\n      return testStringCoercion(value); // throw (to help callers find troubleshooting comments)\n    }\n  }\n}\n\nvar ReactCurrentOwner = ReactSharedInternals.ReactCurrentOwner;\nvar RESERVED_PROPS = {\n  key: true,\n  ref: true,\n  __self: true,\n  __source: true\n};\nvar specialPropKeyWarningShown;\nvar specialPropRefWarningShown;\nvar didWarnAboutStringRefs;\n\n{\n  didWarnAboutStringRefs = {};\n}\n\nfunction hasValidRef(config) {\n  {\n    if (hasOwnProperty.call(config, 'ref')) {\n      var getter = Object.getOwnPropertyDescriptor(config, 'ref').get;\n\n      if (getter && getter.isReactWarning) {\n        return false;\n      }\n    }\n  }\n\n  return config.ref !== undefined;\n}\n\nfunction hasValidKey(config) {\n  {\n    if (hasOwnProperty.call(config, 'key')) {\n      var getter = Object.getOwnPropertyDescriptor(config, 'key').get;\n\n      if (getter && getter.isReactWarning) {\n        return false;\n      }\n    }\n  }\n\n  return config.key !== undefined;\n}\n\nfunction warnIfStringRefCannotBeAutoConverted(config, self) {\n  {\n    if (typeof config.ref === 'string' && ReactCurrentOwner.current && self && ReactCurrentOwner.current.stateNode !== self) {\n      var componentName = getComponentNameFromType(ReactCurrentOwner.current.type);\n\n      if (!didWarnAboutStringRefs[componentName]) {\n        error('Component \"%s\" contains the string ref \"%s\". ' + 'Support for string refs will be removed in a future major release. ' + 'This case cannot be automatically converted to an arrow function. ' + 'We ask you to manually fix this case by using useRef() or createRef() instead. ' + 'Learn more about using refs safely here: ' + 'https://reactjs.org/link/strict-mode-string-ref', getComponentNameFromType(ReactCurrentOwner.current.type), config.ref);\n\n        didWarnAboutStringRefs[componentName] = true;\n      }\n    }\n  }\n}\n\nfunction defineKeyPropWarningGetter(props, displayName) {\n  {\n    var warnAboutAccessingKey = function () {\n      if (!specialPropKeyWarningShown) {\n        specialPropKeyWarningShown = true;\n\n        error('%s: `key` is not a prop. Trying to access it will result ' + 'in `undefined` being returned. If you need to access the same ' + 'value within the child component, you should pass it as a different ' + 'prop. (https://reactjs.org/link/special-props)', displayName);\n      }\n    };\n\n    warnAboutAccessingKey.isReactWarning = true;\n    Object.defineProperty(props, 'key', {\n      get: warnAboutAccessingKey,\n      configurable: true\n    });\n  }\n}\n\nfunction defineRefPropWarningGetter(props, displayName) {\n  {\n    var warnAboutAccessingRef = function () {\n      if (!specialPropRefWarningShown) {\n        specialPropRefWarningShown = true;\n\n        error('%s: `ref` is not a prop. Trying to access it will result ' + 'in `undefined` being returned. If you need to access the same ' + 'value within the child component, you should pass it as a different ' + 'prop. (https://reactjs.org/link/special-props)', displayName);\n      }\n    };\n\n    warnAboutAccessingRef.isReactWarning = true;\n    Object.defineProperty(props, 'ref', {\n      get: warnAboutAccessingRef,\n      configurable: true\n    });\n  }\n}\n/**\n * Factory method to create a new React element. This no longer adheres to\n * the class pattern, so do not use new to call it. Also, instanceof check\n * will not work. Instead test $$typeof field against Symbol.for('react.element') to check\n * if something is a React Element.\n *\n * @param {*} type\n * @param {*} props\n * @param {*} key\n * @param {string|object} ref\n * @param {*} owner\n * @param {*} self A *temporary* helper to detect places where `this` is\n * different from the `owner` when React.createElement is called, so that we\n * can warn. We want to get rid of owner and replace string `ref`s with arrow\n * functions, and as long as `this` and owner are the same, there will be no\n * change in behavior.\n * @param {*} source An annotation object (added by a transpiler or otherwise)\n * indicating filename, line number, and/or other information.\n * @internal\n */\n\n\nvar ReactElement = function (type, key, ref, self, source, owner, props) {\n  var element = {\n    // This tag allows us to uniquely identify this as a React Element\n    $$typeof: REACT_ELEMENT_TYPE,\n    // Built-in properties that belong on the element\n    type: type,\n    key: key,\n    ref: ref,\n    props: props,\n    // Record the component responsible for creating this element.\n    _owner: owner\n  };\n\n  {\n    // The validation flag is currently mutative. We put it on\n    // an external backing store so that we can freeze the whole object.\n    // This can be replaced with a WeakMap once they are implemented in\n    // commonly used development environments.\n    element._store = {}; // To make comparing ReactElements easier for testing purposes, we make\n    // the validation flag non-enumerable (where possible, which should\n    // include every environment we run tests in), so the test framework\n    // ignores it.\n\n    Object.defineProperty(element._store, 'validated', {\n      configurable: false,\n      enumerable: false,\n      writable: true,\n      value: false\n    }); // self and source are DEV only properties.\n\n    Object.defineProperty(element, '_self', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: self\n    }); // Two elements created in two different places should be considered\n    // equal for testing purposes and therefore we hide it from enumeration.\n\n    Object.defineProperty(element, '_source', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: source\n    });\n\n    if (Object.freeze) {\n      Object.freeze(element.props);\n      Object.freeze(element);\n    }\n  }\n\n  return element;\n};\n/**\n * https://github.com/reactjs/rfcs/pull/107\n * @param {*} type\n * @param {object} props\n * @param {string} key\n */\n\nfunction jsxDEV(type, config, maybeKey, source, self) {\n  {\n    var propName; // Reserved names are extracted\n\n    var props = {};\n    var key = null;\n    var ref = null; // Currently, key can be spread in as a prop. This causes a potential\n    // issue if key is also explicitly declared (ie. <div {...props} key=\"Hi\" />\n    // or <div key=\"Hi\" {...props} /> ). We want to deprecate key spread,\n    // but as an intermediary step, we will use jsxDEV for everything except\n    // <div {...props} key=\"Hi\" />, because we aren't currently able to tell if\n    // key is explicitly declared to be undefined or not.\n\n    if (maybeKey !== undefined) {\n      {\n        checkKeyStringCoercion(maybeKey);\n      }\n\n      key = '' + maybeKey;\n    }\n\n    if (hasValidKey(config)) {\n      {\n        checkKeyStringCoercion(config.key);\n      }\n\n      key = '' + config.key;\n    }\n\n    if (hasValidRef(config)) {\n      ref = config.ref;\n      warnIfStringRefCannotBeAutoConverted(config, self);\n    } // Remaining properties are added to a new props object\n\n\n    for (propName in config) {\n      if (hasOwnProperty.call(config, propName) && !RESERVED_PROPS.hasOwnProperty(propName)) {\n        props[propName] = config[propName];\n      }\n    } // Resolve default props\n\n\n    if (type && type.defaultProps) {\n      var defaultProps = type.defaultProps;\n\n      for (propName in defaultProps) {\n        if (props[propName] === undefined) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    }\n\n    if (key || ref) {\n      var displayName = typeof type === 'function' ? type.displayName || type.name || 'Unknown' : type;\n\n      if (key) {\n        defineKeyPropWarningGetter(props, displayName);\n      }\n\n      if (ref) {\n        defineRefPropWarningGetter(props, displayName);\n      }\n    }\n\n    return ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);\n  }\n}\n\nvar ReactCurrentOwner$1 = ReactSharedInternals.ReactCurrentOwner;\nvar ReactDebugCurrentFrame$1 = ReactSharedInternals.ReactDebugCurrentFrame;\n\nfunction setCurrentlyValidatingElement$1(element) {\n  {\n    if (element) {\n      var owner = element._owner;\n      var stack = describeUnknownElementTypeFrameInDEV(element.type, element._source, owner ? owner.type : null);\n      ReactDebugCurrentFrame$1.setExtraStackFrame(stack);\n    } else {\n      ReactDebugCurrentFrame$1.setExtraStackFrame(null);\n    }\n  }\n}\n\nvar propTypesMisspellWarningShown;\n\n{\n  propTypesMisspellWarningShown = false;\n}\n/**\n * Verifies the object is a ReactElement.\n * See https://reactjs.org/docs/react-api.html#isvalidelement\n * @param {?object} object\n * @return {boolean} True if `object` is a ReactElement.\n * @final\n */\n\n\nfunction isValidElement(object) {\n  {\n    return typeof object === 'object' && object !== null && object.$$typeof === REACT_ELEMENT_TYPE;\n  }\n}\n\nfunction getDeclarationErrorAddendum() {\n  {\n    if (ReactCurrentOwner$1.current) {\n      var name = getComponentNameFromType(ReactCurrentOwner$1.current.type);\n\n      if (name) {\n        return '\\n\\nCheck the render method of `' + name + '`.';\n      }\n    }\n\n    return '';\n  }\n}\n\nfunction getSourceInfoErrorAddendum(source) {\n  {\n    if (source !== undefined) {\n      var fileName = source.fileName.replace(/^.*[\\\\\\/]/, '');\n      var lineNumber = source.lineNumber;\n      return '\\n\\nCheck your code at ' + fileName + ':' + lineNumber + '.';\n    }\n\n    return '';\n  }\n}\n/**\n * Warn if there's no key explicitly set on dynamic arrays of children or\n * object keys are not valid. This allows us to keep track of children between\n * updates.\n */\n\n\nvar ownerHasKeyUseWarning = {};\n\nfunction getCurrentComponentErrorInfo(parentType) {\n  {\n    var info = getDeclarationErrorAddendum();\n\n    if (!info) {\n      var parentName = typeof parentType === 'string' ? parentType : parentType.displayName || parentType.name;\n\n      if (parentName) {\n        info = \"\\n\\nCheck the top-level render call using <\" + parentName + \">.\";\n      }\n    }\n\n    return info;\n  }\n}\n/**\n * Warn if the element doesn't have an explicit key assigned to it.\n * This element is in an array. The array could grow and shrink or be\n * reordered. All children that haven't already been validated are required to\n * have a \"key\" property assigned to it. Error statuses are cached so a warning\n * will only be shown once.\n *\n * @internal\n * @param {ReactElement} element Element that requires a key.\n * @param {*} parentType element's parent's type.\n */\n\n\nfunction validateExplicitKey(element, parentType) {\n  {\n    if (!element._store || element._store.validated || element.key != null) {\n      return;\n    }\n\n    element._store.validated = true;\n    var currentComponentErrorInfo = getCurrentComponentErrorInfo(parentType);\n\n    if (ownerHasKeyUseWarning[currentComponentErrorInfo]) {\n      return;\n    }\n\n    ownerHasKeyUseWarning[currentComponentErrorInfo] = true; // Usually the current owner is the offender, but if it accepts children as a\n    // property, it may be the creator of the child that's responsible for\n    // assigning it a key.\n\n    var childOwner = '';\n\n    if (element && element._owner && element._owner !== ReactCurrentOwner$1.current) {\n      // Give the component that originally created this child.\n      childOwner = \" It was passed a child from \" + getComponentNameFromType(element._owner.type) + \".\";\n    }\n\n    setCurrentlyValidatingElement$1(element);\n\n    error('Each child in a list should have a unique \"key\" prop.' + '%s%s See https://reactjs.org/link/warning-keys for more information.', currentComponentErrorInfo, childOwner);\n\n    setCurrentlyValidatingElement$1(null);\n  }\n}\n/**\n * Ensure that every element either is passed in a static location, in an\n * array with an explicit keys property defined, or in an object literal\n * with valid key property.\n *\n * @internal\n * @param {ReactNode} node Statically passed child of any type.\n * @param {*} parentType node's parent's type.\n */\n\n\nfunction validateChildKeys(node, parentType) {\n  {\n    if (typeof node !== 'object') {\n      return;\n    }\n\n    if (isArray(node)) {\n      for (var i = 0; i < node.length; i++) {\n        var child = node[i];\n\n        if (isValidElement(child)) {\n          validateExplicitKey(child, parentType);\n        }\n      }\n    } else if (isValidElement(node)) {\n      // This element was passed in a valid location.\n      if (node._store) {\n        node._store.validated = true;\n      }\n    } else if (node) {\n      var iteratorFn = getIteratorFn(node);\n\n      if (typeof iteratorFn === 'function') {\n        // Entry iterators used to provide implicit keys,\n        // but now we print a separate warning for them later.\n        if (iteratorFn !== node.entries) {\n          var iterator = iteratorFn.call(node);\n          var step;\n\n          while (!(step = iterator.next()).done) {\n            if (isValidElement(step.value)) {\n              validateExplicitKey(step.value, parentType);\n            }\n          }\n        }\n      }\n    }\n  }\n}\n/**\n * Given an element, validate that its props follow the propTypes definition,\n * provided by the type.\n *\n * @param {ReactElement} element\n */\n\n\nfunction validatePropTypes(element) {\n  {\n    var type = element.type;\n\n    if (type === null || type === undefined || typeof type === 'string') {\n      return;\n    }\n\n    var propTypes;\n\n    if (typeof type === 'function') {\n      propTypes = type.propTypes;\n    } else if (typeof type === 'object' && (type.$$typeof === REACT_FORWARD_REF_TYPE || // Note: Memo only checks outer props here.\n    // Inner props are checked in the reconciler.\n    type.$$typeof === REACT_MEMO_TYPE)) {\n      propTypes = type.propTypes;\n    } else {\n      return;\n    }\n\n    if (propTypes) {\n      // Intentionally inside to avoid triggering lazy initializers:\n      var name = getComponentNameFromType(type);\n      checkPropTypes(propTypes, element.props, 'prop', name, element);\n    } else if (type.PropTypes !== undefined && !propTypesMisspellWarningShown) {\n      propTypesMisspellWarningShown = true; // Intentionally inside to avoid triggering lazy initializers:\n\n      var _name = getComponentNameFromType(type);\n\n      error('Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?', _name || 'Unknown');\n    }\n\n    if (typeof type.getDefaultProps === 'function' && !type.getDefaultProps.isReactClassApproved) {\n      error('getDefaultProps is only used on classic React.createClass ' + 'definitions. Use a static property named `defaultProps` instead.');\n    }\n  }\n}\n/**\n * Given a fragment, validate that it can only be provided with fragment props\n * @param {ReactElement} fragment\n */\n\n\nfunction validateFragmentProps(fragment) {\n  {\n    var keys = Object.keys(fragment.props);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n\n      if (key !== 'children' && key !== 'key') {\n        setCurrentlyValidatingElement$1(fragment);\n\n        error('Invalid prop `%s` supplied to `React.Fragment`. ' + 'React.Fragment can only have `key` and `children` props.', key);\n\n        setCurrentlyValidatingElement$1(null);\n        break;\n      }\n    }\n\n    if (fragment.ref !== null) {\n      setCurrentlyValidatingElement$1(fragment);\n\n      error('Invalid attribute `ref` supplied to `React.Fragment`.');\n\n      setCurrentlyValidatingElement$1(null);\n    }\n  }\n}\n\nfunction jsxWithValidation(type, props, key, isStaticChildren, source, self) {\n  {\n    var validType = isValidElementType(type); // We warn in this case but don't throw. We expect the element creation to\n    // succeed and there will likely be errors in render.\n\n    if (!validType) {\n      var info = '';\n\n      if (type === undefined || typeof type === 'object' && type !== null && Object.keys(type).length === 0) {\n        info += ' You likely forgot to export your component from the file ' + \"it's defined in, or you might have mixed up default and named imports.\";\n      }\n\n      var sourceInfo = getSourceInfoErrorAddendum(source);\n\n      if (sourceInfo) {\n        info += sourceInfo;\n      } else {\n        info += getDeclarationErrorAddendum();\n      }\n\n      var typeString;\n\n      if (type === null) {\n        typeString = 'null';\n      } else if (isArray(type)) {\n        typeString = 'array';\n      } else if (type !== undefined && type.$$typeof === REACT_ELEMENT_TYPE) {\n        typeString = \"<\" + (getComponentNameFromType(type.type) || 'Unknown') + \" />\";\n        info = ' Did you accidentally export a JSX literal instead of a component?';\n      } else {\n        typeString = typeof type;\n      }\n\n      error('React.jsx: type is invalid -- expected a string (for ' + 'built-in components) or a class/function (for composite ' + 'components) but got: %s.%s', typeString, info);\n    }\n\n    var element = jsxDEV(type, props, key, source, self); // The result can be nullish if a mock or a custom function is used.\n    // TODO: Drop this when these are no longer allowed as the type argument.\n\n    if (element == null) {\n      return element;\n    } // Skip key warning if the type isn't valid since our key validation logic\n    // doesn't expect a non-string/function type and can throw confusing errors.\n    // We don't want exception behavior to differ between dev and prod.\n    // (Rendering will throw with a helpful message and as soon as the type is\n    // fixed, the key warnings will appear.)\n\n\n    if (validType) {\n      var children = props.children;\n\n      if (children !== undefined) {\n        if (isStaticChildren) {\n          if (isArray(children)) {\n            for (var i = 0; i < children.length; i++) {\n              validateChildKeys(children[i], type);\n            }\n\n            if (Object.freeze) {\n              Object.freeze(children);\n            }\n          } else {\n            error('React.jsx: Static children should always be an array. ' + 'You are likely explicitly calling React.jsxs or React.jsxDEV. ' + 'Use the Babel transform instead.');\n          }\n        } else {\n          validateChildKeys(children, type);\n        }\n      }\n    }\n\n    if (type === REACT_FRAGMENT_TYPE) {\n      validateFragmentProps(element);\n    } else {\n      validatePropTypes(element);\n    }\n\n    return element;\n  }\n} // These two functions exist to still get child warnings in dev\n// even with the prod transform. This means that jsxDEV is purely\n// opt-in behavior for better messages but that we won't stop\n// giving you warnings if you use production apis.\n\nfunction jsxWithValidationStatic(type, props, key) {\n  {\n    return jsxWithValidation(type, props, key, true);\n  }\n}\nfunction jsxWithValidationDynamic(type, props, key) {\n  {\n    return jsxWithValidation(type, props, key, false);\n  }\n}\n\nvar jsx =  jsxWithValidationDynamic ; // we may want to special case jsxs internally to take advantage of static children.\n// for now we can ship identical prod functions\n\nvar jsxs =  jsxWithValidationStatic ;\n\nexports.Fragment = REACT_FRAGMENT_TYPE;\nexports.jsx = jsx;\nexports.jsxs = jsxs;\n  })();\n}\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","const metaState = {};\nconst compatVault = {\n  get(nonRef) {\n    return nonRef;\n  },\n  setMetaValue([id, meta, key], value) {\n    const oldValue = compatVault.getResourceMeta(id, meta);\n    const oldValueItem = oldValue ? oldValue[key] : void 0;\n    const newValue = typeof value === \"function\" ? value(oldValueItem) : value;\n    metaState[id] = {\n      ...metaState[id] || {},\n      [meta]: {\n        ...(metaState[id] || {})[meta] || {},\n        [key]: newValue\n      }\n    };\n  },\n  getResourceMeta: (resource, metaKey) => {\n    const resourceMeta = metaState[resource];\n    if (!resourceMeta) {\n      return void 0;\n    }\n    if (!metaKey) {\n      return resourceMeta;\n    }\n    return resourceMeta[metaKey];\n  }\n};\nfunction createEventsHelper(vault = compatVault) {\n  return {\n    addEventListener(resource, event, listener, scope) {\n      if (!resource) {\n        return;\n      }\n      vault.setMetaValue(\n        [resource.id, \"eventManager\", event],\n        (registeredCallbacks) => {\n          const callbacks = registeredCallbacks || [];\n          for (const registered of callbacks) {\n            if (registered.callback === listener) {\n              return callbacks;\n            }\n          }\n          return [...callbacks, { callback: listener, scope }];\n        }\n      );\n      return listener;\n    },\n    removeEventListener(resource, event, listener) {\n      if (!resource) {\n        return;\n      }\n      vault.setMetaValue(\n        [resource.id, \"eventManager\", event],\n        (registeredCallbacks) => {\n          return (registeredCallbacks || []).filter((registeredCallback) => registeredCallback.callback !== listener);\n        }\n      );\n    },\n    getListenersAsProps(resourceOrId, scope) {\n      const resource = typeof resourceOrId === \"string\" ? { id: resourceOrId } : resourceOrId;\n      if (!resource || !resource.id) {\n        return {};\n      }\n      const hooks = vault.getResourceMeta(resource.id, \"eventManager\");\n      const props = {};\n      if (hooks && resource) {\n        for (const hook of Object.keys(hooks)) {\n          props[hook] = (e) => {\n            const fullResource = vault.get(resource);\n            for (const { callback, scope: _scope } of hooks[hook] || []) {\n              if (!_scope || scope && _scope.indexOf(scope) !== -1) {\n                callback(e, fullResource);\n              }\n            }\n          };\n        }\n      }\n      return props;\n    }\n  };\n}\nfunction createStylesHelper(vault = compatVault) {\n  return {\n    applyStyles(resource, scope, styles) {\n      const id = typeof resource === \"string\" ? resource : resource.id;\n      return vault.setMetaValue([id, \"styles\", scope], styles);\n    },\n    getAppliedStyles(resource) {\n      const id = typeof resource === \"string\" ? resource : resource.id;\n      return vault.getResourceMeta(id, \"styles\");\n    }\n  };\n}\nfunction p(i) {\n  return i.endsWith(\"info.json\") ? i : i.endsWith(\"/\") ? `${i}info.json` : `${i}/info.json`;\n}\nconst te = \"http://library.stanford.edu/iiif/image-api/compliance.html#level0\", z = \"http://library.stanford.edu/iiif/image-api/compliance.html#level1\", A = \"http://library.stanford.edu/iiif/image-api/compliance.html#level2\", ne = \"http://library.stanford.edu/iiif/image-api/conformance.html#level0\", E = \"http://library.stanford.edu/iiif/image-api/conformance.html#level1\", b = \"http://library.stanford.edu/iiif/image-api/conformance.html#level2\", re = \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0\", L = \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1\", M = \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2\", se = \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0\", W = \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1\", j = \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2\", ae = \"http://iiif.io/api/image/1/level0.json\", oe = \"http://iiif.io/api/image/1/profiles/level0.json\", $ = \"http://iiif.io/api/image/1/level1.json\", C = \"http://iiif.io/api/image/1/profiles/level1.json\", P = \"http://iiif.io/api/image/1/level2.json\", B = \"http://iiif.io/api/image/1/profiles/level2.json\", fe = \"http://iiif.io/api/image/2/level0.json\", le = \"http://iiif.io/api/image/2/profiles/level0.json\", N = \"http://iiif.io/api/image/2/level1.json\", R = \"http://iiif.io/api/image/2/profiles/level1.json\", H = \"http://iiif.io/api/image/2/level2.json\", T = \"http://iiif.io/api/image/2/profiles/level2.json\", he = \"level0\", G = \"level1\", k = \"level2\", ue = \"http://iiif.io/api/image/2/level0\", Q = \"http://iiif.io/api/image/2/level1\", V = \"http://iiif.io/api/image/2/level2\", D = [V, A, b, M, j, P, B, H, T, k], U = [...D, Q, z, E, L, W, $, C, N, R, G], J = [ue, Q, V, te, z, A, ne, E, b, re, L, M, se, W, j, ae, oe, $, C, P, B, fe, le, N, R, H, T, he, G, k], ce = { extraFormats: [\"jpg\"], extraQualities: [\"default\"], extraFeatures: [\"sizeByWhListed\"] }, de = { extraFormats: [\"jpg\"], extraQualities: [\"default\"], extraFeatures: [\"baseUriRedirect\", \"cors\", \"jsonldMediaType\", \"regionByPx\", \"regionSquare\", \"sizeByWhListed\", \"sizeByH\", \"sizeByW\", \"sizeByWh\"] }, ge = { extraFormats: [\"jpg\", \"png\"], extraQualities: [\"default\"], extraFeatures: [\"baseUriRedirect\", \"cors\", \"jsonldMediaType\", \"regionByPct\", \"regionByPx\", \"regionSquare\", \"rotationBy90s\", \"sizeByWhListed\", \"sizeByConfinedWh\", \"sizeByH\", \"sizeByPct\", \"sizeByW\", \"sizeByWh\"] };\nfunction pe(i) {\n  return D.indexOf(i) !== -1 ? ge : U.indexOf(i) !== -1 ? de : ce;\n}\nfunction K(i) {\n  const e = i ? Array.isArray(i.profile) ? i.profile : [i.profile] : [], t = { extraQualities: [], extraFormats: [], extraFeatures: [] };\n  for (let n of e)\n    if (typeof n == \"string\" && (n = pe(n)), !!n) {\n      if (n.formats)\n        for (const r of n.formats)\n          t.extraFormats.indexOf(r) === -1 && t.extraFormats.push(r);\n      if (n.qualities)\n        for (const r of n.qualities)\n          t.extraQualities.indexOf(r) === -1 && t.extraQualities.push(r);\n      if (n.supports)\n        for (const r of n.supports)\n          t.extraFeatures.indexOf(r) === -1 && t.extraFeatures.push(r);\n      if (n.maxHeight && (t.maxHeight = n.maxHeight), n.maxWidth && (t.maxWidth = n.maxWidth), n.maxArea && (t.maxArea = n.maxArea), n.extraFormats)\n        for (const r of n.extraFormats)\n          t.extraFormats.indexOf(r) === -1 && t.extraFormats.push(r);\n      if (n.extraQualities)\n        for (const r of n.extraQualities)\n          t.extraQualities.indexOf(r) === -1 && t.extraQualities.push(r);\n      if (n.extraFeatures)\n        for (const r of n.extraFeatures)\n          t.extraFeatures.indexOf(r) === -1 && t.extraFeatures.push(r);\n      n.maxHeight && (t.maxHeight = n.maxHeight), n.maxWidth && (t.maxWidth = n.maxWidth), n.maxArea && (t.maxArea = n.maxArea);\n    }\n  if (i.extraFormats)\n    for (const n of i.extraFormats)\n      t.extraFormats.indexOf(n) === -1 && t.extraFormats.push(n);\n  if (i.extraFeatures)\n    for (const n of i.extraFeatures)\n      t.extraFeatures.indexOf(n) === -1 && t.extraFeatures.push(n);\n  if (i.extraQualities)\n    for (const n of i.extraQualities)\n      t.extraQualities.indexOf(n) === -1 && t.extraQualities.push(n);\n  return t;\n}\nfunction me(i) {\n  try {\n    if (i === \"full\")\n      return { full: true };\n    if (i === \"square\")\n      return { square: true };\n    const e = i.startsWith(\"pct:\"), n = i.substr(e ? 4 : 0).split(\",\").map((r) => parseFloat(r));\n    return { x: n[0], y: n[1], w: n[2], h: n[3], percent: e };\n  } catch {\n    throw new Error(\"Expected 'full', 'square' or 'x,y,w,h'. Found \" + i);\n  }\n}\nfunction xe(i) {\n  const e = { upscaled: false, max: false, confined: false };\n  if (i[0] === \"^\" && (e.upscaled = true, i = i.slice(1)), i === \"max\" || i === \"full\")\n    return e.max = true, e.serialiseAsFull = i === \"full\", e;\n  if (i[0] === \"!\" && (e.confined = true, i = i.slice(1)), i[0] === \"p\")\n    return e.percentScale = parseFloat(i.slice(4)), e;\n  const t = i.split(\",\").map((n) => n.trim());\n  return t.length && (t[0] !== \"\" && (e.width = parseInt(t[0], 10)), t[1] !== \"\" ? (e.height = parseInt(t[1], 10), e.version = 2) : e.version = 3), e;\n}\nfunction Ie(i) {\n  const e = { angle: 0 };\n  if (i[0] === \"!\" && (e.mirror = true, i = i.substr(1)), e.angle = parseFloat(i) % 360, Number.isNaN(e.angle))\n    throw new Error(`Invalid rotation ${i}`);\n  return e;\n}\nfunction ye(i, e = \"\") {\n  const t = i.match(/^(([a-zA-Z]+):\\/\\/([^/]+))?((.*)+)/);\n  if (!t)\n    throw new Error(`Invalid or unknown input ${i}`);\n  const n = t[2], r = t[3];\n  let s = t[4];\n  if (s[0] === \"/\" && (s = s.substr(1)), e.length > 0) {\n    if (e[0] === \"/\" && (e = e.substr(1)), e !== s.substr(0, e.length))\n      throw new Error(`Path does not start with prefix (path: ${s}, prefix: ${e})`);\n    s = s.substr(e.length);\n  }\n  return { scheme: n, server: r, path: s, prefix: e };\n}\nfunction _e(i, e = \"\") {\n  const { path: t, scheme: n, server: r, prefix: s } = ye(i, e), a = t.split(\"/\").reverse(), [o, f, u, l, ...d] = a, g = d.reverse().filter(Boolean).join(\"/\");\n  if (a.length === 1 || o === \"\")\n    return { type: \"base\", scheme: n, server: r, prefix: s, identifier: g };\n  if (o === \"info.json\") {\n    const [, ...c] = a;\n    return { type: \"info\", scheme: n, server: r, prefix: s, identifier: c.reverse().filter(Boolean).join(\"/\") };\n  }\n  const m = o.split(\".\");\n  return { type: \"image\", scheme: n, server: r, prefix: s, identifier: g, originalPath: t, region: me(l), size: xe(u), rotation: Ie(f), quality: m[0], format: m[1] };\n}\nfunction we(i) {\n  const e = _e(p(i.id));\n  if (e.type !== \"info\")\n    throw new Error(\"Invalid service URL\");\n  const t = K(i);\n  return { identifier: e.identifier, originalPath: \"\", server: e.server, prefix: e.prefix, scheme: e.scheme, type: \"image\", quality: t.extraQualities.indexOf(\"default\") === -1 ? t.extraQualities[0] : \"default\", region: { full: true }, size: { max: true, upscaled: false, confined: false }, format: \"jpg\", rotation: { angle: 0 } };\n}\nfunction Se(i, e, t) {\n  const n = t.length, r = [];\n  for (let s = 0; s < n; s++) {\n    const o = t[s].width;\n    r.push(i / o);\n  }\n  return r;\n}\nfunction ve(i, e, t) {\n  const n = t.length, r = [];\n  for (let s = 0; s < n; s++) {\n    const a = t[s];\n    r.push({ width: Math.floor(i / a), height: Math.floor(e / a) });\n  }\n  return r;\n}\nfunction h(i) {\n  if (i[\"@id\"])\n    return i[\"@id\"];\n  if (i.id)\n    return i.id;\n}\nfunction w(i) {\n  if (!i || !i.profile || !h(i))\n    return false;\n  const e = Array.isArray(i.profile) ? i.profile : [i.profile];\n  for (const t of e)\n    if (typeof t == \"string\" && J.indexOf(t) !== -1)\n      return true;\n  return false;\n}\nfunction Fe(i) {\n  if (!w(i))\n    return false;\n  const e = Array.isArray(i.profile) ? i.profile : [i.profile];\n  for (const t of e)\n    if (typeof t == \"string\") {\n      if (U.indexOf(t) !== -1)\n        return true;\n    } else {\n      const n = [...t.supports || [], ...t.extraFeatures || []];\n      if (n.indexOf(\"regionByPx\") !== -1 && (n.indexOf(\"sizeByW\") !== -1 || n.indexOf(\"sizeByWh\") !== -1))\n        return true;\n    }\n  return false;\n}\nfunction v(i, e) {\n  if (e && e.profile) {\n    const t = e.profile;\n    if (t) {\n      const n = Array.isArray(t) ? t : [t];\n      return n.includes(`level${i}`) || n.includes(`http://iiif.io/api/image/2/level${i}.json`) || n.includes(`http://iiif.io/api/image/1/level${i}.json`) || n.includes(`http://iiif.io/api/image/1/profiles/level${i}.json`);\n    }\n  }\n  return false;\n}\nfunction F(i) {\n  return w(i) ? v(0, i) ? 0 : v(1, i) ? 1 : v(2, i) ? 2 : null : null;\n}\nfunction X(i) {\n  return (i[\"@context\"] ? Array.isArray(i[\"@context\"]) ? i[\"@context\"] : [i[\"@context\"]] : []).indexOf(\"http://iiif.io/api/image/3/context.json\") !== -1;\n}\nfunction Oe(i) {\n  if (!Fe(i))\n    return [];\n  const e = [], t = Array.isArray(i.profile) ? i.profile : [i.profile], n = t.length;\n  for (let r = 0; r < n; r++) {\n    const s = t[r];\n    if (typeof s != \"string\" && (s.maxHeight || s.maxWidth))\n      return [{ id: h(i), type: \"variable\", minWidth: 0, minHeight: 0, maxHeight: s.maxHeight || s.maxWidth, maxWidth: s.maxWidth || s.maxHeight, level: F(i), version: i[\"@context\"] === \"http://iiif.io/api/image/3/context.json\" ? 3 : 2 }];\n  }\n  if (i.tiles) {\n    const r = i.tiles.length;\n    for (let s = 0; s < r; s++) {\n      const a = i.tiles[s];\n      (a.height || a.width) && e.push({ id: h(i), type: \"variable\", minHeight: 0, minWidth: 0, maxHeight: a.height || a.width, maxWidth: a.width, level: F(i), version: X(i) ? 3 : 2 });\n    }\n  }\n  return e;\n}\nfunction Y(i) {\n  const e = /^.*\\/(full)\\/(((\\d+),(\\d+)?)|max)\\/(\\d+)\\/default\\.(jpg|png|jpeg)$/, t = i.match(e);\n  if (t) {\n    const n = t[1], r = parseInt(t[4], 10), s = parseInt(t[5], 10), a = t[7];\n    if ((n === \"max\" || n === \"full\") && r && s && a)\n      return { type: \"fixed\", id: i, height: s, width: r };\n  }\n  return { type: \"unknown\", id: i };\n}\nfunction ze(i) {\n  if (i[\"@type\"])\n    return i[\"@type\"];\n  if (i.type)\n    return i.type;\n}\nfunction Ae(i) {\n  if (typeof i == \"string\")\n    return Y(i);\n  const e = ze(i);\n  if (e !== \"Image\" && e !== \"sc:Image\")\n    return null;\n  const t = i, n = h(t);\n  return n ? n && t.width && t.height ? { id: n, type: \"fixed\", width: t.width, height: t.height, unsafe: true } : Y(n) : null;\n}\nfunction Ee(i) {\n  return w(i) ? (i && i.sizes ? i.sizes : []).map((e) => ({ id: h(i), type: \"fixed-service\", height: e.height, width: e.width, level: F(i), version: X(i) ? 3 : 2 })) : [];\n}\nfunction q(i) {\n  const e = [], t = i.length;\n  for (let n = 0; n < t; n++) {\n    const r = Ee(i[n]);\n    r.length && e.push(...r);\n    const s = Oe(i[n]);\n    s.length && e.push(...s);\n  }\n  return e;\n}\nfunction ee(i) {\n  const e = i.service ? Array.isArray(i.service) ? i.service : [i.service] : [], t = e.length, n = [];\n  for (let r = 0; r < t; r++)\n    w(e[r]) && n.push(e[r]);\n  return n;\n}\nfunction be(i, e = true, t) {\n  const n = [], r = Ae(i);\n  if (r === null)\n    return n;\n  const s = i;\n  if (n.push(r), e && s.width && s.height) {\n    const a = [], o = ee(s);\n    for (const f of o) {\n      const u = { id: h(f), width: s.width, height: s.height };\n      if (t.canLoadSync(u)) {\n        const l = t.loadServiceSync(u);\n        l && (l.height || (l.height = s.height), l.width || (l.width = s.width), a.push(...q([l])));\n      }\n    }\n    if (a.length)\n      return n.push(...a), n;\n  }\n  return s.service && n.push(...q(s.service)), n;\n}\nfunction Le({ x: i = 0, y: e = 0, w: t, h: n, full: r, square: s, percent: a }) {\n  if (r)\n    return \"full\";\n  if (s)\n    return \"square\";\n  if (typeof t > \"u\" || typeof n > \"u\")\n    throw new Error(\"RegionParameter: invalid region\");\n  const o = `${i},${e},${t},${n}`;\n  return a ? `pct:${o}` : o;\n}\nfunction Me({ max: i, percentScale: e, upscaled: t, confined: n, width: r, height: s, serialiseAsFull: a, version: o }) {\n  const f = [];\n  return t && f.push(\"^\"), i ? (f.push(a ? \"full\" : \"max\"), f.join(\"\")) : (n && f.push(\"!\"), e && f.push(`pct:${e}`), r && f.push(`${r}`), f.push(\",\"), s && o === 3 && f.push(`${s}`), f.join(\"\"));\n}\nfunction We(i) {\n  return `${i.mirror ? \"!\" : \"\"}${(i.angle || 0) % 360}`;\n}\nvar Ve = Object.defineProperty, De = Object.defineProperties, Ue = Object.getOwnPropertyDescriptors, je = Object.getOwnPropertySymbols, Je = Object.prototype.hasOwnProperty, Ze = Object.prototype.propertyIsEnumerable, $e = (i, e, t) => e in i ? Ve(i, e, { enumerable: true, configurable: true, writable: true, value: t }) : i[e] = t, x = (i, e) => {\n  for (var t in e || (e = {}))\n    Je.call(e, t) && $e(i, t, e[t]);\n  if (je)\n    for (var t of je(e))\n      Ze.call(e, t) && $e(i, t, e[t]);\n  return i;\n}, I = (i, e) => De(i, Ue(e));\nfunction Ce(i, e) {\n  const t = i.prefix.startsWith(\"/\") ? i.prefix.substr(1) : i.prefix, n = `${i.scheme}://${i.server}/${t ? `${t}/` : \"\"}${i.identifier}`;\n  if (i.type === \"base\")\n    return n;\n  if (i.type === \"info\")\n    return `${n}/info.json`;\n  let { size: r } = i;\n  const { region: s, rotation: a, format: o, quality: f } = i;\n  if (e) {\n    const u = e[\"@context\"] ? Array.isArray(e[\"@context\"]) ? e[\"@context\"] : [e[\"@context\"]] : [], l = u.indexOf(\"http://iiif.io/api/image/2/context.json\") !== -1, d = u.indexOf(\"http://iiif.io/api/image/3/context.json\") !== -1;\n    if ((r.width === e.width && !r.height || r.height === e.height && !r.width || r.width === e.width && r.height === e.height) && (r = I(x({}, r), { max: true })), l && (r.max && !r.serialiseAsFull && (r = I(x({}, r), { serialiseAsFull: true })), !r.max && r.width && r.height && (r = I(x({}, r), { height: void 0 })), r = I(x({}, r), { version: 2 })), d) {\n      if (r.max && r.serialiseAsFull && (r = I(x({}, r), { serialiseAsFull: false })), r.width && !r.height && e.width && e.height) {\n        const g = e.height / e.width;\n        r = I(x({}, r), { height: Math.ceil(r.width * g) });\n      }\n      r = I(x({}, r), { version: 3 });\n    }\n  }\n  return [n, Le(s), Me(r), We(a), `${f}.${o}`].filter(Boolean).join(\"/\");\n}\nfunction O(i, e, t) {\n  const n = we({ \"@context\": i.version === 3 ? \"http://iiif.io/api/image/3/context.json\" : \"http://iiif.io/api/image/2/context.json\", id: p(h(i)), profile: i.level === null || typeof i.level > \"u\" ? \"level0\" : `level${i.level}}`, type: i.version === 3 ? \"ImageService3\" : \"ImageService2\" });\n  if (n.type !== \"image\")\n    throw new Error(\"Invalid service\");\n  return n.size.max = false, n.size.width = e, n.size.height = t, { id: Ce(n), type: \"fixed\", width: e, height: t || i.height / (i.width || 1) * e, unsafe: i.width > e };\n}\nfunction y(i) {\n  const e = i.replace(/(https?:\\/\\/)?(www.)?/i, \"\");\n  return e.indexOf(\"/\") !== -1 ? e.split(\"/\")[0] : e;\n}\nfunction Pe(i, e, t) {\n  const n = i.width ? i.width : i.maxWidth;\n  return t.height <= i.maxHeight && t.width <= i.maxWidth && t.height >= i.minHeight && t.width >= i.minWidth && (!e || Math.abs(t.width - n) < Math.abs(e.width - n));\n}\nfunction Be(i, e) {\n  const t = [], n = Object.assign({ unsafeImageService: false, atAnyCost: true, fallback: true, minHeight: 64, minWidth: 64, maxHeight: 1 / 0, maxWidth: 1 / 0, returnAllOptions: false, preferFixedSize: false, allowUnsafe: false, explain: false, height: 0, width: 0 }, i), r = (l, d = 0) => n.explain ? t.push(new Array(d).fill(0).map((g) => \"    \").join(\"\") + l().trim()) : void 0, s = [], a = [];\n  let o = null;\n  r(() => `Using configuration: ${JSON.stringify(n, null, 2)}`);\n  const f = (l, d) => {\n    if (r(() => \"Swapping choice\", 3), Pe(n, d, l)) {\n      if (n.preferFixedSize && l.unsafe) {\n        r(() => `We found an image that was marked as unsafe, but it was the best size. (${l.id})`, 4), a.push(l);\n        return;\n      }\n      n.returnAllOptions && d && a.push(d), r(() => `We found a new image that was the best size. (${l.id})`, 4), o = l;\n    } else\n      n.returnAllOptions && a.push(l);\n  };\n  r(() => `The input shows we have ${e.length} list(s) of candidates to choose from.`);\n  const u = e.length;\n  for (let l = 0; l < u; l++) {\n    const d = e[l]();\n    r(() => `Candidate group ${l}: ${JSON.stringify(d, null, 2)}`, 1);\n    const g = d.length;\n    r(() => `Checking candidate list number ${l} and found ${g} potential ways of creating image(s)`, 1);\n    for (let m = 0; m < g; m++) {\n      const c = d[m];\n      if (r(() => `-> Checking candidate ${m}`, 1), c.type === \"unknown\" && n.atAnyCost && (r(() => `We've found an unknown image type, adding this to the \"last resort\" list`, 2), s.push(c)), c.type === \"fixed\" && (c.unsafe ? (r(() => `We've found an unsafe fixed image type, adding this to the \"last resort\" list`, 2), s.push(c)) : (r(() => \"We've found a fixed size image, checking if it matches the request\", 2), f(c, o))), c.type === \"fixed-service\")\n        if (n.unsafeImageService) {\n          r(() => \"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)\", 2);\n          const S = O(c, n.width, n.height);\n          f(S, o);\n        } else {\n          r(() => \"Checking for an image from the tile source 3\", 2);\n          const S = O(c, c.width, c.height);\n          f(S, o);\n        }\n      if (c.type === \"variable\" && c.maxWidth) {\n        const S = O({ id: c.id, type: \"fixed-service\", width: c.maxWidth, height: c.maxWidth, level: c.level, version: c.version }, c.maxWidth);\n        f(S, o);\n      }\n    }\n    if (o && !n.returnAllOptions) {\n      if (o.unsafe || n.allowUnsafe)\n        continue;\n      r(() => `We found a match in choice list number ${l}, no searching any more`);\n      break;\n    }\n  }\n  return n.atAnyCost && a.length === 0 ? (r(() => o ? `We found an image! ${o.id} of type ${o.type}` : 'We found no images, but \"atAnyCost\" is set, so returning that'), { best: o || s[0], fallback: s.slice(1), log: t }) : n.returnAllOptions ? (r(() => \"Returning all options that we have found\"), { best: n.atAnyCost ? o || a[0] || s[0] : o || a[0], fallback: [...a, ...s], log: t }) : (r(() => \"Returning the best image that we found, and a fallback\"), { best: o || a[0] || null, fallback: o ? a : a.slice(1), log: t });\n}\nvar qe = Object.defineProperty, ei = Object.defineProperties, ii = Object.getOwnPropertyDescriptors, Ne = Object.getOwnPropertySymbols, ti = Object.prototype.hasOwnProperty, ni = Object.prototype.propertyIsEnumerable, Re = (i, e, t) => e in i ? qe(i, e, { enumerable: true, configurable: true, writable: true, value: t }) : i[e] = t, ri = (i, e) => {\n  for (var t in e || (e = {}))\n    ti.call(e, t) && Re(i, t, e[t]);\n  if (Ne)\n    for (var t of Ne(e))\n      ni.call(e, t) && Re(i, t, e[t]);\n  return i;\n}, si = (i, e) => ei(i, ii(e));\nfunction He(i, e, t) {\n  const n = i > e ? i : e, r = t.length, s = [];\n  for (let a = 0; a < r; a++) {\n    const o = t[a];\n    let f = o.scaleFactors[0], u = n / f;\n    const l = [f];\n    for (; u >= o.width; )\n      f = f * 2, l.push(f), u = u / 2;\n    s.push(si(ri({}, o), { scaleFactors: l }));\n  }\n  return s;\n}\nfunction Te(i, e) {\n  if (i.length !== e.length)\n    return false;\n  if (i.length === 0 && e.length === 0)\n    return true;\n  const t = i.length;\n  let n = true;\n  for (let s = 0; s < t; s++) {\n    const a = i[s], o = e[s];\n    if (a.width !== o.width || a.height !== o.height) {\n      n = false;\n      break;\n    }\n  }\n  if (n)\n    return true;\n  let r = 0;\n  for (let s = 0; s < t; s++)\n    for (let a = 0; a < t; a++)\n      if (i[s].width === e[a].width && i[s].height === e[a].height) {\n        r++;\n        break;\n      }\n  return r === t;\n}\nfunction Ge(i) {\n  return v(0, i);\n}\nvar _ = (i, e, t) => new Promise((n, r) => {\n  var s = (f) => {\n    try {\n      o(t.next(f));\n    } catch (u) {\n      r(u);\n    }\n  }, a = (f) => {\n    try {\n      o(t.throw(f));\n    } catch (u) {\n      r(u);\n    }\n  }, o = (f) => f.done ? n(f.value) : Promise.resolve(f.value).then(s, a);\n  o((t = t.apply(i, e)).next());\n});\nclass ke {\n  constructor() {\n    this.config = { verificationsRequired: 1, approximateServices: true, enableFetching: true, disableThrottling: false }, this.fetchingCount = 0, this.imageServices = {}, this.knownImageServers = {};\n  }\n  setConfig(e) {\n    Object.assign(this.config, e);\n  }\n  sample(e, t, n = true) {\n    const r = y(h(e)), s = p(h(e)), a = this.knownImageServers[r];\n    return this.imageServices[s] = Object.assign(e, { real: true }), !a && e.tiles && !Ge(e) ? (this.knownImageServers[r] = { verifications: 0, malformed: false, root: r, preLoaded: n, sampledId: h(e), verified: false, server: null, result: { context: e[\"@context\"] || [], sampledProfile: e.profile, resourceServiceRatio: t && e.height ? t.height / e.height : 1, sampledSizes: e.sizes || [], sizeRatios: Se(e.width, e.height, e.sizes || []), sampledTiles: e.tiles || [] } }, true) : this.verify(e);\n  }\n  preLoad(e, t = true) {\n    this.knownImageServers[e.root] = e, t && (this.knownImageServers[e.root].malformed = false, this.knownImageServers[e.root].verifications = this.config.verificationsRequired);\n  }\n  predict(e, t = false, n = false) {\n    const r = e == null ? void 0 : e.source, s = y(h(e)), a = this.knownImageServers[s];\n    if (!a || !a.result || !((r == null ? void 0 : r.height) || e.height) || !((r == null ? void 0 : r.width) || e.width) || !n && (a.malformed || a.verifications < this.config.verificationsRequired) || Ge(e.source))\n      return null;\n    const o = p(h(e));\n    return this.imageServices[o] || (this.imageServices[o] = { \"@context\": a.result.context, \"@id\": h(e), id: h(e), protocol: \"http://iiif.io/api/image\", tiles: (r == null ? void 0 : r.tiles) || He(e.width, e.height, a.result.sampledTiles), sizes: (r == null ? void 0 : r.sizes) || ve(Math.round(e.width / a.result.resourceServiceRatio), Math.round(e.height / a.result.resourceServiceRatio), a.result.sizeRatios), profile: (r == null ? void 0 : r.profile) || a.result.sampledProfile, height: (r == null ? void 0 : r.height) || e.height, width: (r == null ? void 0 : r.width) || e.width, real: false }), this.imageServices[o];\n  }\n  getThumbnailFromResource(e, t) {\n    return _(this, arguments, function* (n, r, s = true, a = []) {\n      const o = n ? yield this.getImageCandidates(n, s) : [];\n      return Be(r, [() => a, () => o]);\n    });\n  }\n  getImageCandidates(e, t = true) {\n    return _(this, null, function* () {\n      const n = e;\n      if (t && n.height && n.width) {\n        const r = ee(n);\n        for (const s of r) {\n          const a = { id: h(s), width: s.width ? s.width : n.width, height: s.height ? s.height : n.height, source: s };\n          yield this.loadService(a);\n        }\n      }\n      return be(e, t, this);\n    });\n  }\n  verify(e) {\n    return _(this, null, function* () {\n      const t = this.predict(e, false, true), n = yield this.fetchService(h(e));\n      if (!t)\n        return false;\n      const r = t.height === n.height && t.width === n.width && t[\"@context\"] === n[\"@context\"] && Te(t.sizes || [], n.sizes || []);\n      if (r) {\n        const s = y(h(e));\n        this.knownImageServers[s].verifications += 1, this.knownImageServers[s].verifications >= this.config.verificationsRequired && (this.knownImageServers[s].verified = true);\n      }\n      return r;\n    });\n  }\n  canLoadSync(e) {\n    const t = typeof e == \"string\" ? e : h(e), n = p(t);\n    if (this.imageServices[n])\n      return true;\n    const r = this.knownImageServers[y(t)];\n    return r && !r.malformed && r.verifications >= this.config.verificationsRequired;\n  }\n  markAsMalformed(e) {\n    return _(this, null, function* () {\n      return this.knownImageServers[y(h(e))].malformed = true, this.loadService(e, true);\n    });\n  }\n  fetchService(e, t = false) {\n    return _(this, null, function* () {\n      const n = p(e);\n      if (this.imageServices[n] && (!t || this.imageServices[n].real))\n        return this.imageServices[n];\n      if (!this.config.enableFetching)\n        throw new Error(\"Fetching is not enabled\");\n      const r = yield this.fetch(n).then((s) => s.json());\n      return !r.id && r[\"@id\"] && (r.id = r[\"@id\"]), r.id !== e && (r.id = e, r[\"@id\"] && (r[\"@id\"] = e)), this.imageServices[n] = Object.assign(r, { real: true }), this.imageServices[n];\n    });\n  }\n  fetch(e, t) {\n    return _(this, null, function* () {\n      return fetch(e, t);\n    });\n  }\n  loadService(e, t = false) {\n    return _(this, null, function* () {\n      if (!this.config.disableThrottling) {\n        let s = true;\n        for (; s; )\n          if (this.fetchingCount >= this.config.verificationsRequired)\n            yield new Promise((a) => setTimeout(a, 500));\n          else {\n            s = false;\n            break;\n          }\n      }\n      const n = this.knownImageServers[y(h(e))];\n      if (n && !n.malformed && !t) {\n        yield n.result;\n        const s = this.loadServiceSync(e);\n        if (s)\n          return s;\n      }\n      this.fetchingCount++;\n      const r = yield this.fetchService(h(e), t);\n      return this.fetchingCount--, r.real && this.sample(r, e), r;\n    });\n  }\n  loadServiceSync(e) {\n    const t = p(h(e));\n    return this.imageServices[t] ? this.imageServices[t] : this.predict(e);\n  }\n}\nnew ke();\nfunction createThumbnailHelper(vault = compatVault, dependencies = {}) {\n  const imageServiceLoader = dependencies.imageServiceLoader || new ke();\n  async function getBestThumbnailAtSize(input, request, dereference, candidates = [], dimensions) {\n    const thumbnailNotFound = () => imageServiceLoader.getThumbnailFromResource(void 0, request, dereference, candidates);\n    if (!input) {\n      return await imageServiceLoader.getThumbnailFromResource(void 0, request, dereference, candidates);\n    }\n    if (typeof input === \"string\") {\n      const fixed = Ae(input);\n      if (fixed) {\n        candidates.push(fixed);\n      }\n      return await imageServiceLoader.getThumbnailFromResource(void 0, request, dereference, candidates);\n    }\n    const fullInput = vault.get(input, { skipSelfReturn: false });\n    if (typeof fullInput === \"string\") {\n      return { best: Ae(fullInput), fallback: [], log: [] };\n    }\n    if (!fullInput) {\n      return await thumbnailNotFound();\n    }\n    const parseThumbnail = async (resource) => {\n      if (resource && resource.thumbnail && resource.thumbnail.length) {\n        const thumbnail = vault.get(resource.thumbnail[0]);\n        const potentialThumbnails = await imageServiceLoader.getImageCandidates(thumbnail, dereference);\n        if (potentialThumbnails && potentialThumbnails.length) {\n          candidates.push(...potentialThumbnails);\n        }\n      }\n    };\n    await parseThumbnail(fullInput);\n    switch (fullInput.type) {\n      case \"Annotation\": {\n        const contentResources = Array.isArray(fullInput.body) ? fullInput.body : [fullInput.body];\n        const firstContentResources = vault.get(contentResources[0]);\n        if (dimensions && !firstContentResources.width) {\n          firstContentResources.width = dimensions.width;\n          firstContentResources.height = dimensions.height;\n        }\n        return await imageServiceLoader.getThumbnailFromResource(\n          firstContentResources,\n          request,\n          dereference,\n          candidates\n        );\n      }\n      case \"Canvas\": {\n        const canvas = fullInput;\n        return getBestThumbnailAtSize(canvas.items[0], request, dereference, candidates, {\n          width: canvas.width,\n          height: canvas.height\n        });\n      }\n      case \"AnnotationPage\": {\n        const annotationPage = fullInput;\n        return getBestThumbnailAtSize(annotationPage.items[0], request, dereference, candidates, dimensions);\n      }\n      case \"Choice\": {\n        const choice = fullInput;\n        if (!choice.items || choice.items[0]) {\n          return await thumbnailNotFound();\n        }\n        return getBestThumbnailAtSize(choice.items[0], request, dereference, candidates, dimensions);\n      }\n      case \"Collection\": {\n        const collection = fullInput;\n        const firstManifest = collection.items[0];\n        if (!firstManifest) {\n          return await thumbnailNotFound();\n        }\n        return getBestThumbnailAtSize(firstManifest, request, dereference, candidates, dimensions);\n      }\n      case \"Manifest\": {\n        const manifest = fullInput;\n        const firstCanvas = manifest.items[0];\n        if (!firstCanvas) {\n          return await thumbnailNotFound();\n        }\n        return getBestThumbnailAtSize(firstCanvas, request, dereference, candidates, dimensions);\n      }\n      case \"SpecificResource\":\n      case \"Image\":\n      case \"Dataset\":\n      case \"Sound\":\n      case \"Text\":\n      case \"TextualBody\":\n      case \"Video\":\n        if (dimensions && !fullInput.width) {\n          fullInput.width = dimensions.width;\n          fullInput.height = dimensions.height;\n        }\n        return imageServiceLoader.getThumbnailFromResource(fullInput, request, dereference, candidates);\n      case \"Service\":\n      case \"Range\":\n      case \"AnnotationCollection\":\n      case \"CanvasReference\":\n      case \"ContentResource\":\n        return await thumbnailNotFound();\n    }\n    return await thumbnailNotFound();\n  }\n  return {\n    getBestThumbnailAtSize\n  };\n}\nfunction getClosestLanguage(i18nLanguage, languages, i18nLanguages = [], strictFallback = false) {\n  if (!i18nLanguage || !languages || languages.length === 0) {\n    return void 0;\n  }\n  if (languages.length === 1) {\n    return languages[0];\n  }\n  if (languages.indexOf(i18nLanguage) !== -1) {\n    return i18nLanguage;\n  }\n  const root = i18nLanguage.indexOf(\"-\") !== -1 ? i18nLanguage.slice(0, i18nLanguage.indexOf(\"-\")) : null;\n  if (root && languages.indexOf(root) !== -1) {\n    return root;\n  }\n  for (const lang of i18nLanguages) {\n    if (languages.indexOf(lang) !== -1) {\n      return lang;\n    }\n  }\n  if (!strictFallback) {\n    const inverseRoot = languages.map((l) => l.indexOf(\"-\") !== -1 ? l.slice(0, l.indexOf(\"-\")) : null);\n    const inverseIdx = inverseRoot.indexOf(i18nLanguage);\n    if (inverseIdx !== -1) {\n      return languages[inverseIdx];\n    }\n    for (const lang of i18nLanguages) {\n      const root2 = lang.indexOf(\"-\") !== -1 ? lang.slice(0, lang.indexOf(\"-\")) : null;\n      const inverseIdx2 = root2 ? languages.indexOf(root2) : -1;\n      if (inverseIdx2 !== -1) {\n        return languages[inverseIdx2];\n      }\n    }\n  }\n  if (languages.indexOf(\"none\") !== -1) {\n    return \"none\";\n  }\n  if (languages.indexOf(\"@none\") !== -1) {\n    return \"@none\";\n  }\n  return languages[0];\n}\nfunction buildLocaleString(inputText, i18nLanguage, options = {}) {\n  const { strictFallback = false, defaultText = \"\", separator = \"\\n\", fallbackLanguages = [], closest } = options;\n  const languages = Object.keys(inputText || {});\n  const language = closest ? i18nLanguage : getClosestLanguage(i18nLanguage, languages, fallbackLanguages, strictFallback);\n  if (!inputText) {\n    return defaultText;\n  }\n  if (typeof inputText === \"string\") {\n    return inputText;\n  }\n  const candidateText = language ? inputText[language] : void 0;\n  if (candidateText) {\n    if (typeof candidateText === \"string\") {\n      return candidateText;\n    }\n    return candidateText.join(separator);\n  }\n  return \"\";\n}\nfunction getValue(inputText, options = {}) {\n  return buildLocaleString(inputText, typeof navigator !== \"undefined\" ? navigator.language : void 0, options);\n}\nvar _slicedToArray = function() {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e2 = void 0;\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n        if (i && _arr.length === i)\n          break;\n      }\n    } catch (err) {\n      _d = true;\n      _e2 = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"])\n          _i[\"return\"]();\n      } finally {\n        if (_d)\n          throw _e2;\n      }\n    }\n    return _arr;\n  }\n  return function(arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\nvar TAU = Math.PI * 2;\nvar mapToEllipse = function mapToEllipse2(_ref, rx, ry, cosphi, sinphi, centerx, centery) {\n  var x2 = _ref.x, y2 = _ref.y;\n  x2 *= rx;\n  y2 *= ry;\n  var xp = cosphi * x2 - sinphi * y2;\n  var yp = sinphi * x2 + cosphi * y2;\n  return {\n    x: xp + centerx,\n    y: yp + centery\n  };\n};\nvar approxUnitArc = function approxUnitArc2(ang1, ang2) {\n  var a = ang2 === 1.5707963267948966 ? 0.551915024494 : ang2 === -1.5707963267948966 ? -0.551915024494 : 4 / 3 * Math.tan(ang2 / 4);\n  var x1 = Math.cos(ang1);\n  var y1 = Math.sin(ang1);\n  var x2 = Math.cos(ang1 + ang2);\n  var y2 = Math.sin(ang1 + ang2);\n  return [{\n    x: x1 - y1 * a,\n    y: y1 + x1 * a\n  }, {\n    x: x2 + y2 * a,\n    y: y2 - x2 * a\n  }, {\n    x: x2,\n    y: y2\n  }];\n};\nvar vectorAngle = function vectorAngle2(ux, uy, vx, vy) {\n  var sign = ux * vy - uy * vx < 0 ? -1 : 1;\n  var dot = ux * vx + uy * vy;\n  if (dot > 1) {\n    dot = 1;\n  }\n  if (dot < -1) {\n    dot = -1;\n  }\n  return sign * Math.acos(dot);\n};\nvar getArcCenter = function getArcCenter2(px, py, cx, cy, rx, ry, largeArcFlag, sweepFlag, sinphi, cosphi, pxp, pyp) {\n  var rxsq = Math.pow(rx, 2);\n  var rysq = Math.pow(ry, 2);\n  var pxpsq = Math.pow(pxp, 2);\n  var pypsq = Math.pow(pyp, 2);\n  var radicant = rxsq * rysq - rxsq * pypsq - rysq * pxpsq;\n  if (radicant < 0) {\n    radicant = 0;\n  }\n  radicant /= rxsq * pypsq + rysq * pxpsq;\n  radicant = Math.sqrt(radicant) * (largeArcFlag === sweepFlag ? -1 : 1);\n  var centerxp = radicant * rx / ry * pyp;\n  var centeryp = radicant * -ry / rx * pxp;\n  var centerx = cosphi * centerxp - sinphi * centeryp + (px + cx) / 2;\n  var centery = sinphi * centerxp + cosphi * centeryp + (py + cy) / 2;\n  var vx1 = (pxp - centerxp) / rx;\n  var vy1 = (pyp - centeryp) / ry;\n  var vx2 = (-pxp - centerxp) / rx;\n  var vy2 = (-pyp - centeryp) / ry;\n  var ang1 = vectorAngle(1, 0, vx1, vy1);\n  var ang2 = vectorAngle(vx1, vy1, vx2, vy2);\n  if (sweepFlag === 0 && ang2 > 0) {\n    ang2 -= TAU;\n  }\n  if (sweepFlag === 1 && ang2 < 0) {\n    ang2 += TAU;\n  }\n  return [centerx, centery, ang1, ang2];\n};\nvar arcToBezier = function arcToBezier2(_ref2) {\n  var px = _ref2.px, py = _ref2.py, cx = _ref2.cx, cy = _ref2.cy, rx = _ref2.rx, ry = _ref2.ry, _ref2$xAxisRotation = _ref2.xAxisRotation, xAxisRotation = _ref2$xAxisRotation === void 0 ? 0 : _ref2$xAxisRotation, _ref2$largeArcFlag = _ref2.largeArcFlag, largeArcFlag = _ref2$largeArcFlag === void 0 ? 0 : _ref2$largeArcFlag, _ref2$sweepFlag = _ref2.sweepFlag, sweepFlag = _ref2$sweepFlag === void 0 ? 0 : _ref2$sweepFlag;\n  var curves = [];\n  if (rx === 0 || ry === 0) {\n    return [];\n  }\n  var sinphi = Math.sin(xAxisRotation * TAU / 360);\n  var cosphi = Math.cos(xAxisRotation * TAU / 360);\n  var pxp = cosphi * (px - cx) / 2 + sinphi * (py - cy) / 2;\n  var pyp = -sinphi * (px - cx) / 2 + cosphi * (py - cy) / 2;\n  if (pxp === 0 && pyp === 0) {\n    return [];\n  }\n  rx = Math.abs(rx);\n  ry = Math.abs(ry);\n  var lambda = Math.pow(pxp, 2) / Math.pow(rx, 2) + Math.pow(pyp, 2) / Math.pow(ry, 2);\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n  var _getArcCenter = getArcCenter(px, py, cx, cy, rx, ry, largeArcFlag, sweepFlag, sinphi, cosphi, pxp, pyp), _getArcCenter2 = _slicedToArray(_getArcCenter, 4), centerx = _getArcCenter2[0], centery = _getArcCenter2[1], ang1 = _getArcCenter2[2], ang2 = _getArcCenter2[3];\n  var ratio = Math.abs(ang2) / (TAU / 4);\n  if (Math.abs(1 - ratio) < 1e-7) {\n    ratio = 1;\n  }\n  var segments = Math.max(Math.ceil(ratio), 1);\n  ang2 /= segments;\n  for (var i = 0; i < segments; i++) {\n    curves.push(approxUnitArc(ang1, ang2));\n    ang1 += ang2;\n  }\n  return curves.map(function(curve) {\n    var _mapToEllipse = mapToEllipse(curve[0], rx, ry, cosphi, sinphi, centerx, centery), x1 = _mapToEllipse.x, y1 = _mapToEllipse.y;\n    var _mapToEllipse2 = mapToEllipse(curve[1], rx, ry, cosphi, sinphi, centerx, centery), x2 = _mapToEllipse2.x, y2 = _mapToEllipse2.y;\n    var _mapToEllipse3 = mapToEllipse(curve[2], rx, ry, cosphi, sinphi, centerx, centery), x3 = _mapToEllipse3.x, y3 = _mapToEllipse3.y;\n    return { x1, y1, x2, y2, x: x3, y: y3 };\n  });\n};\nvar parseSvgPath = parse;\nvar length = { a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0 };\nvar segment = /([astvzqmhlc])([^astvzqmhlc]*)/ig;\nfunction parse(path) {\n  var data = [];\n  path.replace(segment, function(_2, command, args) {\n    var type = command.toLowerCase();\n    args = parseValues(args);\n    if (type == \"m\" && args.length > 2) {\n      data.push([command].concat(args.splice(0, 2)));\n      type = \"l\";\n      command = command == \"m\" ? \"l\" : \"L\";\n    }\n    while (true) {\n      if (args.length == length[type]) {\n        args.unshift(command);\n        return data.push(args);\n      }\n      if (args.length < length[type])\n        throw new Error(\"malformed path data\");\n      data.push([command].concat(args.splice(0, length[type])));\n    }\n  });\n  return data;\n}\nvar number = /-?[0-9]*\\.?[0-9]+(?:e[-+]?\\d+)?/ig;\nfunction parseValues(args) {\n  var numbers = args.match(number);\n  return numbers ? numbers.map(Number) : [];\n}\nvar absSvgPath = absolutize;\nfunction absolutize(path) {\n  var startX = 0;\n  var startY = 0;\n  var x2 = 0;\n  var y2 = 0;\n  return path.map(function(seg) {\n    seg = seg.slice();\n    var type = seg[0];\n    var command = type.toUpperCase();\n    if (type != command) {\n      seg[0] = command;\n      switch (type) {\n        case \"a\":\n          seg[6] += x2;\n          seg[7] += y2;\n          break;\n        case \"v\":\n          seg[1] += y2;\n          break;\n        case \"h\":\n          seg[1] += x2;\n          break;\n        default:\n          for (var i = 1; i < seg.length; ) {\n            seg[i++] += x2;\n            seg[i++] += y2;\n          }\n      }\n    }\n    switch (command) {\n      case \"Z\":\n        x2 = startX;\n        y2 = startY;\n        break;\n      case \"H\":\n        x2 = seg[1];\n        break;\n      case \"V\":\n        y2 = seg[1];\n        break;\n      case \"M\":\n        x2 = startX = seg[1];\n        y2 = startY = seg[2];\n        break;\n      default:\n        x2 = seg[seg.length - 2];\n        y2 = seg[seg.length - 1];\n    }\n    return seg;\n  });\n}\nfunction parseAndNormalizeSvgPath(path) {\n  const parsed = parseSvgPath(path);\n  const absolute = absSvgPath(parsed);\n  let prevCmd;\n  let startX = 0;\n  let startY = 0;\n  let bezierX = 0;\n  let bezierY = 0;\n  let quadX;\n  let quadY;\n  let x2 = 0;\n  let y2 = 0;\n  const out = [];\n  for (let i = 0; i < absolute.length; i++) {\n    let seg = absolute[i];\n    const cmd = seg[0];\n    switch (cmd) {\n      case \"M\":\n        startX = seg[1];\n        startY = seg[2];\n        break;\n      case \"H\":\n        seg = [\"L\", seg[1], startY];\n        break;\n      case \"V\":\n        seg = [\"L\", startX, seg[1]];\n        break;\n      case \"S\":\n        {\n          let cx = x2;\n          let cy = y2;\n          if (prevCmd === \"C\" || prevCmd == \"S\") {\n            cx += cx - bezierX;\n            cy += cy - bezierY;\n          }\n          seg = [\"C\", cx, cy, seg[1], seg[2], seg[3], seg[4]];\n        }\n        break;\n      case \"T\":\n        if (prevCmd === \"Q\" || prevCmd == \"T\") {\n          quadX = x2 * 2 - quadX;\n          quadY = y2 * 2 - quadY;\n        } else {\n          quadX = x2;\n          quadY = y2;\n        }\n        seg = [\"Q\", quadX, quadY, seg[1], seg[2]];\n        break;\n      case \"Q\":\n        quadX = seg[1];\n        quadY = seg[2];\n        break;\n      case \"A\":\n        {\n          const curves = arcToBezier({\n            px: x2,\n            py: y2,\n            cx: seg[6],\n            cy: seg[7],\n            rx: seg[1],\n            ry: seg[2],\n            xAxisRotation: seg[3],\n            largeArcFlag: seg[4],\n            sweepFlag: seg[5]\n          });\n          if (!curves.length) {\n            continue;\n          }\n          for (const [j2, curve] of curves.entries()) {\n            seg = [\"C\", curve.x1, curve.y1, curve.x2, curve.y2, curve.x, curve.y];\n            if (j2 < curves.length - 1) {\n              out.push(seg);\n            }\n          }\n          seg = seg;\n        }\n        break;\n      case \"Z\":\n        seg = [\"L\", startX, startY];\n        break;\n    }\n    prevCmd = cmd;\n    x2 = seg[seg.length - 2];\n    y2 = seg[seg.length - 1];\n    if ([\"C\", \"Q\", \"A\"].indexOf(cmd) > -1) {\n      bezierX = seg[seg.length - 4];\n      bezierY = seg[seg.length - 3];\n    } else {\n      bezierX = x2;\n      bezierY = y2;\n    }\n    out.push(seg);\n  }\n  return out;\n}\n/** Code to \"flatten\" quadratic and cubic Bézier curves to polylines.\n *\n * All code in this module is based on JavaScript code by Raph Levien, published on his blog at\n * https://raphlinus.github.io/.\n * I merely changed the structure a bit, removed some unneeded parts and added some comments and type hints.\n *\n * Flattening of quadratic Bézier curves:\n * - Article: https://raphlinus.github.io/graphics/curves/2019/12/23/flatten-quadbez.html\n * - Code: https://github.com/raphlinus/raphlinus.github.io/blob/master/_posts/2019-12-23-flatten-quadbez.md?plain=1#L73-L212\n *\n * Flattening of cubic Bézier curves: https://levien.com/tmp/flatten.html\n *\n * Note that the code in this module has a different license than the rest of the package,\n * due to the inclusion of Apache-licensed third party code.\n *\n * @license\n * Copyright 2022 Johannes Baiter <johannes.baiter@gmail.com>\n * Copyright 2019, 2022 Raph Levien <raph.levien@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction flattenQuadraticBezier(start, control, end, tolerance = 1) {\n  return new QuadraticBezier(start, control, end).subdivide(tolerance);\n}\nfunction flattenCubicBezier(start, startControl, end, endControl, tolerance = 1) {\n  return new CubicBezier(\n    new Float64Array([start.x, start.y, startControl.x, startControl.y, end.x, end.y, endControl.x, endControl.y])\n  ).subdivide(tolerance);\n}\nfunction hypot2(p2) {\n  return p2.x * p2.x + p2.y * p2.y;\n}\nfunction approx_myint(x2) {\n  const d = 0.67;\n  return x2 / (1 - d + Math.pow(Math.pow(d, 4) + 0.25 * x2 * x2, 0.25));\n}\nfunction approx_inv_myint(x2) {\n  const b2 = 0.39;\n  return x2 * (1 - b2 + Math.sqrt(b2 * b2 + 0.25 * x2 * x2));\n}\nclass QuadraticBezier {\n  constructor(start, control, end) {\n    this.start = start;\n    this.control = control;\n    this.end = end;\n  }\n  eval(t) {\n    const mt = 1 - t;\n    return {\n      x: this.start.x * mt * mt + 2 * this.control.x * mt * t + this.end.x * t * t,\n      y: this.start.y * mt * mt + 2 * this.control.y * mt * t + this.end.y * t * t\n    };\n  }\n  mapToBasic() {\n    const { x: x0, y: y0 } = this.start;\n    const { x: x1, y: y1 } = this.control;\n    const { x: x2, y: y2 } = this.end;\n    const ddx = 2 * x1 - x0 - x2;\n    const ddy = 2 * y1 - y0 - y2;\n    const u0 = (x1 - x0) * ddx + (y1 - y0) * ddy;\n    const u2 = (x2 - x1) * ddx + (y2 - y1) * ddy;\n    const cross = (x2 - x0) * ddy - (y2 - y0) * ddx;\n    const paramX0 = u0 / cross;\n    const paramX2 = u2 / cross;\n    const scale = Math.abs(cross) / (Math.hypot(ddx, ddy) * Math.abs(paramX2 - paramX0));\n    return { x0, x2, scale, cross };\n  }\n  subdivide(tolerance) {\n    const params = this.mapToBasic();\n    const a0 = approx_myint(params.x0);\n    const a2 = approx_myint(params.x2);\n    const count = 0.5 * Math.abs(a2 - a0) * Math.sqrt(params.scale / tolerance);\n    const n = Math.ceil(count);\n    const u0 = approx_inv_myint(a0);\n    const u2 = approx_inv_myint(a2);\n    const tValues = [0];\n    for (let i = 1; i < n; i++) {\n      const u = approx_inv_myint(a0 + (a2 - a0) * i / n);\n      const t = (u - u0) / (u2 - u0);\n      tValues.push(t);\n    }\n    tValues.push(1);\n    return tValues.map((t) => this.eval(t));\n  }\n}\nclass CubicBezier {\n  constructor(coords) {\n    this.c = coords;\n  }\n  weightsum(c0, c1, c2, c3) {\n    const x2 = c0 * this.c[0] + c1 * this.c[2] + c2 * this.c[4] + c3 * this.c[6];\n    const y2 = c0 * this.c[1] + c1 * this.c[3] + c2 * this.c[5] + c3 * this.c[7];\n    return { x: x2, y: y2 };\n  }\n  eval(t) {\n    const mt = 1 - t;\n    const c0 = mt * mt * mt;\n    const c1 = 3 * mt * mt * t;\n    const c2 = 3 * mt * t * t;\n    const c3 = t * t * t;\n    return this.weightsum(c0, c1, c2, c3);\n  }\n  deriv(t) {\n    const mt = 1 - t;\n    const c0 = -3 * mt * mt;\n    const c3 = 3 * t * t;\n    const c1 = -6 * t * mt - c0;\n    const c2 = 6 * t * mt - c3;\n    return this.weightsum(c0, c1, c2, c3);\n  }\n  midpoint_quadbez() {\n    const p1 = this.weightsum(-0.25, 0.75, 0.75, -0.25);\n    return new QuadraticBezier({ x: this.c[0], y: this.c[1] }, p1, { x: this.c[6], y: this.c[7] });\n  }\n  subsegment(t0, t1) {\n    const c = new Float64Array(8);\n    const p0 = this.eval(t0);\n    const p3 = this.eval(t1);\n    c[0] = p0.x;\n    c[1] = p0.y;\n    const scale = (t1 - t0) / 3;\n    const d1 = this.deriv(t0);\n    c[2] = p0.x + scale * d1.x;\n    c[3] = p0.y + scale * d1.y;\n    const d2 = this.deriv(t1);\n    c[4] = p3.x - scale * d2.x;\n    c[5] = p3.y - scale * d2.y;\n    c[6] = p3.x;\n    c[7] = p3.y;\n    return new CubicBezier(c);\n  }\n  subdivide(tol) {\n    const tol1 = 0.1 * tol;\n    const tol2 = tol - tol1;\n    const sqrt_tol2 = Math.sqrt(tol2);\n    const err2 = hypot2(this.weightsum(1, -3, 3, -1));\n    const n_quads = Math.ceil(Math.pow(err2 / (432 * tol1 * tol1), 1 / 6));\n    const quads = [];\n    let sum = 0;\n    for (let i2 = 0; i2 < n_quads; i2++) {\n      const t0 = i2 / n_quads;\n      const t1 = (i2 + 1) / n_quads;\n      const quad = this.subsegment(t0, t1).midpoint_quadbez();\n      const params = quad.mapToBasic();\n      const a0 = approx_myint(params.x0);\n      const a2 = approx_myint(params.x2);\n      const scale = Math.sqrt(params.scale);\n      let val2 = Math.abs(a2 - a0) * scale;\n      if (Math.sign(params.x0) != Math.sign(params.x2)) {\n        const xmin = sqrt_tol2 / scale;\n        const cusp_val = sqrt_tol2 * Math.abs(a2 - a0) / approx_myint(xmin);\n        val2 = Math.max(val2, cusp_val);\n      }\n      quads.push({\n        quad,\n        a0,\n        a2,\n        val: val2\n      });\n      sum += val2;\n    }\n    const count = 0.5 * sum / sqrt_tol2;\n    const n = Math.ceil(count);\n    const result = [{ x: this.c[0], y: this.c[1] }];\n    let val = 0;\n    let i = 0;\n    for (let j2 = 1; j2 < n; j2++) {\n      const target = sum * j2 / n;\n      while (val + quads[i].val < target) {\n        val += quads[i].val;\n        i++;\n      }\n      const a0 = quads[i].a0;\n      const a2 = quads[i].a2;\n      const u0 = approx_inv_myint(a0);\n      const u2 = approx_inv_myint(a2);\n      const a = a0 + (a2 - a0) * (target - val) / quads[i].val;\n      const u = approx_inv_myint(a);\n      const t = (u - u0) / (u2 - u0);\n      result.push(quads[i].quad.eval(t));\n    }\n    result.push({ x: this.c[6], y: this.c[7] });\n    return result;\n  }\n}\nconst BOX_SELECTOR = /&?(xywh=)?(pixel:|percent:|pct:)?([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?)/;\nconst TEMPORAL_SELECTOR = /&?(t=)(npt:)?([0-9]+(.[0-9]+)?)?(,([0-9]+(.[0-9]+)?))?/;\nconst RGBA_COLOR = /^rgba\\((\\d+),(\\d+),(\\d+),([0-9.]+)\\)$/;\nfunction parseSelector(source, { domParser, svgPreprocessor } = {}) {\n  var _a, _b;\n  if (Array.isArray(source)) {\n    return source.reduce(\n      (data, nextSource) => {\n        const { selector, selectors } = parseSelector(nextSource);\n        if (selector) {\n          if (!data.selector) {\n            data.selector = selector;\n          }\n          data.selectors.push(...selectors);\n        }\n        return data;\n      },\n      {\n        selector: null,\n        selectors: []\n      }\n    );\n  }\n  if (!source) {\n    return {\n      selector: null,\n      selectors: []\n    };\n  }\n  if (typeof source === \"string\") {\n    const [id, fragment] = source.split(\"#\");\n    if (!fragment) {\n      return {\n        selector: null,\n        selectors: []\n      };\n    }\n    return parseSelector({ type: \"FragmentSelector\", value: fragment });\n  }\n  if (source.type === \"PointSelector\" && (source.t || source.t === 0)) {\n    const selector = {\n      type: \"TemporalSelector\",\n      temporal: {\n        startTime: source.t\n      }\n    };\n    return {\n      selector,\n      selectors: [selector]\n    };\n  }\n  if (source.type === \"FragmentSelector\") {\n    const matchBoxSelector = BOX_SELECTOR.exec(source.value);\n    if (matchBoxSelector) {\n      const selector = {\n        type: \"BoxSelector\",\n        spatial: {\n          unit: matchBoxSelector[2] === \"percent:\" || matchBoxSelector[2] === \"pct:\" ? \"percent\" : \"pixel\",\n          x: parseFloat(matchBoxSelector[3]),\n          y: parseFloat(matchBoxSelector[4]),\n          width: parseFloat(matchBoxSelector[5]),\n          height: parseFloat(matchBoxSelector[6])\n        }\n      };\n      return {\n        selector,\n        selectors: [selector]\n      };\n    }\n    const matchTimeSelector = source.value.match(TEMPORAL_SELECTOR);\n    if (matchTimeSelector) {\n      const selector = {\n        type: \"TemporalSelector\",\n        temporal: {\n          startTime: matchTimeSelector[4] ? parseFloat(matchTimeSelector[4]) : 0,\n          endTime: matchTimeSelector[7] ? parseFloat(matchTimeSelector[7]) : void 0\n        }\n      };\n      return {\n        selector,\n        selectors: [selector]\n      };\n    }\n    return {\n      selector: null,\n      selectors: []\n    };\n  }\n  if (source.type === \"SvgSelector\" && \"value\" in source) {\n    if (!domParser) {\n      if (typeof window !== \"undefined\") {\n        domParser = new window.DOMParser();\n      } else {\n        console.warn(\n          \"No DOMParser available, cannot parse SVG selector, `points`, `spatial` and `style` will be unavailable and the SVG will not be normalized.\"\n        );\n      }\n    }\n    let points = [];\n    let rect;\n    let style;\n    let svg = (_a = svgPreprocessor == null ? void 0 : svgPreprocessor(source.value)) != null ? _a : source.value;\n    let svgShape;\n    if (domParser) {\n      const svgElement = domParser.parseFromString(source.value, \"image/svg+xml\").querySelector(\"svg\");\n      if (!svgElement) {\n        console.warn(`Illegal SVG selector: ${source.value}`);\n        return {\n          selector: null,\n          selectors: []\n        };\n      }\n      const selectorElem = getSelectorElement(svgElement);\n      if (selectorElem) {\n        points = selectorElem.points;\n        svgShape = selectorElem.shapeType;\n        rect = [\n          Math.min(...points.map((p2) => p2[0])),\n          Math.min(...points.map((p2) => p2[1])),\n          Math.max(...points.map((p2) => p2[0])),\n          Math.max(...points.map((p2) => p2[1]))\n        ];\n        ({ style, svg } = (_b = extractStyles(selectorElem.element)) != null ? _b : { svg });\n      }\n    }\n    const sel = {\n      type: \"SvgSelector\",\n      svg,\n      svgShape,\n      style,\n      points: points.length ? points : void 0,\n      spatial: rect ? { unit: \"pixel\", x: rect[0], y: rect[1], width: rect[2] - rect[0], height: rect[3] - rect[1] } : void 0\n    };\n    return {\n      selector: sel,\n      selectors: [sel]\n    };\n  }\n  return {\n    selector: null,\n    selectors: []\n  };\n}\nfunction getShapeTypeFromPath(svgPath) {\n  const cmdFrequencies = svgPath.map((seg) => seg[0]).reduce(\n    (acc, cmd) => {\n      acc[cmd] += 1;\n      return acc;\n    },\n    { C: 0, Q: 0, L: 0, M: 0 }\n  );\n  const cmdTypes = new Set(svgPath.map((seg) => seg[0]));\n  if (cmdFrequencies.C > 0 || cmdFrequencies.Q > 0) {\n    return \"path\";\n  }\n  if (cmdFrequencies.L > 0 && (cmdTypes.size === 1 || cmdTypes.size === 2 && cmdTypes.has(\"M\"))) {\n    if (cmdFrequencies.L === 4) {\n      return \"rect\";\n    }\n    const lastSeg = svgPath.slice(-1)[0];\n    if (svgPath[0][0] === \"M\" && lastSeg[0] === \"L\" && lastSeg[1] == svgPath[0][1] && lastSeg[2] === svgPath[0][2] || lastSeg[1] === 0 && lastSeg[2] === 0) {\n      return \"polygon\";\n    } else {\n      return \"polyline\";\n    }\n  }\n  return \"path\";\n}\nfunction getSelectorElement(svgElem) {\n  var _a, _b, _c, _d, _e2, _f, _g, _h, _i, _j, _k, _l, _m, _n, _o, _p, _q;\n  for (const element of Array.from(svgElem.children)) {\n    switch (element == null ? void 0 : element.tagName.toLowerCase()) {\n      case \"g\":\n        {\n          const res = getSelectorElement(element);\n          if (res) {\n            return res;\n          }\n        }\n        continue;\n      case \"path\": {\n        const p2 = element.getAttribute(\"d\");\n        if (!p2) {\n          continue;\n        }\n        const normalized = parseAndNormalizeSvgPath(p2);\n        return { element, points: pathToPoints(normalized), shapeType: getShapeTypeFromPath(normalized) };\n      }\n      case \"circle\": {\n        const cx = parseFloat((_a = element.getAttribute(\"cx\")) != null ? _a : \"0\");\n        const cy = parseFloat((_b = element.getAttribute(\"cy\")) != null ? _b : \"0\");\n        const r = parseFloat((_c = element.getAttribute(\"r\")) != null ? _c : \"0\");\n        if (!r) {\n          continue;\n        }\n        const points = [];\n        for (let angle = 0; angle <= 360; angle += 12) {\n          const rad = angle * Math.PI / 180;\n          points.push([cx + r * Math.cos(rad), cy + r * Math.sin(rad)]);\n        }\n        return { element, points, shapeType: \"circle\" };\n      }\n      case \"ellipse\": {\n        const cx = parseFloat((_d = element.getAttribute(\"cx\")) != null ? _d : \"0\");\n        const cy = parseFloat((_e2 = element.getAttribute(\"cy\")) != null ? _e2 : \"0\");\n        const rx = parseFloat((_f = element.getAttribute(\"rx\")) != null ? _f : \"0\");\n        const ry = parseFloat((_g = element.getAttribute(\"ry\")) != null ? _g : \"0\");\n        if (!rx && !ry) {\n          continue;\n        }\n        const points = [];\n        for (let angle = 0; angle <= 360; angle += 12) {\n          const t = Math.tan(angle / 360 * Math.PI);\n          const px = rx * (1 - t ** 2) / (1 + t ** 2);\n          const py = ry * 2 * t / (1 + t ** 2);\n          points.push([cx + px, cy + py]);\n        }\n        return { element, points, shapeType: \"ellipse\" };\n      }\n      case \"line\": {\n        const x0 = parseFloat((_h = element.getAttribute(\"x0\")) != null ? _h : \"0\");\n        const y0 = parseFloat((_i = element.getAttribute(\"y0\")) != null ? _i : \"0\");\n        const x1 = parseFloat((_j = element.getAttribute(\"x1\")) != null ? _j : \"0\");\n        const y1 = parseFloat((_k = element.getAttribute(\"y1\")) != null ? _k : \"0\");\n        if (x0 === x1 && y0 === y1) {\n          continue;\n        }\n        return {\n          element,\n          points: [\n            [x0, y0],\n            [x1, y1]\n          ],\n          shapeType: \"polyline\"\n        };\n      }\n      case \"polygon\":\n      case \"polyline\": {\n        const points = (_m = (_l = element.getAttribute(\"points\")) == null ? void 0 : _l.split(\" \").map((ps) => ps.split(\",\").map(parseFloat))) != null ? _m : [];\n        if (!points.length) {\n          continue;\n        }\n        let shapeType = \"polyline\";\n        if (element.tagName.toLowerCase() === \"polygon\") {\n          points.push(points[0]);\n          shapeType = \"polygon\";\n        }\n        return { element, points, shapeType };\n      }\n      case \"rect\": {\n        const x2 = parseFloat((_n = element.getAttribute(\"x\")) != null ? _n : \"0\");\n        const y2 = parseFloat((_o = element.getAttribute(\"y\")) != null ? _o : \"0\");\n        const width = parseFloat((_p = element.getAttribute(\"width\")) != null ? _p : \"0\");\n        const height = parseFloat((_q = element.getAttribute(\"height\")) != null ? _q : \"0\");\n        if (!width || !height) {\n          continue;\n        }\n        return {\n          element,\n          points: [\n            [x2, y2],\n            [x2 + width, y2],\n            [x2 + width, y2 + height],\n            [x2, y2 + height],\n            [x2, y2]\n          ],\n          shapeType: \"rect\"\n        };\n      }\n      default:\n        continue;\n    }\n  }\n  return null;\n}\nfunction pathToPoints(normalizedPath) {\n  var _a;\n  const out = [];\n  for (let i = 0; i < normalizedPath.length; i++) {\n    const startPoint = (_a = out[out.length - 1]) != null ? _a : [0, 0];\n    const seg = normalizedPath[i];\n    switch (seg[0]) {\n      case \"M\":\n      case \"L\":\n        out.push([seg[1], seg[2]]);\n        continue;\n      case \"C\":\n        out.push(\n          ...flattenCubicBezier(\n            { x: startPoint[0], y: startPoint[1] },\n            { x: seg[1], y: seg[2] },\n            { x: seg[3], y: seg[4] },\n            { x: seg[5], y: seg[6] }\n          ).map((p2) => [p2.x, p2.y]).slice(1)\n        );\n        continue;\n      case \"Q\":\n        out.push(\n          ...flattenQuadraticBezier(\n            { x: startPoint[0], y: startPoint[1] },\n            { x: seg[1], y: seg[2] },\n            { x: seg[3], y: seg[4] }\n          ).map((p2) => [p2.x, p2.y]).slice(1)\n        );\n        continue;\n    }\n  }\n  return out;\n}\nfunction extractStyles(selectorElement) {\n  const style = {};\n  if (selectorElement.hasAttribute(\"fill\")) {\n    style.fill = selectorElement.getAttribute(\"fill\");\n    selectorElement.removeAttribute(\"fill\");\n  } else if (selectorElement.style.fill) {\n    style.fill = selectorElement.style.fill;\n  }\n  if (style.fill) {\n    const rgbaMatch = RGBA_COLOR.exec(style.fill);\n    if (rgbaMatch) {\n      style.fillOpacity = parseFloat(rgbaMatch[4]);\n      style.fill = `rgb(${rgbaMatch[1]}, ${rgbaMatch[2]}, ${rgbaMatch[3]})`;\n    }\n  }\n  if (selectorElement.hasAttribute(\"fill-opacity\")) {\n    style.fillOpacity = parseFloat(selectorElement.getAttribute(\"fill-opacity\"));\n    selectorElement.removeAttribute(\"fill-opacity\");\n  } else if (selectorElement.style.fillOpacity) {\n    style.fillOpacity = parseFloat(selectorElement.style.fillOpacity);\n  }\n  if (selectorElement.hasAttribute(\"stroke\")) {\n    style.stroke = selectorElement.getAttribute(\"stroke\");\n    selectorElement.removeAttribute(\"stroke\");\n  } else if (selectorElement.style.stroke) {\n    style.stroke = selectorElement.style.stroke;\n  }\n  if (style.stroke) {\n    const rgbaMatch = RGBA_COLOR.exec(style.stroke);\n    if (rgbaMatch) {\n      style.strokeOpacity = parseFloat(rgbaMatch[4]);\n      style.stroke = `rgb(${rgbaMatch[1]}, ${rgbaMatch[2]}, ${rgbaMatch[3]})`;\n    }\n  }\n  if (selectorElement.hasAttribute(\"stroke-opacity\")) {\n    style.strokeOpacity = parseFloat(selectorElement.getAttribute(\"stroke-opacity\"));\n    selectorElement.removeAttribute(\"stroke-opacity\");\n  } else if (selectorElement.style.strokeOpacity) {\n    style.strokeOpacity = parseFloat(selectorElement.style.strokeOpacity);\n  }\n  if (selectorElement.hasAttribute(\"stroke-width\")) {\n    style.strokeWidth = selectorElement.getAttribute(\"stroke-width\");\n    selectorElement.removeAttribute(\"stroke-width\");\n  } else if (selectorElement.style.strokeWidth) {\n    style.strokeWidth = selectorElement.style.strokeWidth;\n  }\n  if (selectorElement.hasAttribute(\"stroke-dasharray\")) {\n    style.strokeDasharray = selectorElement.getAttribute(\"stroke-dasharray\");\n    selectorElement.removeAttribute(\"stroke-dasharray\");\n  } else if (selectorElement.style.strokeDasharray) {\n    style.strokeDasharray = selectorElement.style.strokeDasharray;\n  }\n  let rootElem = selectorElement;\n  while (rootElem.tagName.toLowerCase() !== \"svg\") {\n    rootElem = rootElem.parentElement;\n    if (rootElem === null) {\n      throw new Error(\"Could not find root SVG element\");\n    }\n  }\n  return { svg: rootElem.outerHTML, style: Object.keys(style).length > 0 ? style : void 0 };\n}\nfunction expandTarget(target, options = {}) {\n  if (Array.isArray(target)) {\n    return expandTarget(target[0]);\n  }\n  if (typeof target === \"string\") {\n    const [id, fragment] = target.split(\"#\");\n    if (!fragment) {\n      return {\n        type: \"SpecificResource\",\n        source: { id, type: options.typeMap && options.typeMap[id] || \"Unknown\" },\n        selector: null,\n        selectors: []\n      };\n    }\n    return expandTarget({\n      type: \"SpecificResource\",\n      source: { id, type: \"Unknown\" },\n      selector: {\n        type: \"FragmentSelector\",\n        value: fragment\n      }\n    });\n  }\n  if (target.type === \"Choice\" || target.type === \"List\" || target.type === \"Composite\" || target.type === \"Independents\") {\n    return expandTarget(target.items[0]);\n  }\n  if (target.type === \"SpecificResource\") {\n    if (target.source.type === \"Canvas\" && target.source.partOf && typeof target.source.partOf === \"string\") {\n      target.source.partOf = [\n        {\n          id: target.source.partOf,\n          type: \"Manifest\"\n        }\n      ];\n    }\n    const { selector, selectors } = target.selector ? parseSelector(target.selector, options) : { selector: null, selectors: [] };\n    return {\n      type: \"SpecificResource\",\n      source: target.source,\n      selector,\n      selectors\n    };\n  }\n  if (target.id) {\n    if (target.type === \"Canvas\" && target.partOf && typeof target.partOf === \"string\") {\n      target.partOf = [\n        {\n          id: target.partOf,\n          type: \"Manifest\"\n        }\n      ];\n    }\n    const [id, fragment] = target.id.split(\"#\");\n    if (!fragment) {\n      return {\n        type: \"SpecificResource\",\n        source: {\n          ...target,\n          id\n        },\n        selector: null,\n        selectors: []\n      };\n    }\n    return expandTarget({\n      type: \"SpecificResource\",\n      source: {\n        ...target,\n        id\n      },\n      selector: {\n        type: \"FragmentSelector\",\n        value: fragment\n      }\n    });\n  }\n  return {\n    type: \"SpecificResource\",\n    source: target,\n    selector: null,\n    selectors: []\n  };\n}\nfunction validateContentState(annotation, strict = false) {\n  if (typeof annotation === \"string\") {\n    if (annotation.startsWith(\"{\")) {\n      try {\n        const parsed = JSON.parse(annotation);\n        return validateContentState(parsed);\n      } catch (err) {\n        return [false, { reason: \"Invalid JSON\" }];\n      }\n    }\n    return [true];\n  }\n  if (Array.isArray(annotation)) {\n    for (const anno of annotation) {\n      const [valid, reason] = validateContentState(anno);\n      if (!valid && reason) {\n        return [valid, reason];\n      }\n    }\n    return [true];\n  }\n  if (annotation.type === \"Annotation\") {\n    return [true];\n  }\n  if (strict && annotation.type === \"Canvas\" && !annotation.partOf) {\n    return [false, { reason: \"Canvas without partOf cannot be loaded\" }];\n  }\n  return [true];\n}\nfunction serialiseContentState(annotation) {\n  return encodeContentState(typeof annotation === \"string\" ? annotation : JSON.stringify(annotation));\n}\nfunction parseContentState(state, asyncOrFetcher) {\n  state = state.trim();\n  if (state[0] === \"{\") {\n    return asyncOrFetcher ? Promise.resolve(JSON.parse(state)) : JSON.parse(state);\n  }\n  if (state.startsWith(\"http\")) {\n    if (!asyncOrFetcher) {\n      throw new Error(\"Cannot fetch remote fetch with async=false in parseContentState\");\n    }\n    return fetch(state).then((r) => r.json());\n  }\n  return parseContentState(decodeContentState(state), asyncOrFetcher);\n}\nfunction encodeContentState(state) {\n  const uriEncoded = encodeURIComponent(state);\n  const base64 = typeof btoa === \"undefined\" ? Buffer.from(uriEncoded, \"utf-8\").toString(\"base64\") : btoa(uriEncoded);\n  const base64url = base64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n  return base64url.replace(/=/g, \"\");\n}\nfunction decodeContentState(encodedContentState) {\n  const base64url = restorePadding(encodedContentState);\n  const base64 = base64url.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const base64Decoded = typeof atob === \"undefined\" ? Buffer.from(base64, \"base64\").toString(\"utf-8\") : atob(base64);\n  return decodeURIComponent(base64Decoded).trim();\n}\nfunction restorePadding(s) {\n  const pad = s.length % 4;\n  if (pad === 1) {\n    throw new Error(\"InvalidLengthError: Input base64url string is the wrong length to determine padding\");\n  }\n  return s + (pad ? \"====\".slice(0, 4 - pad) : \"\");\n}\nfunction normaliseContentState(state) {\n  if (!state) {\n    throw new Error(\"Content state is empty\");\n  }\n  if (!Array.isArray(state)) {\n    state = [state];\n  }\n  let annoId = \"vault://virtual-annotation/\" + new Date().getTime();\n  const targets = [];\n  for (const source of state) {\n    if (typeof source === \"string\") {\n      throw new Error(\"Content state is a [String] type and cannot be inferred\");\n    }\n    if (source.type === \"Annotation\") {\n      annoId = source.id;\n      if (Array.isArray(source.motivation)) {\n        for (const singleMotivation of source.motivation) {\n        }\n      }\n      if (Array.isArray(source.target)) {\n        for (const target2 of source.target) {\n          const expanded = expandTarget(target2);\n          targets.push(expanded);\n        }\n      } else {\n        const expanded = expandTarget(source.target);\n        targets.push(expanded);\n      }\n      continue;\n    }\n    const target = expandTarget(source);\n    targets.push(target);\n  }\n  return {\n    id: annoId,\n    type: \"Annotation\",\n    motivation: [\"contentState\", ...state.motivation || []],\n    target: targets,\n    extensions: {}\n  };\n}\nfunction parseSpecificResource(resource) {\n  if (resource.type === \"SpecificResource\") {\n    return [resource.source, { selector: resource.selector }];\n  }\n  return [resource, { selector: null }];\n}\nfunction createPaintingAnnotationsHelper(vault = compatVault) {\n  function getAllPaintingAnnotations(canvasOrId) {\n    const canvas = canvasOrId ? typeof canvasOrId === \"string\" ? vault.get(canvasOrId) : canvasOrId : null;\n    if (!canvas) {\n      return [];\n    }\n    const annotationPages = vault.get(canvas.items);\n    const flatAnnotations = [];\n    for (const page of annotationPages) {\n      flatAnnotations.push(...vault.get(page.items));\n    }\n    return flatAnnotations;\n  }\n  function getPaintables(paintingAnnotationsOrCanvas, enabledChoices = []) {\n    const paintingAnnotations = Array.isArray(paintingAnnotationsOrCanvas) ? paintingAnnotationsOrCanvas : getAllPaintingAnnotations(paintingAnnotationsOrCanvas);\n    const types = [];\n    let choice = null;\n    const items = [];\n    for (const annotation of paintingAnnotations) {\n      if (annotation.type !== \"Annotation\") {\n        throw new Error(`getPaintables() accept either a canvas or list of annotations`);\n      }\n      const unknownBodies = vault.get(annotation.body);\n      const bodies = Array.isArray(unknownBodies) ? unknownBodies : [unknownBodies];\n      for (const unknownBody of bodies) {\n        const [body, { selector }] = parseSpecificResource(unknownBody);\n        const type = (body.type || \"unknown\").toLowerCase();\n        if (type === \"choice\") {\n          const nestedBodies = vault.get(body.items);\n          const selected = enabledChoices.length ? enabledChoices.map((cid) => nestedBodies.find((b2) => b2.id === cid)).filter(Boolean) : [nestedBodies[0]];\n          if (selected.length === 0) {\n            selected.push(nestedBodies[0]);\n          }\n          choice = {\n            type: \"single-choice\",\n            items: nestedBodies.map((b2) => ({\n              id: b2.id,\n              label: b2.label,\n              selected: selected.indexOf(b2) !== -1\n            })),\n            label: unknownBody.label\n          };\n          bodies.push(...selected);\n          continue;\n        }\n        if (types.indexOf(type) === -1) {\n          types.push(type);\n        }\n        items.push({\n          type,\n          resource: body,\n          target: annotation.target,\n          selector\n        });\n      }\n    }\n    return {\n      types,\n      items,\n      choice\n    };\n  }\n  function extractChoices(paintingAnnotationsOrCanvas) {\n    const { choice } = getPaintables(paintingAnnotationsOrCanvas);\n    return choice;\n  }\n  return {\n    getAllPaintingAnnotations,\n    getPaintables,\n    extractChoices\n  };\n}\nfunction defineProperty(name, prototype, vault) {\n  prototype[DEFINED] = prototype[DEFINED] || [];\n  prototype[DEFINED].push(name);\n  Object.defineProperty(prototype, name, {\n    get() {\n      if (typeof prototype[REFS][name] === \"undefined\") {\n        return void 0;\n      }\n      const ref = prototype[REFS][name];\n      if (!ref) {\n        return ref;\n      }\n      return wrapObject(vault.get(prototype[REFS][name]), vault);\n    },\n    set(items) {\n      const existing = prototype[REFS][name];\n      if (existing !== items) {\n        this[REFS][name] = items;\n      }\n    }\n  });\n}\nconst REFS = Symbol.for(\"_refs_\");\nconst REACTIVE = Symbol.for(\"_reactive_\");\nconst DEFINED = Symbol.for(\"_defined_\");\nfunction createPrototype(vault, reactive = false) {\n  const prototype = {\n    id: null,\n    [DEFINED]: [],\n    [REFS]: {},\n    [REACTIVE]: null,\n    is(refOrObject) {\n      if (typeof refOrObject === \"string\") {\n        return this.id === refOrObject;\n      }\n      if (refOrObject.id) {\n        return refOrObject.id === this.id;\n      }\n      return false;\n    },\n    reactive() {\n      if (this[REACTIVE]) {\n        return;\n      }\n      this[REACTIVE] = this.subscribe(() => this.refresh(), true);\n      return () => {\n        this.unreactive();\n      };\n    },\n    refresh() {\n      if (this.id) {\n        const fresh = this.unwrap();\n        for (const key of Object.keys(fresh || {})) {\n          if (this[DEFINED].includes(key)) {\n            this[REFS][key] = fresh[key];\n          } else {\n            this[key] = fresh[key];\n          }\n        }\n      }\n    },\n    unreactive() {\n      if (this[REACTIVE]) {\n        this[REACTIVE]();\n        this[REACTIVE] = null;\n      }\n    },\n    unwrap() {\n      if (!this.id) {\n        throw new Error(\"Invalid object\");\n      }\n      return vault.get(this.id);\n    },\n    toPresentation3() {\n      return vault.toPresentation3(this.unwrap());\n    },\n    toPresentation2() {\n      return vault.toPresentation2(this.unwrap());\n    },\n    toJSON() {\n      const that = this;\n      return {\n        ...that,\n        items: that.items,\n        annotations: that.annotations,\n        structures: that.structures,\n        seeAlso: that.seeAlso,\n        service: that.service,\n        services: that.services,\n        rendering: that.rendering,\n        partOf: that.partOf,\n        start: that.start,\n        supplementary: that.supplementary,\n        homepage: that.homepage,\n        thumbnail: that.thumbnail,\n        placeholderCanvas: that.placeholderCanvas,\n        accompanyingCanvas: that.accompanyingCanvas,\n        provider: that.provider\n      };\n    },\n    subscribe(subscription, skipInitial = true) {\n      return vault.subscribe(\n        () => {\n          return this.id ? vault.get(this.id) : null;\n        },\n        subscription,\n        skipInitial\n      );\n    }\n  };\n  defineProperty(\"items\", prototype, vault);\n  defineProperty(\"annotations\", prototype, vault);\n  defineProperty(\"structures\", prototype, vault);\n  defineProperty(\"seeAlso\", prototype, vault);\n  defineProperty(\"service\", prototype, vault);\n  defineProperty(\"services\", prototype, vault);\n  defineProperty(\"rendering\", prototype, vault);\n  defineProperty(\"partOf\", prototype, vault);\n  defineProperty(\"start\", prototype, vault);\n  defineProperty(\"supplementary\", prototype, vault);\n  defineProperty(\"homepage\", prototype, vault);\n  defineProperty(\"thumbnail\", prototype, vault);\n  defineProperty(\"placeholderCanvas\", prototype, vault);\n  defineProperty(\"accompanyingCanvas\", prototype, vault);\n  defineProperty(\"provider\", prototype, vault);\n  defineProperty(\"body\", prototype, vault);\n  defineProperty(\"logo\", prototype, vault);\n  return prototype;\n}\nfunction unwrapObject(object) {\n  if (Array.isArray(object)) {\n    return object.map((o) => unwrapObject(o));\n  }\n  if (!object || !object.type) {\n    return object;\n  }\n  return { id: object.id, type: object.type };\n}\nfunction wrapObject(object, vault, reactive = false) {\n  if (Array.isArray(object)) {\n    return object.map((o) => wrapObject(o, vault, reactive));\n  }\n  if (!object || !object.type || !object.id) {\n    return object;\n  }\n  const prototype = createPrototype(vault, reactive);\n  const newObject = Object.create(prototype);\n  const wrapped = Object.assign(newObject, object);\n  if (reactive) {\n    wrapped.reactive();\n  }\n  return wrapped;\n}\nfunction createObjectsHelper(vault) {\n  return {\n    get(id, reactive = false) {\n      return wrapObject(vault.get(id), vault, reactive);\n    },\n    async load(id, json) {\n      return wrapObject(await vault.load(id, json), vault);\n    },\n    async loadManifest(id, json) {\n      return wrapObject(await vault.loadManifest(id, json), vault);\n    },\n    async loadCollection(id, json) {\n      return wrapObject(await vault.loadCollection(id, json), vault);\n    },\n    wrapObject(objectType) {\n      return wrapObject(vault.get(objectType, { skipSelfReturn: false }), vault);\n    },\n    isWrapped(object) {\n      return !!object[DEFINED];\n    }\n  };\n}\nfunction createRangeHelper(vault = compatVault) {\n  return {\n    findFirstCanvasFromRange: (range) => findFirstCanvasFromRange(vault, range),\n    findAllCanvasesInRange: (range) => findAllCanvasesInRange(vault, range),\n    findManifestSelectedRange: (manifest, canvasId) => findManifestSelectedRange(vault, manifest, canvasId),\n    findSelectedRange: (range, canvasId) => findSelectedRange(vault, range, canvasId)\n  };\n}\nfunction findFirstCanvasFromRange(vault, range) {\n  for (const inner of range.items) {\n    if (inner.type === \"Canvas\") {\n      return inner;\n    }\n    if (inner.type === \"Range\") {\n      const found = findFirstCanvasFromRange(vault, vault.get(inner));\n      if (found) {\n        return found;\n      }\n    }\n  }\n  return null;\n}\nfunction findAllCanvasesInRange(vault, range) {\n  const found = [];\n  for (const inner of range.items) {\n    if (inner.type === \"Canvas\") {\n      if (inner.id.indexOf(\"#\") !== -1) {\n        found.push({ id: inner.id.split(\"#\")[0], type: \"Canvas\" });\n      } else {\n        found.push(inner);\n      }\n    }\n    if (inner.type === \"Range\") {\n      found.push(...findAllCanvasesInRange(vault, vault.get(inner)));\n    }\n    if (inner.type === \"SpecificResource\") {\n      const sourceId = typeof inner.source === \"string\" ? inner.source : inner.source.id;\n      found.push({ id: sourceId, type: \"Canvas\" });\n    }\n  }\n  return found;\n}\nfunction findManifestSelectedRange(vault, manifest, canvasId) {\n  for (const range of manifest.structures) {\n    const found = findSelectedRange(vault, vault.get(range), canvasId);\n    if (found) {\n      return found;\n    }\n  }\n  return null;\n}\nfunction findSelectedRange(vault, range, canvasId) {\n  var _a;\n  for (const inner of range.items) {\n    const parsedId = (_a = inner.id) == null ? void 0 : _a.split(\"#\")[0];\n    if (inner.type === \"SpecificResource\" && inner.source === canvasId) {\n      return range;\n    }\n    if (inner.type === \"Canvas\" && canvasId === parsedId) {\n      return range;\n    }\n    if (inner.type === \"Range\") {\n      const found = findSelectedRange(vault, vault.get(inner), canvasId);\n      if (found) {\n        return found;\n      }\n    }\n  }\n  return null;\n}\nfunction createSequenceHelper(vault = compatVault) {\n  return {\n    getVisibleCanvasesFromCanvasId: (manifestOrRange, canvasId, preventPaged = false) => getVisibleCanvasesFromCanvasId(vault, manifestOrRange, canvasId, preventPaged),\n    getManifestSequence: (manifestOrRange, options = {}) => getManifestSequence(vault, manifestOrRange, options)\n  };\n}\nfunction getVisibleCanvasesFromCanvasId(vault = compatVault, manifestOrRange, canvasId, preventPaged = false) {\n  const behavior = manifestOrRange.behavior || [];\n  const fullCanvas = canvasId ? vault.get(canvasId) : null;\n  if (!fullCanvas) {\n    return [];\n  }\n  const canvasBehavior = fullCanvas.behavior || [];\n  const isPaged = preventPaged ? false : behavior.includes(\"paged\");\n  const isContinuous = isPaged ? false : behavior.includes(\"continuous\");\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes(\"individuals\");\n  const isCanvasFacingPages = canvasBehavior.includes(\"facing-pages\");\n  const isCanvasNonPaged = canvasBehavior.includes(\"non-paged\");\n  if (isCanvasFacingPages || isCanvasNonPaged || isIndividuals || preventPaged) {\n    return [{ id: fullCanvas.id, type: \"Canvas\" }];\n  }\n  const [manifestItems, ordering] = getManifestSequence(vault, manifestOrRange);\n  if (isContinuous) {\n    return manifestItems;\n  }\n  const canvasIndex = manifestItems.findIndex((r) => r.id === canvasId);\n  if (canvasIndex === -1) {\n    return [];\n  }\n  for (const indexes of ordering) {\n    if (indexes.includes(canvasIndex)) {\n      return indexes.map((index) => manifestItems[index]);\n    }\n  }\n  return [{ id: fullCanvas.id, type: \"Canvas\" }];\n}\nfunction getManifestSequence(vault = compatVault, manifestOrRange, { disablePaging, skipNonPaged } = {}) {\n  const behavior = manifestOrRange.behavior || [];\n  const isPaged = behavior.includes(\"paged\");\n  const isContinuous = isPaged ? false : behavior.includes(\"continuous\");\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes(\"individuals\");\n  const manifestItems = manifestOrRange.type === \"Manifest\" ? manifestOrRange.items : findAllCanvasesInRange(vault, manifestOrRange);\n  if (isContinuous) {\n    return [manifestItems, [manifestItems.map((_2, index) => index)]];\n  }\n  if (isIndividuals || !isPaged || disablePaging) {\n    return [manifestItems, manifestItems.map((_2, index) => [index])];\n  }\n  const ordering = [];\n  let currentOrdering = [];\n  const flush = () => {\n    if (currentOrdering.length) {\n      ordering.push([...currentOrdering]);\n      currentOrdering = [];\n    }\n  };\n  let offset = 0;\n  let flushNextPaged = false;\n  for (let i = 0; i < manifestItems.length; i++) {\n    const canvas = vault.get(manifestItems[i]);\n    const canvasBehavior = canvas.behavior || [];\n    if (canvasBehavior.includes(\"non-paged\")) {\n      if (i === offset) {\n        offset++;\n      }\n      if (!skipNonPaged) {\n        flush();\n        ordering.push([i]);\n        flush();\n      }\n      continue;\n    }\n    if (i === offset || canvasBehavior.includes(\"facing-pages\")) {\n      if (currentOrdering.length) {\n        flushNextPaged = true;\n      }\n      flush();\n      ordering.push([i]);\n      flush();\n      continue;\n    }\n    currentOrdering.push(i);\n    if (flushNextPaged) {\n      flush();\n      flushNextPaged = false;\n      continue;\n    }\n    if (currentOrdering.length > 1) {\n      flush();\n    }\n  }\n  if (currentOrdering.length) {\n    flush();\n  }\n  return [manifestItems, ordering];\n}\nexport { buildLocaleString, createEventsHelper, createObjectsHelper, createPaintingAnnotationsHelper, createRangeHelper, createSequenceHelper, createStylesHelper, createThumbnailHelper, decodeContentState, encodeContentState, expandTarget, findAllCanvasesInRange, findFirstCanvasFromRange, findManifestSelectedRange, findSelectedRange, getClosestLanguage, getManifestSequence, getValue, getVisibleCanvasesFromCanvasId, normaliseContentState, parseContentState, parseSelector, parseSpecificResource, serialiseContentState, unwrapObject, validateContentState, wrapObject };\n//# sourceMappingURL=index.mjs.map\n","var commonjsGlobal = typeof globalThis !== \"undefined\" ? globalThis : typeof window !== \"undefined\" ? window : typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : {};\nvar index_umd = { exports: {} };\n(function(module, exports) {\n  var __defProp = Object.defineProperty, __defNormalProp = (e, t, i) => t in e ? __defProp(e, t, { enumerable: true, configurable: true, writable: true, value: i }) : e[t] = i, __publicField = (e, t, i) => (__defNormalProp(e, \"symbol\" != typeof t ? t + \"\" : t, i), i);\n  !function(e, t) {\n    t(exports);\n  }(commonjsGlobal, function(e) {\n    const t = \"http://library.stanford.edu/iiif/image-api/compliance.html#level1\", i = \"http://library.stanford.edu/iiif/image-api/compliance.html#level2\", r = \"http://library.stanford.edu/iiif/image-api/conformance.html#level1\", n = \"http://library.stanford.edu/iiif/image-api/conformance.html#level2\", s = \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1\", a = \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2\", o = \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1\", c = \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2\", l = \"http://iiif.io/api/image/1/level1.json\", p = \"http://iiif.io/api/image/1/profiles/level1.json\", h = \"http://iiif.io/api/image/1/level2.json\", u = \"http://iiif.io/api/image/1/profiles/level2.json\", v = \"http://iiif.io/api/image/2/level1.json\", f = \"http://iiif.io/api/image/2/profiles/level1.json\", m = \"http://iiif.io/api/image/2/level2.json\", y = \"http://iiif.io/api/image/2/profiles/level2.json\", g = \"level1\", d = \"level2\", A = \"http://iiif.io/api/image/2/level1\", b = \"http://iiif.io/api/image/2/level2\", C = [A, b, t, i, r, n, s, a, o, c, l, p, h, u, v, f, m, y, g, d], x = [\"http://iiif.io/api/image/2/level0\", A, b, \"http://library.stanford.edu/iiif/image-api/compliance.html#level0\", t, i, \"http://library.stanford.edu/iiif/image-api/conformance.html#level0\", r, n, \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0\", s, a, \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0\", o, c, \"http://iiif.io/api/image/1/level0.json\", \"http://iiif.io/api/image/1/profiles/level0.json\", l, p, h, u, \"http://iiif.io/api/image/2/level0.json\", \"http://iiif.io/api/image/2/profiles/level0.json\", v, f, m, y, \"level0\", g, d], w = [\"sc:Collection\", \"sc:Manifest\", \"sc:Canvas\", \"sc:AnnotationList\", \"oa:Annotation\", \"sc:Range\", \"sc:Layer\", \"sc:Sequence\", \"oa:Choice\", \"Service\", \"ContentResource\"];\n    class L {\n      constructor(e2, t2 = {}) {\n        __publicField(this, \"traversals\"), __publicField(this, \"options\"), this.traversals = { collection: [], manifest: [], canvas: [], annotationList: [], sequence: [], annotation: [], contentResource: [], choice: [], range: [], service: [], layer: [], ...e2 }, this.options = { convertPropsToArray: true, mergeMemberProperties: true, allowUndefinedReturn: false, ...t2 };\n      }\n      static all(e2) {\n        return new L({ collection: [e2], manifest: [e2], canvas: [e2], annotationList: [e2], sequence: [e2], annotation: [e2], contentResource: [e2], choice: [e2], range: [e2], service: [e2], layer: [e2] });\n      }\n      traverseCollection(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e2))), this.traversals.collection);\n      }\n      traverseCollectionItems(e2) {\n        if (this.options.mergeMemberProperties) {\n          const t2 = [...(e2.manifests || []).map((e3) => \"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Manifest\" } : e3), ...(e2.collections || []).map((e3) => \"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Collection\" } : e3), ...e2.members || []];\n          delete e2.collections, delete e2.manifests, e2.members = t2;\n        }\n        return e2.manifests && (e2.manifests = e2.manifests.map((e3) => this.traverseManifest(\"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Manifest\" } : e3))), e2.collections && (e2.collections = e2.collections.map((e3) => this.traverseCollection(\"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Collection\" } : e3))), e2.members && (e2.members = e2.members.map((e3) => \"string\" == typeof e3 ? e3 : this.traverseUnknown(e3))), e2;\n      }\n      traverseManifest(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e2))), this.traversals.manifest);\n      }\n      traverseManifestItems(e2) {\n        return e2.sequences && (e2.sequences = e2.sequences.map((e3) => this.traverseSequence(e3))), e2.structures && (e2.structures = e2.structures.map((e3) => this.traverseRange(e3))), e2;\n      }\n      traverseSequence(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e2))), this.traversals.sequence);\n      }\n      traverseSequenceItems(e2) {\n        return e2.canvases && (e2.canvases = e2.canvases.map((e3) => this.traverseCanvas(e3))), e2;\n      }\n      traverseCanvas(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e2))), this.traversals.canvas);\n      }\n      traverseCanvasItems(e2) {\n        return e2.images && (e2.images = e2.images.map((e3) => this.traverseAnnotation(e3))), e2.otherContent && (e2.otherContent = e2.otherContent.map((e3) => this.traverseAnnotationList(e3))), e2;\n      }\n      traverseRange(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e2))), this.traversals.range);\n      }\n      traverseRangeItems(e2) {\n        if (this.options.mergeMemberProperties) {\n          const t2 = [...(e2.ranges || []).map((e3) => \"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Range\" } : e3), ...(e2.canvases || []).map((e3) => \"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Canvas\" } : e3), ...e2.members || []];\n          delete e2.ranges, delete e2.canvases, e2.members = t2.length ? t2.map((e3) => this.traverseUnknown(e3)) : void 0;\n        }\n        return e2;\n      }\n      traverseAnnotationList(e2) {\n        const t2 = \"string\" == typeof e2 ? { \"@id\": e2, \"@type\": \"sc:AnnotationList\" } : e2;\n        return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t2)), this.traversals.annotationList);\n      }\n      traverseAnnotationListItems(e2) {\n        return e2.resources && (e2.resources = e2.resources.map((e3) => this.traverseAnnotation(e3))), e2;\n      }\n      traverseAnnotation(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e2))), this.traversals.annotation);\n      }\n      traverseAnnotationItems(e2) {\n        return e2.resource && (Array.isArray(e2.resource) ? e2.resource = e2.resource.map((e3) => this.traverseContentResource(e3)) : e2.resource = this.traverseContentResource(e2.resource)), e2.on, e2;\n      }\n      traverseLayer(e2) {\n        return this.traverseType(this.traverseLinking(this.traverseLayerItems(e2)), this.traversals.layer);\n      }\n      traverseLayerItems(e2) {\n        return e2.otherContent && (e2.otherContent = e2.otherContent.map((e3) => this.traverseAnnotationList(e3))), e2;\n      }\n      traverseChoice(e2) {\n        return this.traverseType(this.traverseChoiceItems(e2), this.traversals.choice);\n      }\n      traverseChoiceItems(e2) {\n        return e2.default && \"rdf:nil\" !== e2.default && (e2.default = this.traverseContentResource(e2.default)), e2.item && \"rdf:nil\" !== e2.item && (e2.item = e2.item.map((e3) => this.traverseContentResource(e3))), e2;\n      }\n      traverseService(e2) {\n        return this.traverseType(this.traverseLinking(e2), this.traversals.service);\n      }\n      traverseContentResource(e2) {\n        return \"oa:Choice\" === e2[\"@type\"] ? this.traverseChoice(e2) : this.traverseType(this.traverseDescriptive(this.traverseLinking(e2)), this.traversals.contentResource);\n      }\n      traverseUnknown(e2) {\n        if (!e2[\"@type\"] || \"string\" == typeof e2)\n          return e2;\n        switch (function(e3) {\n          if (null == e3)\n            throw new Error(\"Null or undefined is not a valid entity.\");\n          if (Array.isArray(e3))\n            throw new Error(\"Array is not a valid entity\");\n          if (\"object\" != typeof e3)\n            throw new Error(typeof e3 + \" is not a valid entity\");\n          if (\"string\" == typeof e3[\"@type\"]) {\n            const t2 = w.indexOf(e3[\"@type\"]);\n            if (-1 !== t2)\n              return w[t2];\n          }\n          if (e3.profile)\n            return \"Service\";\n          if (e3.format)\n            return \"ContentResource\";\n          if (e3[\"@type\"])\n            return \"ContentResource\";\n          throw new Error(\"Resource type is not known\");\n        }(e2)) {\n          case \"sc:Collection\":\n            return this.traverseCollection(e2);\n          case \"sc:Manifest\":\n            return this.traverseManifest(e2);\n          case \"sc:Canvas\":\n            return this.traverseCanvas(e2);\n          case \"sc:Sequence\":\n            return this.traverseSequence(e2);\n          case \"sc:Range\":\n            return this.traverseRange(e2);\n          case \"oa:Annotation\":\n            return this.traverseAnnotation(e2);\n          case \"sc:AnnotationList\":\n            return this.traverseAnnotationList(e2);\n          case \"sc:Layer\":\n            return this.traverseLayer(e2);\n          case \"Service\":\n            return this.traverseService(e2);\n          case \"oa:Choice\":\n            return this.traverseChoice(e2);\n          case \"ContentResource\":\n            return this.traverseContentResource(e2);\n        }\n        return e2.profile ? this.traverseService(e2) : e2;\n      }\n      traverseImageResource(e2) {\n        const t2 = Array.isArray(e2), i2 = Array.isArray(e2) ? e2 : [e2], r2 = [];\n        for (const n2 of i2)\n          \"string\" == typeof n2 ? r2.push(this.traverseContentResource({ \"@id\": n2, \"@type\": \"dctypes:Image\" })) : r2.push(this.traverseContentResource(n2));\n        return t2 || this.options.convertPropsToArray ? r2 : r2[0];\n      }\n      traverseDescriptive(e2) {\n        return e2.thumbnail && (e2.thumbnail = this.traverseImageResource(e2.thumbnail)), e2.logo && (e2.logo = this.traverseImageResource(e2.logo)), e2;\n      }\n      traverseOneOrMoreServices(e2) {\n        const t2 = Array.isArray(e2), i2 = Array.isArray(e2) ? e2 : [e2], r2 = [];\n        for (const n2 of i2)\n          r2.push(this.traverseService(n2));\n        return t2 || this.options.convertPropsToArray ? r2 : r2[0];\n      }\n      traverseLinking(e2) {\n        return e2.related && (e2.related = this.traverseOneOrManyType(e2.related, this.traversals.contentResource)), e2.rendering && (e2.rendering = this.traverseOneOrManyType(e2.rendering, this.traversals.contentResource)), e2.service && (e2.service = this.traverseOneOrMoreServices(e2.service)), e2.seeAlso && (e2.seeAlso = this.traverseOneOrManyType(e2.seeAlso, this.traversals.contentResource)), e2.within && (\"string\" == typeof e2.within || (e2.within = this.traverseOneOrManyType(e2.within, this.traversals.contentResource))), e2.startCanvas && (\"string\" == typeof e2.startCanvas ? e2.startCanvas = this.traverseType({ \"@id\": e2.startCanvas, \"@type\": \"sc:Canvas\" }, this.traversals.canvas) : e2.startCanvas && this.traverseType(e2.startCanvas, this.traversals.canvas)), e2.contentLayer && (\"string\" == typeof e2.contentLayer ? e2.contentLayer = this.traverseLayer({ \"@id\": e2.contentLayer, \"@type\": \"sc:Layer\" }) : e2.contentLayer = this.traverseLayer(e2.contentLayer)), e2;\n      }\n      traverseOneOrManyType(e2, t2) {\n        if (!Array.isArray(e2)) {\n          if (!this.options.convertPropsToArray)\n            return this.traverseType(e2, t2);\n          e2 = [e2];\n        }\n        return e2.map((e3) => this.traverseType(e3, t2));\n      }\n      traverseType(e2, t2) {\n        return t2.reduce((e3, t3) => {\n          const i2 = t3(e3);\n          return void 0 !== i2 || this.options.allowUndefinedReturn ? i2 : e3;\n        }, e2);\n      }\n    }\n    const S = \"Attribution\", j = \"http://example.org/provider\", R = \"Unknown\";\n    function I(e2, t2 = \"none\") {\n      if (!e2)\n        return {};\n      const i2 = Array.isArray(e2) ? e2 : [e2], r2 = {};\n      for (const n2 of i2) {\n        if (\"string\" == typeof n2) {\n          r2[t2] = r2[t2] ? r2[t2] : [], r2[t2].push(n2 || \"\");\n          continue;\n        }\n        if (!n2[\"@language\"]) {\n          r2[t2] = r2[t2] ? r2[t2] : [], r2[t2].push(n2[\"@value\"] || \"\");\n          continue;\n        }\n        const e3 = n2[\"@language\"];\n        r2[e3] = r2[e3] ? r2[e3] : [], r2[e3].push(n2[\"@value\"] || \"\");\n      }\n      return r2;\n    }\n    function T(e2) {\n      return Array.isArray(e2) ? T(e2.find((e3) => \"string\" == typeof e3)) : -1 !== x.indexOf(e2) ? \"level2\" : -1 !== C.indexOf(e2) ? \"level1\" : \"string\" == typeof e2 ? e2 : void 0;\n    }\n    function k(e2) {\n      for (const t2 of [\"sc\", \"oa\", \"dcterms\", \"dctypes\", \"iiif\"])\n        if (e2.startsWith(`${t2}:`))\n          return e2.slice(t2.length + 1);\n      return e2;\n    }\n    const O = [\"Collection\", \"Manifest\", \"Annotation\", \"AnnotationPage\", \"Range\", \"Service\"];\n    function M(e2) {\n      const t2 = e2[\"@id\"] || e2.id;\n      let i2 = e2[\"@type\"] || e2.type;\n      const r2 = e2.profile || void 0, n2 = e2[\"@context\"] || void 0;\n      if (r2) {\n        const e3 = function(e4) {\n          switch (e4) {\n            case \"http://iiif.io/api/image/2/level0.json\":\n            case \"http://iiif.io/api/image/2/level1.json\":\n            case \"http://iiif.io/api/image/2/level2.json\":\n              return \"ImageService2\";\n            case \"http://iiif.io/api/auth/1/kiosk\":\n            case \"http://iiif.io/api/auth/1/login\":\n            case \"http://iiif.io/api/auth/1/clickthrough\":\n            case \"http://iiif.io/api/auth/1/external\":\n            case \"http://iiif.io/api/auth/0/kiosk\":\n            case \"http://iiif.io/api/auth/0/login\":\n            case \"http://iiif.io/api/auth/0/clickthrough\":\n            case \"http://iiif.io/api/auth/0/external\":\n              return \"AuthCookieService1\";\n            case \"http://iiif.io/api/auth/1/token\":\n            case \"http://iiif.io/api/auth/0/token\":\n              return \"AuthTokenService1\";\n            case \"http://iiif.io/api/auth/1/logout\":\n            case \"http://iiif.io/api/auth/0/logout\":\n              return \"AuthLogoutService1\";\n            case \"http://iiif.io/api/search/1/search\":\n            case \"http://iiif.io/api/search/0/search\":\n              return \"SearchService1\";\n            case \"http://iiif.io/api/search/1/autocomplete\":\n            case \"http://iiif.io/api/search/0/autocomplete\":\n              return \"AutoCompleteService1\";\n          }\n        }(r2);\n        if (e3)\n          return e3;\n      }\n      if (n2) {\n        const e3 = function(e4) {\n          const t3 = Array.isArray(e4) ? e4 : [e4];\n          for (const i3 of t3)\n            switch (i3) {\n              case \"http://iiif.io/api/image/2/context.json\":\n              case \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2\":\n                return \"ImageService2\";\n              case \"http://iiif.io/api/image/1/context.json\":\n              case \"http://library.stanford.edu/iiif/image-api/1.1/context.json\":\n                return \"ImageService1\";\n              case \"http://iiif.io/api/annex/openannotation/context.json\":\n                return \"ImageApiSelector\";\n            }\n        }(n2);\n        if (e3)\n          return e3;\n      }\n      if (i2) {\n        if (Array.isArray(i2)) {\n          if (-1 !== i2.indexOf(\"oa:CssStylesheet\"))\n            return \"CssStylesheet\";\n          if (-1 !== i2.indexOf(\"cnt:ContentAsText\"))\n            return \"TextualBody\";\n          i2 = i2[0];\n        }\n        for (const e3 of [\"sc\", \"oa\", \"dcterms\", \"dctypes\", \"iiif\"])\n          if (i2.startsWith(`${e3}:`)) {\n            i2 = i2.slice(e3.length + 1);\n            break;\n          }\n        switch (i2) {\n          case \"Layer\":\n            return \"AnnotationCollection\";\n          case \"AnnotationList\":\n            return \"AnnotationPage\";\n          case \"cnt:ContentAsText\":\n            return \"TextualBody\";\n        }\n      }\n      if (i2 && -1 !== O.indexOf(i2))\n        return i2;\n      if (e2.format) {\n        if (e2.format.startsWith(\"image/\"))\n          return \"Image\";\n        if (e2.format.startsWith(\"text/\"))\n          return \"Text\";\n        if (\"application/pdf\" === e2.format)\n          return \"Text\";\n        if (e2.format.startsWith(\"application/\"))\n          return \"Dataset\";\n      }\n      return t2 && (t2.endsWith(\".jpg\") || t2.endsWith(\".png\") || t2.endsWith(\".jpeg\")) ? \"Image\" : i2 || \"unknown\";\n    }\n    const q = /http(s)?:\\/\\/(creativecommons.org|rightsstatements.org)[^\"'\\\\<\\n]+/gm;\n    function P(e2) {\n      const t2 = e2.match(q);\n      return t2 ? t2[0] : e2;\n    }\n    const _ = [\"http://iiif.io/api/presentation/2/context.json\", \"http://iiif.io/api/image/2/context.json\", \"http://iiif.io/api/image/1/context.json\", \"http://library.stanford.edu/iiif/image-api/1.1/context.json\", \"http://iiif.io/api/search/1/context.json\", \"http://iiif.io/api/search/0/context.json\", \"http://iiif.io/api/auth/1/context.json\", \"http://iiif.io/api/auth/0/context.json\", \"http://iiif.io/api/annex/openannotation/context.json\"];\n    function D(e2) {\n      if (e2) {\n        const t2 = Array.isArray(e2) ? e2 : [e2], i2 = [];\n        for (const e3 of t2)\n          \"http://iiif.io/api/presentation/2/context.json\" === e3 && i2.push(\"http://iiif.io/api/presentation/3/context.json\"), -1 === _.indexOf(e3) && i2.push(e3);\n        if (t2.length)\n          return 1 === i2.length ? i2[0] : i2;\n      }\n    }\n    function U(e2) {\n      for (const t2 in e2)\n        void 0 !== e2[t2] && null !== e2[t2] || delete e2[t2];\n      return e2;\n    }\n    let $ = 0;\n    function W(e2, t2) {\n      const i2 = encodeURI(e2.id || e2[\"@id\"] || \"\").trim();\n      return i2 && t2 ? `${i2}/${t2}` : i2 || ($++, `http://example.org/${e2[\"@type\"]}${t2 ? `/${t2}` : \"\"}/${$}`);\n    }\n    function E(e2) {\n      const t2 = [...e2.behavior || []];\n      let i2;\n      return e2.viewingHint && t2.push(e2.viewingHint), Array.isArray(e2.motivation) ? i2 = e2.motivation.map(k) : e2.motivation && (i2 = k(e2.motivation)), { \"@context\": e2[\"@context\"] ? D(e2[\"@context\"]) : void 0, id: (e2[\"@id\"] || W(e2)).trim(), type: M(e2), behavior: t2.length ? t2 : void 0, height: e2.height ? e2.height : void 0, width: e2.width ? e2.width : void 0, motivation: i2, viewingDirection: e2.viewingDirection, profile: e2.profile, format: e2.format ? e2.format : void 0, duration: void 0, timeMode: void 0 };\n    }\n    function F(e2) {\n      const [t2, i2] = function(e3, t3 = \"Rights/License\", i3 = \"none\") {\n        let r3 = null;\n        const n3 = [], s2 = Array.isArray(e3) ? e3 : [e3];\n        for (const a2 of s2) {\n          const e4 = a2 ? P(a2) : void 0;\n          !e4 || -1 === e4.indexOf(\"creativecommons.org\") && -1 === e4.indexOf(\"rightsstatements.org\") ? e4 && n3.push({ label: { [i3]: [t3] }, value: { [i3]: [e4] } }) : r3 = e4.startsWith(\"https://\") ? `http://${e4.slice(8)}` : e4;\n        }\n        return [r3, n3];\n      }(e2.license), r2 = [...e2.metadata ? (n2 = e2.metadata, n2 ? n2.map((e3) => ({ label: I(e3.label), value: I(e3.value) })) : []) : [], ...i2];\n      var n2;\n      return { rights: t2, metadata: r2.length ? r2 : void 0, label: e2.label ? I(e2.label) : void 0, requiredStatement: e2.attribution ? { label: I(S), value: I(e2.attribution) } : void 0, navDate: e2.navDate, summary: e2.description ? I(e2.description) : void 0, thumbnail: e2.thumbnail };\n    }\n    function H(e2) {\n      if (!e2.within)\n        return;\n      const t2 = Array.isArray(e2.within) ? e2.within : [e2.within], i2 = [];\n      for (const r2 of t2)\n        if (\"string\" == typeof r2) {\n          if (r2 && \"sc:Manifest\" === e2[\"@type\"])\n            i2.push({ id: r2, type: \"Collection\" });\n        } else\n          r2[\"@id\"] && i2.push({ id: r2[\"@id\"], type: M(r2) });\n      return i2.length ? i2 : void 0;\n    }\n    function N(e2) {\n      const t2 = e2.related ? Array.isArray(e2.related) ? e2.related : [e2.related] : [], i2 = e2.contentLayer;\n      return { provider: e2.logo || t2.length ? [{ id: j, type: \"Agent\", homepage: t2.length ? [t2[0]] : void 0, logo: e2.logo ? Array.isArray(e2.logo) ? e2.logo : [e2.logo] : void 0, label: I(R) }] : void 0, partOf: H(e2), rendering: e2.rendering, seeAlso: e2.seeAlso, start: e2.startCanvas, service: e2.service ? (r2 = e2.service, Array.isArray(r2) ? r2 : [r2]) : void 0, supplementary: i2 ? [i2] : void 0 };\n      var r2;\n    }\n    function B(e2) {\n      const t2 = e2;\n      return U({ ...E(t2), ...F(t2), ...N(t2), ...(i2 = t2, { chars: i2.chars, format: i2.format ? i2.format : void 0, language: i2.language }) });\n      var i2;\n    }\n    const z = new L({ collection: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2), items: e2.members });\n    }], manifest: [function(e2) {\n      const t2 = [], i2 = [];\n      for (const n2 of e2.sequences || [])\n        n2.canvases.length && t2.push(...n2.canvases), n2.behavior && i2.push(...n2.behavior);\n      const r2 = E(e2);\n      return i2.length && (r2.behavior ? r2.behavior.push(...i2) : r2.behavior = i2), U({ ...r2, ...F(e2), ...N(e2), items: t2, structures: e2.structures });\n    }], canvas: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2), annotations: e2.otherContent && e2.otherContent.length ? e2.otherContent : void 0, items: e2.images && e2.images.length ? [{ id: W(e2, \"annotation-page\"), type: \"AnnotationPage\", items: e2.images }] : void 0 });\n    }], annotationList: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2), items: e2.resources && e2.resources.length ? e2.resources : void 0 });\n    }], sequence: [function(e2) {\n      return e2.canvases && 0 !== e2.canvases.length ? { canvases: e2.canvases, behavior: e2.viewingHint ? [e2.viewingHint] : [] } : { canvases: [], behavior: [] };\n    }], annotation: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2), target: function e3(t2) {\n        if (Array.isArray(t2)) {\n          if (t2.length > 1)\n            return { type: \"List\", items: t2.map(e3) };\n          t2 = t2[0];\n        }\n        if (\"string\" == typeof t2)\n          return encodeURI(t2).trim();\n        if (\"@type\" in t2) {\n          let e4;\n          if (\"string\" == typeof t2.full)\n            e4 = t2.full;\n          else if (\"dctypes:Image\" === t2.full[\"@type\"])\n            e4 = { id: t2.full[\"@id\"], type: \"Image\" };\n          else {\n            if (\"sc:Canvas\" !== t2.full[\"@type\"])\n              throw new Error(`Unsupported source type on annotation: ${t2.full[\"@type\"]}`);\n            e4 = { id: t2.full[\"@id\"], type: \"Canvas\" };\n          }\n          return { type: \"SpecificResource\", source: e4, selector: G(t2.selector) };\n        }\n        return encodeURI(t2[\"@id\"]).trim();\n      }(e2.on), body: Array.isArray(e2.resource) ? e2.resource.map(B) : B(e2.resource) });\n    }], contentResource: [B], choice: [function(e2) {\n      const t2 = [];\n      return e2.default && \"rdf:nil\" !== e2.default && t2.push(e2.default), e2.item && \"rdf:nil\" !== e2.item && t2.push(...e2.item), { ...E(e2), ...F(e2), items: t2 };\n    }], range: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2), items: e2.members });\n    }], service: [function(e2) {\n      const { \"@id\": t2, \"@type\": i2, \"@context\": r2, profile: n2, ...s2 } = e2, a2 = {};\n      return t2 && (a2[\"@id\"] = t2), a2[\"@type\"] = M(e2), \"unknown\" === a2[\"@type\"] && (r2 && r2.length && (a2[\"@context\"] = r2), a2[\"@type\"] = \"Service\"), n2 && (a2.profile = T(n2)), U({ ...a2, ...s2 });\n    }], layer: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2) });\n    }] });\n    function G(e2) {\n      if ((Array.isArray(e2[\"@type\"]) && e2[\"@type\"].includes(\"oa:SvgSelector\") || \"oa:SvgSelector\" == e2[\"@type\"]) && (\"chars\" in e2 || \"value\" in e2))\n        return { type: \"SvgSelector\", value: \"chars\" in e2 ? e2.chars : e2.value };\n      if (\"oa:FragmentSelector\" === e2[\"@type\"])\n        return { type: \"FragmentSelector\", value: e2.value };\n      if (\"oa:Choice\" === e2[\"@type\"])\n        return [G(e2.default), ...(Array.isArray(e2.item) ? e2.item : [e2.item]).map(G)];\n      if (\"iiif:ImageApiSelector\" == e2[\"@type\"])\n        return { type: \"ImageApiSelector\", region: \"region\" in e2 ? e2.region : void 0, rotation: \"rotation\" in e2 ? e2.rotation : void 0 };\n      throw new Error(`Unsupported selector type: ${e2[\"@type\"]}`);\n    }\n    const J = function(e2) {\n      return e2 && e2[\"@context\"] && (\"http://iiif.io/api/presentation/2/context.json\" === e2[\"@context\"] || -1 !== e2[\"@context\"].indexOf(\"http://iiif.io/api/presentation/2/context.json\") || \"http://www.shared-canvas.org/ns/context.json\" === e2[\"@context\"]) || \"http://iiif.io/api/image/2/context.json\" === e2[\"@context\"] ? z.traverseUnknown(e2) : e2;\n    };\n    e.upgrade = J, Object.defineProperties(e, { __esModule: { value: true }, [Symbol.toStringTag]: { value: \"Module\" } });\n  });\n})(index_umd, index_umd.exports);\nfunction fetchAndUpgrade(input, init) {\n  return fetch(input, init).then((resp) => resp.json()).then(index_umd.exports.upgrade);\n}\nexport { fetchAndUpgrade as fetch };\n//# sourceMappingURL=fetch.mjs.map\n","import * as Presentation3 from '@iiif/presentation-3';\n\nimport React, { ReactNode, createContext, useContext, useEffect, useMemo, useState } from 'react';\n\nimport { Orientation } from 'src/types/options';\nimport { fetch } from '@iiif/vault-helpers/fetch';\n\ninterface IIIFContentContext {\n  currentResourceId: string | undefined;\n  error: string | any | null;\n  isLoaded: boolean;\n  orientation: Orientation;\n  resource?: Presentation3.Manifest | Presentation3.Collection;\n}\n\nexport const ReactContext = createContext<IIIFContentContext>({\n  currentResourceId: undefined,\n  error: null,\n  isLoaded: false,\n  orientation: 'vertical',\n  resource: undefined,\n});\n\nexport function useThumbnailPanelContext() {\n  return useContext(ReactContext);\n}\n\nexport function IIIFContentProvider(props: {\n  resource: string | any;\n  children: ReactNode;\n  overrides?: Partial<Presentation3.Manifest | Presentation3.Collection>;\n  currentResourceId: string | undefined;\n  orientation: Orientation;\n  onLoad?: (resource?: Presentation3.Manifest | Presentation3.Collection) => void;\n  onResourceChanged?: (resourceId: string) => void;\n}) {\n  const { currentResourceId, orientation, onLoad, overrides } = props;\n  const [resource, setResource] = useState<Presentation3.Manifest | Presentation3.Collection>();\n  const mergedResource = useMemo(() => {\n    if (!overrides || !resource) {\n      return resource;\n    }\n\n    const values = Object.fromEntries(Object.entries(overrides).filter(([, value]) => typeof value !== 'undefined'));\n\n    return Object.assign({}, resource, values || {});\n  }, [resource, ...Object.values(overrides || {})]);\n  const [error, setError] = useState(false);\n\n  useEffect(() => {\n    if (!props.resource) {\n      return;\n    }\n\n    if (typeof props.resource === 'string') {\n      const controller = new AbortController();\n\n      fetch(props.resource, { signal: controller.signal })\n        .then((json) => {\n          setResource(json as any);\n          if (onLoad) {\n            onLoad(json);\n          }\n        })\n        .catch((e) => setError(e));\n\n      return () => {\n        controller.abort();\n      };\n    } else {\n      setResource(props.resource);\n      if (onLoad) {\n        onLoad(props.resource);\n      }\n    }\n  }, [props.resource]);\n\n  const value = useMemo(() => {\n    return { resource: mergedResource, error, isLoaded: !!resource, orientation, currentResourceId };\n  }, [mergedResource, error, orientation, currentResourceId]);\n\n  return <ReactContext.Provider value={value}>{props.children}</ReactContext.Provider>;\n}\n","import { Canvas, Collection, Manifest } from '@iiif/presentation-3';\nimport React, { useEffect, useState } from 'react';\n\nimport { createThumbnailHelper } from '@iiif/vault-helpers';\nimport { useThumbnailPanelContext } from '../context/IIIFResourceContext';\n\ninterface ThumbnailProps {\n  item: Canvas | Collection | Manifest;\n  onClick?: (resourceId?: string) => void;\n}\n\nexport const Thumbnail: React.FC<ThumbnailProps> = ({ item, onClick }) => {\n  const helper = createThumbnailHelper(); // no vault\n  const [thumb, setThumb] = useState<any>();\n  const { resource } = useThumbnailPanelContext();\n  const thumbnailSize = (resource as any)?.thumbnailSize || 200;\n\n  useEffect(() => {\n    async function getData() {\n      const response = await helper.getBestThumbnailAtSize(item as any, {\n        width: thumbnailSize,\n        height: thumbnailSize,\n      });\n      setThumb(response.best as any);\n    }\n\n    item && getData();\n  }, [item]);\n\n  return (\n    <button\n      data-testid=\"thumbnail-wrapper\"\n      onClick={() => {\n        if (onClick) {\n          onClick(resource?.id);\n        }\n      }}\n    >\n      <figure>\n        <div\n          style={{\n            backgroundColor: '#f0f0f0',\n            width: `${thumbnailSize}px`,\n            height: `${thumbnailSize}px`,\n            objectFit: 'contain',\n          }}\n        >\n          {thumb ? (\n            <img src={thumb.id} alt=\"\" style={{ maxWidth: '100%', maxHeight: '100%' }} data-testid=\"thumb-image\" />\n          ) : (\n            <></>\n          )}\n        </div>\n        <figcaption>{item.id}</figcaption>\n      </figure>\n    </button>\n  );\n};\n","const metaState = {};\nconst compatVault = {\n  get(nonRef) {\n    return nonRef;\n  },\n  setMetaValue([id, meta, key], value) {\n    const oldValue = compatVault.getResourceMeta(id, meta);\n    const oldValueItem = oldValue ? oldValue[key] : void 0;\n    const newValue = typeof value === \"function\" ? value(oldValueItem) : value;\n    metaState[id] = {\n      ...metaState[id] || {},\n      [meta]: {\n        ...(metaState[id] || {})[meta] || {},\n        [key]: newValue\n      }\n    };\n  },\n  getResourceMeta: (resource, metaKey) => {\n    const resourceMeta = metaState[resource];\n    if (!resourceMeta) {\n      return void 0;\n    }\n    if (!metaKey) {\n      return resourceMeta;\n    }\n    return resourceMeta[metaKey];\n  }\n};\nfunction findAllCanvasesInRange(vault, range) {\n  const found = [];\n  for (const inner of range.items) {\n    if (inner.type === \"Canvas\") {\n      if (inner.id.indexOf(\"#\") !== -1) {\n        found.push({ id: inner.id.split(\"#\")[0], type: \"Canvas\" });\n      } else {\n        found.push(inner);\n      }\n    }\n    if (inner.type === \"Range\") {\n      found.push(...findAllCanvasesInRange(vault, vault.get(inner)));\n    }\n    if (inner.type === \"SpecificResource\") {\n      const sourceId = typeof inner.source === \"string\" ? inner.source : inner.source.id;\n      found.push({ id: sourceId, type: \"Canvas\" });\n    }\n  }\n  return found;\n}\nfunction createSequenceHelper(vault = compatVault) {\n  return {\n    getVisibleCanvasesFromCanvasId: (manifestOrRange, canvasId, preventPaged = false) => getVisibleCanvasesFromCanvasId(vault, manifestOrRange, canvasId, preventPaged),\n    getManifestSequence: (manifestOrRange, options = {}) => getManifestSequence(vault, manifestOrRange, options)\n  };\n}\nfunction getVisibleCanvasesFromCanvasId(vault = compatVault, manifestOrRange, canvasId, preventPaged = false) {\n  const behavior = manifestOrRange.behavior || [];\n  const fullCanvas = canvasId ? vault.get(canvasId) : null;\n  if (!fullCanvas) {\n    return [];\n  }\n  const canvasBehavior = fullCanvas.behavior || [];\n  const isPaged = preventPaged ? false : behavior.includes(\"paged\");\n  const isContinuous = isPaged ? false : behavior.includes(\"continuous\");\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes(\"individuals\");\n  const isCanvasFacingPages = canvasBehavior.includes(\"facing-pages\");\n  const isCanvasNonPaged = canvasBehavior.includes(\"non-paged\");\n  if (isCanvasFacingPages || isCanvasNonPaged || isIndividuals || preventPaged) {\n    return [{ id: fullCanvas.id, type: \"Canvas\" }];\n  }\n  const [manifestItems, ordering] = getManifestSequence(vault, manifestOrRange);\n  if (isContinuous) {\n    return manifestItems;\n  }\n  const canvasIndex = manifestItems.findIndex((r) => r.id === canvasId);\n  if (canvasIndex === -1) {\n    return [];\n  }\n  for (const indexes of ordering) {\n    if (indexes.includes(canvasIndex)) {\n      return indexes.map((index) => manifestItems[index]);\n    }\n  }\n  return [{ id: fullCanvas.id, type: \"Canvas\" }];\n}\nfunction getManifestSequence(vault = compatVault, manifestOrRange, { disablePaging, skipNonPaged } = {}) {\n  const behavior = manifestOrRange.behavior || [];\n  const isPaged = behavior.includes(\"paged\");\n  const isContinuous = isPaged ? false : behavior.includes(\"continuous\");\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes(\"individuals\");\n  const manifestItems = manifestOrRange.type === \"Manifest\" ? manifestOrRange.items : findAllCanvasesInRange(vault, manifestOrRange);\n  if (isContinuous) {\n    return [manifestItems, [manifestItems.map((_, index) => index)]];\n  }\n  if (isIndividuals || !isPaged || disablePaging) {\n    return [manifestItems, manifestItems.map((_, index) => [index])];\n  }\n  const ordering = [];\n  let currentOrdering = [];\n  const flush = () => {\n    if (currentOrdering.length) {\n      ordering.push([...currentOrdering]);\n      currentOrdering = [];\n    }\n  };\n  let offset = 0;\n  let flushNextPaged = false;\n  for (let i = 0; i < manifestItems.length; i++) {\n    const canvas = vault.get(manifestItems[i]);\n    const canvasBehavior = canvas.behavior || [];\n    if (canvasBehavior.includes(\"non-paged\")) {\n      if (i === offset) {\n        offset++;\n      }\n      if (!skipNonPaged) {\n        flush();\n        ordering.push([i]);\n        flush();\n      }\n      continue;\n    }\n    if (i === offset || canvasBehavior.includes(\"facing-pages\")) {\n      if (currentOrdering.length) {\n        flushNextPaged = true;\n      }\n      flush();\n      ordering.push([i]);\n      flush();\n      continue;\n    }\n    currentOrdering.push(i);\n    if (flushNextPaged) {\n      flush();\n      flushNextPaged = false;\n      continue;\n    }\n    if (currentOrdering.length > 1) {\n      flush();\n    }\n  }\n  if (currentOrdering.length) {\n    flush();\n  }\n  return [manifestItems, ordering];\n}\nexport { createSequenceHelper, getManifestSequence, getVisibleCanvasesFromCanvasId };\n//# sourceMappingURL=sequences.mjs.map\n","import '../style.css';\n\nimport * as Presentation3 from '@iiif/presentation-3';\n\nimport { IIIFContentProvider, useThumbnailPanelContext } from '../context/IIIFResourceContext';\nimport React, { useMemo } from 'react';\n\nimport { Orientation } from 'src/types/options';\nimport { Thumbnail } from './Thumbnail';\nimport { createSequenceHelper } from '@iiif/vault-helpers/sequences';\nimport { getValue } from '@iiif/vault-helpers';\n\ntype OnResourceChanged = (resourceId?: string) => void;\ninterface ItemsProps {\n  onResourceChanged?: OnResourceChanged;\n}\n\nconst Items: React.FC<ItemsProps> = ({ onResourceChanged }) => {\n  const { resource, isLoaded, currentResourceId, orientation } = useThumbnailPanelContext();\n  const sequence = createSequenceHelper();\n\n  const [items, seq] = useMemo(() => {\n    if (!resource) {\n      return [];\n    }\n    //ignore type checking on resource (expecting ManifestNormalized)\n    //@ts-ignore\n    const [items, seq] = sequence.getManifestSequence(resource, {\n      disablePaging: false,\n    });\n\n    // if (resource.viewingDirection === 'bottom-to-top') {\n    //   return [items, seq.reverse()]\n    // }\n\n    return [items, seq];\n  }, [resource]);\n\n  if (!isLoaded || !resource || !seq || !items) {\n    return <></>;\n  }\n\n  const dir = resource.viewingDirection === 'left-to-right' ? 'ltr' : 'rtl';\n\n  const onKeyDown = (e: any) => {\n    if (e.keyCode === 40) {\n      const next = 1 + Number(e.currentTarget.getAttribute('data-index'));\n      `div[data-index=\"${next}\"]`;\n      const nextElement = (e.currentTarget as HTMLDivElement).parentElement?.parentElement?.querySelector(\n        `div[data-index=\"${next}\"]`\n      ) as HTMLElement;\n      nextElement.focus();\n    }\n  };\n\n  const isCurrentGroup = (groupIdx: number) => {\n    const foundIdx = seq.findIndex((group) => {\n      const resourceIdx = items.findIndex((resource) => {\n        return resource.id === currentResourceId;\n      });\n      return group.includes(resourceIdx);\n    });\n\n    return foundIdx === groupIdx;\n  };\n\n  return (\n    <div dir={dir} thumbnail-panel=\"\" data-orientation={orientation}>\n      <h3>{getValue(resource.label)}</h3>\n      <span>{orientation}</span>\n\n      {seq.map((group, groupIdx) => {\n        // console.log('group', group);\n        return (\n          <div thumbnail-group=\"\" key={groupIdx} data-selected={isCurrentGroup(groupIdx)}>\n            {group.map((idx, itemIdx) => (\n              <div\n                thumbnail-item=\"\"\n                tabIndex={idx === 0 ? 0 : -1}\n                key={itemIdx}\n                data-index={idx}\n                onKeyDown={onKeyDown}\n                data-selected={currentResourceId === items[idx]?.id}\n              >\n                <Thumbnail\n                  key={idx}\n                  item={items[idx]}\n                  onClick={() => {\n                    // todo: set state\n                    if (onResourceChanged) {\n                      // console.log(idx);\n                      onResourceChanged(items[idx]?.id);\n                    }\n                  }}\n                />\n              </div>\n            ))}\n          </div>\n        );\n      })}\n\n      {/* <p>{resource.behavior}</p>\n      <p>{resource.viewingDirection || 'left-to-right'}</p>\n      {resource?.items.map((item, index) => (\n        <>\n          <Thumbnail key={index} item={item} />\n        </>\n      ))} */}\n    </div>\n  );\n};\n\ninterface ThumbnailPanelProps {\n  currentResourceId: string | undefined;\n  iiifContent: string;\n  onLoad?: (resource: any) => void;\n  onResourceChanged?: OnResourceChanged;\n  orientation: Orientation;\n  overrides?: Partial<Presentation3.Collection | Presentation3.Manifest>;\n}\n\nexport const ThumbnailPanel: React.FC<ThumbnailPanelProps> = ({\n  iiifContent,\n  orientation,\n  currentResourceId,\n  overrides,\n  onLoad,\n  onResourceChanged,\n}) => {\n  return (\n    <IIIFContentProvider\n      resource={iiifContent}\n      overrides={overrides}\n      orientation={orientation}\n      currentResourceId={currentResourceId}\n      onLoad={onLoad}\n    >\n      <Items onResourceChanged={onResourceChanged} />\n    </IIIFContentProvider>\n  );\n};\n"],"names":["process","env","NODE_ENV","React","require$$0","REACT_ELEMENT_TYPE","Symbol","for","REACT_PORTAL_TYPE","REACT_FRAGMENT_TYPE","REACT_STRICT_MODE_TYPE","REACT_PROFILER_TYPE","REACT_PROVIDER_TYPE","REACT_CONTEXT_TYPE","REACT_FORWARD_REF_TYPE","REACT_SUSPENSE_TYPE","REACT_SUSPENSE_LIST_TYPE","REACT_MEMO_TYPE","REACT_LAZY_TYPE","REACT_OFFSCREEN_TYPE","MAYBE_ITERATOR_SYMBOL","iterator","ReactSharedInternals","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","error","format","_len2","arguments","length","args","Array","_key2","printWarning","level","stack","ReactDebugCurrentFrame","getStackAddendum","concat","argsWithFormat","map","item","String","unshift","Function","prototype","apply","call","console","REACT_MODULE_REFERENCE","getContextName","type","displayName","getComponentNameFromType","tag","name","$$typeof","_context","outerType","innerType","wrapperName","functionName","getWrappedName","render","outerName","lazyComponent","payload","_payload","init","_init","x","prevLog","prevInfo","prevWarn","prevError","prevGroup","prevGroupCollapsed","prevGroupEnd","assign","Object","disabledDepth","disabledLog","__reactDisabledLog","prefix","ReactCurrentDispatcher","describeBuiltInComponentFrame","source","ownerFn","Error","match","trim","componentFrameCache","reentry","PossiblyWeakMap","WeakMap","Map","describeNativeComponentFrame","fn","construct","control","frame","get","previousDispatcher","previousPrepareStackTrace","prepareStackTrace","current","log","info","warn","group","groupCollapsed","groupEnd","props","configurable","enumerable","value","writable","defineProperties","Fake","defineProperty","set","Reflect","sample","sampleLines","split","controlLines","s","c","_frame","replace","includes","syntheticFrame","describeUnknownElementTypeFrameInDEV","isReactComponent","hasOwnProperty","loggedTypeFailures","setCurrentlyValidatingElement","element","owner","_owner","_source","setExtraStackFrame","isArrayImpl","isArray","a","testStringCoercion","checkKeyStringCoercion","e","willCoercionThrow","toStringTag","constructor","typeName","specialPropKeyWarningShown","specialPropRefWarningShown","didWarnAboutStringRefs","ReactCurrentOwner","RESERVED_PROPS","key","ref","__self","__source","jsxDEV","config","maybeKey","self","propName","getter","getOwnPropertyDescriptor","isReactWarning","hasValidKey","hasValidRef","stateNode","componentName","warnIfStringRefCannotBeAutoConverted","defaultProps","warnAboutAccessingKey","defineKeyPropWarningGetter","warnAboutAccessingRef","defineRefPropWarningGetter","_store","freeze","ReactElement","propTypesMisspellWarningShown","ReactCurrentOwner$1","ReactDebugCurrentFrame$1","setCurrentlyValidatingElement$1","isValidElement","object","getDeclarationErrorAddendum","ownerHasKeyUseWarning","validateExplicitKey","parentType","validated","currentComponentErrorInfo","parentName","getCurrentComponentErrorInfo","childOwner","validateChildKeys","node","i","child","iteratorFn","maybeIterable","maybeIterator","getIteratorFn","entries","step","next","done","validatePropTypes","propTypes","typeSpecs","values","location","has","bind","typeSpecName","error$1","err","ex","message","checkPropTypes","PropTypes","getDefaultProps","isReactClassApproved","jsxWithValidation","isStaticChildren","validType","getModuleId","isValidElementType","keys","typeString","sourceInfo","fileName","lineNumber","getSourceInfoErrorAddendum","children","fragment","validateFragmentProps","jsx","jsxs","reactJsxRuntime_development","Fragment","module","exports","f","k","l","m","n","p","q","g","b","d","h","reactJsxRuntime_production_min","require$$1","metaState","compatVault","nonRef","setMetaValue","id","meta","oldValue","getResourceMeta","oldValueItem","newValue","resource","metaKey","resourceMeta","endsWith","z","A","E","L","M","W","j","$","C","P","B","N","R","H","T","G","Q","V","D","U","J","ce","extraFormats","extraQualities","extraFeatures","de","ge","pe","indexOf","me","full","square","startsWith","substr","r","parseFloat","y","w","percent","xe","upscaled","max","confined","slice","serialiseAsFull","percentScale","t","width","parseInt","height","version","Ie","angle","mirror","Number","isNaN","_e","path","scheme","server","ye","reverse","o","u","filter","Boolean","join","identifier","originalPath","region","size","rotation","quality","we","profile","formats","push","qualities","supports","maxHeight","maxWidth","maxArea","K","Se","ve","Math","floor","v","F","X","Oe","Fe","minWidth","minHeight","tiles","Y","Ae","ze","unsafe","Ee","sizes","ee","service","Le","Me","We","Ve","De","Ue","getOwnPropertyDescriptors","je","getOwnPropertySymbols","Je","Ze","propertyIsEnumerable","$e","I","Ce","ceil","O","Be","unsafeImageService","atAnyCost","fallback","returnAllOptions","preferFixedSize","allowUnsafe","explain","fill","JSON","stringify","abs","Pe","best","qe","ei","ii","Ne","ti","ni","Re","ri","si","He","scaleFactors","Ge","_","Promise","throw","resolve","then","ke","this","verificationsRequired","approximateServices","enableFetching","disableThrottling","fetchingCount","imageServices","knownImageServers","setConfig","real","verify","verifications","malformed","root","preLoaded","sampledId","verified","result","context","sampledProfile","resourceServiceRatio","sampledSizes","sizeRatios","sampledTiles","preLoad","predict","protocol","round","getThumbnailFromResource","getImageCandidates","loadService","canLoadSync","loadServiceSync","be","fetchService","Te","markAsMalformed","fetch","json","setTimeout","getValue","inputText","options","i18nLanguage","strictFallback","defaultText","separator","fallbackLanguages","closest","languages","language","i18nLanguages","lang","inverseIdx","root2","inverseIdx2","getClosestLanguage","candidateText","buildLocaleString","navigator","globalThis","window","global","__defProp","__publicField","index_umd","__defNormalProp","e2","t2","traversals","collection","manifest","canvas","annotationList","sequence","annotation","contentResource","choice","range","layer","convertPropsToArray","mergeMemberProperties","allowUndefinedReturn","static","traverseCollection","traverseType","traverseDescriptive","traverseLinking","traverseCollectionItems","manifests","e3","collections","members","traverseManifest","traverseUnknown","traverseManifestItems","sequences","traverseSequence","structures","traverseRange","traverseSequenceItems","canvases","traverseCanvas","traverseCanvasItems","images","traverseAnnotation","otherContent","traverseAnnotationList","traverseRangeItems","ranges","traverseAnnotationListItems","resources","traverseAnnotationItems","traverseContentResource","on","traverseLayer","traverseLayerItems","traverseChoice","traverseChoiceItems","default","traverseService","traverseImageResource","i2","r2","n2","thumbnail","logo","traverseOneOrMoreServices","related","traverseOneOrManyType","rendering","seeAlso","within","startCanvas","contentLayer","reduce","t3","S","find","e4","i3","encodeURI","behavior","viewingHint","motivation","viewingDirection","duration","timeMode","r3","n3","s2","a2","label","license","metadata","rights","requiredStatement","attribution","navDate","summary","description","provider","homepage","partOf","start","supplementary","chars","items","annotations","target","selector","body","upgrade","__esModule","ReactContext","createContext","currentResourceId","isLoaded","orientation","useThumbnailPanelContext","useContext","IIIFContentProvider","onLoad","overrides","setResource","useState","mergedResource","useMemo","fromEntries","setError","useEffect","controller","AbortController","input","signal","resp","catch","abort","Provider","Thumbnail","onClick","helper","vault","dependencies","imageServiceLoader","getBestThumbnailAtSize","async","request","dereference","candidates","dimensions","thumbnailNotFound","fixed","fullInput","skipSelfReturn","potentialThumbnails","parseThumbnail","contentResources","firstContentResources","firstManifest","firstCanvas","createThumbnailHelper","thumb","setThumb","thumbnailSize","response","getData","style","backgroundColor","objectFit","src","alt","findAllCanvasesInRange","found","inner","sourceId","createSequenceHelper","getVisibleCanvasesFromCanvasId","manifestOrRange","canvasId","preventPaged","fullCanvas","canvasBehavior","isPaged","isContinuous","isIndividuals","isCanvasFacingPages","isCanvasNonPaged","manifestItems","ordering","getManifestSequence","canvasIndex","findIndex","indexes","index","disablePaging","skipNonPaged","currentOrdering","flush","offset","flushNextPaged","Items","onResourceChanged","seq","dir","onKeyDown","keyCode","currentTarget","getAttribute","_b","_a","parentElement","querySelector","focus","isCurrentGroup","groupIdx","resourceIdx","idx","itemIdx","tabIndex","iiifContent"],"mappings":"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"}