!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).IIIFThumbnailPanel={})}(this,(function(e){"use strict";var t={},i={get exports(){return t},set exports(e){t=e}},r={},n={},o={get exports(){return n},set exports(e){n=e}},s={},a=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),p=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.iterator;var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,w={};function S(e,t,i){this.props=e,this.context=t,this.refs=w,this.updater=i||x}function A(){}function C(e,t,i){this.props=e,this.context=t,this.refs=w,this.updater=i||x}S.prototype.isReactComponent={},S.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},S.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},A.prototype=S.prototype;var j=C.prototype=new A;j.constructor=C,b(j,S.prototype),j.isPureReactComponent=!0;var O=Array.isArray,R=Object.prototype.hasOwnProperty,k={current:null},I={key:!0,ref:!0,__self:!0,__source:!0};function $(e,t,i){var r,n={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)R.call(t,r)&&!I.hasOwnProperty(r)&&(n[r]=t[r]);var c=arguments.length-2;if(1===c)n.children=i;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];n.children=u}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===n[r]&&(n[r]=c[r]);return{$$typeof:a,type:e,key:o,ref:s,props:n,_owner:k.current}}function T(e){return"object"==typeof e&&null!==e&&e.$$typeof===a}var L=/\/+/g;function _(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function F(e,t,i,r,n){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var s=!1;if(null===e)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case a:case c:s=!0}}if(s)return n=n(s=e),e=""===r?"."+_(s,0):r,O(n)?(i="",null!=e&&(i=e.replace(L,"$&/")+"/"),F(n,t,i,"",(function(e){return e}))):null!=n&&(T(n)&&(n=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(n,i+(!n.key||s&&s.key===n.key?"":(""+n.key).replace(L,"$&/")+"/")+e)),t.push(n)),1;if(s=0,r=""===r?".":r+":",O(e))for(var u=0;u<e.length;u++){var l=r+_(o=e[u],u);s+=F(o,t,i,l,n)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=y&&e[y]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),u=0;!(o=e.next()).done;)s+=F(o=o.value,t,i,l=r+_(o,u++),n);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function P(e,t,i){if(null==e)return e;var r=[],n=0;return F(e,r,"","",(function(e){return t.call(i,e,n++)})),r}function W(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var E={current:null},M={transition:null},q={ReactCurrentDispatcher:E,ReactCurrentBatchConfig:M,ReactCurrentOwner:k};s.Children={map:P,forEach:function(e,t,i){P(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},s.Component=S,s.Fragment=u,s.Profiler=f,s.PureComponent=C,s.StrictMode=l,s.Suspense=v,s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q,s.cloneElement=function(e,t,i){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=b({},e.props),n=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=k.current),void 0!==t.key&&(n=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)R.call(t,u)&&!I.hasOwnProperty(u)&&(r[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)r.children=i;else if(1<u){c=Array(u);for(var l=0;l<u;l++)c[l]=arguments[l+2];r.children=c}return{$$typeof:a,type:e.type,key:n,ref:o,props:r,_owner:s}},s.createContext=function(e){return(e={$$typeof:p,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:h,_context:e},e.Consumer=e},s.createElement=$,s.createFactory=function(e){var t=$.bind(null,e);return t.type=e,t},s.createRef=function(){return{current:null}},s.forwardRef=function(e){return{$$typeof:d,render:e}},s.isValidElement=T,s.lazy=function(e){return{$$typeof:g,_payload:{_status:-1,_result:e},_init:W}},s.memo=function(e,t){return{$$typeof:m,type:e,compare:void 0===t?null:t}},s.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},s.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},s.useCallback=function(e,t){return E.current.useCallback(e,t)},s.useContext=function(e){return E.current.useContext(e)},s.useDebugValue=function(){},s.useDeferredValue=function(e){return E.current.useDeferredValue(e)},s.useEffect=function(e,t){return E.current.useEffect(e,t)},s.useId=function(){return E.current.useId()},s.useImperativeHandle=function(e,t,i){return E.current.useImperativeHandle(e,t,i)},s.useInsertionEffect=function(e,t){return E.current.useInsertionEffect(e,t)},s.useLayoutEffect=function(e,t){return E.current.useLayoutEffect(e,t)},s.useMemo=function(e,t){return E.current.useMemo(e,t)},s.useReducer=function(e,t,i){return E.current.useReducer(e,t,i)},s.useRef=function(e){return E.current.useRef(e)},s.useState=function(e){return E.current.useState(e)},s.useSyncExternalStore=function(e,t,i){return E.current.useSyncExternalStore(e,t,i)},s.useTransition=function(){return E.current.useTransition()},s.version="18.2.0",o.exports=s;
/**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */
var z=n,B=Symbol.for("react.element"),D=Symbol.for("react.fragment"),H=Object.prototype.hasOwnProperty,U=z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Q={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,i){var r,n={},o=null,s=null;for(r in void 0!==i&&(o=""+i),void 0!==t.key&&(o=""+t.key),void 0!==t.ref&&(s=t.ref),t)H.call(t,r)&&!Q.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===n[r]&&(n[r]=t[r]);return{$$typeof:B,type:e,key:o,ref:s,props:n,_owner:U.current}}r.Fragment=D,r.jsx=N,r.jsxs=N,function(e){e.exports=r}(i);const V=t.Fragment,J=t.jsx,Y=t.jsxs,K={},Z={get:e=>e,setMetaValue([e,t,i],r){const n=Z.getResourceMeta(e,t),o=n?n[i]:void 0,s="function"==typeof r?r(o):r;K[e]={...K[e]||{},[t]:{...(K[e]||{})[t]||{},[i]:s}}},getResourceMeta:(e,t)=>{const i=K[e];if(i)return t?i[t]:i}};function G(e){return e.endsWith("info.json")?e:e.endsWith("/")?`${e}info.json`:`${e}/info.json`}const X="http://library.stanford.edu/iiif/image-api/compliance.html#level1",ee="http://library.stanford.edu/iiif/image-api/compliance.html#level2",te="http://library.stanford.edu/iiif/image-api/conformance.html#level1",ie="http://library.stanford.edu/iiif/image-api/conformance.html#level2",re="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",ne="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",oe="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",se="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",ae="http://iiif.io/api/image/1/level1.json",ce="http://iiif.io/api/image/1/profiles/level1.json",ue="http://iiif.io/api/image/1/level2.json",le="http://iiif.io/api/image/1/profiles/level2.json",fe="http://iiif.io/api/image/2/level1.json",he="http://iiif.io/api/image/2/profiles/level1.json",pe="http://iiif.io/api/image/2/level2.json",de="http://iiif.io/api/image/2/profiles/level2.json",ve="level1",me="level2",ge="http://iiif.io/api/image/2/level1",ye="http://iiif.io/api/image/2/level2",xe=[ye,ee,ie,ne,se,ue,le,pe,de,me],be=[...xe,ge,X,te,re,oe,ae,ce,fe,he,ve],we=["http://iiif.io/api/image/2/level0",ge,ye,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",X,ee,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",te,ie,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",re,ne,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",oe,se,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",ae,ce,ue,le,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",fe,he,pe,de,"level0",ve,me],Se={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},Ae={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},Ce={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]};function je(e){return-1!==xe.indexOf(e)?Ce:-1!==be.indexOf(e)?Ae:Se}function Oe(e){try{if("full"===e)return{full:!0};if("square"===e)return{square:!0};const t=e.startsWith("pct:"),i=e.substr(t?4:0).split(",").map((e=>parseFloat(e)));return{x:i[0],y:i[1],w:i[2],h:i[3],percent:t}}catch{throw new Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+e)}}function Re(e){const t={upscaled:!1,max:!1,confined:!1};if("^"===e[0]&&(t.upscaled=!0,e=e.slice(1)),"max"===e||"full"===e)return t.max=!0,t.serialiseAsFull="full"===e,t;if("!"===e[0]&&(t.confined=!0,e=e.slice(1)),"p"===e[0])return t.percentScale=parseFloat(e.slice(4)),t;const i=e.split(",").map((e=>e.trim()));return i.length&&(""!==i[0]&&(t.width=parseInt(i[0],10)),""!==i[1]?(t.height=parseInt(i[1],10),t.version=2):t.version=3),t}function ke(e){const t={angle:0};if("!"===e[0]&&(t.mirror=!0,e=e.substr(1)),t.angle=parseFloat(e)%360,Number.isNaN(t.angle))throw new Error(`Invalid rotation ${e}`);return t}function Ie(e,t=""){const{path:i,scheme:r,server:n,prefix:o}=function(e,t=""){const i=e.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!i)throw new Error(`Invalid or unknown input ${e}`);const r=i[2],n=i[3];let o=i[4];if("/"===o[0]&&(o=o.substr(1)),t.length>0){if("/"===t[0]&&(t=t.substr(1)),t!==o.substr(0,t.length))throw new Error(`Path does not start with prefix (path: ${o}, prefix: ${t})`);o=o.substr(t.length)}return{scheme:r,server:n,path:o,prefix:t}}(e,t),s=i.split("/").reverse(),[a,c,u,l,...f]=s,h=f.reverse().filter(Boolean).join("/");if(1===s.length||""===a)return{type:"base",scheme:r,server:n,prefix:o,identifier:h};if("info.json"===a){const[,...e]=s;return{type:"info",scheme:r,server:n,prefix:o,identifier:e.reverse().filter(Boolean).join("/")}}const p=a.split(".");return{type:"image",scheme:r,server:n,prefix:o,identifier:h,originalPath:i,region:Oe(l),size:Re(u),rotation:ke(c),quality:p[0],format:p[1]}}function $e(e){const t=Ie(G(e.id));if("info"!==t.type)throw new Error("Invalid service URL");const i=function(e){const t=e?Array.isArray(e.profile)?e.profile:[e.profile]:[],i={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let r of t)if("string"==typeof r&&(r=je(r)),r){if(r.formats)for(const e of r.formats)-1===i.extraFormats.indexOf(e)&&i.extraFormats.push(e);if(r.qualities)for(const e of r.qualities)-1===i.extraQualities.indexOf(e)&&i.extraQualities.push(e);if(r.supports)for(const e of r.supports)-1===i.extraFeatures.indexOf(e)&&i.extraFeatures.push(e);if(r.maxHeight&&(i.maxHeight=r.maxHeight),r.maxWidth&&(i.maxWidth=r.maxWidth),r.maxArea&&(i.maxArea=r.maxArea),r.extraFormats)for(const e of r.extraFormats)-1===i.extraFormats.indexOf(e)&&i.extraFormats.push(e);if(r.extraQualities)for(const e of r.extraQualities)-1===i.extraQualities.indexOf(e)&&i.extraQualities.push(e);if(r.extraFeatures)for(const e of r.extraFeatures)-1===i.extraFeatures.indexOf(e)&&i.extraFeatures.push(e);r.maxHeight&&(i.maxHeight=r.maxHeight),r.maxWidth&&(i.maxWidth=r.maxWidth),r.maxArea&&(i.maxArea=r.maxArea)}if(e.extraFormats)for(const r of e.extraFormats)-1===i.extraFormats.indexOf(r)&&i.extraFormats.push(r);if(e.extraFeatures)for(const r of e.extraFeatures)-1===i.extraFeatures.indexOf(r)&&i.extraFeatures.push(r);if(e.extraQualities)for(const r of e.extraQualities)-1===i.extraQualities.indexOf(r)&&i.extraQualities.push(r);return i}(e);return{identifier:t.identifier,originalPath:"",server:t.server,prefix:t.prefix,scheme:t.scheme,type:"image",quality:-1===i.extraQualities.indexOf("default")?i.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}function Te(e,t,i){const r=i.length,n=[];for(let o=0;o<r;o++){const t=i[o].width;n.push(e/t)}return n}function Le(e,t,i){const r=i.length,n=[];for(let o=0;o<r;o++){const r=i[o];n.push({width:Math.floor(e/r),height:Math.floor(t/r)})}return n}function _e(e){return e["@id"]?e["@id"]:e.id?e.id:void 0}function Fe(e){if(!e||!e.profile||!_e(e))return!1;const t=Array.isArray(e.profile)?e.profile:[e.profile];for(const i of t)if("string"==typeof i&&-1!==we.indexOf(i))return!0;return!1}function Pe(e,t){if(t&&t.profile){const i=t.profile;if(i){const t=Array.isArray(i)?i:[i];return t.includes(`level${e}`)||t.includes(`http://iiif.io/api/image/2/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/profiles/level${e}.json`)}}return!1}function We(e){return Fe(e)?Pe(0,e)?0:Pe(1,e)?1:Pe(2,e)?2:null:null}function Ee(e){return-1!==(e["@context"]?Array.isArray(e["@context"])?e["@context"]:[e["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")}function Me(e){if(!function(e){if(!Fe(e))return!1;const t=Array.isArray(e.profile)?e.profile:[e.profile];for(const i of t)if("string"==typeof i){if(-1!==be.indexOf(i))return!0}else{const e=[...i.supports||[],...i.extraFeatures||[]];if(-1!==e.indexOf("regionByPx")&&(-1!==e.indexOf("sizeByW")||-1!==e.indexOf("sizeByWh")))return!0}return!1}(e))return[];const t=[],i=Array.isArray(e.profile)?e.profile:[e.profile],r=i.length;for(let n=0;n<r;n++){const t=i[n];if("string"!=typeof t&&(t.maxHeight||t.maxWidth))return[{id:_e(e),type:"variable",minWidth:0,minHeight:0,maxHeight:t.maxHeight||t.maxWidth,maxWidth:t.maxWidth||t.maxHeight,level:We(e),version:"http://iiif.io/api/image/3/context.json"===e["@context"]?3:2}]}if(e.tiles){const i=e.tiles.length;for(let r=0;r<i;r++){const i=e.tiles[r];(i.height||i.width)&&t.push({id:_e(e),type:"variable",minHeight:0,minWidth:0,maxHeight:i.height||i.width,maxWidth:i.width,level:We(e),version:Ee(e)?3:2})}}return t}function qe(e){const t=e.match(/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/);if(t){const i=t[1],r=parseInt(t[4],10),n=parseInt(t[5],10),o=t[7];if(("max"===i||"full"===i)&&r&&n&&o)return{type:"fixed",id:e,height:n,width:r}}return{type:"unknown",id:e}}function ze(e){if("string"==typeof e)return qe(e);const t=function(e){return e["@type"]?e["@type"]:e.type?e.type:void 0}(e);if("Image"!==t&&"sc:Image"!==t)return null;const i=e,r=_e(i);return r?r&&i.width&&i.height?{id:r,type:"fixed",width:i.width,height:i.height,unsafe:!0}:qe(r):null}function Be(e){return Fe(e)?(e&&e.sizes?e.sizes:[]).map((t=>({id:_e(e),type:"fixed-service",height:t.height,width:t.width,level:We(e),version:Ee(e)?3:2}))):[]}function De(e){const t=[],i=e.length;for(let r=0;r<i;r++){const i=Be(e[r]);i.length&&t.push(...i);const n=Me(e[r]);n.length&&t.push(...n)}return t}function He(e){const t=e.service?Array.isArray(e.service)?e.service:[e.service]:[],i=t.length,r=[];for(let n=0;n<i;n++)Fe(t[n])&&r.push(t[n]);return r}function Ue({x:e=0,y:t=0,w:i,h:r,full:n,square:o,percent:s}){if(n)return"full";if(o)return"square";if(typeof i>"u"||typeof r>"u")throw new Error("RegionParameter: invalid region");const a=`${e},${t},${i},${r}`;return s?`pct:${a}`:a}function Qe({max:e,percentScale:t,upscaled:i,confined:r,width:n,height:o,serialiseAsFull:s,version:a}){const c=[];return i&&c.push("^"),e?(c.push(s?"full":"max"),c.join("")):(r&&c.push("!"),t&&c.push(`pct:${t}`),n&&c.push(`${n}`),c.push(","),o&&3===a&&c.push(`${o}`),c.join(""))}function Ne(e){return`${e.mirror?"!":""}${(e.angle||0)%360}`}var Ve=Object.defineProperty,Je=Object.defineProperties,Ye=Object.getOwnPropertyDescriptors,Ke=Object.getOwnPropertySymbols,Ze=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable,Xe=(e,t,i)=>t in e?Ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,et=(e,t)=>{for(var i in t||(t={}))Ze.call(t,i)&&Xe(e,i,t[i]);if(Ke)for(var i of Ke(t))Ge.call(t,i)&&Xe(e,i,t[i]);return e},tt=(e,t)=>Je(e,Ye(t));function it(e,t){const i=e.prefix.startsWith("/")?e.prefix.substr(1):e.prefix,r=`${e.scheme}://${e.server}/${i?`${i}/`:""}${e.identifier}`;if("base"===e.type)return r;if("info"===e.type)return`${r}/info.json`;let{size:n}=e;const{region:o,rotation:s,format:a,quality:c}=e;if(t){const e=t["@context"]?Array.isArray(t["@context"])?t["@context"]:[t["@context"]]:[],i=-1!==e.indexOf("http://iiif.io/api/image/2/context.json"),r=-1!==e.indexOf("http://iiif.io/api/image/3/context.json");if((n.width===t.width&&!n.height||n.height===t.height&&!n.width||n.width===t.width&&n.height===t.height)&&(n=tt(et({},n),{max:!0})),i&&(n.max&&!n.serialiseAsFull&&(n=tt(et({},n),{serialiseAsFull:!0})),!n.max&&n.width&&n.height&&(n=tt(et({},n),{height:void 0})),n=tt(et({},n),{version:2})),r){if(n.max&&n.serialiseAsFull&&(n=tt(et({},n),{serialiseAsFull:!1})),n.width&&!n.height&&t.width&&t.height){const e=t.height/t.width;n=tt(et({},n),{height:Math.ceil(n.width*e)})}n=tt(et({},n),{version:3})}}return[r,Ue(o),Qe(n),Ne(s),`${c}.${a}`].filter(Boolean).join("/")}function rt(e,t,i){const r=$e({"@context":3===e.version?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:G(_e(e)),profile:null===e.level||typeof e.level>"u"?"level0":`level${e.level}}`,type:3===e.version?"ImageService3":"ImageService2"});if("image"!==r.type)throw new Error("Invalid service");return r.size.max=!1,r.size.width=t,r.size.height=i,{id:it(r),type:"fixed",width:t,height:i||e.height/(e.width||1)*t,unsafe:e.width>t}}function nt(e){const t=e.replace(/(https?:\/\/)?(www.)?/i,"");return-1!==t.indexOf("/")?t.split("/")[0]:t}function ot(e,t){const i=[],r=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},e),n=(e,t=0)=>r.explain?i.push(new Array(t).fill(0).map((e=>"    ")).join("")+e().trim()):void 0,o=[],s=[];let a=null;n((()=>`Using configuration: ${JSON.stringify(r,null,2)}`));const c=(e,t)=>{if(n((()=>"Swapping choice"),3),function(e,t,i){const r=e.width?e.width:e.maxWidth;return i.height<=e.maxHeight&&i.width<=e.maxWidth&&i.height>=e.minHeight&&i.width>=e.minWidth&&(!t||Math.abs(i.width-r)<Math.abs(t.width-r))}(r,t,e)){if(r.preferFixedSize&&e.unsafe)return n((()=>`We found an image that was marked as unsafe, but it was the best size. (${e.id})`),4),void s.push(e);r.returnAllOptions&&t&&s.push(t),n((()=>`We found a new image that was the best size. (${e.id})`),4),a=e}else r.returnAllOptions&&s.push(e)};n((()=>`The input shows we have ${t.length} list(s) of candidates to choose from.`));const u=t.length;for(let l=0;l<u;l++){const e=t[l]();n((()=>`Candidate group ${l}: ${JSON.stringify(e,null,2)}`),1);const i=e.length;n((()=>`Checking candidate list number ${l} and found ${i} potential ways of creating image(s)`),1);for(let t=0;t<i;t++){const i=e[t];if(n((()=>`-> Checking candidate ${t}`),1),"unknown"===i.type&&r.atAnyCost&&(n((()=>'We\'ve found an unknown image type, adding this to the "last resort" list'),2),o.push(i)),"fixed"===i.type&&(i.unsafe?(n((()=>'We\'ve found an unsafe fixed image type, adding this to the "last resort" list'),2),o.push(i)):(n((()=>"We've found a fixed size image, checking if it matches the request"),2),c(i,a))),"fixed-service"===i.type)if(r.unsafeImageService){n((()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)"),2);c(rt(i,r.width,r.height),a)}else{n((()=>"Checking for an image from the tile source 3"),2);c(rt(i,i.width,i.height),a)}if("variable"===i.type&&i.maxWidth){c(rt({id:i.id,type:"fixed-service",width:i.maxWidth,height:i.maxWidth,level:i.level,version:i.version},i.maxWidth),a)}}if(a&&!r.returnAllOptions){if(a.unsafe||r.allowUnsafe)continue;n((()=>`We found a match in choice list number ${l}, no searching any more`));break}}return r.atAnyCost&&0===s.length?(n((()=>a?`We found an image! ${a.id} of type ${a.type}`:'We found no images, but "atAnyCost" is set, so returning that')),{best:a||o[0],fallback:o.slice(1),log:i}):r.returnAllOptions?(n((()=>"Returning all options that we have found")),{best:r.atAnyCost?a||s[0]||o[0]:a||s[0],fallback:[...s,...o],log:i}):(n((()=>"Returning the best image that we found, and a fallback")),{best:a||s[0]||null,fallback:a?s:s.slice(1),log:i})}var st=Object.defineProperty,at=Object.defineProperties,ct=Object.getOwnPropertyDescriptors,ut=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable,ht=(e,t,i)=>t in e?st(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,pt=(e,t)=>{for(var i in t||(t={}))lt.call(t,i)&&ht(e,i,t[i]);if(ut)for(var i of ut(t))ft.call(t,i)&&ht(e,i,t[i]);return e},dt=(e,t)=>at(e,ct(t));function vt(e,t,i){const r=e>t?e:t,n=i.length,o=[];for(let s=0;s<n;s++){const e=i[s];let t=e.scaleFactors[0],n=r/t;const a=[t];for(;n>=e.width;)t*=2,a.push(t),n/=2;o.push(dt(pt({},e),{scaleFactors:a}))}return o}function mt(e){return Pe(0,e)}var gt=(e,t,i)=>new Promise(((r,n)=>{var o=e=>{try{a(i.next(e))}catch(t){n(t)}},s=e=>{try{a(i.throw(e))}catch(t){n(t)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,s);a((i=i.apply(e,t)).next())}));class yt{constructor(){this.config={verificationsRequired:1,approximateServices:!0,enableFetching:!0,disableThrottling:!1},this.fetchingCount=0,this.imageServices={},this.knownImageServers={}}setConfig(e){Object.assign(this.config,e)}sample(e,t,i=!0){const r=nt(_e(e)),n=G(_e(e)),o=this.knownImageServers[r];return this.imageServices[n]=Object.assign(e,{real:!0}),o||!e.tiles||mt(e)?this.verify(e):(this.knownImageServers[r]={verifications:0,malformed:!1,root:r,preLoaded:i,sampledId:_e(e),verified:!1,server:null,result:{context:e["@context"]||[],sampledProfile:e.profile,resourceServiceRatio:t&&e.height?t.height/e.height:1,sampledSizes:e.sizes||[],sizeRatios:Te(e.width,e.height,e.sizes||[]),sampledTiles:e.tiles||[]}},!0)}preLoad(e,t=!0){this.knownImageServers[e.root]=e,t&&(this.knownImageServers[e.root].malformed=!1,this.knownImageServers[e.root].verifications=this.config.verificationsRequired)}predict(e,t=!1,i=!1){const r=null==e?void 0:e.source,n=nt(_e(e)),o=this.knownImageServers[n];if(!o||!o.result||!(null==r?void 0:r.height)&&!e.height||!(null==r?void 0:r.width)&&!e.width||!i&&(o.malformed||o.verifications<this.config.verificationsRequired)||mt(e.source))return null;const s=G(_e(e));return this.imageServices[s]||(this.imageServices[s]={"@context":o.result.context,"@id":_e(e),id:_e(e),protocol:"http://iiif.io/api/image",tiles:(null==r?void 0:r.tiles)||vt(e.width,e.height,o.result.sampledTiles),sizes:(null==r?void 0:r.sizes)||Le(Math.round(e.width/o.result.resourceServiceRatio),Math.round(e.height/o.result.resourceServiceRatio),o.result.sizeRatios),profile:(null==r?void 0:r.profile)||o.result.sampledProfile,height:(null==r?void 0:r.height)||e.height,width:(null==r?void 0:r.width)||e.width,real:!1}),this.imageServices[s]}getThumbnailFromResource(e,t){return gt(this,arguments,(function*(e,t,i=!0,r=[]){const n=e?yield this.getImageCandidates(e,i):[];return ot(t,[()=>r,()=>n])}))}getImageCandidates(e,t=!0){return gt(this,null,(function*(){const i=e;if(t&&i.height&&i.width){const e=He(i);for(const t of e){const e={id:_e(t),width:t.width?t.width:i.width,height:t.height?t.height:i.height,source:t};yield this.loadService(e)}}return function(e,t=!0,i){const r=[],n=ze(e);if(null===n)return r;const o=e;if(r.push(n),t&&o.width&&o.height){const e=[],t=He(o);for(const r of t){const t={id:_e(r),width:o.width,height:o.height};if(i.canLoadSync(t)){const r=i.loadServiceSync(t);r&&(r.height||(r.height=o.height),r.width||(r.width=o.width),e.push(...De([r])))}}if(e.length)return r.push(...e),r}return o.service&&r.push(...De(o.service)),r}(e,t,this)}))}verify(e){return gt(this,null,(function*(){const t=this.predict(e,!1,!0),i=yield this.fetchService(_e(e));if(!t)return!1;const r=t.height===i.height&&t.width===i.width&&t["@context"]===i["@context"]&&function(e,t){if(e.length!==t.length)return!1;if(0===e.length&&0===t.length)return!0;const i=e.length;let r=!0;for(let o=0;o<i;o++){const i=e[o],n=t[o];if(i.width!==n.width||i.height!==n.height){r=!1;break}}if(r)return!0;let n=0;for(let o=0;o<i;o++)for(let r=0;r<i;r++)if(e[o].width===t[r].width&&e[o].height===t[r].height){n++;break}return n===i}(t.sizes||[],i.sizes||[]);if(r){const t=nt(_e(e));this.knownImageServers[t].verifications+=1,this.knownImageServers[t].verifications>=this.config.verificationsRequired&&(this.knownImageServers[t].verified=!0)}return r}))}canLoadSync(e){const t="string"==typeof e?e:_e(e),i=G(t);if(this.imageServices[i])return!0;const r=this.knownImageServers[nt(t)];return r&&!r.malformed&&r.verifications>=this.config.verificationsRequired}markAsMalformed(e){return gt(this,null,(function*(){return this.knownImageServers[nt(_e(e))].malformed=!0,this.loadService(e,!0)}))}fetchService(e,t=!1){return gt(this,null,(function*(){const i=G(e);if(this.imageServices[i]&&(!t||this.imageServices[i].real))return this.imageServices[i];if(!this.config.enableFetching)throw new Error("Fetching is not enabled");const r=yield this.fetch(i).then((e=>e.json()));return!r.id&&r["@id"]&&(r.id=r["@id"]),r.id!==e&&(r.id=e,r["@id"]&&(r["@id"]=e)),this.imageServices[i]=Object.assign(r,{real:!0}),this.imageServices[i]}))}fetch(e,t){return gt(this,null,(function*(){return fetch(e,t)}))}loadService(e,t=!1){return gt(this,null,(function*(){if(!this.config.disableThrottling){let e=!0;for(;e;){if(!(this.fetchingCount>=this.config.verificationsRequired)){e=!1;break}yield new Promise((e=>setTimeout(e,500)))}}const i=this.knownImageServers[nt(_e(e))];if(i&&!i.malformed&&!t){yield i.result;const t=this.loadServiceSync(e);if(t)return t}this.fetchingCount++;const r=yield this.fetchService(_e(e),t);return this.fetchingCount--,r.real&&this.sample(r,e),r}))}loadServiceSync(e){const t=G(_e(e));return this.imageServices[t]?this.imageServices[t]:this.predict(e)}}function xt(e,t={}){return function(e,t,i={}){const{strictFallback:r=!1,defaultText:n="",separator:o="\n",fallbackLanguages:s=[],closest:a}=i,c=Object.keys(e||{}),u=a?t:function(e,t,i=[],r=!1){if(!e||!t||0===t.length)return;if(1===t.length)return t[0];if(-1!==t.indexOf(e))return e;const n=-1!==e.indexOf("-")?e.slice(0,e.indexOf("-")):null;if(n&&-1!==t.indexOf(n))return n;for(const o of i)if(-1!==t.indexOf(o))return o;if(!r){const r=t.map((e=>-1!==e.indexOf("-")?e.slice(0,e.indexOf("-")):null)).indexOf(e);if(-1!==r)return t[r];for(const e of i){const i=-1!==e.indexOf("-")?e.slice(0,e.indexOf("-")):null,r=i?t.indexOf(i):-1;if(-1!==r)return t[r]}}return-1!==t.indexOf("none")?"none":-1!==t.indexOf("@none")?"@none":t[0]}(t,c,s,r);if(!e)return n;if("string"==typeof e)return e;const l=u?e[u]:void 0;return l?"string"==typeof l?l:l.join(o):""}(e,"undefined"!=typeof navigator?navigator.language:void 0,t)}new yt;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var bt,wt,St,At={exports:{}};bt=At.exports,wt=Object.defineProperty,St=(e,t,i)=>(((e,t,i)=>{t in e?wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),function(e){const t="http://library.stanford.edu/iiif/image-api/compliance.html#level1",i="http://library.stanford.edu/iiif/image-api/compliance.html#level2",r="http://library.stanford.edu/iiif/image-api/conformance.html#level1",n="http://library.stanford.edu/iiif/image-api/conformance.html#level2",o="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",s="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",a="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",c="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",u="http://iiif.io/api/image/1/level1.json",l="http://iiif.io/api/image/1/profiles/level1.json",f="http://iiif.io/api/image/1/level2.json",h="http://iiif.io/api/image/1/profiles/level2.json",p="http://iiif.io/api/image/2/level1.json",d="http://iiif.io/api/image/2/profiles/level1.json",v="http://iiif.io/api/image/2/level2.json",m="http://iiif.io/api/image/2/profiles/level2.json",g="level1",y="level2",x="http://iiif.io/api/image/2/level1",b="http://iiif.io/api/image/2/level2",w=[x,b,t,i,r,n,o,s,a,c,u,l,f,h,p,d,v,m,g,y],S=["http://iiif.io/api/image/2/level0",x,b,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",t,i,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",r,n,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",o,s,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",a,c,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",u,l,f,h,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",p,d,v,m,"level0",g,y],A=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];class C{constructor(e,t={}){St(this,"traversals"),St(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(e){return new C({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){const t=[...(e.manifests||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e)),...(e.collections||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e)),...e.members||[]];delete e.collections,delete e.manifests,e.members=t}return e.manifests&&(e.manifests=e.manifests.map((e=>this.traverseManifest("string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e)))),e.collections&&(e.collections=e.collections.map((e=>this.traverseCollection("string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e)))),e.members&&(e.members=e.members.map((e=>"string"==typeof e?e:this.traverseUnknown(e)))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map((e=>this.traverseSequence(e)))),e.structures&&(e.structures=e.structures.map((e=>this.traverseRange(e)))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map((e=>this.traverseCanvas(e)))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map((e=>this.traverseAnnotation(e)))),e.otherContent&&(e.otherContent=e.otherContent.map((e=>this.traverseAnnotationList(e)))),e}traverseRange(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){const t=[...(e.ranges||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Range"}:e)),...(e.canvases||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Canvas"}:e)),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map((e=>this.traverseUnknown(e))):void 0}return e}traverseAnnotationList(e){const t="string"==typeof e?{"@id":e,"@type":"sc:AnnotationList"}:e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map((e=>this.traverseAnnotation(e)))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map((e=>this.traverseContentResource(e))):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map((e=>this.traverseAnnotationList(e)))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&"rdf:nil"!==e.default&&(e.default=this.traverseContentResource(e.default)),e.item&&"rdf:nil"!==e.item&&(e.item=e.item.map((e=>this.traverseContentResource(e)))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return"oa:Choice"===e["@type"]?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||"string"==typeof e)return e;switch(function(e){if(null==e)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw new Error("Array is not a valid entity");if("object"!=typeof e)throw new Error(typeof e+" is not a valid entity");if("string"==typeof e["@type"]){const t=A.indexOf(e["@type"]);if(-1!==t)return A[t]}if(e.profile)return"Service";if(e.format)return"ContentResource";if(e["@type"])return"ContentResource";throw new Error("Resource type is not known")}(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){const t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(const n of i)"string"==typeof n?r.push(this.traverseContentResource({"@id":n,"@type":"dctypes:Image"})):r.push(this.traverseContentResource(n));return t||this.options.convertPropsToArray?r:r[0]}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){const t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(const n of i)r.push(this.traverseService(n));return t||this.options.convertPropsToArray?r:r[0]}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&("string"==typeof e.within||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&("string"==typeof e.startCanvas?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&("string"==typeof e.contentLayer?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e)){if(!this.options.convertPropsToArray)return this.traverseType(e,t);e=[e]}return e.map((e=>this.traverseType(e,t)))}traverseType(e,t){return t.reduce(((e,t)=>{const i=t(e);return void 0!==i||this.options.allowUndefinedReturn?i:e}),e)}}const j="Attribution",O="http://example.org/provider",R="Unknown";function k(e,t="none"){if(!e)return{};const i=Array.isArray(e)?e:[e],r={};for(const n of i){if("string"==typeof n){r[t]=r[t]?r[t]:[],r[t].push(n||"");continue}if(!n["@language"]){r[t]=r[t]?r[t]:[],r[t].push(n["@value"]||"");continue}const e=n["@language"];r[e]=r[e]?r[e]:[],r[e].push(n["@value"]||"")}return r}function I(e){return Array.isArray(e)?I(e.find((e=>"string"==typeof e))):-1!==S.indexOf(e)?"level2":-1!==w.indexOf(e)?"level1":"string"==typeof e?e:void 0}function $(e){for(const t of["sc","oa","dcterms","dctypes","iiif"])if(e.startsWith(`${t}:`))return e.slice(t.length+1);return e}const T=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function L(e){const t=e["@id"]||e.id;let i=e["@type"]||e.type;const r=e.profile||void 0,n=e["@context"]||void 0;if(r){const e=function(e){switch(e){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}(r);if(e)return e}if(n){const e=function(e){const t=Array.isArray(e)?e:[e];for(const i of t)switch(i){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}(n);if(e)return e}if(i){if(Array.isArray(i)){if(-1!==i.indexOf("oa:CssStylesheet"))return"CssStylesheet";if(-1!==i.indexOf("cnt:ContentAsText"))return"TextualBody";i=i[0]}for(const e of["sc","oa","dcterms","dctypes","iiif"])if(i.startsWith(`${e}:`)){i=i.slice(e.length+1);break}switch(i){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(i&&-1!==T.indexOf(i))return i;if(e.format){if(e.format.startsWith("image/"))return"Image";if(e.format.startsWith("text/"))return"Text";if("application/pdf"===e.format)return"Text";if(e.format.startsWith("application/"))return"Dataset"}return t&&(t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".jpeg"))?"Image":i||"unknown"}const _=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function F(e){const t=e.match(_);return t?t[0]:e}const P=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function W(e){if(e){const t=Array.isArray(e)?e:[e],i=[];for(const e of t)"http://iiif.io/api/presentation/2/context.json"===e&&i.push("http://iiif.io/api/presentation/3/context.json"),-1===P.indexOf(e)&&i.push(e);if(t.length)return 1===i.length?i[0]:i}}function E(e){for(const t in e)void 0!==e[t]&&null!==e[t]||delete e[t];return e}let M=0;function q(e,t){const i=encodeURI(e.id||e["@id"]||"").trim();return i&&t?`${i}/${t}`:i||(M++,`http://example.org/${e["@type"]}${t?`/${t}`:""}/${M}`)}function z(e){const t=[...e.behavior||[]];let i;return e.viewingHint&&t.push(e.viewingHint),Array.isArray(e.motivation)?i=e.motivation.map($):e.motivation&&(i=$(e.motivation)),{"@context":e["@context"]?W(e["@context"]):void 0,id:(e["@id"]||q(e)).trim(),type:L(e),behavior:t.length?t:void 0,height:e.height?e.height:void 0,width:e.width?e.width:void 0,motivation:i,viewingDirection:e.viewingDirection,profile:e.profile,format:e.format?e.format:void 0,duration:void 0,timeMode:void 0}}function B(e){const[t,i]=function(e,t="Rights/License",i="none"){let r=null;const n=[],o=Array.isArray(e)?e:[e];for(const s of o){const e=s?F(s):void 0;!e||-1===e.indexOf("creativecommons.org")&&-1===e.indexOf("rightsstatements.org")?e&&n.push({label:{[i]:[t]},value:{[i]:[e]}}):r=e.startsWith("https://")?`http://${e.slice(8)}`:e}return[r,n]}(e.license),r=[...e.metadata?(n=e.metadata,n?n.map((e=>({label:k(e.label),value:k(e.value)}))):[]):[],...i];var n;return{rights:t,metadata:r.length?r:void 0,label:e.label?k(e.label):void 0,requiredStatement:e.attribution?{label:k(j),value:k(e.attribution)}:void 0,navDate:e.navDate,summary:e.description?k(e.description):void 0,thumbnail:e.thumbnail}}function D(e){if(!e.within)return;const t=Array.isArray(e.within)?e.within:[e.within],i=[];for(const r of t)"string"==typeof r?r&&"sc:Manifest"===e["@type"]&&i.push({id:r,type:"Collection"}):r["@id"]&&i.push({id:r["@id"],type:L(r)});return i.length?i:void 0}function H(e){const t=e.related?Array.isArray(e.related)?e.related:[e.related]:[],i=e.contentLayer;return{provider:e.logo||t.length?[{id:O,type:"Agent",homepage:t.length?[t[0]]:void 0,logo:e.logo?Array.isArray(e.logo)?e.logo:[e.logo]:void 0,label:k(R)}]:void 0,partOf:D(e),rendering:e.rendering,seeAlso:e.seeAlso,start:e.startCanvas,service:e.service?(r=e.service,Array.isArray(r)?r:[r]):void 0,supplementary:i?[i]:void 0};var r}function U(e){const t=e;return E({...z(t),...B(t),...H(t),...(i=t,{chars:i.chars,format:i.format?i.format:void 0,language:i.language})});var i}const Q=new C({collection:[function(e){return E({...z(e),...B(e),...H(e),items:e.members})}],manifest:[function(e){const t=[],i=[];for(const n of e.sequences||[])n.canvases.length&&t.push(...n.canvases),n.behavior&&i.push(...n.behavior);const r=z(e);return i.length&&(r.behavior?r.behavior.push(...i):r.behavior=i),E({...r,...B(e),...H(e),items:t,structures:e.structures})}],canvas:[function(e){return E({...z(e),...B(e),...H(e),annotations:e.otherContent&&e.otherContent.length?e.otherContent:void 0,items:e.images&&e.images.length?[{id:q(e,"annotation-page"),type:"AnnotationPage",items:e.images}]:void 0})}],annotationList:[function(e){return E({...z(e),...B(e),...H(e),items:e.resources&&e.resources.length?e.resources:void 0})}],sequence:[function(e){return e.canvases&&0!==e.canvases.length?{canvases:e.canvases,behavior:e.viewingHint?[e.viewingHint]:[]}:{canvases:[],behavior:[]}}],annotation:[function(e){return E({...z(e),...B(e),...H(e),target:function e(t){if(Array.isArray(t)){if(t.length>1)return{type:"List",items:t.map(e)};t=t[0]}if("string"==typeof t)return encodeURI(t).trim();if("@type"in t){let e;if("string"==typeof t.full)e=t.full;else if("dctypes:Image"===t.full["@type"])e={id:t.full["@id"],type:"Image"};else{if("sc:Canvas"!==t.full["@type"])throw new Error(`Unsupported source type on annotation: ${t.full["@type"]}`);e={id:t.full["@id"],type:"Canvas"}}return{type:"SpecificResource",source:e,selector:N(t.selector)}}return encodeURI(t["@id"]).trim()}(e.on),body:Array.isArray(e.resource)?e.resource.map(U):U(e.resource)})}],contentResource:[U],choice:[function(e){const t=[];return e.default&&"rdf:nil"!==e.default&&t.push(e.default),e.item&&"rdf:nil"!==e.item&&t.push(...e.item),{...z(e),...B(e),items:t}}],range:[function(e){return E({...z(e),...B(e),...H(e),items:e.members})}],service:[function(e){const{"@id":t,"@type":i,"@context":r,profile:n,...o}=e,s={};return t&&(s["@id"]=t),s["@type"]=L(e),"unknown"===s["@type"]&&(r&&r.length&&(s["@context"]=r),s["@type"]="Service"),n&&(s.profile=I(n)),E({...s,...o})}],layer:[function(e){return E({...z(e),...B(e),...H(e)})}]});function N(e){if((Array.isArray(e["@type"])&&e["@type"].includes("oa:SvgSelector")||"oa:SvgSelector"==e["@type"])&&("chars"in e||"value"in e))return{type:"SvgSelector",value:"chars"in e?e.chars:e.value};if("oa:FragmentSelector"===e["@type"])return{type:"FragmentSelector",value:e.value};if("oa:Choice"===e["@type"])return[N(e.default),...(Array.isArray(e.item)?e.item:[e.item]).map(N)];if("iiif:ImageApiSelector"==e["@type"])return{type:"ImageApiSelector",region:"region"in e?e.region:void 0,rotation:"rotation"in e?e.rotation:void 0};throw new Error(`Unsupported selector type: ${e["@type"]}`)}const V=function(e){return e&&e["@context"]&&("http://iiif.io/api/presentation/2/context.json"===e["@context"]||-1!==e["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")||"http://www.shared-canvas.org/ns/context.json"===e["@context"])||"http://iiif.io/api/image/2/context.json"===e["@context"]?Q.traverseUnknown(e):e};e.upgrade=V,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}(bt);const Ct=n.createContext({currentResourceId:void 0,error:null,isLoaded:!1,orientation:"vertical",resource:void 0});function jt(){return n.useContext(Ct)}function Ot(e){const{currentResourceId:t,orientation:i,onLoad:r,overrides:o}=e,[s,a]=n.useState(),c=n.useMemo((()=>{if(!o||!s)return s;const e=Object.fromEntries(Object.entries(o).filter((([,e])=>void 0!==e)));return Object.assign({},s,e||{})}),[s,...Object.values(o||{})]),[u,l]=n.useState(!1);n.useEffect((()=>{if(e.resource){if("string"==typeof e.resource){const n=new AbortController;return(t=e.resource,i={signal:n.signal},fetch(t,i).then((e=>e.json())).then(At.exports.upgrade)).then((e=>{a(e),r&&r(e)})).catch((e=>l(e))),()=>{n.abort()}}var t,i;a(e.resource),r&&r(e.resource)}}),[e.resource]);const f=n.useMemo((()=>({resource:c,error:u,isLoaded:!!s,orientation:i,currentResourceId:t})),[c,u,i,t]);return J(Ct.Provider,{value:f,children:e.children})}const Rt=({item:e,onClick:t})=>{const i=function(e=Z,t={}){const i=t.imageServiceLoader||new yt;return{getBestThumbnailAtSize:async function t(r,n,o,s=[],a){const c=()=>i.getThumbnailFromResource(void 0,n,o,s);if(!r)return await i.getThumbnailFromResource(void 0,n,o,s);if("string"==typeof r){const e=ze(r);return e&&s.push(e),await i.getThumbnailFromResource(void 0,n,o,s)}const u=e.get(r,{skipSelfReturn:!1});if("string"==typeof u)return{best:ze(u),fallback:[],log:[]};if(!u)return await c();switch(await(async t=>{if(t&&t.thumbnail&&t.thumbnail.length){const r=e.get(t.thumbnail[0]),n=await i.getImageCandidates(r,o);n&&n.length&&s.push(...n)}})(u),u.type){case"Annotation":{const t=Array.isArray(u.body)?u.body:[u.body],r=e.get(t[0]);return a&&!r.width&&(r.width=a.width,r.height=a.height),await i.getThumbnailFromResource(r,n,o,s)}case"Canvas":{const e=u;return t(e.items[0],n,o,s,{width:e.width,height:e.height})}case"AnnotationPage":return t(u.items[0],n,o,s,a);case"Choice":{const e=u;return!e.items||e.items[0]?await c():t(e.items[0],n,o,s,a)}case"Collection":{const e=u.items[0];return e?t(e,n,o,s,a):await c()}case"Manifest":{const e=u.items[0];return e?t(e,n,o,s,a):await c()}case"SpecificResource":case"Image":case"Dataset":case"Sound":case"Text":case"TextualBody":case"Video":return a&&!u.width&&(u.width=a.width,u.height=a.height),i.getThumbnailFromResource(u,n,o,s);case"Service":case"Range":case"AnnotationCollection":case"CanvasReference":case"ContentResource":return await c()}return await c()}}}(),[r,o]=n.useState(),{resource:s}=jt(),a=(null==s?void 0:s.thumbnailSize)||200;return n.useEffect((()=>{e&&async function(){const t=await i.getBestThumbnailAtSize(e,{width:a,height:a});o(t.best)}()}),[e]),J("button",{"data-testid":"thumbnail-wrapper",onClick:()=>{t&&t(null==s?void 0:s.id)},children:Y("figure",{children:[J("div",{style:{backgroundColor:"#f0f0f0",width:`${a}px`,height:`${a}px`,objectFit:"contain"},children:r?J("img",{src:r.id,alt:"",style:{maxWidth:"100%",maxHeight:"100%"},"data-testid":"thumb-image"}):J(V,{})}),J("figcaption",{children:e.id})]})})},kt={},It={get:e=>e,setMetaValue([e,t,i],r){const n=It.getResourceMeta(e,t),o=n?n[i]:void 0,s="function"==typeof r?r(o):r;kt[e]={...kt[e]||{},[t]:{...(kt[e]||{})[t]||{},[i]:s}}},getResourceMeta:(e,t)=>{const i=kt[e];if(i)return t?i[t]:i}};function $t(e,t){const i=[];for(const r of t.items)if("Canvas"===r.type&&(-1!==r.id.indexOf("#")?i.push({id:r.id.split("#")[0],type:"Canvas"}):i.push(r)),"Range"===r.type&&i.push(...$t(e,e.get(r))),"SpecificResource"===r.type){const e="string"==typeof r.source?r.source:r.source.id;i.push({id:e,type:"Canvas"})}return i}function Tt(e=It){return{getVisibleCanvasesFromCanvasId:(t,i,r=!1)=>function(e=It,t,i,r=!1){const n=t.behavior||[],o=i?e.get(i):null;if(!o)return[];const s=o.behavior||[],a=!r&&n.includes("paged"),c=!a&&n.includes("continuous"),u=!a&&!c&&n.includes("individuals"),l=s.includes("facing-pages"),f=s.includes("non-paged");if(l||f||u||r)return[{id:o.id,type:"Canvas"}];const[h,p]=Lt(e,t);if(c)return h;const d=h.findIndex((e=>e.id===i));if(-1===d)return[];for(const v of p)if(v.includes(d))return v.map((e=>h[e]));return[{id:o.id,type:"Canvas"}]}(e,t,i,r),getManifestSequence:(t,i={})=>Lt(e,t,i)}}function Lt(e=It,t,{disablePaging:i,skipNonPaged:r}={}){const n=t.behavior||[],o=n.includes("paged"),s=!o&&n.includes("continuous"),a=!o&&!s&&n.includes("individuals"),c="Manifest"===t.type?t.items:$t(e,t);if(s)return[c,[c.map(((e,t)=>t))]];if(a||!o||i)return[c,c.map(((e,t)=>[t]))];const u=[];let l=[];const f=()=>{l.length&&(u.push([...l]),l=[])};let h=0,p=!1;for(let d=0;d<c.length;d++){const t=e.get(c[d]).behavior||[];t.includes("non-paged")?(d===h&&h++,r||(f(),u.push([d]),f())):d===h||t.includes("facing-pages")?(l.length&&(p=!0),f(),u.push([d]),f()):(l.push(d),p?(f(),p=!1):l.length>1&&f())}return l.length&&f(),[c,u]}const _t=({onResourceChanged:e})=>{const{resource:t,isLoaded:i,currentResourceId:r,orientation:o}=jt(),s=Tt(),[a,c]=n.useMemo((()=>{if(!t)return[];const[e,i]=s.getManifestSequence(t,{disablePaging:!1});return[e,i]}),[t]);if(!(i&&t&&c&&a))return J(V,{});const u="left-to-right"===t.viewingDirection?"ltr":"rtl",l=e=>{var t,i;if(40===e.keyCode){const r=1+Number(e.currentTarget.getAttribute("data-index"));(null==(i=null==(t=e.currentTarget.parentElement)?void 0:t.parentElement)?void 0:i.querySelector(`div[data-index="${r}"]`)).focus()}},f=e=>c.findIndex((e=>{const t=a.findIndex((e=>e.id===r));return e.includes(t)}))===e;return Y("div",{dir:u,"thumbnail-panel":"","data-orientation":o,children:[J("h3",{children:xt(t.label)}),J("span",{children:o}),c.map(((t,i)=>J("div",{"thumbnail-group":"","data-selected":f(i),children:t.map(((t,i)=>{var n;return J("div",{"thumbnail-item":"",tabIndex:0===t?0:-1,"data-index":t,onKeyDown:l,"data-selected":r===(null==(n=a[t])?void 0:n.id),children:J(Rt,{item:a[t],onClick:()=>{var i;e&&e(null==(i=a[t])?void 0:i.id)}},t)},i)}))},i)))]})};e.Thumbnail=Rt,e.ThumbnailPanel=({iiifContent:e,orientation:t,currentResourceId:i,overrides:r,onLoad:n,onResourceChanged:o})=>J(Ot,{resource:e,overrides:r,orientation:t,currentResourceId:i,onLoad:n,children:J(_t,{onResourceChanged:o})}),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=index.umd.js.map
