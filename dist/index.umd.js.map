{"version":3,"file":"index.umd.js","sources":["../node_modules/react/cjs/react.production.min.js","../node_modules/react/index.js","../node_modules/react/cjs/react-jsx-runtime.production.min.js","../node_modules/react/jsx-runtime.js","../node_modules/@iiif/vault-helpers/dist/esm/index.mjs","../node_modules/@iiif/vault-helpers/dist/fetch/esm/fetch.mjs","../src/context/IIIFResourceContext.tsx","../src/components/Thumbnail.tsx","../node_modules/@iiif/vault-helpers/dist/sequences/esm/sequences.mjs","../src/components/ThumbnailPanel.tsx"],"sourcesContent":["/**\n * @license React\n * react.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var l=Symbol.for(\"react.element\"),n=Symbol.for(\"react.portal\"),p=Symbol.for(\"react.fragment\"),q=Symbol.for(\"react.strict_mode\"),r=Symbol.for(\"react.profiler\"),t=Symbol.for(\"react.provider\"),u=Symbol.for(\"react.context\"),v=Symbol.for(\"react.forward_ref\"),w=Symbol.for(\"react.suspense\"),x=Symbol.for(\"react.memo\"),y=Symbol.for(\"react.lazy\"),z=Symbol.iterator;function A(a){if(null===a||\"object\"!==typeof a)return null;a=z&&a[z]||a[\"@@iterator\"];return\"function\"===typeof a?a:null}\nvar B={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,D={};function E(a,b,e){this.props=a;this.context=b;this.refs=D;this.updater=e||B}E.prototype.isReactComponent={};\nE.prototype.setState=function(a,b){if(\"object\"!==typeof a&&\"function\"!==typeof a&&null!=a)throw Error(\"setState(...): takes an object of state variables to update or a function which returns an object of state variables.\");this.updater.enqueueSetState(this,a,b,\"setState\")};E.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,\"forceUpdate\")};function F(){}F.prototype=E.prototype;function G(a,b,e){this.props=a;this.context=b;this.refs=D;this.updater=e||B}var H=G.prototype=new F;\nH.constructor=G;C(H,E.prototype);H.isPureReactComponent=!0;var I=Array.isArray,J=Object.prototype.hasOwnProperty,K={current:null},L={key:!0,ref:!0,__self:!0,__source:!0};\nfunction M(a,b,e){var d,c={},k=null,h=null;if(null!=b)for(d in void 0!==b.ref&&(h=b.ref),void 0!==b.key&&(k=\"\"+b.key),b)J.call(b,d)&&!L.hasOwnProperty(d)&&(c[d]=b[d]);var g=arguments.length-2;if(1===g)c.children=e;else if(1<g){for(var f=Array(g),m=0;m<g;m++)f[m]=arguments[m+2];c.children=f}if(a&&a.defaultProps)for(d in g=a.defaultProps,g)void 0===c[d]&&(c[d]=g[d]);return{$$typeof:l,type:a,key:k,ref:h,props:c,_owner:K.current}}\nfunction N(a,b){return{$$typeof:l,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function O(a){return\"object\"===typeof a&&null!==a&&a.$$typeof===l}function escape(a){var b={\"=\":\"=0\",\":\":\"=2\"};return\"$\"+a.replace(/[=:]/g,function(a){return b[a]})}var P=/\\/+/g;function Q(a,b){return\"object\"===typeof a&&null!==a&&null!=a.key?escape(\"\"+a.key):b.toString(36)}\nfunction R(a,b,e,d,c){var k=typeof a;if(\"undefined\"===k||\"boolean\"===k)a=null;var h=!1;if(null===a)h=!0;else switch(k){case \"string\":case \"number\":h=!0;break;case \"object\":switch(a.$$typeof){case l:case n:h=!0}}if(h)return h=a,c=c(h),a=\"\"===d?\".\"+Q(h,0):d,I(c)?(e=\"\",null!=a&&(e=a.replace(P,\"$&/\")+\"/\"),R(c,b,e,\"\",function(a){return a})):null!=c&&(O(c)&&(c=N(c,e+(!c.key||h&&h.key===c.key?\"\":(\"\"+c.key).replace(P,\"$&/\")+\"/\")+a)),b.push(c)),1;h=0;d=\"\"===d?\".\":d+\":\";if(I(a))for(var g=0;g<a.length;g++){k=\na[g];var f=d+Q(k,g);h+=R(k,b,e,f,c)}else if(f=A(a),\"function\"===typeof f)for(a=f.call(a),g=0;!(k=a.next()).done;)k=k.value,f=d+Q(k,g++),h+=R(k,b,e,f,c);else if(\"object\"===k)throw b=String(a),Error(\"Objects are not valid as a React child (found: \"+(\"[object Object]\"===b?\"object with keys {\"+Object.keys(a).join(\", \")+\"}\":b)+\"). If you meant to render a collection of children, use an array instead.\");return h}\nfunction S(a,b,e){if(null==a)return a;var d=[],c=0;R(a,d,\"\",\"\",function(a){return b.call(e,a,c++)});return d}function T(a){if(-1===a._status){var b=a._result;b=b();b.then(function(b){if(0===a._status||-1===a._status)a._status=1,a._result=b},function(b){if(0===a._status||-1===a._status)a._status=2,a._result=b});-1===a._status&&(a._status=0,a._result=b)}if(1===a._status)return a._result.default;throw a._result;}\nvar U={current:null},V={transition:null},W={ReactCurrentDispatcher:U,ReactCurrentBatchConfig:V,ReactCurrentOwner:K};exports.Children={map:S,forEach:function(a,b,e){S(a,function(){b.apply(this,arguments)},e)},count:function(a){var b=0;S(a,function(){b++});return b},toArray:function(a){return S(a,function(a){return a})||[]},only:function(a){if(!O(a))throw Error(\"React.Children.only expected to receive a single React element child.\");return a}};exports.Component=E;exports.Fragment=p;\nexports.Profiler=r;exports.PureComponent=G;exports.StrictMode=q;exports.Suspense=w;exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W;\nexports.cloneElement=function(a,b,e){if(null===a||void 0===a)throw Error(\"React.cloneElement(...): The argument must be a React element, but you passed \"+a+\".\");var d=C({},a.props),c=a.key,k=a.ref,h=a._owner;if(null!=b){void 0!==b.ref&&(k=b.ref,h=K.current);void 0!==b.key&&(c=\"\"+b.key);if(a.type&&a.type.defaultProps)var g=a.type.defaultProps;for(f in b)J.call(b,f)&&!L.hasOwnProperty(f)&&(d[f]=void 0===b[f]&&void 0!==g?g[f]:b[f])}var f=arguments.length-2;if(1===f)d.children=e;else if(1<f){g=Array(f);\nfor(var m=0;m<f;m++)g[m]=arguments[m+2];d.children=g}return{$$typeof:l,type:a.type,key:c,ref:k,props:d,_owner:h}};exports.createContext=function(a){a={$$typeof:u,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null};a.Provider={$$typeof:t,_context:a};return a.Consumer=a};exports.createElement=M;exports.createFactory=function(a){var b=M.bind(null,a);b.type=a;return b};exports.createRef=function(){return{current:null}};\nexports.forwardRef=function(a){return{$$typeof:v,render:a}};exports.isValidElement=O;exports.lazy=function(a){return{$$typeof:y,_payload:{_status:-1,_result:a},_init:T}};exports.memo=function(a,b){return{$$typeof:x,type:a,compare:void 0===b?null:b}};exports.startTransition=function(a){var b=V.transition;V.transition={};try{a()}finally{V.transition=b}};exports.unstable_act=function(){throw Error(\"act(...) is not supported in production builds of React.\");};\nexports.useCallback=function(a,b){return U.current.useCallback(a,b)};exports.useContext=function(a){return U.current.useContext(a)};exports.useDebugValue=function(){};exports.useDeferredValue=function(a){return U.current.useDeferredValue(a)};exports.useEffect=function(a,b){return U.current.useEffect(a,b)};exports.useId=function(){return U.current.useId()};exports.useImperativeHandle=function(a,b,e){return U.current.useImperativeHandle(a,b,e)};\nexports.useInsertionEffect=function(a,b){return U.current.useInsertionEffect(a,b)};exports.useLayoutEffect=function(a,b){return U.current.useLayoutEffect(a,b)};exports.useMemo=function(a,b){return U.current.useMemo(a,b)};exports.useReducer=function(a,b,e){return U.current.useReducer(a,b,e)};exports.useRef=function(a){return U.current.useRef(a)};exports.useState=function(a){return U.current.useState(a)};exports.useSyncExternalStore=function(a,b,e){return U.current.useSyncExternalStore(a,b,e)};\nexports.useTransition=function(){return U.current.useTransition()};exports.version=\"18.2.0\";\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react.production.min.js');\n} else {\n  module.exports = require('./cjs/react.development.js');\n}\n","/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","const metaState = {};\nconst compatVault = {\n  get(nonRef) {\n    return nonRef;\n  },\n  setMetaValue([id, meta, key], value) {\n    const oldValue = compatVault.getResourceMeta(id, meta);\n    const oldValueItem = oldValue ? oldValue[key] : void 0;\n    const newValue = typeof value === \"function\" ? value(oldValueItem) : value;\n    metaState[id] = {\n      ...metaState[id] || {},\n      [meta]: {\n        ...(metaState[id] || {})[meta] || {},\n        [key]: newValue\n      }\n    };\n  },\n  getResourceMeta: (resource, metaKey) => {\n    const resourceMeta = metaState[resource];\n    if (!resourceMeta) {\n      return void 0;\n    }\n    if (!metaKey) {\n      return resourceMeta;\n    }\n    return resourceMeta[metaKey];\n  }\n};\nfunction createEventsHelper(vault = compatVault) {\n  return {\n    addEventListener(resource, event, listener, scope) {\n      if (!resource) {\n        return;\n      }\n      vault.setMetaValue(\n        [resource.id, \"eventManager\", event],\n        (registeredCallbacks) => {\n          const callbacks = registeredCallbacks || [];\n          for (const registered of callbacks) {\n            if (registered.callback === listener) {\n              return callbacks;\n            }\n          }\n          return [...callbacks, { callback: listener, scope }];\n        }\n      );\n      return listener;\n    },\n    removeEventListener(resource, event, listener) {\n      if (!resource) {\n        return;\n      }\n      vault.setMetaValue(\n        [resource.id, \"eventManager\", event],\n        (registeredCallbacks) => {\n          return (registeredCallbacks || []).filter((registeredCallback) => registeredCallback.callback !== listener);\n        }\n      );\n    },\n    getListenersAsProps(resourceOrId, scope) {\n      const resource = typeof resourceOrId === \"string\" ? { id: resourceOrId } : resourceOrId;\n      if (!resource || !resource.id) {\n        return {};\n      }\n      const hooks = vault.getResourceMeta(resource.id, \"eventManager\");\n      const props = {};\n      if (hooks && resource) {\n        for (const hook of Object.keys(hooks)) {\n          props[hook] = (e) => {\n            const fullResource = vault.get(resource);\n            for (const { callback, scope: _scope } of hooks[hook] || []) {\n              if (!_scope || scope && _scope.indexOf(scope) !== -1) {\n                callback(e, fullResource);\n              }\n            }\n          };\n        }\n      }\n      return props;\n    }\n  };\n}\nfunction createStylesHelper(vault = compatVault) {\n  return {\n    applyStyles(resource, scope, styles) {\n      const id = typeof resource === \"string\" ? resource : resource.id;\n      return vault.setMetaValue([id, \"styles\", scope], styles);\n    },\n    getAppliedStyles(resource) {\n      const id = typeof resource === \"string\" ? resource : resource.id;\n      return vault.getResourceMeta(id, \"styles\");\n    }\n  };\n}\nfunction p(i) {\n  return i.endsWith(\"info.json\") ? i : i.endsWith(\"/\") ? `${i}info.json` : `${i}/info.json`;\n}\nconst te = \"http://library.stanford.edu/iiif/image-api/compliance.html#level0\", z = \"http://library.stanford.edu/iiif/image-api/compliance.html#level1\", A = \"http://library.stanford.edu/iiif/image-api/compliance.html#level2\", ne = \"http://library.stanford.edu/iiif/image-api/conformance.html#level0\", E = \"http://library.stanford.edu/iiif/image-api/conformance.html#level1\", b = \"http://library.stanford.edu/iiif/image-api/conformance.html#level2\", re = \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0\", L = \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1\", M = \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2\", se = \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0\", W = \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1\", j = \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2\", ae = \"http://iiif.io/api/image/1/level0.json\", oe = \"http://iiif.io/api/image/1/profiles/level0.json\", $ = \"http://iiif.io/api/image/1/level1.json\", C = \"http://iiif.io/api/image/1/profiles/level1.json\", P = \"http://iiif.io/api/image/1/level2.json\", B = \"http://iiif.io/api/image/1/profiles/level2.json\", fe = \"http://iiif.io/api/image/2/level0.json\", le = \"http://iiif.io/api/image/2/profiles/level0.json\", N = \"http://iiif.io/api/image/2/level1.json\", R = \"http://iiif.io/api/image/2/profiles/level1.json\", H = \"http://iiif.io/api/image/2/level2.json\", T = \"http://iiif.io/api/image/2/profiles/level2.json\", he = \"level0\", G = \"level1\", k = \"level2\", ue = \"http://iiif.io/api/image/2/level0\", Q = \"http://iiif.io/api/image/2/level1\", V = \"http://iiif.io/api/image/2/level2\", D = [V, A, b, M, j, P, B, H, T, k], U = [...D, Q, z, E, L, W, $, C, N, R, G], J = [ue, Q, V, te, z, A, ne, E, b, re, L, M, se, W, j, ae, oe, $, C, P, B, fe, le, N, R, H, T, he, G, k], ce = { extraFormats: [\"jpg\"], extraQualities: [\"default\"], extraFeatures: [\"sizeByWhListed\"] }, de = { extraFormats: [\"jpg\"], extraQualities: [\"default\"], extraFeatures: [\"baseUriRedirect\", \"cors\", \"jsonldMediaType\", \"regionByPx\", \"regionSquare\", \"sizeByWhListed\", \"sizeByH\", \"sizeByW\", \"sizeByWh\"] }, ge = { extraFormats: [\"jpg\", \"png\"], extraQualities: [\"default\"], extraFeatures: [\"baseUriRedirect\", \"cors\", \"jsonldMediaType\", \"regionByPct\", \"regionByPx\", \"regionSquare\", \"rotationBy90s\", \"sizeByWhListed\", \"sizeByConfinedWh\", \"sizeByH\", \"sizeByPct\", \"sizeByW\", \"sizeByWh\"] };\nfunction pe(i) {\n  return D.indexOf(i) !== -1 ? ge : U.indexOf(i) !== -1 ? de : ce;\n}\nfunction K(i) {\n  const e = i ? Array.isArray(i.profile) ? i.profile : [i.profile] : [], t = { extraQualities: [], extraFormats: [], extraFeatures: [] };\n  for (let n of e)\n    if (typeof n == \"string\" && (n = pe(n)), !!n) {\n      if (n.formats)\n        for (const r of n.formats)\n          t.extraFormats.indexOf(r) === -1 && t.extraFormats.push(r);\n      if (n.qualities)\n        for (const r of n.qualities)\n          t.extraQualities.indexOf(r) === -1 && t.extraQualities.push(r);\n      if (n.supports)\n        for (const r of n.supports)\n          t.extraFeatures.indexOf(r) === -1 && t.extraFeatures.push(r);\n      if (n.maxHeight && (t.maxHeight = n.maxHeight), n.maxWidth && (t.maxWidth = n.maxWidth), n.maxArea && (t.maxArea = n.maxArea), n.extraFormats)\n        for (const r of n.extraFormats)\n          t.extraFormats.indexOf(r) === -1 && t.extraFormats.push(r);\n      if (n.extraQualities)\n        for (const r of n.extraQualities)\n          t.extraQualities.indexOf(r) === -1 && t.extraQualities.push(r);\n      if (n.extraFeatures)\n        for (const r of n.extraFeatures)\n          t.extraFeatures.indexOf(r) === -1 && t.extraFeatures.push(r);\n      n.maxHeight && (t.maxHeight = n.maxHeight), n.maxWidth && (t.maxWidth = n.maxWidth), n.maxArea && (t.maxArea = n.maxArea);\n    }\n  if (i.extraFormats)\n    for (const n of i.extraFormats)\n      t.extraFormats.indexOf(n) === -1 && t.extraFormats.push(n);\n  if (i.extraFeatures)\n    for (const n of i.extraFeatures)\n      t.extraFeatures.indexOf(n) === -1 && t.extraFeatures.push(n);\n  if (i.extraQualities)\n    for (const n of i.extraQualities)\n      t.extraQualities.indexOf(n) === -1 && t.extraQualities.push(n);\n  return t;\n}\nfunction me(i) {\n  try {\n    if (i === \"full\")\n      return { full: true };\n    if (i === \"square\")\n      return { square: true };\n    const e = i.startsWith(\"pct:\"), n = i.substr(e ? 4 : 0).split(\",\").map((r) => parseFloat(r));\n    return { x: n[0], y: n[1], w: n[2], h: n[3], percent: e };\n  } catch {\n    throw new Error(\"Expected 'full', 'square' or 'x,y,w,h'. Found \" + i);\n  }\n}\nfunction xe(i) {\n  const e = { upscaled: false, max: false, confined: false };\n  if (i[0] === \"^\" && (e.upscaled = true, i = i.slice(1)), i === \"max\" || i === \"full\")\n    return e.max = true, e.serialiseAsFull = i === \"full\", e;\n  if (i[0] === \"!\" && (e.confined = true, i = i.slice(1)), i[0] === \"p\")\n    return e.percentScale = parseFloat(i.slice(4)), e;\n  const t = i.split(\",\").map((n) => n.trim());\n  return t.length && (t[0] !== \"\" && (e.width = parseInt(t[0], 10)), t[1] !== \"\" ? (e.height = parseInt(t[1], 10), e.version = 2) : e.version = 3), e;\n}\nfunction Ie(i) {\n  const e = { angle: 0 };\n  if (i[0] === \"!\" && (e.mirror = true, i = i.substr(1)), e.angle = parseFloat(i) % 360, Number.isNaN(e.angle))\n    throw new Error(`Invalid rotation ${i}`);\n  return e;\n}\nfunction ye(i, e = \"\") {\n  const t = i.match(/^(([a-zA-Z]+):\\/\\/([^/]+))?((.*)+)/);\n  if (!t)\n    throw new Error(`Invalid or unknown input ${i}`);\n  const n = t[2], r = t[3];\n  let s = t[4];\n  if (s[0] === \"/\" && (s = s.substr(1)), e.length > 0) {\n    if (e[0] === \"/\" && (e = e.substr(1)), e !== s.substr(0, e.length))\n      throw new Error(`Path does not start with prefix (path: ${s}, prefix: ${e})`);\n    s = s.substr(e.length);\n  }\n  return { scheme: n, server: r, path: s, prefix: e };\n}\nfunction _e(i, e = \"\") {\n  const { path: t, scheme: n, server: r, prefix: s } = ye(i, e), a = t.split(\"/\").reverse(), [o, f, u, l, ...d] = a, g = d.reverse().filter(Boolean).join(\"/\");\n  if (a.length === 1 || o === \"\")\n    return { type: \"base\", scheme: n, server: r, prefix: s, identifier: g };\n  if (o === \"info.json\") {\n    const [, ...c] = a;\n    return { type: \"info\", scheme: n, server: r, prefix: s, identifier: c.reverse().filter(Boolean).join(\"/\") };\n  }\n  const m = o.split(\".\");\n  return { type: \"image\", scheme: n, server: r, prefix: s, identifier: g, originalPath: t, region: me(l), size: xe(u), rotation: Ie(f), quality: m[0], format: m[1] };\n}\nfunction we(i) {\n  const e = _e(p(i.id));\n  if (e.type !== \"info\")\n    throw new Error(\"Invalid service URL\");\n  const t = K(i);\n  return { identifier: e.identifier, originalPath: \"\", server: e.server, prefix: e.prefix, scheme: e.scheme, type: \"image\", quality: t.extraQualities.indexOf(\"default\") === -1 ? t.extraQualities[0] : \"default\", region: { full: true }, size: { max: true, upscaled: false, confined: false }, format: \"jpg\", rotation: { angle: 0 } };\n}\nfunction Se(i, e, t) {\n  const n = t.length, r = [];\n  for (let s = 0; s < n; s++) {\n    const o = t[s].width;\n    r.push(i / o);\n  }\n  return r;\n}\nfunction ve(i, e, t) {\n  const n = t.length, r = [];\n  for (let s = 0; s < n; s++) {\n    const a = t[s];\n    r.push({ width: Math.floor(i / a), height: Math.floor(e / a) });\n  }\n  return r;\n}\nfunction h(i) {\n  if (i[\"@id\"])\n    return i[\"@id\"];\n  if (i.id)\n    return i.id;\n}\nfunction w(i) {\n  if (!i || !i.profile || !h(i))\n    return false;\n  const e = Array.isArray(i.profile) ? i.profile : [i.profile];\n  for (const t of e)\n    if (typeof t == \"string\" && J.indexOf(t) !== -1)\n      return true;\n  return false;\n}\nfunction Fe(i) {\n  if (!w(i))\n    return false;\n  const e = Array.isArray(i.profile) ? i.profile : [i.profile];\n  for (const t of e)\n    if (typeof t == \"string\") {\n      if (U.indexOf(t) !== -1)\n        return true;\n    } else {\n      const n = [...t.supports || [], ...t.extraFeatures || []];\n      if (n.indexOf(\"regionByPx\") !== -1 && (n.indexOf(\"sizeByW\") !== -1 || n.indexOf(\"sizeByWh\") !== -1))\n        return true;\n    }\n  return false;\n}\nfunction v(i, e) {\n  if (e && e.profile) {\n    const t = e.profile;\n    if (t) {\n      const n = Array.isArray(t) ? t : [t];\n      return n.includes(`level${i}`) || n.includes(`http://iiif.io/api/image/2/level${i}.json`) || n.includes(`http://iiif.io/api/image/1/level${i}.json`) || n.includes(`http://iiif.io/api/image/1/profiles/level${i}.json`);\n    }\n  }\n  return false;\n}\nfunction F(i) {\n  return w(i) ? v(0, i) ? 0 : v(1, i) ? 1 : v(2, i) ? 2 : null : null;\n}\nfunction X(i) {\n  return (i[\"@context\"] ? Array.isArray(i[\"@context\"]) ? i[\"@context\"] : [i[\"@context\"]] : []).indexOf(\"http://iiif.io/api/image/3/context.json\") !== -1;\n}\nfunction Oe(i) {\n  if (!Fe(i))\n    return [];\n  const e = [], t = Array.isArray(i.profile) ? i.profile : [i.profile], n = t.length;\n  for (let r = 0; r < n; r++) {\n    const s = t[r];\n    if (typeof s != \"string\" && (s.maxHeight || s.maxWidth))\n      return [{ id: h(i), type: \"variable\", minWidth: 0, minHeight: 0, maxHeight: s.maxHeight || s.maxWidth, maxWidth: s.maxWidth || s.maxHeight, level: F(i), version: i[\"@context\"] === \"http://iiif.io/api/image/3/context.json\" ? 3 : 2 }];\n  }\n  if (i.tiles) {\n    const r = i.tiles.length;\n    for (let s = 0; s < r; s++) {\n      const a = i.tiles[s];\n      (a.height || a.width) && e.push({ id: h(i), type: \"variable\", minHeight: 0, minWidth: 0, maxHeight: a.height || a.width, maxWidth: a.width, level: F(i), version: X(i) ? 3 : 2 });\n    }\n  }\n  return e;\n}\nfunction Y(i) {\n  const e = /^.*\\/(full)\\/(((\\d+),(\\d+)?)|max)\\/(\\d+)\\/default\\.(jpg|png|jpeg)$/, t = i.match(e);\n  if (t) {\n    const n = t[1], r = parseInt(t[4], 10), s = parseInt(t[5], 10), a = t[7];\n    if ((n === \"max\" || n === \"full\") && r && s && a)\n      return { type: \"fixed\", id: i, height: s, width: r };\n  }\n  return { type: \"unknown\", id: i };\n}\nfunction ze(i) {\n  if (i[\"@type\"])\n    return i[\"@type\"];\n  if (i.type)\n    return i.type;\n}\nfunction Ae(i) {\n  if (typeof i == \"string\")\n    return Y(i);\n  const e = ze(i);\n  if (e !== \"Image\" && e !== \"sc:Image\")\n    return null;\n  const t = i, n = h(t);\n  return n ? n && t.width && t.height ? { id: n, type: \"fixed\", width: t.width, height: t.height, unsafe: true } : Y(n) : null;\n}\nfunction Ee(i) {\n  return w(i) ? (i && i.sizes ? i.sizes : []).map((e) => ({ id: h(i), type: \"fixed-service\", height: e.height, width: e.width, level: F(i), version: X(i) ? 3 : 2 })) : [];\n}\nfunction q(i) {\n  const e = [], t = i.length;\n  for (let n = 0; n < t; n++) {\n    const r = Ee(i[n]);\n    r.length && e.push(...r);\n    const s = Oe(i[n]);\n    s.length && e.push(...s);\n  }\n  return e;\n}\nfunction ee(i) {\n  const e = i.service ? Array.isArray(i.service) ? i.service : [i.service] : [], t = e.length, n = [];\n  for (let r = 0; r < t; r++)\n    w(e[r]) && n.push(e[r]);\n  return n;\n}\nfunction be(i, e = true, t) {\n  const n = [], r = Ae(i);\n  if (r === null)\n    return n;\n  const s = i;\n  if (n.push(r), e && s.width && s.height) {\n    const a = [], o = ee(s);\n    for (const f of o) {\n      const u = { id: h(f), width: s.width, height: s.height };\n      if (t.canLoadSync(u)) {\n        const l = t.loadServiceSync(u);\n        l && (l.height || (l.height = s.height), l.width || (l.width = s.width), a.push(...q([l])));\n      }\n    }\n    if (a.length)\n      return n.push(...a), n;\n  }\n  return s.service && n.push(...q(s.service)), n;\n}\nfunction Le({ x: i = 0, y: e = 0, w: t, h: n, full: r, square: s, percent: a }) {\n  if (r)\n    return \"full\";\n  if (s)\n    return \"square\";\n  if (typeof t > \"u\" || typeof n > \"u\")\n    throw new Error(\"RegionParameter: invalid region\");\n  const o = `${i},${e},${t},${n}`;\n  return a ? `pct:${o}` : o;\n}\nfunction Me({ max: i, percentScale: e, upscaled: t, confined: n, width: r, height: s, serialiseAsFull: a, version: o }) {\n  const f = [];\n  return t && f.push(\"^\"), i ? (f.push(a ? \"full\" : \"max\"), f.join(\"\")) : (n && f.push(\"!\"), e && f.push(`pct:${e}`), r && f.push(`${r}`), f.push(\",\"), s && o === 3 && f.push(`${s}`), f.join(\"\"));\n}\nfunction We(i) {\n  return `${i.mirror ? \"!\" : \"\"}${(i.angle || 0) % 360}`;\n}\nvar Ve = Object.defineProperty, De = Object.defineProperties, Ue = Object.getOwnPropertyDescriptors, je = Object.getOwnPropertySymbols, Je = Object.prototype.hasOwnProperty, Ze = Object.prototype.propertyIsEnumerable, $e = (i, e, t) => e in i ? Ve(i, e, { enumerable: true, configurable: true, writable: true, value: t }) : i[e] = t, x = (i, e) => {\n  for (var t in e || (e = {}))\n    Je.call(e, t) && $e(i, t, e[t]);\n  if (je)\n    for (var t of je(e))\n      Ze.call(e, t) && $e(i, t, e[t]);\n  return i;\n}, I = (i, e) => De(i, Ue(e));\nfunction Ce(i, e) {\n  const t = i.prefix.startsWith(\"/\") ? i.prefix.substr(1) : i.prefix, n = `${i.scheme}://${i.server}/${t ? `${t}/` : \"\"}${i.identifier}`;\n  if (i.type === \"base\")\n    return n;\n  if (i.type === \"info\")\n    return `${n}/info.json`;\n  let { size: r } = i;\n  const { region: s, rotation: a, format: o, quality: f } = i;\n  if (e) {\n    const u = e[\"@context\"] ? Array.isArray(e[\"@context\"]) ? e[\"@context\"] : [e[\"@context\"]] : [], l = u.indexOf(\"http://iiif.io/api/image/2/context.json\") !== -1, d = u.indexOf(\"http://iiif.io/api/image/3/context.json\") !== -1;\n    if ((r.width === e.width && !r.height || r.height === e.height && !r.width || r.width === e.width && r.height === e.height) && (r = I(x({}, r), { max: true })), l && (r.max && !r.serialiseAsFull && (r = I(x({}, r), { serialiseAsFull: true })), !r.max && r.width && r.height && (r = I(x({}, r), { height: void 0 })), r = I(x({}, r), { version: 2 })), d) {\n      if (r.max && r.serialiseAsFull && (r = I(x({}, r), { serialiseAsFull: false })), r.width && !r.height && e.width && e.height) {\n        const g = e.height / e.width;\n        r = I(x({}, r), { height: Math.ceil(r.width * g) });\n      }\n      r = I(x({}, r), { version: 3 });\n    }\n  }\n  return [n, Le(s), Me(r), We(a), `${f}.${o}`].filter(Boolean).join(\"/\");\n}\nfunction O(i, e, t) {\n  const n = we({ \"@context\": i.version === 3 ? \"http://iiif.io/api/image/3/context.json\" : \"http://iiif.io/api/image/2/context.json\", id: p(h(i)), profile: i.level === null || typeof i.level > \"u\" ? \"level0\" : `level${i.level}}`, type: i.version === 3 ? \"ImageService3\" : \"ImageService2\" });\n  if (n.type !== \"image\")\n    throw new Error(\"Invalid service\");\n  return n.size.max = false, n.size.width = e, n.size.height = t, { id: Ce(n), type: \"fixed\", width: e, height: t || i.height / (i.width || 1) * e, unsafe: i.width > e };\n}\nfunction y(i) {\n  const e = i.replace(/(https?:\\/\\/)?(www.)?/i, \"\");\n  return e.indexOf(\"/\") !== -1 ? e.split(\"/\")[0] : e;\n}\nfunction Pe(i, e, t) {\n  const n = i.width ? i.width : i.maxWidth;\n  return t.height <= i.maxHeight && t.width <= i.maxWidth && t.height >= i.minHeight && t.width >= i.minWidth && (!e || Math.abs(t.width - n) < Math.abs(e.width - n));\n}\nfunction Be(i, e) {\n  const t = [], n = Object.assign({ unsafeImageService: false, atAnyCost: true, fallback: true, minHeight: 64, minWidth: 64, maxHeight: 1 / 0, maxWidth: 1 / 0, returnAllOptions: false, preferFixedSize: false, allowUnsafe: false, explain: false, height: 0, width: 0 }, i), r = (l, d = 0) => n.explain ? t.push(new Array(d).fill(0).map((g) => \"    \").join(\"\") + l().trim()) : void 0, s = [], a = [];\n  let o = null;\n  r(() => `Using configuration: ${JSON.stringify(n, null, 2)}`);\n  const f = (l, d) => {\n    if (r(() => \"Swapping choice\", 3), Pe(n, d, l)) {\n      if (n.preferFixedSize && l.unsafe) {\n        r(() => `We found an image that was marked as unsafe, but it was the best size. (${l.id})`, 4), a.push(l);\n        return;\n      }\n      n.returnAllOptions && d && a.push(d), r(() => `We found a new image that was the best size. (${l.id})`, 4), o = l;\n    } else\n      n.returnAllOptions && a.push(l);\n  };\n  r(() => `The input shows we have ${e.length} list(s) of candidates to choose from.`);\n  const u = e.length;\n  for (let l = 0; l < u; l++) {\n    const d = e[l]();\n    r(() => `Candidate group ${l}: ${JSON.stringify(d, null, 2)}`, 1);\n    const g = d.length;\n    r(() => `Checking candidate list number ${l} and found ${g} potential ways of creating image(s)`, 1);\n    for (let m = 0; m < g; m++) {\n      const c = d[m];\n      if (r(() => `-> Checking candidate ${m}`, 1), c.type === \"unknown\" && n.atAnyCost && (r(() => `We've found an unknown image type, adding this to the \"last resort\" list`, 2), s.push(c)), c.type === \"fixed\" && (c.unsafe ? (r(() => `We've found an unsafe fixed image type, adding this to the \"last resort\" list`, 2), s.push(c)) : (r(() => \"We've found a fixed size image, checking if it matches the request\", 2), f(c, o))), c.type === \"fixed-service\")\n        if (n.unsafeImageService) {\n          r(() => \"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)\", 2);\n          const S = O(c, n.width, n.height);\n          f(S, o);\n        } else {\n          r(() => \"Checking for an image from the tile source 3\", 2);\n          const S = O(c, c.width, c.height);\n          f(S, o);\n        }\n      if (c.type === \"variable\" && c.maxWidth) {\n        const S = O({ id: c.id, type: \"fixed-service\", width: c.maxWidth, height: c.maxWidth, level: c.level, version: c.version }, c.maxWidth);\n        f(S, o);\n      }\n    }\n    if (o && !n.returnAllOptions) {\n      if (o.unsafe || n.allowUnsafe)\n        continue;\n      r(() => `We found a match in choice list number ${l}, no searching any more`);\n      break;\n    }\n  }\n  return n.atAnyCost && a.length === 0 ? (r(() => o ? `We found an image! ${o.id} of type ${o.type}` : 'We found no images, but \"atAnyCost\" is set, so returning that'), { best: o || s[0], fallback: s.slice(1), log: t }) : n.returnAllOptions ? (r(() => \"Returning all options that we have found\"), { best: n.atAnyCost ? o || a[0] || s[0] : o || a[0], fallback: [...a, ...s], log: t }) : (r(() => \"Returning the best image that we found, and a fallback\"), { best: o || a[0] || null, fallback: o ? a : a.slice(1), log: t });\n}\nvar qe = Object.defineProperty, ei = Object.defineProperties, ii = Object.getOwnPropertyDescriptors, Ne = Object.getOwnPropertySymbols, ti = Object.prototype.hasOwnProperty, ni = Object.prototype.propertyIsEnumerable, Re = (i, e, t) => e in i ? qe(i, e, { enumerable: true, configurable: true, writable: true, value: t }) : i[e] = t, ri = (i, e) => {\n  for (var t in e || (e = {}))\n    ti.call(e, t) && Re(i, t, e[t]);\n  if (Ne)\n    for (var t of Ne(e))\n      ni.call(e, t) && Re(i, t, e[t]);\n  return i;\n}, si = (i, e) => ei(i, ii(e));\nfunction He(i, e, t) {\n  const n = i > e ? i : e, r = t.length, s = [];\n  for (let a = 0; a < r; a++) {\n    const o = t[a];\n    let f = o.scaleFactors[0], u = n / f;\n    const l = [f];\n    for (; u >= o.width; )\n      f = f * 2, l.push(f), u = u / 2;\n    s.push(si(ri({}, o), { scaleFactors: l }));\n  }\n  return s;\n}\nfunction Te(i, e) {\n  if (i.length !== e.length)\n    return false;\n  if (i.length === 0 && e.length === 0)\n    return true;\n  const t = i.length;\n  let n = true;\n  for (let s = 0; s < t; s++) {\n    const a = i[s], o = e[s];\n    if (a.width !== o.width || a.height !== o.height) {\n      n = false;\n      break;\n    }\n  }\n  if (n)\n    return true;\n  let r = 0;\n  for (let s = 0; s < t; s++)\n    for (let a = 0; a < t; a++)\n      if (i[s].width === e[a].width && i[s].height === e[a].height) {\n        r++;\n        break;\n      }\n  return r === t;\n}\nfunction Ge(i) {\n  return v(0, i);\n}\nvar _ = (i, e, t) => new Promise((n, r) => {\n  var s = (f) => {\n    try {\n      o(t.next(f));\n    } catch (u) {\n      r(u);\n    }\n  }, a = (f) => {\n    try {\n      o(t.throw(f));\n    } catch (u) {\n      r(u);\n    }\n  }, o = (f) => f.done ? n(f.value) : Promise.resolve(f.value).then(s, a);\n  o((t = t.apply(i, e)).next());\n});\nclass ke {\n  constructor() {\n    this.config = { verificationsRequired: 1, approximateServices: true, enableFetching: true, disableThrottling: false }, this.fetchingCount = 0, this.imageServices = {}, this.knownImageServers = {};\n  }\n  setConfig(e) {\n    Object.assign(this.config, e);\n  }\n  sample(e, t, n = true) {\n    const r = y(h(e)), s = p(h(e)), a = this.knownImageServers[r];\n    return this.imageServices[s] = Object.assign(e, { real: true }), !a && e.tiles && !Ge(e) ? (this.knownImageServers[r] = { verifications: 0, malformed: false, root: r, preLoaded: n, sampledId: h(e), verified: false, server: null, result: { context: e[\"@context\"] || [], sampledProfile: e.profile, resourceServiceRatio: t && e.height ? t.height / e.height : 1, sampledSizes: e.sizes || [], sizeRatios: Se(e.width, e.height, e.sizes || []), sampledTiles: e.tiles || [] } }, true) : this.verify(e);\n  }\n  preLoad(e, t = true) {\n    this.knownImageServers[e.root] = e, t && (this.knownImageServers[e.root].malformed = false, this.knownImageServers[e.root].verifications = this.config.verificationsRequired);\n  }\n  predict(e, t = false, n = false) {\n    const r = e == null ? void 0 : e.source, s = y(h(e)), a = this.knownImageServers[s];\n    if (!a || !a.result || !((r == null ? void 0 : r.height) || e.height) || !((r == null ? void 0 : r.width) || e.width) || !n && (a.malformed || a.verifications < this.config.verificationsRequired) || Ge(e.source))\n      return null;\n    const o = p(h(e));\n    return this.imageServices[o] || (this.imageServices[o] = { \"@context\": a.result.context, \"@id\": h(e), id: h(e), protocol: \"http://iiif.io/api/image\", tiles: (r == null ? void 0 : r.tiles) || He(e.width, e.height, a.result.sampledTiles), sizes: (r == null ? void 0 : r.sizes) || ve(Math.round(e.width / a.result.resourceServiceRatio), Math.round(e.height / a.result.resourceServiceRatio), a.result.sizeRatios), profile: (r == null ? void 0 : r.profile) || a.result.sampledProfile, height: (r == null ? void 0 : r.height) || e.height, width: (r == null ? void 0 : r.width) || e.width, real: false }), this.imageServices[o];\n  }\n  getThumbnailFromResource(e, t) {\n    return _(this, arguments, function* (n, r, s = true, a = []) {\n      const o = n ? yield this.getImageCandidates(n, s) : [];\n      return Be(r, [() => a, () => o]);\n    });\n  }\n  getImageCandidates(e, t = true) {\n    return _(this, null, function* () {\n      const n = e;\n      if (t && n.height && n.width) {\n        const r = ee(n);\n        for (const s of r) {\n          const a = { id: h(s), width: s.width ? s.width : n.width, height: s.height ? s.height : n.height, source: s };\n          yield this.loadService(a);\n        }\n      }\n      return be(e, t, this);\n    });\n  }\n  verify(e) {\n    return _(this, null, function* () {\n      const t = this.predict(e, false, true), n = yield this.fetchService(h(e));\n      if (!t)\n        return false;\n      const r = t.height === n.height && t.width === n.width && t[\"@context\"] === n[\"@context\"] && Te(t.sizes || [], n.sizes || []);\n      if (r) {\n        const s = y(h(e));\n        this.knownImageServers[s].verifications += 1, this.knownImageServers[s].verifications >= this.config.verificationsRequired && (this.knownImageServers[s].verified = true);\n      }\n      return r;\n    });\n  }\n  canLoadSync(e) {\n    const t = typeof e == \"string\" ? e : h(e), n = p(t);\n    if (this.imageServices[n])\n      return true;\n    const r = this.knownImageServers[y(t)];\n    return r && !r.malformed && r.verifications >= this.config.verificationsRequired;\n  }\n  markAsMalformed(e) {\n    return _(this, null, function* () {\n      return this.knownImageServers[y(h(e))].malformed = true, this.loadService(e, true);\n    });\n  }\n  fetchService(e, t = false) {\n    return _(this, null, function* () {\n      const n = p(e);\n      if (this.imageServices[n] && (!t || this.imageServices[n].real))\n        return this.imageServices[n];\n      if (!this.config.enableFetching)\n        throw new Error(\"Fetching is not enabled\");\n      const r = yield this.fetch(n).then((s) => s.json());\n      return !r.id && r[\"@id\"] && (r.id = r[\"@id\"]), r.id !== e && (r.id = e, r[\"@id\"] && (r[\"@id\"] = e)), this.imageServices[n] = Object.assign(r, { real: true }), this.imageServices[n];\n    });\n  }\n  fetch(e, t) {\n    return _(this, null, function* () {\n      return fetch(e, t);\n    });\n  }\n  loadService(e, t = false) {\n    return _(this, null, function* () {\n      if (!this.config.disableThrottling) {\n        let s = true;\n        for (; s; )\n          if (this.fetchingCount >= this.config.verificationsRequired)\n            yield new Promise((a) => setTimeout(a, 500));\n          else {\n            s = false;\n            break;\n          }\n      }\n      const n = this.knownImageServers[y(h(e))];\n      if (n && !n.malformed && !t) {\n        yield n.result;\n        const s = this.loadServiceSync(e);\n        if (s)\n          return s;\n      }\n      this.fetchingCount++;\n      const r = yield this.fetchService(h(e), t);\n      return this.fetchingCount--, r.real && this.sample(r, e), r;\n    });\n  }\n  loadServiceSync(e) {\n    const t = p(h(e));\n    return this.imageServices[t] ? this.imageServices[t] : this.predict(e);\n  }\n}\nnew ke();\nfunction createThumbnailHelper(vault = compatVault, dependencies = {}) {\n  const imageServiceLoader = dependencies.imageServiceLoader || new ke();\n  async function getBestThumbnailAtSize(input, request, dereference, candidates = [], dimensions) {\n    const thumbnailNotFound = () => imageServiceLoader.getThumbnailFromResource(void 0, request, dereference, candidates);\n    if (!input) {\n      return await imageServiceLoader.getThumbnailFromResource(void 0, request, dereference, candidates);\n    }\n    if (typeof input === \"string\") {\n      const fixed = Ae(input);\n      if (fixed) {\n        candidates.push(fixed);\n      }\n      return await imageServiceLoader.getThumbnailFromResource(void 0, request, dereference, candidates);\n    }\n    const fullInput = vault.get(input, { skipSelfReturn: false });\n    if (typeof fullInput === \"string\") {\n      return { best: Ae(fullInput), fallback: [], log: [] };\n    }\n    if (!fullInput) {\n      return await thumbnailNotFound();\n    }\n    const parseThumbnail = async (resource) => {\n      if (resource && resource.thumbnail && resource.thumbnail.length) {\n        const thumbnail = vault.get(resource.thumbnail[0]);\n        const potentialThumbnails = await imageServiceLoader.getImageCandidates(thumbnail, dereference);\n        if (potentialThumbnails && potentialThumbnails.length) {\n          candidates.push(...potentialThumbnails);\n        }\n      }\n    };\n    await parseThumbnail(fullInput);\n    switch (fullInput.type) {\n      case \"Annotation\": {\n        const contentResources = Array.isArray(fullInput.body) ? fullInput.body : [fullInput.body];\n        const firstContentResources = vault.get(contentResources[0]);\n        if (dimensions && !firstContentResources.width) {\n          firstContentResources.width = dimensions.width;\n          firstContentResources.height = dimensions.height;\n        }\n        return await imageServiceLoader.getThumbnailFromResource(\n          firstContentResources,\n          request,\n          dereference,\n          candidates\n        );\n      }\n      case \"Canvas\": {\n        const canvas = fullInput;\n        return getBestThumbnailAtSize(canvas.items[0], request, dereference, candidates, {\n          width: canvas.width,\n          height: canvas.height\n        });\n      }\n      case \"AnnotationPage\": {\n        const annotationPage = fullInput;\n        return getBestThumbnailAtSize(annotationPage.items[0], request, dereference, candidates, dimensions);\n      }\n      case \"Choice\": {\n        const choice = fullInput;\n        if (!choice.items || choice.items[0]) {\n          return await thumbnailNotFound();\n        }\n        return getBestThumbnailAtSize(choice.items[0], request, dereference, candidates, dimensions);\n      }\n      case \"Collection\": {\n        const collection = fullInput;\n        const firstManifest = collection.items[0];\n        if (!firstManifest) {\n          return await thumbnailNotFound();\n        }\n        return getBestThumbnailAtSize(firstManifest, request, dereference, candidates, dimensions);\n      }\n      case \"Manifest\": {\n        const manifest = fullInput;\n        const firstCanvas = manifest.items[0];\n        if (!firstCanvas) {\n          return await thumbnailNotFound();\n        }\n        return getBestThumbnailAtSize(firstCanvas, request, dereference, candidates, dimensions);\n      }\n      case \"SpecificResource\":\n      case \"Image\":\n      case \"Dataset\":\n      case \"Sound\":\n      case \"Text\":\n      case \"TextualBody\":\n      case \"Video\":\n        if (dimensions && !fullInput.width) {\n          fullInput.width = dimensions.width;\n          fullInput.height = dimensions.height;\n        }\n        return imageServiceLoader.getThumbnailFromResource(fullInput, request, dereference, candidates);\n      case \"Service\":\n      case \"Range\":\n      case \"AnnotationCollection\":\n      case \"CanvasReference\":\n      case \"ContentResource\":\n        return await thumbnailNotFound();\n    }\n    return await thumbnailNotFound();\n  }\n  return {\n    getBestThumbnailAtSize\n  };\n}\nfunction getClosestLanguage(i18nLanguage, languages, i18nLanguages = [], strictFallback = false) {\n  if (!i18nLanguage || !languages || languages.length === 0) {\n    return void 0;\n  }\n  if (languages.length === 1) {\n    return languages[0];\n  }\n  if (languages.indexOf(i18nLanguage) !== -1) {\n    return i18nLanguage;\n  }\n  const root = i18nLanguage.indexOf(\"-\") !== -1 ? i18nLanguage.slice(0, i18nLanguage.indexOf(\"-\")) : null;\n  if (root && languages.indexOf(root) !== -1) {\n    return root;\n  }\n  for (const lang of i18nLanguages) {\n    if (languages.indexOf(lang) !== -1) {\n      return lang;\n    }\n  }\n  if (!strictFallback) {\n    const inverseRoot = languages.map((l) => l.indexOf(\"-\") !== -1 ? l.slice(0, l.indexOf(\"-\")) : null);\n    const inverseIdx = inverseRoot.indexOf(i18nLanguage);\n    if (inverseIdx !== -1) {\n      return languages[inverseIdx];\n    }\n    for (const lang of i18nLanguages) {\n      const root2 = lang.indexOf(\"-\") !== -1 ? lang.slice(0, lang.indexOf(\"-\")) : null;\n      const inverseIdx2 = root2 ? languages.indexOf(root2) : -1;\n      if (inverseIdx2 !== -1) {\n        return languages[inverseIdx2];\n      }\n    }\n  }\n  if (languages.indexOf(\"none\") !== -1) {\n    return \"none\";\n  }\n  if (languages.indexOf(\"@none\") !== -1) {\n    return \"@none\";\n  }\n  return languages[0];\n}\nfunction buildLocaleString(inputText, i18nLanguage, options = {}) {\n  const { strictFallback = false, defaultText = \"\", separator = \"\\n\", fallbackLanguages = [], closest } = options;\n  const languages = Object.keys(inputText || {});\n  const language = closest ? i18nLanguage : getClosestLanguage(i18nLanguage, languages, fallbackLanguages, strictFallback);\n  if (!inputText) {\n    return defaultText;\n  }\n  if (typeof inputText === \"string\") {\n    return inputText;\n  }\n  const candidateText = language ? inputText[language] : void 0;\n  if (candidateText) {\n    if (typeof candidateText === \"string\") {\n      return candidateText;\n    }\n    return candidateText.join(separator);\n  }\n  return \"\";\n}\nfunction getValue(inputText, options = {}) {\n  return buildLocaleString(inputText, typeof navigator !== \"undefined\" ? navigator.language : void 0, options);\n}\nvar _slicedToArray = function() {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e2 = void 0;\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n        if (i && _arr.length === i)\n          break;\n      }\n    } catch (err) {\n      _d = true;\n      _e2 = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"])\n          _i[\"return\"]();\n      } finally {\n        if (_d)\n          throw _e2;\n      }\n    }\n    return _arr;\n  }\n  return function(arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\nvar TAU = Math.PI * 2;\nvar mapToEllipse = function mapToEllipse2(_ref, rx, ry, cosphi, sinphi, centerx, centery) {\n  var x2 = _ref.x, y2 = _ref.y;\n  x2 *= rx;\n  y2 *= ry;\n  var xp = cosphi * x2 - sinphi * y2;\n  var yp = sinphi * x2 + cosphi * y2;\n  return {\n    x: xp + centerx,\n    y: yp + centery\n  };\n};\nvar approxUnitArc = function approxUnitArc2(ang1, ang2) {\n  var a = ang2 === 1.5707963267948966 ? 0.551915024494 : ang2 === -1.5707963267948966 ? -0.551915024494 : 4 / 3 * Math.tan(ang2 / 4);\n  var x1 = Math.cos(ang1);\n  var y1 = Math.sin(ang1);\n  var x2 = Math.cos(ang1 + ang2);\n  var y2 = Math.sin(ang1 + ang2);\n  return [{\n    x: x1 - y1 * a,\n    y: y1 + x1 * a\n  }, {\n    x: x2 + y2 * a,\n    y: y2 - x2 * a\n  }, {\n    x: x2,\n    y: y2\n  }];\n};\nvar vectorAngle = function vectorAngle2(ux, uy, vx, vy) {\n  var sign = ux * vy - uy * vx < 0 ? -1 : 1;\n  var dot = ux * vx + uy * vy;\n  if (dot > 1) {\n    dot = 1;\n  }\n  if (dot < -1) {\n    dot = -1;\n  }\n  return sign * Math.acos(dot);\n};\nvar getArcCenter = function getArcCenter2(px, py, cx, cy, rx, ry, largeArcFlag, sweepFlag, sinphi, cosphi, pxp, pyp) {\n  var rxsq = Math.pow(rx, 2);\n  var rysq = Math.pow(ry, 2);\n  var pxpsq = Math.pow(pxp, 2);\n  var pypsq = Math.pow(pyp, 2);\n  var radicant = rxsq * rysq - rxsq * pypsq - rysq * pxpsq;\n  if (radicant < 0) {\n    radicant = 0;\n  }\n  radicant /= rxsq * pypsq + rysq * pxpsq;\n  radicant = Math.sqrt(radicant) * (largeArcFlag === sweepFlag ? -1 : 1);\n  var centerxp = radicant * rx / ry * pyp;\n  var centeryp = radicant * -ry / rx * pxp;\n  var centerx = cosphi * centerxp - sinphi * centeryp + (px + cx) / 2;\n  var centery = sinphi * centerxp + cosphi * centeryp + (py + cy) / 2;\n  var vx1 = (pxp - centerxp) / rx;\n  var vy1 = (pyp - centeryp) / ry;\n  var vx2 = (-pxp - centerxp) / rx;\n  var vy2 = (-pyp - centeryp) / ry;\n  var ang1 = vectorAngle(1, 0, vx1, vy1);\n  var ang2 = vectorAngle(vx1, vy1, vx2, vy2);\n  if (sweepFlag === 0 && ang2 > 0) {\n    ang2 -= TAU;\n  }\n  if (sweepFlag === 1 && ang2 < 0) {\n    ang2 += TAU;\n  }\n  return [centerx, centery, ang1, ang2];\n};\nvar arcToBezier = function arcToBezier2(_ref2) {\n  var px = _ref2.px, py = _ref2.py, cx = _ref2.cx, cy = _ref2.cy, rx = _ref2.rx, ry = _ref2.ry, _ref2$xAxisRotation = _ref2.xAxisRotation, xAxisRotation = _ref2$xAxisRotation === void 0 ? 0 : _ref2$xAxisRotation, _ref2$largeArcFlag = _ref2.largeArcFlag, largeArcFlag = _ref2$largeArcFlag === void 0 ? 0 : _ref2$largeArcFlag, _ref2$sweepFlag = _ref2.sweepFlag, sweepFlag = _ref2$sweepFlag === void 0 ? 0 : _ref2$sweepFlag;\n  var curves = [];\n  if (rx === 0 || ry === 0) {\n    return [];\n  }\n  var sinphi = Math.sin(xAxisRotation * TAU / 360);\n  var cosphi = Math.cos(xAxisRotation * TAU / 360);\n  var pxp = cosphi * (px - cx) / 2 + sinphi * (py - cy) / 2;\n  var pyp = -sinphi * (px - cx) / 2 + cosphi * (py - cy) / 2;\n  if (pxp === 0 && pyp === 0) {\n    return [];\n  }\n  rx = Math.abs(rx);\n  ry = Math.abs(ry);\n  var lambda = Math.pow(pxp, 2) / Math.pow(rx, 2) + Math.pow(pyp, 2) / Math.pow(ry, 2);\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n  var _getArcCenter = getArcCenter(px, py, cx, cy, rx, ry, largeArcFlag, sweepFlag, sinphi, cosphi, pxp, pyp), _getArcCenter2 = _slicedToArray(_getArcCenter, 4), centerx = _getArcCenter2[0], centery = _getArcCenter2[1], ang1 = _getArcCenter2[2], ang2 = _getArcCenter2[3];\n  var ratio = Math.abs(ang2) / (TAU / 4);\n  if (Math.abs(1 - ratio) < 1e-7) {\n    ratio = 1;\n  }\n  var segments = Math.max(Math.ceil(ratio), 1);\n  ang2 /= segments;\n  for (var i = 0; i < segments; i++) {\n    curves.push(approxUnitArc(ang1, ang2));\n    ang1 += ang2;\n  }\n  return curves.map(function(curve) {\n    var _mapToEllipse = mapToEllipse(curve[0], rx, ry, cosphi, sinphi, centerx, centery), x1 = _mapToEllipse.x, y1 = _mapToEllipse.y;\n    var _mapToEllipse2 = mapToEllipse(curve[1], rx, ry, cosphi, sinphi, centerx, centery), x2 = _mapToEllipse2.x, y2 = _mapToEllipse2.y;\n    var _mapToEllipse3 = mapToEllipse(curve[2], rx, ry, cosphi, sinphi, centerx, centery), x3 = _mapToEllipse3.x, y3 = _mapToEllipse3.y;\n    return { x1, y1, x2, y2, x: x3, y: y3 };\n  });\n};\nvar parseSvgPath = parse;\nvar length = { a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0 };\nvar segment = /([astvzqmhlc])([^astvzqmhlc]*)/ig;\nfunction parse(path) {\n  var data = [];\n  path.replace(segment, function(_2, command, args) {\n    var type = command.toLowerCase();\n    args = parseValues(args);\n    if (type == \"m\" && args.length > 2) {\n      data.push([command].concat(args.splice(0, 2)));\n      type = \"l\";\n      command = command == \"m\" ? \"l\" : \"L\";\n    }\n    while (true) {\n      if (args.length == length[type]) {\n        args.unshift(command);\n        return data.push(args);\n      }\n      if (args.length < length[type])\n        throw new Error(\"malformed path data\");\n      data.push([command].concat(args.splice(0, length[type])));\n    }\n  });\n  return data;\n}\nvar number = /-?[0-9]*\\.?[0-9]+(?:e[-+]?\\d+)?/ig;\nfunction parseValues(args) {\n  var numbers = args.match(number);\n  return numbers ? numbers.map(Number) : [];\n}\nvar absSvgPath = absolutize;\nfunction absolutize(path) {\n  var startX = 0;\n  var startY = 0;\n  var x2 = 0;\n  var y2 = 0;\n  return path.map(function(seg) {\n    seg = seg.slice();\n    var type = seg[0];\n    var command = type.toUpperCase();\n    if (type != command) {\n      seg[0] = command;\n      switch (type) {\n        case \"a\":\n          seg[6] += x2;\n          seg[7] += y2;\n          break;\n        case \"v\":\n          seg[1] += y2;\n          break;\n        case \"h\":\n          seg[1] += x2;\n          break;\n        default:\n          for (var i = 1; i < seg.length; ) {\n            seg[i++] += x2;\n            seg[i++] += y2;\n          }\n      }\n    }\n    switch (command) {\n      case \"Z\":\n        x2 = startX;\n        y2 = startY;\n        break;\n      case \"H\":\n        x2 = seg[1];\n        break;\n      case \"V\":\n        y2 = seg[1];\n        break;\n      case \"M\":\n        x2 = startX = seg[1];\n        y2 = startY = seg[2];\n        break;\n      default:\n        x2 = seg[seg.length - 2];\n        y2 = seg[seg.length - 1];\n    }\n    return seg;\n  });\n}\nfunction parseAndNormalizeSvgPath(path) {\n  const parsed = parseSvgPath(path);\n  const absolute = absSvgPath(parsed);\n  let prevCmd;\n  let startX = 0;\n  let startY = 0;\n  let bezierX = 0;\n  let bezierY = 0;\n  let quadX;\n  let quadY;\n  let x2 = 0;\n  let y2 = 0;\n  const out = [];\n  for (let i = 0; i < absolute.length; i++) {\n    let seg = absolute[i];\n    const cmd = seg[0];\n    switch (cmd) {\n      case \"M\":\n        startX = seg[1];\n        startY = seg[2];\n        break;\n      case \"H\":\n        seg = [\"L\", seg[1], startY];\n        break;\n      case \"V\":\n        seg = [\"L\", startX, seg[1]];\n        break;\n      case \"S\":\n        {\n          let cx = x2;\n          let cy = y2;\n          if (prevCmd === \"C\" || prevCmd == \"S\") {\n            cx += cx - bezierX;\n            cy += cy - bezierY;\n          }\n          seg = [\"C\", cx, cy, seg[1], seg[2], seg[3], seg[4]];\n        }\n        break;\n      case \"T\":\n        if (prevCmd === \"Q\" || prevCmd == \"T\") {\n          quadX = x2 * 2 - quadX;\n          quadY = y2 * 2 - quadY;\n        } else {\n          quadX = x2;\n          quadY = y2;\n        }\n        seg = [\"Q\", quadX, quadY, seg[1], seg[2]];\n        break;\n      case \"Q\":\n        quadX = seg[1];\n        quadY = seg[2];\n        break;\n      case \"A\":\n        {\n          const curves = arcToBezier({\n            px: x2,\n            py: y2,\n            cx: seg[6],\n            cy: seg[7],\n            rx: seg[1],\n            ry: seg[2],\n            xAxisRotation: seg[3],\n            largeArcFlag: seg[4],\n            sweepFlag: seg[5]\n          });\n          if (!curves.length) {\n            continue;\n          }\n          for (const [j2, curve] of curves.entries()) {\n            seg = [\"C\", curve.x1, curve.y1, curve.x2, curve.y2, curve.x, curve.y];\n            if (j2 < curves.length - 1) {\n              out.push(seg);\n            }\n          }\n          seg = seg;\n        }\n        break;\n      case \"Z\":\n        seg = [\"L\", startX, startY];\n        break;\n    }\n    prevCmd = cmd;\n    x2 = seg[seg.length - 2];\n    y2 = seg[seg.length - 1];\n    if ([\"C\", \"Q\", \"A\"].indexOf(cmd) > -1) {\n      bezierX = seg[seg.length - 4];\n      bezierY = seg[seg.length - 3];\n    } else {\n      bezierX = x2;\n      bezierY = y2;\n    }\n    out.push(seg);\n  }\n  return out;\n}\n/** Code to \"flatten\" quadratic and cubic Bézier curves to polylines.\n *\n * All code in this module is based on JavaScript code by Raph Levien, published on his blog at\n * https://raphlinus.github.io/.\n * I merely changed the structure a bit, removed some unneeded parts and added some comments and type hints.\n *\n * Flattening of quadratic Bézier curves:\n * - Article: https://raphlinus.github.io/graphics/curves/2019/12/23/flatten-quadbez.html\n * - Code: https://github.com/raphlinus/raphlinus.github.io/blob/master/_posts/2019-12-23-flatten-quadbez.md?plain=1#L73-L212\n *\n * Flattening of cubic Bézier curves: https://levien.com/tmp/flatten.html\n *\n * Note that the code in this module has a different license than the rest of the package,\n * due to the inclusion of Apache-licensed third party code.\n *\n * @license\n * Copyright 2022 Johannes Baiter <johannes.baiter@gmail.com>\n * Copyright 2019, 2022 Raph Levien <raph.levien@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction flattenQuadraticBezier(start, control, end, tolerance = 1) {\n  return new QuadraticBezier(start, control, end).subdivide(tolerance);\n}\nfunction flattenCubicBezier(start, startControl, end, endControl, tolerance = 1) {\n  return new CubicBezier(\n    new Float64Array([start.x, start.y, startControl.x, startControl.y, end.x, end.y, endControl.x, endControl.y])\n  ).subdivide(tolerance);\n}\nfunction hypot2(p2) {\n  return p2.x * p2.x + p2.y * p2.y;\n}\nfunction approx_myint(x2) {\n  const d = 0.67;\n  return x2 / (1 - d + Math.pow(Math.pow(d, 4) + 0.25 * x2 * x2, 0.25));\n}\nfunction approx_inv_myint(x2) {\n  const b2 = 0.39;\n  return x2 * (1 - b2 + Math.sqrt(b2 * b2 + 0.25 * x2 * x2));\n}\nclass QuadraticBezier {\n  constructor(start, control, end) {\n    this.start = start;\n    this.control = control;\n    this.end = end;\n  }\n  eval(t) {\n    const mt = 1 - t;\n    return {\n      x: this.start.x * mt * mt + 2 * this.control.x * mt * t + this.end.x * t * t,\n      y: this.start.y * mt * mt + 2 * this.control.y * mt * t + this.end.y * t * t\n    };\n  }\n  mapToBasic() {\n    const { x: x0, y: y0 } = this.start;\n    const { x: x1, y: y1 } = this.control;\n    const { x: x2, y: y2 } = this.end;\n    const ddx = 2 * x1 - x0 - x2;\n    const ddy = 2 * y1 - y0 - y2;\n    const u0 = (x1 - x0) * ddx + (y1 - y0) * ddy;\n    const u2 = (x2 - x1) * ddx + (y2 - y1) * ddy;\n    const cross = (x2 - x0) * ddy - (y2 - y0) * ddx;\n    const paramX0 = u0 / cross;\n    const paramX2 = u2 / cross;\n    const scale = Math.abs(cross) / (Math.hypot(ddx, ddy) * Math.abs(paramX2 - paramX0));\n    return { x0, x2, scale, cross };\n  }\n  subdivide(tolerance) {\n    const params = this.mapToBasic();\n    const a0 = approx_myint(params.x0);\n    const a2 = approx_myint(params.x2);\n    const count = 0.5 * Math.abs(a2 - a0) * Math.sqrt(params.scale / tolerance);\n    const n = Math.ceil(count);\n    const u0 = approx_inv_myint(a0);\n    const u2 = approx_inv_myint(a2);\n    const tValues = [0];\n    for (let i = 1; i < n; i++) {\n      const u = approx_inv_myint(a0 + (a2 - a0) * i / n);\n      const t = (u - u0) / (u2 - u0);\n      tValues.push(t);\n    }\n    tValues.push(1);\n    return tValues.map((t) => this.eval(t));\n  }\n}\nclass CubicBezier {\n  constructor(coords) {\n    this.c = coords;\n  }\n  weightsum(c0, c1, c2, c3) {\n    const x2 = c0 * this.c[0] + c1 * this.c[2] + c2 * this.c[4] + c3 * this.c[6];\n    const y2 = c0 * this.c[1] + c1 * this.c[3] + c2 * this.c[5] + c3 * this.c[7];\n    return { x: x2, y: y2 };\n  }\n  eval(t) {\n    const mt = 1 - t;\n    const c0 = mt * mt * mt;\n    const c1 = 3 * mt * mt * t;\n    const c2 = 3 * mt * t * t;\n    const c3 = t * t * t;\n    return this.weightsum(c0, c1, c2, c3);\n  }\n  deriv(t) {\n    const mt = 1 - t;\n    const c0 = -3 * mt * mt;\n    const c3 = 3 * t * t;\n    const c1 = -6 * t * mt - c0;\n    const c2 = 6 * t * mt - c3;\n    return this.weightsum(c0, c1, c2, c3);\n  }\n  midpoint_quadbez() {\n    const p1 = this.weightsum(-0.25, 0.75, 0.75, -0.25);\n    return new QuadraticBezier({ x: this.c[0], y: this.c[1] }, p1, { x: this.c[6], y: this.c[7] });\n  }\n  subsegment(t0, t1) {\n    const c = new Float64Array(8);\n    const p0 = this.eval(t0);\n    const p3 = this.eval(t1);\n    c[0] = p0.x;\n    c[1] = p0.y;\n    const scale = (t1 - t0) / 3;\n    const d1 = this.deriv(t0);\n    c[2] = p0.x + scale * d1.x;\n    c[3] = p0.y + scale * d1.y;\n    const d2 = this.deriv(t1);\n    c[4] = p3.x - scale * d2.x;\n    c[5] = p3.y - scale * d2.y;\n    c[6] = p3.x;\n    c[7] = p3.y;\n    return new CubicBezier(c);\n  }\n  subdivide(tol) {\n    const tol1 = 0.1 * tol;\n    const tol2 = tol - tol1;\n    const sqrt_tol2 = Math.sqrt(tol2);\n    const err2 = hypot2(this.weightsum(1, -3, 3, -1));\n    const n_quads = Math.ceil(Math.pow(err2 / (432 * tol1 * tol1), 1 / 6));\n    const quads = [];\n    let sum = 0;\n    for (let i2 = 0; i2 < n_quads; i2++) {\n      const t0 = i2 / n_quads;\n      const t1 = (i2 + 1) / n_quads;\n      const quad = this.subsegment(t0, t1).midpoint_quadbez();\n      const params = quad.mapToBasic();\n      const a0 = approx_myint(params.x0);\n      const a2 = approx_myint(params.x2);\n      const scale = Math.sqrt(params.scale);\n      let val2 = Math.abs(a2 - a0) * scale;\n      if (Math.sign(params.x0) != Math.sign(params.x2)) {\n        const xmin = sqrt_tol2 / scale;\n        const cusp_val = sqrt_tol2 * Math.abs(a2 - a0) / approx_myint(xmin);\n        val2 = Math.max(val2, cusp_val);\n      }\n      quads.push({\n        quad,\n        a0,\n        a2,\n        val: val2\n      });\n      sum += val2;\n    }\n    const count = 0.5 * sum / sqrt_tol2;\n    const n = Math.ceil(count);\n    const result = [{ x: this.c[0], y: this.c[1] }];\n    let val = 0;\n    let i = 0;\n    for (let j2 = 1; j2 < n; j2++) {\n      const target = sum * j2 / n;\n      while (val + quads[i].val < target) {\n        val += quads[i].val;\n        i++;\n      }\n      const a0 = quads[i].a0;\n      const a2 = quads[i].a2;\n      const u0 = approx_inv_myint(a0);\n      const u2 = approx_inv_myint(a2);\n      const a = a0 + (a2 - a0) * (target - val) / quads[i].val;\n      const u = approx_inv_myint(a);\n      const t = (u - u0) / (u2 - u0);\n      result.push(quads[i].quad.eval(t));\n    }\n    result.push({ x: this.c[6], y: this.c[7] });\n    return result;\n  }\n}\nconst BOX_SELECTOR = /&?(xywh=)?(pixel:|percent:|pct:)?([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?)/;\nconst TEMPORAL_SELECTOR = /&?(t=)(npt:)?([0-9]+(.[0-9]+)?)?(,([0-9]+(.[0-9]+)?))?/;\nconst RGBA_COLOR = /^rgba\\((\\d+),(\\d+),(\\d+),([0-9.]+)\\)$/;\nfunction parseSelector(source, { domParser, svgPreprocessor } = {}) {\n  var _a, _b;\n  if (Array.isArray(source)) {\n    return source.reduce(\n      (data, nextSource) => {\n        const { selector, selectors } = parseSelector(nextSource);\n        if (selector) {\n          if (!data.selector) {\n            data.selector = selector;\n          }\n          data.selectors.push(...selectors);\n        }\n        return data;\n      },\n      {\n        selector: null,\n        selectors: []\n      }\n    );\n  }\n  if (!source) {\n    return {\n      selector: null,\n      selectors: []\n    };\n  }\n  if (typeof source === \"string\") {\n    const [id, fragment] = source.split(\"#\");\n    if (!fragment) {\n      return {\n        selector: null,\n        selectors: []\n      };\n    }\n    return parseSelector({ type: \"FragmentSelector\", value: fragment });\n  }\n  if (source.type === \"PointSelector\" && (source.t || source.t === 0)) {\n    const selector = {\n      type: \"TemporalSelector\",\n      temporal: {\n        startTime: source.t\n      }\n    };\n    return {\n      selector,\n      selectors: [selector]\n    };\n  }\n  if (source.type === \"FragmentSelector\") {\n    const matchBoxSelector = BOX_SELECTOR.exec(source.value);\n    if (matchBoxSelector) {\n      const selector = {\n        type: \"BoxSelector\",\n        spatial: {\n          unit: matchBoxSelector[2] === \"percent:\" || matchBoxSelector[2] === \"pct:\" ? \"percent\" : \"pixel\",\n          x: parseFloat(matchBoxSelector[3]),\n          y: parseFloat(matchBoxSelector[4]),\n          width: parseFloat(matchBoxSelector[5]),\n          height: parseFloat(matchBoxSelector[6])\n        }\n      };\n      return {\n        selector,\n        selectors: [selector]\n      };\n    }\n    const matchTimeSelector = source.value.match(TEMPORAL_SELECTOR);\n    if (matchTimeSelector) {\n      const selector = {\n        type: \"TemporalSelector\",\n        temporal: {\n          startTime: matchTimeSelector[4] ? parseFloat(matchTimeSelector[4]) : 0,\n          endTime: matchTimeSelector[7] ? parseFloat(matchTimeSelector[7]) : void 0\n        }\n      };\n      return {\n        selector,\n        selectors: [selector]\n      };\n    }\n    return {\n      selector: null,\n      selectors: []\n    };\n  }\n  if (source.type === \"SvgSelector\" && \"value\" in source) {\n    if (!domParser) {\n      if (typeof window !== \"undefined\") {\n        domParser = new window.DOMParser();\n      } else {\n        console.warn(\n          \"No DOMParser available, cannot parse SVG selector, `points`, `spatial` and `style` will be unavailable and the SVG will not be normalized.\"\n        );\n      }\n    }\n    let points = [];\n    let rect;\n    let style;\n    let svg = (_a = svgPreprocessor == null ? void 0 : svgPreprocessor(source.value)) != null ? _a : source.value;\n    let svgShape;\n    if (domParser) {\n      const svgElement = domParser.parseFromString(source.value, \"image/svg+xml\").querySelector(\"svg\");\n      if (!svgElement) {\n        console.warn(`Illegal SVG selector: ${source.value}`);\n        return {\n          selector: null,\n          selectors: []\n        };\n      }\n      const selectorElem = getSelectorElement(svgElement);\n      if (selectorElem) {\n        points = selectorElem.points;\n        svgShape = selectorElem.shapeType;\n        rect = [\n          Math.min(...points.map((p2) => p2[0])),\n          Math.min(...points.map((p2) => p2[1])),\n          Math.max(...points.map((p2) => p2[0])),\n          Math.max(...points.map((p2) => p2[1]))\n        ];\n        ({ style, svg } = (_b = extractStyles(selectorElem.element)) != null ? _b : { svg });\n      }\n    }\n    const sel = {\n      type: \"SvgSelector\",\n      svg,\n      svgShape,\n      style,\n      points: points.length ? points : void 0,\n      spatial: rect ? { unit: \"pixel\", x: rect[0], y: rect[1], width: rect[2] - rect[0], height: rect[3] - rect[1] } : void 0\n    };\n    return {\n      selector: sel,\n      selectors: [sel]\n    };\n  }\n  return {\n    selector: null,\n    selectors: []\n  };\n}\nfunction getShapeTypeFromPath(svgPath) {\n  const cmdFrequencies = svgPath.map((seg) => seg[0]).reduce(\n    (acc, cmd) => {\n      acc[cmd] += 1;\n      return acc;\n    },\n    { C: 0, Q: 0, L: 0, M: 0 }\n  );\n  const cmdTypes = new Set(svgPath.map((seg) => seg[0]));\n  if (cmdFrequencies.C > 0 || cmdFrequencies.Q > 0) {\n    return \"path\";\n  }\n  if (cmdFrequencies.L > 0 && (cmdTypes.size === 1 || cmdTypes.size === 2 && cmdTypes.has(\"M\"))) {\n    if (cmdFrequencies.L === 4) {\n      return \"rect\";\n    }\n    const lastSeg = svgPath.slice(-1)[0];\n    if (svgPath[0][0] === \"M\" && lastSeg[0] === \"L\" && lastSeg[1] == svgPath[0][1] && lastSeg[2] === svgPath[0][2] || lastSeg[1] === 0 && lastSeg[2] === 0) {\n      return \"polygon\";\n    } else {\n      return \"polyline\";\n    }\n  }\n  return \"path\";\n}\nfunction getSelectorElement(svgElem) {\n  var _a, _b, _c, _d, _e2, _f, _g, _h, _i, _j, _k, _l, _m, _n, _o, _p, _q;\n  for (const element of Array.from(svgElem.children)) {\n    switch (element == null ? void 0 : element.tagName.toLowerCase()) {\n      case \"g\":\n        {\n          const res = getSelectorElement(element);\n          if (res) {\n            return res;\n          }\n        }\n        continue;\n      case \"path\": {\n        const p2 = element.getAttribute(\"d\");\n        if (!p2) {\n          continue;\n        }\n        const normalized = parseAndNormalizeSvgPath(p2);\n        return { element, points: pathToPoints(normalized), shapeType: getShapeTypeFromPath(normalized) };\n      }\n      case \"circle\": {\n        const cx = parseFloat((_a = element.getAttribute(\"cx\")) != null ? _a : \"0\");\n        const cy = parseFloat((_b = element.getAttribute(\"cy\")) != null ? _b : \"0\");\n        const r = parseFloat((_c = element.getAttribute(\"r\")) != null ? _c : \"0\");\n        if (!r) {\n          continue;\n        }\n        const points = [];\n        for (let angle = 0; angle <= 360; angle += 12) {\n          const rad = angle * Math.PI / 180;\n          points.push([cx + r * Math.cos(rad), cy + r * Math.sin(rad)]);\n        }\n        return { element, points, shapeType: \"circle\" };\n      }\n      case \"ellipse\": {\n        const cx = parseFloat((_d = element.getAttribute(\"cx\")) != null ? _d : \"0\");\n        const cy = parseFloat((_e2 = element.getAttribute(\"cy\")) != null ? _e2 : \"0\");\n        const rx = parseFloat((_f = element.getAttribute(\"rx\")) != null ? _f : \"0\");\n        const ry = parseFloat((_g = element.getAttribute(\"ry\")) != null ? _g : \"0\");\n        if (!rx && !ry) {\n          continue;\n        }\n        const points = [];\n        for (let angle = 0; angle <= 360; angle += 12) {\n          const t = Math.tan(angle / 360 * Math.PI);\n          const px = rx * (1 - t ** 2) / (1 + t ** 2);\n          const py = ry * 2 * t / (1 + t ** 2);\n          points.push([cx + px, cy + py]);\n        }\n        return { element, points, shapeType: \"ellipse\" };\n      }\n      case \"line\": {\n        const x0 = parseFloat((_h = element.getAttribute(\"x0\")) != null ? _h : \"0\");\n        const y0 = parseFloat((_i = element.getAttribute(\"y0\")) != null ? _i : \"0\");\n        const x1 = parseFloat((_j = element.getAttribute(\"x1\")) != null ? _j : \"0\");\n        const y1 = parseFloat((_k = element.getAttribute(\"y1\")) != null ? _k : \"0\");\n        if (x0 === x1 && y0 === y1) {\n          continue;\n        }\n        return {\n          element,\n          points: [\n            [x0, y0],\n            [x1, y1]\n          ],\n          shapeType: \"polyline\"\n        };\n      }\n      case \"polygon\":\n      case \"polyline\": {\n        const points = (_m = (_l = element.getAttribute(\"points\")) == null ? void 0 : _l.split(\" \").map((ps) => ps.split(\",\").map(parseFloat))) != null ? _m : [];\n        if (!points.length) {\n          continue;\n        }\n        let shapeType = \"polyline\";\n        if (element.tagName.toLowerCase() === \"polygon\") {\n          points.push(points[0]);\n          shapeType = \"polygon\";\n        }\n        return { element, points, shapeType };\n      }\n      case \"rect\": {\n        const x2 = parseFloat((_n = element.getAttribute(\"x\")) != null ? _n : \"0\");\n        const y2 = parseFloat((_o = element.getAttribute(\"y\")) != null ? _o : \"0\");\n        const width = parseFloat((_p = element.getAttribute(\"width\")) != null ? _p : \"0\");\n        const height = parseFloat((_q = element.getAttribute(\"height\")) != null ? _q : \"0\");\n        if (!width || !height) {\n          continue;\n        }\n        return {\n          element,\n          points: [\n            [x2, y2],\n            [x2 + width, y2],\n            [x2 + width, y2 + height],\n            [x2, y2 + height],\n            [x2, y2]\n          ],\n          shapeType: \"rect\"\n        };\n      }\n      default:\n        continue;\n    }\n  }\n  return null;\n}\nfunction pathToPoints(normalizedPath) {\n  var _a;\n  const out = [];\n  for (let i = 0; i < normalizedPath.length; i++) {\n    const startPoint = (_a = out[out.length - 1]) != null ? _a : [0, 0];\n    const seg = normalizedPath[i];\n    switch (seg[0]) {\n      case \"M\":\n      case \"L\":\n        out.push([seg[1], seg[2]]);\n        continue;\n      case \"C\":\n        out.push(\n          ...flattenCubicBezier(\n            { x: startPoint[0], y: startPoint[1] },\n            { x: seg[1], y: seg[2] },\n            { x: seg[3], y: seg[4] },\n            { x: seg[5], y: seg[6] }\n          ).map((p2) => [p2.x, p2.y]).slice(1)\n        );\n        continue;\n      case \"Q\":\n        out.push(\n          ...flattenQuadraticBezier(\n            { x: startPoint[0], y: startPoint[1] },\n            { x: seg[1], y: seg[2] },\n            { x: seg[3], y: seg[4] }\n          ).map((p2) => [p2.x, p2.y]).slice(1)\n        );\n        continue;\n    }\n  }\n  return out;\n}\nfunction extractStyles(selectorElement) {\n  const style = {};\n  if (selectorElement.hasAttribute(\"fill\")) {\n    style.fill = selectorElement.getAttribute(\"fill\");\n    selectorElement.removeAttribute(\"fill\");\n  } else if (selectorElement.style.fill) {\n    style.fill = selectorElement.style.fill;\n  }\n  if (style.fill) {\n    const rgbaMatch = RGBA_COLOR.exec(style.fill);\n    if (rgbaMatch) {\n      style.fillOpacity = parseFloat(rgbaMatch[4]);\n      style.fill = `rgb(${rgbaMatch[1]}, ${rgbaMatch[2]}, ${rgbaMatch[3]})`;\n    }\n  }\n  if (selectorElement.hasAttribute(\"fill-opacity\")) {\n    style.fillOpacity = parseFloat(selectorElement.getAttribute(\"fill-opacity\"));\n    selectorElement.removeAttribute(\"fill-opacity\");\n  } else if (selectorElement.style.fillOpacity) {\n    style.fillOpacity = parseFloat(selectorElement.style.fillOpacity);\n  }\n  if (selectorElement.hasAttribute(\"stroke\")) {\n    style.stroke = selectorElement.getAttribute(\"stroke\");\n    selectorElement.removeAttribute(\"stroke\");\n  } else if (selectorElement.style.stroke) {\n    style.stroke = selectorElement.style.stroke;\n  }\n  if (style.stroke) {\n    const rgbaMatch = RGBA_COLOR.exec(style.stroke);\n    if (rgbaMatch) {\n      style.strokeOpacity = parseFloat(rgbaMatch[4]);\n      style.stroke = `rgb(${rgbaMatch[1]}, ${rgbaMatch[2]}, ${rgbaMatch[3]})`;\n    }\n  }\n  if (selectorElement.hasAttribute(\"stroke-opacity\")) {\n    style.strokeOpacity = parseFloat(selectorElement.getAttribute(\"stroke-opacity\"));\n    selectorElement.removeAttribute(\"stroke-opacity\");\n  } else if (selectorElement.style.strokeOpacity) {\n    style.strokeOpacity = parseFloat(selectorElement.style.strokeOpacity);\n  }\n  if (selectorElement.hasAttribute(\"stroke-width\")) {\n    style.strokeWidth = selectorElement.getAttribute(\"stroke-width\");\n    selectorElement.removeAttribute(\"stroke-width\");\n  } else if (selectorElement.style.strokeWidth) {\n    style.strokeWidth = selectorElement.style.strokeWidth;\n  }\n  if (selectorElement.hasAttribute(\"stroke-dasharray\")) {\n    style.strokeDasharray = selectorElement.getAttribute(\"stroke-dasharray\");\n    selectorElement.removeAttribute(\"stroke-dasharray\");\n  } else if (selectorElement.style.strokeDasharray) {\n    style.strokeDasharray = selectorElement.style.strokeDasharray;\n  }\n  let rootElem = selectorElement;\n  while (rootElem.tagName.toLowerCase() !== \"svg\") {\n    rootElem = rootElem.parentElement;\n    if (rootElem === null) {\n      throw new Error(\"Could not find root SVG element\");\n    }\n  }\n  return { svg: rootElem.outerHTML, style: Object.keys(style).length > 0 ? style : void 0 };\n}\nfunction expandTarget(target, options = {}) {\n  if (Array.isArray(target)) {\n    return expandTarget(target[0]);\n  }\n  if (typeof target === \"string\") {\n    const [id, fragment] = target.split(\"#\");\n    if (!fragment) {\n      return {\n        type: \"SpecificResource\",\n        source: { id, type: options.typeMap && options.typeMap[id] || \"Unknown\" },\n        selector: null,\n        selectors: []\n      };\n    }\n    return expandTarget({\n      type: \"SpecificResource\",\n      source: { id, type: \"Unknown\" },\n      selector: {\n        type: \"FragmentSelector\",\n        value: fragment\n      }\n    });\n  }\n  if (target.type === \"Choice\" || target.type === \"List\" || target.type === \"Composite\" || target.type === \"Independents\") {\n    return expandTarget(target.items[0]);\n  }\n  if (target.type === \"SpecificResource\") {\n    if (target.source.type === \"Canvas\" && target.source.partOf && typeof target.source.partOf === \"string\") {\n      target.source.partOf = [\n        {\n          id: target.source.partOf,\n          type: \"Manifest\"\n        }\n      ];\n    }\n    const { selector, selectors } = target.selector ? parseSelector(target.selector, options) : { selector: null, selectors: [] };\n    return {\n      type: \"SpecificResource\",\n      source: target.source,\n      selector,\n      selectors\n    };\n  }\n  if (target.id) {\n    if (target.type === \"Canvas\" && target.partOf && typeof target.partOf === \"string\") {\n      target.partOf = [\n        {\n          id: target.partOf,\n          type: \"Manifest\"\n        }\n      ];\n    }\n    const [id, fragment] = target.id.split(\"#\");\n    if (!fragment) {\n      return {\n        type: \"SpecificResource\",\n        source: {\n          ...target,\n          id\n        },\n        selector: null,\n        selectors: []\n      };\n    }\n    return expandTarget({\n      type: \"SpecificResource\",\n      source: {\n        ...target,\n        id\n      },\n      selector: {\n        type: \"FragmentSelector\",\n        value: fragment\n      }\n    });\n  }\n  return {\n    type: \"SpecificResource\",\n    source: target,\n    selector: null,\n    selectors: []\n  };\n}\nfunction validateContentState(annotation, strict = false) {\n  if (typeof annotation === \"string\") {\n    if (annotation.startsWith(\"{\")) {\n      try {\n        const parsed = JSON.parse(annotation);\n        return validateContentState(parsed);\n      } catch (err) {\n        return [false, { reason: \"Invalid JSON\" }];\n      }\n    }\n    return [true];\n  }\n  if (Array.isArray(annotation)) {\n    for (const anno of annotation) {\n      const [valid, reason] = validateContentState(anno);\n      if (!valid && reason) {\n        return [valid, reason];\n      }\n    }\n    return [true];\n  }\n  if (annotation.type === \"Annotation\") {\n    return [true];\n  }\n  if (strict && annotation.type === \"Canvas\" && !annotation.partOf) {\n    return [false, { reason: \"Canvas without partOf cannot be loaded\" }];\n  }\n  return [true];\n}\nfunction serialiseContentState(annotation) {\n  return encodeContentState(typeof annotation === \"string\" ? annotation : JSON.stringify(annotation));\n}\nfunction parseContentState(state, asyncOrFetcher) {\n  state = state.trim();\n  if (state[0] === \"{\") {\n    return asyncOrFetcher ? Promise.resolve(JSON.parse(state)) : JSON.parse(state);\n  }\n  if (state.startsWith(\"http\")) {\n    if (!asyncOrFetcher) {\n      throw new Error(\"Cannot fetch remote fetch with async=false in parseContentState\");\n    }\n    return fetch(state).then((r) => r.json());\n  }\n  return parseContentState(decodeContentState(state), asyncOrFetcher);\n}\nfunction encodeContentState(state) {\n  const uriEncoded = encodeURIComponent(state);\n  const base64 = typeof btoa === \"undefined\" ? Buffer.from(uriEncoded, \"utf-8\").toString(\"base64\") : btoa(uriEncoded);\n  const base64url = base64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n  return base64url.replace(/=/g, \"\");\n}\nfunction decodeContentState(encodedContentState) {\n  const base64url = restorePadding(encodedContentState);\n  const base64 = base64url.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const base64Decoded = typeof atob === \"undefined\" ? Buffer.from(base64, \"base64\").toString(\"utf-8\") : atob(base64);\n  return decodeURIComponent(base64Decoded).trim();\n}\nfunction restorePadding(s) {\n  const pad = s.length % 4;\n  if (pad === 1) {\n    throw new Error(\"InvalidLengthError: Input base64url string is the wrong length to determine padding\");\n  }\n  return s + (pad ? \"====\".slice(0, 4 - pad) : \"\");\n}\nfunction normaliseContentState(state) {\n  if (!state) {\n    throw new Error(\"Content state is empty\");\n  }\n  if (!Array.isArray(state)) {\n    state = [state];\n  }\n  let annoId = \"vault://virtual-annotation/\" + new Date().getTime();\n  const targets = [];\n  for (const source of state) {\n    if (typeof source === \"string\") {\n      throw new Error(\"Content state is a [String] type and cannot be inferred\");\n    }\n    if (source.type === \"Annotation\") {\n      annoId = source.id;\n      if (Array.isArray(source.motivation)) {\n        for (const singleMotivation of source.motivation) {\n        }\n      }\n      if (Array.isArray(source.target)) {\n        for (const target2 of source.target) {\n          const expanded = expandTarget(target2);\n          targets.push(expanded);\n        }\n      } else {\n        const expanded = expandTarget(source.target);\n        targets.push(expanded);\n      }\n      continue;\n    }\n    const target = expandTarget(source);\n    targets.push(target);\n  }\n  return {\n    id: annoId,\n    type: \"Annotation\",\n    motivation: [\"contentState\", ...state.motivation || []],\n    target: targets,\n    extensions: {}\n  };\n}\nfunction parseSpecificResource(resource) {\n  if (resource.type === \"SpecificResource\") {\n    return [resource.source, { selector: resource.selector }];\n  }\n  return [resource, { selector: null }];\n}\nfunction createPaintingAnnotationsHelper(vault = compatVault) {\n  function getAllPaintingAnnotations(canvasOrId) {\n    const canvas = canvasOrId ? typeof canvasOrId === \"string\" ? vault.get(canvasOrId) : canvasOrId : null;\n    if (!canvas) {\n      return [];\n    }\n    const annotationPages = vault.get(canvas.items);\n    const flatAnnotations = [];\n    for (const page of annotationPages) {\n      flatAnnotations.push(...vault.get(page.items));\n    }\n    return flatAnnotations;\n  }\n  function getPaintables(paintingAnnotationsOrCanvas, enabledChoices = []) {\n    const paintingAnnotations = Array.isArray(paintingAnnotationsOrCanvas) ? paintingAnnotationsOrCanvas : getAllPaintingAnnotations(paintingAnnotationsOrCanvas);\n    const types = [];\n    let choice = null;\n    const items = [];\n    for (const annotation of paintingAnnotations) {\n      if (annotation.type !== \"Annotation\") {\n        throw new Error(`getPaintables() accept either a canvas or list of annotations`);\n      }\n      const unknownBodies = vault.get(annotation.body);\n      const bodies = Array.isArray(unknownBodies) ? unknownBodies : [unknownBodies];\n      for (const unknownBody of bodies) {\n        const [body, { selector }] = parseSpecificResource(unknownBody);\n        const type = (body.type || \"unknown\").toLowerCase();\n        if (type === \"choice\") {\n          const nestedBodies = vault.get(body.items);\n          const selected = enabledChoices.length ? enabledChoices.map((cid) => nestedBodies.find((b2) => b2.id === cid)).filter(Boolean) : [nestedBodies[0]];\n          if (selected.length === 0) {\n            selected.push(nestedBodies[0]);\n          }\n          choice = {\n            type: \"single-choice\",\n            items: nestedBodies.map((b2) => ({\n              id: b2.id,\n              label: b2.label,\n              selected: selected.indexOf(b2) !== -1\n            })),\n            label: unknownBody.label\n          };\n          bodies.push(...selected);\n          continue;\n        }\n        if (types.indexOf(type) === -1) {\n          types.push(type);\n        }\n        items.push({\n          type,\n          resource: body,\n          target: annotation.target,\n          selector\n        });\n      }\n    }\n    return {\n      types,\n      items,\n      choice\n    };\n  }\n  function extractChoices(paintingAnnotationsOrCanvas) {\n    const { choice } = getPaintables(paintingAnnotationsOrCanvas);\n    return choice;\n  }\n  return {\n    getAllPaintingAnnotations,\n    getPaintables,\n    extractChoices\n  };\n}\nfunction defineProperty(name, prototype, vault) {\n  prototype[DEFINED] = prototype[DEFINED] || [];\n  prototype[DEFINED].push(name);\n  Object.defineProperty(prototype, name, {\n    get() {\n      if (typeof prototype[REFS][name] === \"undefined\") {\n        return void 0;\n      }\n      const ref = prototype[REFS][name];\n      if (!ref) {\n        return ref;\n      }\n      return wrapObject(vault.get(prototype[REFS][name]), vault);\n    },\n    set(items) {\n      const existing = prototype[REFS][name];\n      if (existing !== items) {\n        this[REFS][name] = items;\n      }\n    }\n  });\n}\nconst REFS = Symbol.for(\"_refs_\");\nconst REACTIVE = Symbol.for(\"_reactive_\");\nconst DEFINED = Symbol.for(\"_defined_\");\nfunction createPrototype(vault, reactive = false) {\n  const prototype = {\n    id: null,\n    [DEFINED]: [],\n    [REFS]: {},\n    [REACTIVE]: null,\n    is(refOrObject) {\n      if (typeof refOrObject === \"string\") {\n        return this.id === refOrObject;\n      }\n      if (refOrObject.id) {\n        return refOrObject.id === this.id;\n      }\n      return false;\n    },\n    reactive() {\n      if (this[REACTIVE]) {\n        return;\n      }\n      this[REACTIVE] = this.subscribe(() => this.refresh(), true);\n      return () => {\n        this.unreactive();\n      };\n    },\n    refresh() {\n      if (this.id) {\n        const fresh = this.unwrap();\n        for (const key of Object.keys(fresh || {})) {\n          if (this[DEFINED].includes(key)) {\n            this[REFS][key] = fresh[key];\n          } else {\n            this[key] = fresh[key];\n          }\n        }\n      }\n    },\n    unreactive() {\n      if (this[REACTIVE]) {\n        this[REACTIVE]();\n        this[REACTIVE] = null;\n      }\n    },\n    unwrap() {\n      if (!this.id) {\n        throw new Error(\"Invalid object\");\n      }\n      return vault.get(this.id);\n    },\n    toPresentation3() {\n      return vault.toPresentation3(this.unwrap());\n    },\n    toPresentation2() {\n      return vault.toPresentation2(this.unwrap());\n    },\n    toJSON() {\n      const that = this;\n      return {\n        ...that,\n        items: that.items,\n        annotations: that.annotations,\n        structures: that.structures,\n        seeAlso: that.seeAlso,\n        service: that.service,\n        services: that.services,\n        rendering: that.rendering,\n        partOf: that.partOf,\n        start: that.start,\n        supplementary: that.supplementary,\n        homepage: that.homepage,\n        thumbnail: that.thumbnail,\n        placeholderCanvas: that.placeholderCanvas,\n        accompanyingCanvas: that.accompanyingCanvas,\n        provider: that.provider\n      };\n    },\n    subscribe(subscription, skipInitial = true) {\n      return vault.subscribe(\n        () => {\n          return this.id ? vault.get(this.id) : null;\n        },\n        subscription,\n        skipInitial\n      );\n    }\n  };\n  defineProperty(\"items\", prototype, vault);\n  defineProperty(\"annotations\", prototype, vault);\n  defineProperty(\"structures\", prototype, vault);\n  defineProperty(\"seeAlso\", prototype, vault);\n  defineProperty(\"service\", prototype, vault);\n  defineProperty(\"services\", prototype, vault);\n  defineProperty(\"rendering\", prototype, vault);\n  defineProperty(\"partOf\", prototype, vault);\n  defineProperty(\"start\", prototype, vault);\n  defineProperty(\"supplementary\", prototype, vault);\n  defineProperty(\"homepage\", prototype, vault);\n  defineProperty(\"thumbnail\", prototype, vault);\n  defineProperty(\"placeholderCanvas\", prototype, vault);\n  defineProperty(\"accompanyingCanvas\", prototype, vault);\n  defineProperty(\"provider\", prototype, vault);\n  defineProperty(\"body\", prototype, vault);\n  defineProperty(\"logo\", prototype, vault);\n  return prototype;\n}\nfunction unwrapObject(object) {\n  if (Array.isArray(object)) {\n    return object.map((o) => unwrapObject(o));\n  }\n  if (!object || !object.type) {\n    return object;\n  }\n  return { id: object.id, type: object.type };\n}\nfunction wrapObject(object, vault, reactive = false) {\n  if (Array.isArray(object)) {\n    return object.map((o) => wrapObject(o, vault, reactive));\n  }\n  if (!object || !object.type || !object.id) {\n    return object;\n  }\n  const prototype = createPrototype(vault, reactive);\n  const newObject = Object.create(prototype);\n  const wrapped = Object.assign(newObject, object);\n  if (reactive) {\n    wrapped.reactive();\n  }\n  return wrapped;\n}\nfunction createObjectsHelper(vault) {\n  return {\n    get(id, reactive = false) {\n      return wrapObject(vault.get(id), vault, reactive);\n    },\n    async load(id, json) {\n      return wrapObject(await vault.load(id, json), vault);\n    },\n    async loadManifest(id, json) {\n      return wrapObject(await vault.loadManifest(id, json), vault);\n    },\n    async loadCollection(id, json) {\n      return wrapObject(await vault.loadCollection(id, json), vault);\n    },\n    wrapObject(objectType) {\n      return wrapObject(vault.get(objectType, { skipSelfReturn: false }), vault);\n    },\n    isWrapped(object) {\n      return !!object[DEFINED];\n    }\n  };\n}\nfunction createRangeHelper(vault = compatVault) {\n  return {\n    findFirstCanvasFromRange: (range) => findFirstCanvasFromRange(vault, range),\n    findAllCanvasesInRange: (range) => findAllCanvasesInRange(vault, range),\n    findManifestSelectedRange: (manifest, canvasId) => findManifestSelectedRange(vault, manifest, canvasId),\n    findSelectedRange: (range, canvasId) => findSelectedRange(vault, range, canvasId)\n  };\n}\nfunction findFirstCanvasFromRange(vault, range) {\n  for (const inner of range.items) {\n    if (inner.type === \"Canvas\") {\n      return inner;\n    }\n    if (inner.type === \"Range\") {\n      const found = findFirstCanvasFromRange(vault, vault.get(inner));\n      if (found) {\n        return found;\n      }\n    }\n  }\n  return null;\n}\nfunction findAllCanvasesInRange(vault, range) {\n  const found = [];\n  for (const inner of range.items) {\n    if (inner.type === \"Canvas\") {\n      if (inner.id.indexOf(\"#\") !== -1) {\n        found.push({ id: inner.id.split(\"#\")[0], type: \"Canvas\" });\n      } else {\n        found.push(inner);\n      }\n    }\n    if (inner.type === \"Range\") {\n      found.push(...findAllCanvasesInRange(vault, vault.get(inner)));\n    }\n    if (inner.type === \"SpecificResource\") {\n      const sourceId = typeof inner.source === \"string\" ? inner.source : inner.source.id;\n      found.push({ id: sourceId, type: \"Canvas\" });\n    }\n  }\n  return found;\n}\nfunction findManifestSelectedRange(vault, manifest, canvasId) {\n  for (const range of manifest.structures) {\n    const found = findSelectedRange(vault, vault.get(range), canvasId);\n    if (found) {\n      return found;\n    }\n  }\n  return null;\n}\nfunction findSelectedRange(vault, range, canvasId) {\n  var _a;\n  for (const inner of range.items) {\n    const parsedId = (_a = inner.id) == null ? void 0 : _a.split(\"#\")[0];\n    if (inner.type === \"SpecificResource\" && inner.source === canvasId) {\n      return range;\n    }\n    if (inner.type === \"Canvas\" && canvasId === parsedId) {\n      return range;\n    }\n    if (inner.type === \"Range\") {\n      const found = findSelectedRange(vault, vault.get(inner), canvasId);\n      if (found) {\n        return found;\n      }\n    }\n  }\n  return null;\n}\nfunction createSequenceHelper(vault = compatVault) {\n  return {\n    getVisibleCanvasesFromCanvasId: (manifestOrRange, canvasId, preventPaged = false) => getVisibleCanvasesFromCanvasId(vault, manifestOrRange, canvasId, preventPaged),\n    getManifestSequence: (manifestOrRange, options = {}) => getManifestSequence(vault, manifestOrRange, options)\n  };\n}\nfunction getVisibleCanvasesFromCanvasId(vault = compatVault, manifestOrRange, canvasId, preventPaged = false) {\n  const behavior = manifestOrRange.behavior || [];\n  const fullCanvas = canvasId ? vault.get(canvasId) : null;\n  if (!fullCanvas) {\n    return [];\n  }\n  const canvasBehavior = fullCanvas.behavior || [];\n  const isPaged = preventPaged ? false : behavior.includes(\"paged\");\n  const isContinuous = isPaged ? false : behavior.includes(\"continuous\");\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes(\"individuals\");\n  const isCanvasFacingPages = canvasBehavior.includes(\"facing-pages\");\n  const isCanvasNonPaged = canvasBehavior.includes(\"non-paged\");\n  if (isCanvasFacingPages || isCanvasNonPaged || isIndividuals || preventPaged) {\n    return [{ id: fullCanvas.id, type: \"Canvas\" }];\n  }\n  const [manifestItems, ordering] = getManifestSequence(vault, manifestOrRange);\n  if (isContinuous) {\n    return manifestItems;\n  }\n  const canvasIndex = manifestItems.findIndex((r) => r.id === canvasId);\n  if (canvasIndex === -1) {\n    return [];\n  }\n  for (const indexes of ordering) {\n    if (indexes.includes(canvasIndex)) {\n      return indexes.map((index) => manifestItems[index]);\n    }\n  }\n  return [{ id: fullCanvas.id, type: \"Canvas\" }];\n}\nfunction getManifestSequence(vault = compatVault, manifestOrRange, { disablePaging, skipNonPaged } = {}) {\n  const behavior = manifestOrRange.behavior || [];\n  const isPaged = behavior.includes(\"paged\");\n  const isContinuous = isPaged ? false : behavior.includes(\"continuous\");\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes(\"individuals\");\n  const manifestItems = manifestOrRange.type === \"Manifest\" ? manifestOrRange.items : findAllCanvasesInRange(vault, manifestOrRange);\n  if (isContinuous) {\n    return [manifestItems, [manifestItems.map((_2, index) => index)]];\n  }\n  if (isIndividuals || !isPaged || disablePaging) {\n    return [manifestItems, manifestItems.map((_2, index) => [index])];\n  }\n  const ordering = [];\n  let currentOrdering = [];\n  const flush = () => {\n    if (currentOrdering.length) {\n      ordering.push([...currentOrdering]);\n      currentOrdering = [];\n    }\n  };\n  let offset = 0;\n  let flushNextPaged = false;\n  for (let i = 0; i < manifestItems.length; i++) {\n    const canvas = vault.get(manifestItems[i]);\n    const canvasBehavior = canvas.behavior || [];\n    if (canvasBehavior.includes(\"non-paged\")) {\n      if (i === offset) {\n        offset++;\n      }\n      if (!skipNonPaged) {\n        flush();\n        ordering.push([i]);\n        flush();\n      }\n      continue;\n    }\n    if (i === offset || canvasBehavior.includes(\"facing-pages\")) {\n      if (currentOrdering.length) {\n        flushNextPaged = true;\n      }\n      flush();\n      ordering.push([i]);\n      flush();\n      continue;\n    }\n    currentOrdering.push(i);\n    if (flushNextPaged) {\n      flush();\n      flushNextPaged = false;\n      continue;\n    }\n    if (currentOrdering.length > 1) {\n      flush();\n    }\n  }\n  if (currentOrdering.length) {\n    flush();\n  }\n  return [manifestItems, ordering];\n}\nexport { buildLocaleString, createEventsHelper, createObjectsHelper, createPaintingAnnotationsHelper, createRangeHelper, createSequenceHelper, createStylesHelper, createThumbnailHelper, decodeContentState, encodeContentState, expandTarget, findAllCanvasesInRange, findFirstCanvasFromRange, findManifestSelectedRange, findSelectedRange, getClosestLanguage, getManifestSequence, getValue, getVisibleCanvasesFromCanvasId, normaliseContentState, parseContentState, parseSelector, parseSpecificResource, serialiseContentState, unwrapObject, validateContentState, wrapObject };\n//# sourceMappingURL=index.mjs.map\n","var commonjsGlobal = typeof globalThis !== \"undefined\" ? globalThis : typeof window !== \"undefined\" ? window : typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : {};\nvar index_umd = { exports: {} };\n(function(module, exports) {\n  var __defProp = Object.defineProperty, __defNormalProp = (e, t, i) => t in e ? __defProp(e, t, { enumerable: true, configurable: true, writable: true, value: i }) : e[t] = i, __publicField = (e, t, i) => (__defNormalProp(e, \"symbol\" != typeof t ? t + \"\" : t, i), i);\n  !function(e, t) {\n    t(exports);\n  }(commonjsGlobal, function(e) {\n    const t = \"http://library.stanford.edu/iiif/image-api/compliance.html#level1\", i = \"http://library.stanford.edu/iiif/image-api/compliance.html#level2\", r = \"http://library.stanford.edu/iiif/image-api/conformance.html#level1\", n = \"http://library.stanford.edu/iiif/image-api/conformance.html#level2\", s = \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1\", a = \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2\", o = \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1\", c = \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2\", l = \"http://iiif.io/api/image/1/level1.json\", p = \"http://iiif.io/api/image/1/profiles/level1.json\", h = \"http://iiif.io/api/image/1/level2.json\", u = \"http://iiif.io/api/image/1/profiles/level2.json\", v = \"http://iiif.io/api/image/2/level1.json\", f = \"http://iiif.io/api/image/2/profiles/level1.json\", m = \"http://iiif.io/api/image/2/level2.json\", y = \"http://iiif.io/api/image/2/profiles/level2.json\", g = \"level1\", d = \"level2\", A = \"http://iiif.io/api/image/2/level1\", b = \"http://iiif.io/api/image/2/level2\", C = [A, b, t, i, r, n, s, a, o, c, l, p, h, u, v, f, m, y, g, d], x = [\"http://iiif.io/api/image/2/level0\", A, b, \"http://library.stanford.edu/iiif/image-api/compliance.html#level0\", t, i, \"http://library.stanford.edu/iiif/image-api/conformance.html#level0\", r, n, \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0\", s, a, \"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0\", o, c, \"http://iiif.io/api/image/1/level0.json\", \"http://iiif.io/api/image/1/profiles/level0.json\", l, p, h, u, \"http://iiif.io/api/image/2/level0.json\", \"http://iiif.io/api/image/2/profiles/level0.json\", v, f, m, y, \"level0\", g, d], w = [\"sc:Collection\", \"sc:Manifest\", \"sc:Canvas\", \"sc:AnnotationList\", \"oa:Annotation\", \"sc:Range\", \"sc:Layer\", \"sc:Sequence\", \"oa:Choice\", \"Service\", \"ContentResource\"];\n    class L {\n      constructor(e2, t2 = {}) {\n        __publicField(this, \"traversals\"), __publicField(this, \"options\"), this.traversals = { collection: [], manifest: [], canvas: [], annotationList: [], sequence: [], annotation: [], contentResource: [], choice: [], range: [], service: [], layer: [], ...e2 }, this.options = { convertPropsToArray: true, mergeMemberProperties: true, allowUndefinedReturn: false, ...t2 };\n      }\n      static all(e2) {\n        return new L({ collection: [e2], manifest: [e2], canvas: [e2], annotationList: [e2], sequence: [e2], annotation: [e2], contentResource: [e2], choice: [e2], range: [e2], service: [e2], layer: [e2] });\n      }\n      traverseCollection(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e2))), this.traversals.collection);\n      }\n      traverseCollectionItems(e2) {\n        if (this.options.mergeMemberProperties) {\n          const t2 = [...(e2.manifests || []).map((e3) => \"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Manifest\" } : e3), ...(e2.collections || []).map((e3) => \"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Collection\" } : e3), ...e2.members || []];\n          delete e2.collections, delete e2.manifests, e2.members = t2;\n        }\n        return e2.manifests && (e2.manifests = e2.manifests.map((e3) => this.traverseManifest(\"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Manifest\" } : e3))), e2.collections && (e2.collections = e2.collections.map((e3) => this.traverseCollection(\"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Collection\" } : e3))), e2.members && (e2.members = e2.members.map((e3) => \"string\" == typeof e3 ? e3 : this.traverseUnknown(e3))), e2;\n      }\n      traverseManifest(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e2))), this.traversals.manifest);\n      }\n      traverseManifestItems(e2) {\n        return e2.sequences && (e2.sequences = e2.sequences.map((e3) => this.traverseSequence(e3))), e2.structures && (e2.structures = e2.structures.map((e3) => this.traverseRange(e3))), e2;\n      }\n      traverseSequence(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e2))), this.traversals.sequence);\n      }\n      traverseSequenceItems(e2) {\n        return e2.canvases && (e2.canvases = e2.canvases.map((e3) => this.traverseCanvas(e3))), e2;\n      }\n      traverseCanvas(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e2))), this.traversals.canvas);\n      }\n      traverseCanvasItems(e2) {\n        return e2.images && (e2.images = e2.images.map((e3) => this.traverseAnnotation(e3))), e2.otherContent && (e2.otherContent = e2.otherContent.map((e3) => this.traverseAnnotationList(e3))), e2;\n      }\n      traverseRange(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e2))), this.traversals.range);\n      }\n      traverseRangeItems(e2) {\n        if (this.options.mergeMemberProperties) {\n          const t2 = [...(e2.ranges || []).map((e3) => \"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Range\" } : e3), ...(e2.canvases || []).map((e3) => \"string\" == typeof e3 ? { \"@id\": e3, \"@type\": \"sc:Canvas\" } : e3), ...e2.members || []];\n          delete e2.ranges, delete e2.canvases, e2.members = t2.length ? t2.map((e3) => this.traverseUnknown(e3)) : void 0;\n        }\n        return e2;\n      }\n      traverseAnnotationList(e2) {\n        const t2 = \"string\" == typeof e2 ? { \"@id\": e2, \"@type\": \"sc:AnnotationList\" } : e2;\n        return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t2)), this.traversals.annotationList);\n      }\n      traverseAnnotationListItems(e2) {\n        return e2.resources && (e2.resources = e2.resources.map((e3) => this.traverseAnnotation(e3))), e2;\n      }\n      traverseAnnotation(e2) {\n        return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e2))), this.traversals.annotation);\n      }\n      traverseAnnotationItems(e2) {\n        return e2.resource && (Array.isArray(e2.resource) ? e2.resource = e2.resource.map((e3) => this.traverseContentResource(e3)) : e2.resource = this.traverseContentResource(e2.resource)), e2.on, e2;\n      }\n      traverseLayer(e2) {\n        return this.traverseType(this.traverseLinking(this.traverseLayerItems(e2)), this.traversals.layer);\n      }\n      traverseLayerItems(e2) {\n        return e2.otherContent && (e2.otherContent = e2.otherContent.map((e3) => this.traverseAnnotationList(e3))), e2;\n      }\n      traverseChoice(e2) {\n        return this.traverseType(this.traverseChoiceItems(e2), this.traversals.choice);\n      }\n      traverseChoiceItems(e2) {\n        return e2.default && \"rdf:nil\" !== e2.default && (e2.default = this.traverseContentResource(e2.default)), e2.item && \"rdf:nil\" !== e2.item && (e2.item = e2.item.map((e3) => this.traverseContentResource(e3))), e2;\n      }\n      traverseService(e2) {\n        return this.traverseType(this.traverseLinking(e2), this.traversals.service);\n      }\n      traverseContentResource(e2) {\n        return \"oa:Choice\" === e2[\"@type\"] ? this.traverseChoice(e2) : this.traverseType(this.traverseDescriptive(this.traverseLinking(e2)), this.traversals.contentResource);\n      }\n      traverseUnknown(e2) {\n        if (!e2[\"@type\"] || \"string\" == typeof e2)\n          return e2;\n        switch (function(e3) {\n          if (null == e3)\n            throw new Error(\"Null or undefined is not a valid entity.\");\n          if (Array.isArray(e3))\n            throw new Error(\"Array is not a valid entity\");\n          if (\"object\" != typeof e3)\n            throw new Error(typeof e3 + \" is not a valid entity\");\n          if (\"string\" == typeof e3[\"@type\"]) {\n            const t2 = w.indexOf(e3[\"@type\"]);\n            if (-1 !== t2)\n              return w[t2];\n          }\n          if (e3.profile)\n            return \"Service\";\n          if (e3.format)\n            return \"ContentResource\";\n          if (e3[\"@type\"])\n            return \"ContentResource\";\n          throw new Error(\"Resource type is not known\");\n        }(e2)) {\n          case \"sc:Collection\":\n            return this.traverseCollection(e2);\n          case \"sc:Manifest\":\n            return this.traverseManifest(e2);\n          case \"sc:Canvas\":\n            return this.traverseCanvas(e2);\n          case \"sc:Sequence\":\n            return this.traverseSequence(e2);\n          case \"sc:Range\":\n            return this.traverseRange(e2);\n          case \"oa:Annotation\":\n            return this.traverseAnnotation(e2);\n          case \"sc:AnnotationList\":\n            return this.traverseAnnotationList(e2);\n          case \"sc:Layer\":\n            return this.traverseLayer(e2);\n          case \"Service\":\n            return this.traverseService(e2);\n          case \"oa:Choice\":\n            return this.traverseChoice(e2);\n          case \"ContentResource\":\n            return this.traverseContentResource(e2);\n        }\n        return e2.profile ? this.traverseService(e2) : e2;\n      }\n      traverseImageResource(e2) {\n        const t2 = Array.isArray(e2), i2 = Array.isArray(e2) ? e2 : [e2], r2 = [];\n        for (const n2 of i2)\n          \"string\" == typeof n2 ? r2.push(this.traverseContentResource({ \"@id\": n2, \"@type\": \"dctypes:Image\" })) : r2.push(this.traverseContentResource(n2));\n        return t2 || this.options.convertPropsToArray ? r2 : r2[0];\n      }\n      traverseDescriptive(e2) {\n        return e2.thumbnail && (e2.thumbnail = this.traverseImageResource(e2.thumbnail)), e2.logo && (e2.logo = this.traverseImageResource(e2.logo)), e2;\n      }\n      traverseOneOrMoreServices(e2) {\n        const t2 = Array.isArray(e2), i2 = Array.isArray(e2) ? e2 : [e2], r2 = [];\n        for (const n2 of i2)\n          r2.push(this.traverseService(n2));\n        return t2 || this.options.convertPropsToArray ? r2 : r2[0];\n      }\n      traverseLinking(e2) {\n        return e2.related && (e2.related = this.traverseOneOrManyType(e2.related, this.traversals.contentResource)), e2.rendering && (e2.rendering = this.traverseOneOrManyType(e2.rendering, this.traversals.contentResource)), e2.service && (e2.service = this.traverseOneOrMoreServices(e2.service)), e2.seeAlso && (e2.seeAlso = this.traverseOneOrManyType(e2.seeAlso, this.traversals.contentResource)), e2.within && (\"string\" == typeof e2.within || (e2.within = this.traverseOneOrManyType(e2.within, this.traversals.contentResource))), e2.startCanvas && (\"string\" == typeof e2.startCanvas ? e2.startCanvas = this.traverseType({ \"@id\": e2.startCanvas, \"@type\": \"sc:Canvas\" }, this.traversals.canvas) : e2.startCanvas && this.traverseType(e2.startCanvas, this.traversals.canvas)), e2.contentLayer && (\"string\" == typeof e2.contentLayer ? e2.contentLayer = this.traverseLayer({ \"@id\": e2.contentLayer, \"@type\": \"sc:Layer\" }) : e2.contentLayer = this.traverseLayer(e2.contentLayer)), e2;\n      }\n      traverseOneOrManyType(e2, t2) {\n        if (!Array.isArray(e2)) {\n          if (!this.options.convertPropsToArray)\n            return this.traverseType(e2, t2);\n          e2 = [e2];\n        }\n        return e2.map((e3) => this.traverseType(e3, t2));\n      }\n      traverseType(e2, t2) {\n        return t2.reduce((e3, t3) => {\n          const i2 = t3(e3);\n          return void 0 !== i2 || this.options.allowUndefinedReturn ? i2 : e3;\n        }, e2);\n      }\n    }\n    const S = \"Attribution\", j = \"http://example.org/provider\", R = \"Unknown\";\n    function I(e2, t2 = \"none\") {\n      if (!e2)\n        return {};\n      const i2 = Array.isArray(e2) ? e2 : [e2], r2 = {};\n      for (const n2 of i2) {\n        if (\"string\" == typeof n2) {\n          r2[t2] = r2[t2] ? r2[t2] : [], r2[t2].push(n2 || \"\");\n          continue;\n        }\n        if (!n2[\"@language\"]) {\n          r2[t2] = r2[t2] ? r2[t2] : [], r2[t2].push(n2[\"@value\"] || \"\");\n          continue;\n        }\n        const e3 = n2[\"@language\"];\n        r2[e3] = r2[e3] ? r2[e3] : [], r2[e3].push(n2[\"@value\"] || \"\");\n      }\n      return r2;\n    }\n    function T(e2) {\n      return Array.isArray(e2) ? T(e2.find((e3) => \"string\" == typeof e3)) : -1 !== x.indexOf(e2) ? \"level2\" : -1 !== C.indexOf(e2) ? \"level1\" : \"string\" == typeof e2 ? e2 : void 0;\n    }\n    function k(e2) {\n      for (const t2 of [\"sc\", \"oa\", \"dcterms\", \"dctypes\", \"iiif\"])\n        if (e2.startsWith(`${t2}:`))\n          return e2.slice(t2.length + 1);\n      return e2;\n    }\n    const O = [\"Collection\", \"Manifest\", \"Annotation\", \"AnnotationPage\", \"Range\", \"Service\"];\n    function M(e2) {\n      const t2 = e2[\"@id\"] || e2.id;\n      let i2 = e2[\"@type\"] || e2.type;\n      const r2 = e2.profile || void 0, n2 = e2[\"@context\"] || void 0;\n      if (r2) {\n        const e3 = function(e4) {\n          switch (e4) {\n            case \"http://iiif.io/api/image/2/level0.json\":\n            case \"http://iiif.io/api/image/2/level1.json\":\n            case \"http://iiif.io/api/image/2/level2.json\":\n              return \"ImageService2\";\n            case \"http://iiif.io/api/auth/1/kiosk\":\n            case \"http://iiif.io/api/auth/1/login\":\n            case \"http://iiif.io/api/auth/1/clickthrough\":\n            case \"http://iiif.io/api/auth/1/external\":\n            case \"http://iiif.io/api/auth/0/kiosk\":\n            case \"http://iiif.io/api/auth/0/login\":\n            case \"http://iiif.io/api/auth/0/clickthrough\":\n            case \"http://iiif.io/api/auth/0/external\":\n              return \"AuthCookieService1\";\n            case \"http://iiif.io/api/auth/1/token\":\n            case \"http://iiif.io/api/auth/0/token\":\n              return \"AuthTokenService1\";\n            case \"http://iiif.io/api/auth/1/logout\":\n            case \"http://iiif.io/api/auth/0/logout\":\n              return \"AuthLogoutService1\";\n            case \"http://iiif.io/api/search/1/search\":\n            case \"http://iiif.io/api/search/0/search\":\n              return \"SearchService1\";\n            case \"http://iiif.io/api/search/1/autocomplete\":\n            case \"http://iiif.io/api/search/0/autocomplete\":\n              return \"AutoCompleteService1\";\n          }\n        }(r2);\n        if (e3)\n          return e3;\n      }\n      if (n2) {\n        const e3 = function(e4) {\n          const t3 = Array.isArray(e4) ? e4 : [e4];\n          for (const i3 of t3)\n            switch (i3) {\n              case \"http://iiif.io/api/image/2/context.json\":\n              case \"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2\":\n                return \"ImageService2\";\n              case \"http://iiif.io/api/image/1/context.json\":\n              case \"http://library.stanford.edu/iiif/image-api/1.1/context.json\":\n                return \"ImageService1\";\n              case \"http://iiif.io/api/annex/openannotation/context.json\":\n                return \"ImageApiSelector\";\n            }\n        }(n2);\n        if (e3)\n          return e3;\n      }\n      if (i2) {\n        if (Array.isArray(i2)) {\n          if (-1 !== i2.indexOf(\"oa:CssStylesheet\"))\n            return \"CssStylesheet\";\n          if (-1 !== i2.indexOf(\"cnt:ContentAsText\"))\n            return \"TextualBody\";\n          i2 = i2[0];\n        }\n        for (const e3 of [\"sc\", \"oa\", \"dcterms\", \"dctypes\", \"iiif\"])\n          if (i2.startsWith(`${e3}:`)) {\n            i2 = i2.slice(e3.length + 1);\n            break;\n          }\n        switch (i2) {\n          case \"Layer\":\n            return \"AnnotationCollection\";\n          case \"AnnotationList\":\n            return \"AnnotationPage\";\n          case \"cnt:ContentAsText\":\n            return \"TextualBody\";\n        }\n      }\n      if (i2 && -1 !== O.indexOf(i2))\n        return i2;\n      if (e2.format) {\n        if (e2.format.startsWith(\"image/\"))\n          return \"Image\";\n        if (e2.format.startsWith(\"text/\"))\n          return \"Text\";\n        if (\"application/pdf\" === e2.format)\n          return \"Text\";\n        if (e2.format.startsWith(\"application/\"))\n          return \"Dataset\";\n      }\n      return t2 && (t2.endsWith(\".jpg\") || t2.endsWith(\".png\") || t2.endsWith(\".jpeg\")) ? \"Image\" : i2 || \"unknown\";\n    }\n    const q = /http(s)?:\\/\\/(creativecommons.org|rightsstatements.org)[^\"'\\\\<\\n]+/gm;\n    function P(e2) {\n      const t2 = e2.match(q);\n      return t2 ? t2[0] : e2;\n    }\n    const _ = [\"http://iiif.io/api/presentation/2/context.json\", \"http://iiif.io/api/image/2/context.json\", \"http://iiif.io/api/image/1/context.json\", \"http://library.stanford.edu/iiif/image-api/1.1/context.json\", \"http://iiif.io/api/search/1/context.json\", \"http://iiif.io/api/search/0/context.json\", \"http://iiif.io/api/auth/1/context.json\", \"http://iiif.io/api/auth/0/context.json\", \"http://iiif.io/api/annex/openannotation/context.json\"];\n    function D(e2) {\n      if (e2) {\n        const t2 = Array.isArray(e2) ? e2 : [e2], i2 = [];\n        for (const e3 of t2)\n          \"http://iiif.io/api/presentation/2/context.json\" === e3 && i2.push(\"http://iiif.io/api/presentation/3/context.json\"), -1 === _.indexOf(e3) && i2.push(e3);\n        if (t2.length)\n          return 1 === i2.length ? i2[0] : i2;\n      }\n    }\n    function U(e2) {\n      for (const t2 in e2)\n        void 0 !== e2[t2] && null !== e2[t2] || delete e2[t2];\n      return e2;\n    }\n    let $ = 0;\n    function W(e2, t2) {\n      const i2 = encodeURI(e2.id || e2[\"@id\"] || \"\").trim();\n      return i2 && t2 ? `${i2}/${t2}` : i2 || ($++, `http://example.org/${e2[\"@type\"]}${t2 ? `/${t2}` : \"\"}/${$}`);\n    }\n    function E(e2) {\n      const t2 = [...e2.behavior || []];\n      let i2;\n      return e2.viewingHint && t2.push(e2.viewingHint), Array.isArray(e2.motivation) ? i2 = e2.motivation.map(k) : e2.motivation && (i2 = k(e2.motivation)), { \"@context\": e2[\"@context\"] ? D(e2[\"@context\"]) : void 0, id: (e2[\"@id\"] || W(e2)).trim(), type: M(e2), behavior: t2.length ? t2 : void 0, height: e2.height ? e2.height : void 0, width: e2.width ? e2.width : void 0, motivation: i2, viewingDirection: e2.viewingDirection, profile: e2.profile, format: e2.format ? e2.format : void 0, duration: void 0, timeMode: void 0 };\n    }\n    function F(e2) {\n      const [t2, i2] = function(e3, t3 = \"Rights/License\", i3 = \"none\") {\n        let r3 = null;\n        const n3 = [], s2 = Array.isArray(e3) ? e3 : [e3];\n        for (const a2 of s2) {\n          const e4 = a2 ? P(a2) : void 0;\n          !e4 || -1 === e4.indexOf(\"creativecommons.org\") && -1 === e4.indexOf(\"rightsstatements.org\") ? e4 && n3.push({ label: { [i3]: [t3] }, value: { [i3]: [e4] } }) : r3 = e4.startsWith(\"https://\") ? `http://${e4.slice(8)}` : e4;\n        }\n        return [r3, n3];\n      }(e2.license), r2 = [...e2.metadata ? (n2 = e2.metadata, n2 ? n2.map((e3) => ({ label: I(e3.label), value: I(e3.value) })) : []) : [], ...i2];\n      var n2;\n      return { rights: t2, metadata: r2.length ? r2 : void 0, label: e2.label ? I(e2.label) : void 0, requiredStatement: e2.attribution ? { label: I(S), value: I(e2.attribution) } : void 0, navDate: e2.navDate, summary: e2.description ? I(e2.description) : void 0, thumbnail: e2.thumbnail };\n    }\n    function H(e2) {\n      if (!e2.within)\n        return;\n      const t2 = Array.isArray(e2.within) ? e2.within : [e2.within], i2 = [];\n      for (const r2 of t2)\n        if (\"string\" == typeof r2) {\n          if (r2 && \"sc:Manifest\" === e2[\"@type\"])\n            i2.push({ id: r2, type: \"Collection\" });\n        } else\n          r2[\"@id\"] && i2.push({ id: r2[\"@id\"], type: M(r2) });\n      return i2.length ? i2 : void 0;\n    }\n    function N(e2) {\n      const t2 = e2.related ? Array.isArray(e2.related) ? e2.related : [e2.related] : [], i2 = e2.contentLayer;\n      return { provider: e2.logo || t2.length ? [{ id: j, type: \"Agent\", homepage: t2.length ? [t2[0]] : void 0, logo: e2.logo ? Array.isArray(e2.logo) ? e2.logo : [e2.logo] : void 0, label: I(R) }] : void 0, partOf: H(e2), rendering: e2.rendering, seeAlso: e2.seeAlso, start: e2.startCanvas, service: e2.service ? (r2 = e2.service, Array.isArray(r2) ? r2 : [r2]) : void 0, supplementary: i2 ? [i2] : void 0 };\n      var r2;\n    }\n    function B(e2) {\n      const t2 = e2;\n      return U({ ...E(t2), ...F(t2), ...N(t2), ...(i2 = t2, { chars: i2.chars, format: i2.format ? i2.format : void 0, language: i2.language }) });\n      var i2;\n    }\n    const z = new L({ collection: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2), items: e2.members });\n    }], manifest: [function(e2) {\n      const t2 = [], i2 = [];\n      for (const n2 of e2.sequences || [])\n        n2.canvases.length && t2.push(...n2.canvases), n2.behavior && i2.push(...n2.behavior);\n      const r2 = E(e2);\n      return i2.length && (r2.behavior ? r2.behavior.push(...i2) : r2.behavior = i2), U({ ...r2, ...F(e2), ...N(e2), items: t2, structures: e2.structures });\n    }], canvas: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2), annotations: e2.otherContent && e2.otherContent.length ? e2.otherContent : void 0, items: e2.images && e2.images.length ? [{ id: W(e2, \"annotation-page\"), type: \"AnnotationPage\", items: e2.images }] : void 0 });\n    }], annotationList: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2), items: e2.resources && e2.resources.length ? e2.resources : void 0 });\n    }], sequence: [function(e2) {\n      return e2.canvases && 0 !== e2.canvases.length ? { canvases: e2.canvases, behavior: e2.viewingHint ? [e2.viewingHint] : [] } : { canvases: [], behavior: [] };\n    }], annotation: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2), target: function e3(t2) {\n        if (Array.isArray(t2)) {\n          if (t2.length > 1)\n            return { type: \"List\", items: t2.map(e3) };\n          t2 = t2[0];\n        }\n        if (\"string\" == typeof t2)\n          return encodeURI(t2).trim();\n        if (\"@type\" in t2) {\n          let e4;\n          if (\"string\" == typeof t2.full)\n            e4 = t2.full;\n          else if (\"dctypes:Image\" === t2.full[\"@type\"])\n            e4 = { id: t2.full[\"@id\"], type: \"Image\" };\n          else {\n            if (\"sc:Canvas\" !== t2.full[\"@type\"])\n              throw new Error(`Unsupported source type on annotation: ${t2.full[\"@type\"]}`);\n            e4 = { id: t2.full[\"@id\"], type: \"Canvas\" };\n          }\n          return { type: \"SpecificResource\", source: e4, selector: G(t2.selector) };\n        }\n        return encodeURI(t2[\"@id\"]).trim();\n      }(e2.on), body: Array.isArray(e2.resource) ? e2.resource.map(B) : B(e2.resource) });\n    }], contentResource: [B], choice: [function(e2) {\n      const t2 = [];\n      return e2.default && \"rdf:nil\" !== e2.default && t2.push(e2.default), e2.item && \"rdf:nil\" !== e2.item && t2.push(...e2.item), { ...E(e2), ...F(e2), items: t2 };\n    }], range: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2), items: e2.members });\n    }], service: [function(e2) {\n      const { \"@id\": t2, \"@type\": i2, \"@context\": r2, profile: n2, ...s2 } = e2, a2 = {};\n      return t2 && (a2[\"@id\"] = t2), a2[\"@type\"] = M(e2), \"unknown\" === a2[\"@type\"] && (r2 && r2.length && (a2[\"@context\"] = r2), a2[\"@type\"] = \"Service\"), n2 && (a2.profile = T(n2)), U({ ...a2, ...s2 });\n    }], layer: [function(e2) {\n      return U({ ...E(e2), ...F(e2), ...N(e2) });\n    }] });\n    function G(e2) {\n      if ((Array.isArray(e2[\"@type\"]) && e2[\"@type\"].includes(\"oa:SvgSelector\") || \"oa:SvgSelector\" == e2[\"@type\"]) && (\"chars\" in e2 || \"value\" in e2))\n        return { type: \"SvgSelector\", value: \"chars\" in e2 ? e2.chars : e2.value };\n      if (\"oa:FragmentSelector\" === e2[\"@type\"])\n        return { type: \"FragmentSelector\", value: e2.value };\n      if (\"oa:Choice\" === e2[\"@type\"])\n        return [G(e2.default), ...(Array.isArray(e2.item) ? e2.item : [e2.item]).map(G)];\n      if (\"iiif:ImageApiSelector\" == e2[\"@type\"])\n        return { type: \"ImageApiSelector\", region: \"region\" in e2 ? e2.region : void 0, rotation: \"rotation\" in e2 ? e2.rotation : void 0 };\n      throw new Error(`Unsupported selector type: ${e2[\"@type\"]}`);\n    }\n    const J = function(e2) {\n      return e2 && e2[\"@context\"] && (\"http://iiif.io/api/presentation/2/context.json\" === e2[\"@context\"] || -1 !== e2[\"@context\"].indexOf(\"http://iiif.io/api/presentation/2/context.json\") || \"http://www.shared-canvas.org/ns/context.json\" === e2[\"@context\"]) || \"http://iiif.io/api/image/2/context.json\" === e2[\"@context\"] ? z.traverseUnknown(e2) : e2;\n    };\n    e.upgrade = J, Object.defineProperties(e, { __esModule: { value: true }, [Symbol.toStringTag]: { value: \"Module\" } });\n  });\n})(index_umd, index_umd.exports);\nfunction fetchAndUpgrade(input, init) {\n  return fetch(input, init).then((resp) => resp.json()).then(index_umd.exports.upgrade);\n}\nexport { fetchAndUpgrade as fetch };\n//# sourceMappingURL=fetch.mjs.map\n","import * as Presentation3 from '@iiif/presentation-3';\n\nimport React, { ReactNode, createContext, useContext, useEffect, useMemo, useState } from 'react';\n\nimport { Orientation } from 'src/types/options';\nimport { fetch } from '@iiif/vault-helpers/fetch';\n\ninterface IIIFContentContext {\n  currentResourceId: string | undefined;\n  error: string | any | null;\n  isLoaded: boolean;\n  orientation: Orientation;\n  resource?: Presentation3.Manifest | Presentation3.Collection;\n}\n\nexport const ReactContext = createContext<IIIFContentContext>({\n  currentResourceId: undefined,\n  error: null,\n  isLoaded: false,\n  orientation: 'vertical',\n  resource: undefined,\n});\n\nexport function useThumbnailPanelContext() {\n  return useContext(ReactContext);\n}\n\nexport function IIIFContentProvider(props: {\n  resource: string | any;\n  children: ReactNode;\n  overrides?: Partial<Presentation3.Manifest | Presentation3.Collection>;\n  currentResourceId: string | undefined;\n  orientation: Orientation;\n  onLoad?: (resource?: Presentation3.Manifest | Presentation3.Collection) => void;\n  onResourceChanged?: (resourceId: string) => void;\n}) {\n  const { currentResourceId, orientation, onLoad, overrides } = props;\n  const [resource, setResource] = useState<Presentation3.Manifest | Presentation3.Collection>();\n  const mergedResource = useMemo(() => {\n    if (!overrides || !resource) {\n      return resource;\n    }\n\n    const values = Object.fromEntries(Object.entries(overrides).filter(([, value]) => typeof value !== 'undefined'));\n\n    return Object.assign({}, resource, values || {});\n  }, [resource, ...Object.values(overrides || {})]);\n  const [error, setError] = useState(false);\n\n  useEffect(() => {\n    if (!props.resource) {\n      return;\n    }\n\n    if (typeof props.resource === 'string') {\n      const controller = new AbortController();\n\n      fetch(props.resource, { signal: controller.signal })\n        .then((json) => {\n          setResource(json as any);\n          if (onLoad) {\n            onLoad(json);\n          }\n        })\n        .catch((e) => setError(e));\n\n      return () => {\n        controller.abort();\n      };\n    } else {\n      setResource(props.resource);\n      if (onLoad) {\n        onLoad(props.resource);\n      }\n    }\n  }, [props.resource]);\n\n  const value = useMemo(() => {\n    return { resource: mergedResource, error, isLoaded: !!resource, orientation, currentResourceId };\n  }, [mergedResource, error, orientation, currentResourceId]);\n\n  return <ReactContext.Provider value={value}>{props.children}</ReactContext.Provider>;\n}\n","import { Canvas, Collection, Manifest } from '@iiif/presentation-3';\nimport React, { useEffect, useState } from 'react';\n\nimport { createThumbnailHelper } from '@iiif/vault-helpers';\nimport { useThumbnailPanelContext } from '../context/IIIFResourceContext';\n\ninterface ThumbnailProps {\n  item: Canvas | Collection | Manifest;\n  onClick?: (resourceId?: string) => void;\n}\n\nexport const Thumbnail: React.FC<ThumbnailProps> = ({ item, onClick }) => {\n  const helper = createThumbnailHelper(); // no vault\n  const [thumb, setThumb] = useState<any>();\n  const { resource } = useThumbnailPanelContext();\n  const thumbnailSize = (resource as any)?.thumbnailSize || 200;\n\n  useEffect(() => {\n    async function getData() {\n      const response = await helper.getBestThumbnailAtSize(item as any, {\n        width: thumbnailSize,\n        height: thumbnailSize,\n      });\n      setThumb(response.best as any);\n    }\n\n    item && getData();\n  }, [item]);\n\n  return (\n    <button\n      data-testid=\"thumbnail-wrapper\"\n      onClick={() => {\n        if (onClick) {\n          onClick(resource?.id);\n        }\n      }}\n    >\n      <figure>\n        <div\n          style={{\n            backgroundColor: '#f0f0f0',\n            width: `${thumbnailSize}px`,\n            height: `${thumbnailSize}px`,\n            objectFit: 'contain',\n          }}\n        >\n          {thumb ? (\n            <img src={thumb.id} alt=\"\" style={{ maxWidth: '100%', maxHeight: '100%' }} data-testid=\"thumb-image\" />\n          ) : (\n            <></>\n          )}\n        </div>\n        <figcaption>{item.id}</figcaption>\n      </figure>\n    </button>\n  );\n};\n","const metaState = {};\nconst compatVault = {\n  get(nonRef) {\n    return nonRef;\n  },\n  setMetaValue([id, meta, key], value) {\n    const oldValue = compatVault.getResourceMeta(id, meta);\n    const oldValueItem = oldValue ? oldValue[key] : void 0;\n    const newValue = typeof value === \"function\" ? value(oldValueItem) : value;\n    metaState[id] = {\n      ...metaState[id] || {},\n      [meta]: {\n        ...(metaState[id] || {})[meta] || {},\n        [key]: newValue\n      }\n    };\n  },\n  getResourceMeta: (resource, metaKey) => {\n    const resourceMeta = metaState[resource];\n    if (!resourceMeta) {\n      return void 0;\n    }\n    if (!metaKey) {\n      return resourceMeta;\n    }\n    return resourceMeta[metaKey];\n  }\n};\nfunction findAllCanvasesInRange(vault, range) {\n  const found = [];\n  for (const inner of range.items) {\n    if (inner.type === \"Canvas\") {\n      if (inner.id.indexOf(\"#\") !== -1) {\n        found.push({ id: inner.id.split(\"#\")[0], type: \"Canvas\" });\n      } else {\n        found.push(inner);\n      }\n    }\n    if (inner.type === \"Range\") {\n      found.push(...findAllCanvasesInRange(vault, vault.get(inner)));\n    }\n    if (inner.type === \"SpecificResource\") {\n      const sourceId = typeof inner.source === \"string\" ? inner.source : inner.source.id;\n      found.push({ id: sourceId, type: \"Canvas\" });\n    }\n  }\n  return found;\n}\nfunction createSequenceHelper(vault = compatVault) {\n  return {\n    getVisibleCanvasesFromCanvasId: (manifestOrRange, canvasId, preventPaged = false) => getVisibleCanvasesFromCanvasId(vault, manifestOrRange, canvasId, preventPaged),\n    getManifestSequence: (manifestOrRange, options = {}) => getManifestSequence(vault, manifestOrRange, options)\n  };\n}\nfunction getVisibleCanvasesFromCanvasId(vault = compatVault, manifestOrRange, canvasId, preventPaged = false) {\n  const behavior = manifestOrRange.behavior || [];\n  const fullCanvas = canvasId ? vault.get(canvasId) : null;\n  if (!fullCanvas) {\n    return [];\n  }\n  const canvasBehavior = fullCanvas.behavior || [];\n  const isPaged = preventPaged ? false : behavior.includes(\"paged\");\n  const isContinuous = isPaged ? false : behavior.includes(\"continuous\");\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes(\"individuals\");\n  const isCanvasFacingPages = canvasBehavior.includes(\"facing-pages\");\n  const isCanvasNonPaged = canvasBehavior.includes(\"non-paged\");\n  if (isCanvasFacingPages || isCanvasNonPaged || isIndividuals || preventPaged) {\n    return [{ id: fullCanvas.id, type: \"Canvas\" }];\n  }\n  const [manifestItems, ordering] = getManifestSequence(vault, manifestOrRange);\n  if (isContinuous) {\n    return manifestItems;\n  }\n  const canvasIndex = manifestItems.findIndex((r) => r.id === canvasId);\n  if (canvasIndex === -1) {\n    return [];\n  }\n  for (const indexes of ordering) {\n    if (indexes.includes(canvasIndex)) {\n      return indexes.map((index) => manifestItems[index]);\n    }\n  }\n  return [{ id: fullCanvas.id, type: \"Canvas\" }];\n}\nfunction getManifestSequence(vault = compatVault, manifestOrRange, { disablePaging, skipNonPaged } = {}) {\n  const behavior = manifestOrRange.behavior || [];\n  const isPaged = behavior.includes(\"paged\");\n  const isContinuous = isPaged ? false : behavior.includes(\"continuous\");\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes(\"individuals\");\n  const manifestItems = manifestOrRange.type === \"Manifest\" ? manifestOrRange.items : findAllCanvasesInRange(vault, manifestOrRange);\n  if (isContinuous) {\n    return [manifestItems, [manifestItems.map((_, index) => index)]];\n  }\n  if (isIndividuals || !isPaged || disablePaging) {\n    return [manifestItems, manifestItems.map((_, index) => [index])];\n  }\n  const ordering = [];\n  let currentOrdering = [];\n  const flush = () => {\n    if (currentOrdering.length) {\n      ordering.push([...currentOrdering]);\n      currentOrdering = [];\n    }\n  };\n  let offset = 0;\n  let flushNextPaged = false;\n  for (let i = 0; i < manifestItems.length; i++) {\n    const canvas = vault.get(manifestItems[i]);\n    const canvasBehavior = canvas.behavior || [];\n    if (canvasBehavior.includes(\"non-paged\")) {\n      if (i === offset) {\n        offset++;\n      }\n      if (!skipNonPaged) {\n        flush();\n        ordering.push([i]);\n        flush();\n      }\n      continue;\n    }\n    if (i === offset || canvasBehavior.includes(\"facing-pages\")) {\n      if (currentOrdering.length) {\n        flushNextPaged = true;\n      }\n      flush();\n      ordering.push([i]);\n      flush();\n      continue;\n    }\n    currentOrdering.push(i);\n    if (flushNextPaged) {\n      flush();\n      flushNextPaged = false;\n      continue;\n    }\n    if (currentOrdering.length > 1) {\n      flush();\n    }\n  }\n  if (currentOrdering.length) {\n    flush();\n  }\n  return [manifestItems, ordering];\n}\nexport { createSequenceHelper, getManifestSequence, getVisibleCanvasesFromCanvasId };\n//# sourceMappingURL=sequences.mjs.map\n","import '../style.css';\n\nimport * as Presentation3 from '@iiif/presentation-3';\n\nimport { IIIFContentProvider, useThumbnailPanelContext } from '../context/IIIFResourceContext';\nimport React, { useMemo } from 'react';\n\nimport { Orientation } from 'src/types/options';\nimport { Thumbnail } from './Thumbnail';\nimport { createSequenceHelper } from '@iiif/vault-helpers/sequences';\nimport { getValue } from '@iiif/vault-helpers';\n\ntype OnResourceChanged = (resourceId?: string) => void;\ninterface ItemsProps {\n  onResourceChanged?: OnResourceChanged;\n}\n\nconst Items: React.FC<ItemsProps> = ({ onResourceChanged }) => {\n  const { resource, isLoaded, currentResourceId, orientation } = useThumbnailPanelContext();\n  const sequence = createSequenceHelper();\n\n  const [items, seq] = useMemo(() => {\n    if (!resource) {\n      return [];\n    }\n    //ignore type checking on resource (expecting ManifestNormalized)\n    //@ts-ignore\n    const [items, seq] = sequence.getManifestSequence(resource, {\n      disablePaging: false,\n    });\n\n    // if (resource.viewingDirection === 'bottom-to-top') {\n    //   return [items, seq.reverse()]\n    // }\n\n    return [items, seq];\n  }, [resource]);\n\n  if (!isLoaded || !resource || !seq || !items) {\n    return <></>;\n  }\n\n  const dir = resource.viewingDirection === 'left-to-right' ? 'ltr' : 'rtl';\n\n  const onKeyDown = (e: any) => {\n    if (e.keyCode === 40) {\n      const next = 1 + Number(e.currentTarget.getAttribute('data-index'));\n      `div[data-index=\"${next}\"]`;\n      const nextElement = (e.currentTarget as HTMLDivElement).parentElement?.parentElement?.querySelector(\n        `div[data-index=\"${next}\"]`\n      ) as HTMLElement;\n      nextElement.focus();\n    }\n  };\n\n  const isCurrentGroup = (groupIdx: number) => {\n    const foundIdx = seq.findIndex((group) => {\n      const resourceIdx = items.findIndex((resource) => {\n        return resource.id === currentResourceId;\n      });\n      return group.includes(resourceIdx);\n    });\n\n    return foundIdx === groupIdx;\n  };\n\n  return (\n    <div dir={dir} thumbnail-panel=\"\" data-orientation={orientation}>\n      <h3>{getValue(resource.label)}</h3>\n      <span>{orientation}</span>\n\n      {seq.map((group, groupIdx) => {\n        // console.log('group', group);\n        return (\n          <div thumbnail-group=\"\" key={groupIdx} data-selected={isCurrentGroup(groupIdx)}>\n            {group.map((idx, itemIdx) => (\n              <div\n                thumbnail-item=\"\"\n                tabIndex={idx === 0 ? 0 : -1}\n                key={itemIdx}\n                data-index={idx}\n                onKeyDown={onKeyDown}\n                data-selected={currentResourceId === items[idx]?.id}\n              >\n                <Thumbnail\n                  key={idx}\n                  item={items[idx]}\n                  onClick={() => {\n                    // todo: set state\n                    if (onResourceChanged) {\n                      // console.log(idx);\n                      onResourceChanged(items[idx]?.id);\n                    }\n                  }}\n                />\n              </div>\n            ))}\n          </div>\n        );\n      })}\n\n      {/* <p>{resource.behavior}</p>\n      <p>{resource.viewingDirection || 'left-to-right'}</p>\n      {resource?.items.map((item, index) => (\n        <>\n          <Thumbnail key={index} item={item} />\n        </>\n      ))} */}\n    </div>\n  );\n};\n\ninterface ThumbnailPanelProps {\n  currentResourceId: string | undefined;\n  iiifContent: string;\n  onLoad?: (resource: any) => void;\n  onResourceChanged?: OnResourceChanged;\n  orientation: Orientation;\n  overrides?: Partial<Presentation3.Collection | Presentation3.Manifest>;\n}\n\nexport const ThumbnailPanel: React.FC<ThumbnailPanelProps> = ({\n  iiifContent,\n  orientation,\n  currentResourceId,\n  overrides,\n  onLoad,\n  onResourceChanged,\n}) => {\n  return (\n    <IIIFContentProvider\n      resource={iiifContent}\n      overrides={overrides}\n      orientation={orientation}\n      currentResourceId={currentResourceId}\n      onLoad={onLoad}\n    >\n      <Items onResourceChanged={onResourceChanged} />\n    </IIIFContentProvider>\n  );\n};\n"],"names":["l","Symbol","for","n","p","q","r","t","u","v","w","x","y","z","iterator","B","isMounted","enqueueForceUpdate","enqueueReplaceState","enqueueSetState","C","Object","assign","D","E","a","b","e","this","props","context","refs","updater","F","G","E$1","prototype","isReactComponent","setState","Error","forceUpdate","H","constructor","isPureReactComponent","I","Array","isArray","J","hasOwnProperty","K","current","L","key","ref","__self","__source","M","d","c","k","h","call","g","arguments","length","children","f","m","defaultProps","$$typeof","type","_owner","O","P","Q","replace","escape","toString","R","N","push","A","next","done","value","String","keys","join","S","T","_status","_result","then","default","U","V","transition","W","ReactCurrentDispatcher","ReactCurrentBatchConfig","ReactCurrentOwner","react_production_min","Children","map","forEach","apply","count","toArray","only","Component","Fragment","Profiler","StrictMode","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","cloneElement","J$1","createContext","_currentValue","_currentValue2","_threadCount","Provider","Consumer","_defaultValue","_globalName","_context","createElement","bind","createRef","forwardRef","render","isValidElement","lazy","_payload","_init","memo","compare","startTransition","unstable_act","useCallback","useContext","useDebugValue","useDeferredValue","useEffect","useId","useImperativeHandle","useInsertionEffect","useLayoutEffect","useMemo","useReducer","useRef","useState","useSyncExternalStore","useTransition","version","exports","require$$0","reactJsxRuntime_production_min","jsx","jsxs","module","metaState","compatVault","get","nonRef","setMetaValue","id","meta","oldValue","getResourceMeta","oldValueItem","newValue","resource","metaKey","resourceMeta","i","endsWith","j","$","ce","extraFormats","extraQualities","extraFeatures","de","ge","pe","indexOf","me","full","square","startsWith","substr","split","parseFloat","percent","xe","upscaled","max","confined","slice","serialiseAsFull","percentScale","trim","width","parseInt","height","Ie","angle","mirror","Number","isNaN","_e","path","scheme","server","prefix","s","match","ye","reverse","o","filter","Boolean","identifier","originalPath","region","size","rotation","quality","format","we","profile","formats","qualities","supports","maxHeight","maxWidth","maxArea","Se","ve","Math","floor","includes","X","Oe","Fe","minWidth","minHeight","level","tiles","Y","Ae","ze","unsafe","Ee","sizes","ee","service","Le","Me","We","Ve","defineProperty","De","defineProperties","Ue","getOwnPropertyDescriptors","je","getOwnPropertySymbols","Je","Ze","propertyIsEnumerable","$e","enumerable","configurable","writable","Ce","ceil","Be","unsafeImageService","atAnyCost","fallback","returnAllOptions","preferFixedSize","allowUnsafe","explain","fill","JSON","stringify","abs","Pe","best","log","qe","ei","ii","Ne","ti","ni","Re","ri","si","He","scaleFactors","Ge","_","Promise","throw","resolve","ke","config","verificationsRequired","approximateServices","enableFetching","disableThrottling","fetchingCount","imageServices","knownImageServers","setConfig","sample","real","verify","verifications","malformed","root","preLoaded","sampledId","verified","result","sampledProfile","resourceServiceRatio","sampledSizes","sizeRatios","sampledTiles","preLoad","predict","source","protocol","round","getThumbnailFromResource","getImageCandidates","loadService","canLoadSync","loadServiceSync","be","fetchService","Te","markAsMalformed","fetch","json","setTimeout","getValue","inputText","options","i18nLanguage","strictFallback","defaultText","separator","fallbackLanguages","closest","languages","language","i18nLanguages","lang","inverseIdx","root2","inverseIdx2","getClosestLanguage","candidateText","buildLocaleString","navigator","globalThis","window","global","self","__defProp","__publicField","index_umd","__defNormalProp","e2","t2","traversals","collection","manifest","canvas","annotationList","sequence","annotation","contentResource","choice","range","layer","convertPropsToArray","mergeMemberProperties","allowUndefinedReturn","static","traverseCollection","traverseType","traverseDescriptive","traverseLinking","traverseCollectionItems","manifests","e3","collections","members","traverseManifest","traverseUnknown","traverseManifestItems","sequences","traverseSequence","structures","traverseRange","traverseSequenceItems","canvases","traverseCanvas","traverseCanvasItems","images","traverseAnnotation","otherContent","traverseAnnotationList","traverseRangeItems","ranges","traverseAnnotationListItems","resources","traverseAnnotationItems","traverseContentResource","on","traverseLayer","traverseLayerItems","traverseChoice","traverseChoiceItems","item","traverseService","traverseImageResource","i2","r2","n2","thumbnail","logo","traverseOneOrMoreServices","related","traverseOneOrManyType","rendering","seeAlso","within","startCanvas","contentLayer","reduce","t3","find","e4","i3","encodeURI","behavior","viewingHint","motivation","viewingDirection","duration","timeMode","r3","n3","s2","a2","label","license","metadata","rights","requiredStatement","attribution","navDate","summary","description","provider","homepage","partOf","start","supplementary","chars","items","annotations","target","selector","body","upgrade","__esModule","toStringTag","ReactContext","currentResourceId","error","isLoaded","orientation","useThumbnailPanelContext","IIIFContentProvider","onLoad","overrides","setResource","mergedResource","values","fromEntries","entries","setError","controller","AbortController","input","init","signal","resp","catch","abort","Thumbnail","onClick","helper","vault","dependencies","imageServiceLoader","getBestThumbnailAtSize","async","request","dereference","candidates","dimensions","thumbnailNotFound","fixed","fullInput","skipSelfReturn","potentialThumbnails","parseThumbnail","contentResources","firstContentResources","firstManifest","firstCanvas","createThumbnailHelper","thumb","setThumb","thumbnailSize","response","getData","style","backgroundColor","objectFit","src","alt","findAllCanvasesInRange","found","inner","sourceId","createSequenceHelper","getVisibleCanvasesFromCanvasId","manifestOrRange","canvasId","preventPaged","fullCanvas","canvasBehavior","isPaged","isContinuous","isIndividuals","isCanvasFacingPages","isCanvasNonPaged","manifestItems","ordering","getManifestSequence","canvasIndex","findIndex","indexes","index","disablePaging","skipNonPaged","currentOrdering","flush","offset","flushNextPaged","Items","onResourceChanged","seq","dir","onKeyDown","keyCode","currentTarget","getAttribute","_b","_a","parentElement","querySelector","focus","isCurrentGroup","groupIdx","group","resourceIdx","idx","itemIdx","tabIndex","iiifContent"],"mappings":"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"}